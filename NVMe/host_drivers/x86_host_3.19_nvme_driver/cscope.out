cscope 15 $HOME/Vki/NXP_PJT_1/fslu_nvme_sdk_ear6/x86_host_3.19_nvme_driver               0000269199
	@nvme-core.c

15 
	~<löux/nvme.h
>

16 
	~<löux/bô›s.h
>

17 
	~<löux/blkdev.h
>

18 
	~<löux/blk-mq.h
>

19 
	~<löux/˝u.h
>

20 
	~<löux/dñay.h
>

21 
	~<löux/î∫o.h
>

22 
	~<löux/fs.h
>

23 
	~<löux/gíhd.h
>

24 
	~<löux/hdªg.h
>

25 
	~<löux/idr.h
>

26 
	~<löux/öô.h
>

27 
	~<löux/öãºu±.h
>

28 
	~<löux/io.h
>

29 
	~<löux/kdev_t.h
>

30 
	~<löux/kthªad.h
>

31 
	~<löux/kî√l.h
>

32 
	~<löux/mm.h
>

33 
	~<löux/moduÀ.h
>

34 
	~<löux/moduÀ∑øm.h
>

35 
	~<löux/pci.h
>

36 
	~<löux/pois⁄.h
>

37 
	~<löux/±ø˚.h
>

38 
	~<löux/sched.h
>

39 
	~<löux/¶ab.h
>

40 
	~<löux/ty≥s.h
>

41 
	~<scsi/sg.h
>

42 
	~<asm-gíîic/io-64-n⁄©omic-lo-hi.h
>

44 
	#NVME_Q_DEPTH
 1024

	)

45 
	#NVME_AQ_DEPTH
 64

	)

46 
	#SQ_SIZE
(
dïth
Ë(dïth * (
nvme_comm™d
))

	)

47 
	#CQ_SIZE
(
dïth
Ë(dïth * (
nvme_com∂ëi⁄
))

	)

48 
	#ADMIN_TIMEOUT
 (
admö_timeout
 * 
HZ
)

	)

49 
	#SHUTDOWN_TIMEOUT
 (
shutdown_timeout
 * 
HZ
)

	)

50 
	#IOD_TIMEOUT
 (
ªåy_time
 * 
HZ
)

	)

52 
	gadmö_timeout
 = 60;

53 
moduÀ_∑øm
(
admö_timeout
, 
byã
, 0644);

54 
MODULE_PARM_DESC
(
admö_timeout
, "timeout in seconds forádmin commands");

56 
	gnvme_io_timeout
 = 30;

57 
moduÀ_∑øm_«med
(
io_timeout
, 
nvme_io_timeout
, 
byã
, 0644);

58 
MODULE_PARM_DESC
(
io_timeout
, "timeout in seconds for I/O");

60 
	gªåy_time
 = 30;

61 
moduÀ_∑øm
(
ªåy_time
, 
byã
, 0644);

62 
MODULE_PARM_DESC
(
ªåy_time
, "time in secondsÅoÑetry failed I/O");

64 
	gshutdown_timeout
 = 5;

65 
moduÀ_∑øm
(
shutdown_timeout
, 
byã
, 0644);

66 
MODULE_PARM_DESC
(
shutdown_timeout
, "timeout in seconds for controller shutdown");

68 
	gnvme_maj‹
;

69 
moduÀ_∑øm
(
nvme_maj‹
, , 0);

71 
	gu£_thªaded_öãºu±s
;

72 
moduÀ_∑øm
(
u£_thªaded_öãºu±s
, , 0);

74 
DEFINE_SPINLOCK
(
dev_li°_lock
);

75 
LIST_HEAD
(
dev_li°
);

76 
èsk_°ru˘
 *
	gnvme_thªad
;

77 
w‹kqueue_°ru˘
 *
	gnvme_w‹kq
;

78 
waô_queue_hód_t
 
	gnvme_kthªad_waô
;

79 
nŸifõr_block
 
	gnvme_nb
;

81 
nvme_ª£t_Áûed_dev
(
w‹k_°ru˘
 *
ws
);

82 
nvme_¥o˚ss_cq
(
nvme_queue
 *
nvmeq
);

84 
	sasync_cmd_öfo
 {

85 
kthªad_w‹k
 
	mw‹k
;

86 
kthªad_w‹kî
 *
	mw‹kî
;

87 
ªque°
 *
	mªq
;

88 
u32
 
	mªsu…
;

89 
	m°©us
;

90 *
	m˘x
;

97 
	snvme_queue
 {

98 
Œi°_node
 
	mnode
;

99 
devi˚
 *
	mq_dmadev
;

100 
nvme_dev
 *
	mdev
;

101 
	múq«me
[24];

102 
•ölock_t
 
	mq_lock
;

103 
nvme_comm™d
 *
	msq_cmds
;

104 vﬁ©ûê
nvme_com∂ëi⁄
 *
	mcqes
;

105 
dma_addr_t
 
	msq_dma_addr
;

106 
dma_addr_t
 
	mcq_dma_addr
;

107 
u32
 
__iomem
 *
	mq_db
;

108 
u16
 
	mq_dïth
;

109 
s16
 
	mcq_ve˘‹
;

110 
u16
 
	msq_hód
;

111 
u16
 
	msq_èû
;

112 
u16
 
	mcq_hód
;

113 
u16
 
	mqid
;

114 
u8
 
	mcq_pha£
;

115 
u8
 
	mcqe_£í
;

116 
async_cmd_öfo
 
	mcmdöfo
;

117 
blk_mq_hw_˘x
 *
	mh˘x
;

123 
ölöe
 
	$_nvme_check_size
()

125 
	`BUILD_BUG_ON
((
nvme_rw_comm™d
) != 64);

126 
	`BUILD_BUG_ON
((
nvme_¸óã_cq
) != 64);

127 
	`BUILD_BUG_ON
((
nvme_¸óã_sq
) != 64);

128 
	`BUILD_BUG_ON
((
nvme_dñëe_queue
) != 64);

129 
	`BUILD_BUG_ON
((
nvme_„©uªs
) != 64);

130 
	`BUILD_BUG_ON
((
nvme_f‹m©_cmd
) != 64);

131 
	`BUILD_BUG_ON
((
nvme_ab‹t_cmd
) != 64);

132 
	`BUILD_BUG_ON
((
nvme_comm™d
) != 64);

133 
	`BUILD_BUG_ON
((
nvme_id_˘æ
) != 4096);

134 
	`BUILD_BUG_ON
((
nvme_id_ns
) != 4096);

135 
	`BUILD_BUG_ON
((
nvme_lba_ønge_ty≥
) != 64);

136 
	`BUILD_BUG_ON
((
nvme_sm¨t_log
) != 512);

137 
	}
}

139 (*
	tnvme_com∂ëi⁄_‚
)(
	tnvme_queue
 *, *,

140 
	tnvme_com∂ëi⁄
 *);

142 
	snvme_cmd_öfo
 {

143 
nvme_com∂ëi⁄_‚
 
‚
;

144 *
˘x
;

145 
ab‹ãd
;

146 
nvme_queue
 *
nvmeq
;

149 
	$nvme_admö_öô_h˘x
(
blk_mq_hw_˘x
 *
h˘x
, *
d©a
,

150 
h˘x_idx
)

152 
nvme_dev
 *
dev
 = 
d©a
;

153 
nvme_queue
 *
nvmeq
 = 
dev
->
queues
[0];

155 
	`WARN_ON
(
nvmeq
->
h˘x
);

156 
nvmeq
->
h˘x
 = hctx;

157 
h˘x
->
drivî_d©a
 = 
nvmeq
;

159 
	}
}

161 
	$nvme_admö_öô_ªque°
(*
d©a
, 
ªque°
 *
ªq
,

162 
h˘x_idx
, 
rq_idx
,

163 
numa_node
)

165 
nvme_dev
 *
dev
 = 
d©a
;

166 
nvme_cmd_öfo
 *
cmd
 = 
	`blk_mq_rq_to_pdu
(
ªq
);

167 
nvme_queue
 *
nvmeq
 = 
dev
->
queues
[0];

169 
	`BUG_ON
(!
nvmeq
);

170 
cmd
->
nvmeq
 =Çvmeq;

172 
	}
}

174 
	$nvme_exô_h˘x
(
blk_mq_hw_˘x
 *
h˘x
, 
h˘x_idx
)

176 
nvme_queue
 *
nvmeq
 = 
h˘x
->
drivî_d©a
;

178 
nvmeq
->
h˘x
 = 
NULL
;

179 
	}
}

181 
	$nvme_öô_h˘x
(
blk_mq_hw_˘x
 *
h˘x
, *
d©a
,

182 
h˘x_idx
)

184 
nvme_dev
 *
dev
 = 
d©a
;

185 
nvme_queue
 *
nvmeq
 = 
dev
->
queues
[

186 (
h˘x_idx
 % 
dev
->
queue_cou¡
) + 1];

188 i‡(!
nvmeq
->
h˘x
)

189 
nvmeq
->
h˘x
 = hctx;

193 
	`WARN_ON
(
nvmeq
->
h˘x
->
ègs
 != hctx->tags);

195 
h˘x
->
drivî_d©a
 = 
nvmeq
;

197 
	}
}

199 
	$nvme_öô_ªque°
(*
d©a
, 
ªque°
 *
ªq
,

200 
h˘x_idx
, 
rq_idx
,

201 
numa_node
)

203 
nvme_dev
 *
dev
 = 
d©a
;

204 
nvme_cmd_öfo
 *
cmd
 = 
	`blk_mq_rq_to_pdu
(
ªq
);

205 
nvme_queue
 *
nvmeq
 = 
dev
->
queues
[
h˘x_idx
 + 1];

207 
	`BUG_ON
(!
nvmeq
);

208 
cmd
->
nvmeq
 =Çvmeq;

210 
	}
}

212 
	$nvme_£t_öfo
(
nvme_cmd_öfo
 *
cmd
, *
˘x
,

213 
nvme_com∂ëi⁄_‚
 
h™dÀr
)

215 
cmd
->
‚
 = 
h™dÀr
;

216 
cmd
->
˘x
 = ctx;

217 
cmd
->
ab‹ãd
 = 0;

218 
	`blk_mq_°¨t_ªque°
(
	`blk_mq_rq_‰om_pdu
(
cmd
));

219 
	}
}

222 
	#CMD_CTX_BASE
 ((*)
POISON_POINTER_DELTA
)

	)

223 
	#CMD_CTX_CANCELLED
 (0x30C + 
CMD_CTX_BASE
)

	)

224 
	#CMD_CTX_COMPLETED
 (0x310 + 
CMD_CTX_BASE
)

	)

225 
	#CMD_CTX_INVALID
 (0x314 + 
CMD_CTX_BASE
)

	)

227 
	$•ecül_com∂ëi⁄
(
nvme_queue
 *
nvmeq
, *
˘x
,

228 
nvme_com∂ëi⁄
 *
cqe
)

230 i‡(
˘x
 =
CMD_CTX_CANCELLED
)

232 i‡(
˘x
 =
CMD_CTX_COMPLETED
) {

233 
	`dev_w¨n
(
nvmeq
->
q_dmadev
,

235 
cqe
->
comm™d_id
, 
	`À16_to_˝up
(&cqe->
sq_id
));

238 i‡(
˘x
 =
CMD_CTX_INVALID
) {

239 
	`dev_w¨n
(
nvmeq
->
q_dmadev
,

241 
cqe
->
comm™d_id
, 
	`À16_to_˝up
(&cqe->
sq_id
));

244 
	`dev_w¨n
(
nvmeq
->
q_dmadev
, "Unknow¿•ecü»com∂ëi⁄ %p\n", 
˘x
);

245 
	}
}

247 *
	$ˇn˚l_cmd_öfo
(
nvme_cmd_öfo
 *
cmd
, 
nvme_com∂ëi⁄_‚
 *
‚
)

249 *
˘x
;

251 i‡(
‚
)

252 *
‚
 = 
cmd
->fn;

253 
˘x
 = 
cmd
->ctx;

254 
cmd
->
‚
 = 
•ecül_com∂ëi⁄
;

255 
cmd
->
˘x
 = 
CMD_CTX_CANCELLED
;

256  
˘x
;

257 
	}
}

259 
	$async_ªq_com∂ëi⁄
(
nvme_queue
 *
nvmeq
, *
˘x
,

260 
nvme_com∂ëi⁄
 *
cqe
)

262 
ªque°
 *
ªq
 = 
˘x
;

264 
u32
 
ªsu…
 = 
	`À32_to_˝up
(&
cqe
->result);

265 
u16
 
°©us
 = 
	`À16_to_˝up
(&
cqe
->status) >> 1;

267 i‡(
°©us
 =
NVME_SC_SUCCESS
 || sètu†=
NVME_SC_ABORT_REQ
)

268 ++
nvmeq
->
dev
->
evít_limô
;

269 i‡(
°©us
 =
NVME_SC_SUCCESS
)

270 
	`dev_w¨n
(
nvmeq
->
q_dmadev
,

271 "asyn¯evíàªsu… %08x\n", 
ªsu…
);

273 
	`blk_mq_‰ì_h˘x_ªque°
(
nvmeq
->
h˘x
, 
ªq
);

274 
	}
}

276 
	$ab‹t_com∂ëi⁄
(
nvme_queue
 *
nvmeq
, *
˘x
,

277 
nvme_com∂ëi⁄
 *
cqe
)

279 
ªque°
 *
ªq
 = 
˘x
;

281 
u16
 
°©us
 = 
	`À16_to_˝up
(&
cqe
->status) >> 1;

282 
u32
 
ªsu…
 = 
	`À32_to_˝up
(&
cqe
->result);

284 
	`blk_mq_‰ì_h˘x_ªque°
(
nvmeq
->
h˘x
, 
ªq
);

286 
	`dev_w¨n
(
nvmeq
->
q_dmadev
, "Ab‹à°©us:%xÑesu…:%x", 
°©us
, 
ªsu…
);

287 ++
nvmeq
->
dev
->
ab‹t_limô
;

288 
	}
}

290 
	$async_com∂ëi⁄
(
nvme_queue
 *
nvmeq
, *
˘x
,

291 
nvme_com∂ëi⁄
 *
cqe
)

293 
async_cmd_öfo
 *
cmdöfo
 = 
˘x
;

294 
cmdöfo
->
ªsu…
 = 
	`À32_to_˝up
(&
cqe
->result);

295 
cmdöfo
->
°©us
 = 
	`À16_to_˝up
(&
cqe
->status) >> 1;

296 
	`queue_kthªad_w‹k
(
cmdöfo
->
w‹kî
, &cmdöfo->
w‹k
);

297 
	`blk_mq_‰ì_h˘x_ªque°
(
nvmeq
->
h˘x
, 
cmdöfo
->
ªq
);

298 
	}
}

300 
ölöe
 
nvme_cmd_öfo
 *
	$gë_cmd_‰om_èg
(
nvme_queue
 *
nvmeq
,

301 
èg
)

303 
blk_mq_hw_˘x
 *
h˘x
 = 
nvmeq
->hctx;

304 
ªque°
 *
ªq
 = 
	`blk_mq_èg_to_rq
(
h˘x
->
ègs
, 
èg
);

306  
	`blk_mq_rq_to_pdu
(
ªq
);

307 
	}
}

312 *
	$nvme_föish_cmd
(
nvme_queue
 *
nvmeq
, 
èg
,

313 
nvme_com∂ëi⁄_‚
 *
‚
)

315 
nvme_cmd_öfo
 *
cmd
 = 
	`gë_cmd_‰om_èg
(
nvmeq
, 
èg
);

316 *
˘x
;

317 i‡(
èg
 >
nvmeq
->
q_dïth
) {

318 *
‚
 = 
•ecül_com∂ëi⁄
;

319  
CMD_CTX_INVALID
;

321 i‡(
‚
)

322 *
‚
 = 
cmd
->fn;

323 
˘x
 = 
cmd
->ctx;

324 
cmd
->
‚
 = 
•ecül_com∂ëi⁄
;

325 
cmd
->
˘x
 = 
CMD_CTX_COMPLETED
;

326  
˘x
;

327 
	}
}

336 
	$__nvme_submô_cmd
(
nvme_queue
 *
nvmeq
, 
nvme_comm™d
 *
cmd
)

338 
u16
 
èû
 = 
nvmeq
->
sq_èû
;

340 
	`mem˝y
(&
nvmeq
->
sq_cmds
[
èû
], 
cmd
, (*cmd));

341 i‡(++
èû
 =
nvmeq
->
q_dïth
)

342 
èû
 = 0;

343 
	`wrôñ
(
èû
, 
nvmeq
->
q_db
);

344 
nvmeq
->
sq_èû
 = 
èû
;

347 
	}
}

349 
	$nvme_submô_cmd
(
nvme_queue
 *
nvmeq
, 
nvme_comm™d
 *
cmd
)

351 
Êags
;

352 
ªt
;

353 
	`•ö_lock_úqßve
(&
nvmeq
->
q_lock
, 
Êags
);

354 
ªt
 = 
	`__nvme_submô_cmd
(
nvmeq
, 
cmd
);

355 
	`•ö_u∆ock_úqª°‹e
(&
nvmeq
->
q_lock
, 
Êags
);

356  
ªt
;

357 
	}
}

359 
__À64
 **
	$iod_li°
(
nvme_iod
 *
iod
)

361  ((*)
iod
Ë+ iod->
off£t
;

362 
	}
}

369 
	$nvme_≈ages
(
size
, 
nvme_dev
 *
dev
)

371 
≈Ωs
 = 
	`DIV_ROUND_UP
(
size
 + 
dev
->
∑ge_size
, dev->page_size);

372  
	`DIV_ROUND_UP
(8 * 
≈Ωs
, 
dev
->
∑ge_size
 - 8);

373 
	}
}

375 
nvme_iod
 *

376 
	$nvme_Æloc_iod
(
n£g
, 
nbyãs
, 
nvme_dev
 *
dev
, 
gÂ_t
 
gÂ
)

378 
nvme_iod
 *
iod
 = 
	`kmÆloc
((nvme_iod) +

379 (
__À64
 *Ë* 
	`nvme_≈ages
(
nbyãs
, 
dev
) +

380 (
sˇâîli°
Ë* 
n£g
, 
gÂ
);

382 i‡(
iod
) {

383 
iod
->
off£t
 = 
	`off£tof
(
nvme_iod
, 
sg
[
n£g
]);

384 
iod
->
≈ages
 = -1;

385 
iod
->
Àngth
 = 
nbyãs
;

386 
iod
->
√¡s
 = 0;

387 
iod
->
fú°_dma
 = 0ULL;

390  
iod
;

391 
	}
}

393 
	$nvme_‰ì_iod
(
nvme_dev
 *
dev
, 
nvme_iod
 *
iod
)

395 c⁄° 
œ°_¥p
 = 
dev
->
∑ge_size
 / 8 - 1;

396 
i
;

397 
__À64
 **
li°
 = 
	`iod_li°
(
iod
);

398 
dma_addr_t
 
¥p_dma
 = 
iod
->
fú°_dma
;

400 i‡(
iod
->
≈ages
 == 0)

401 
	`dma_poﬁ_‰ì
(
dev
->
¥p_smÆl_poﬁ
, 
li°
[0], 
¥p_dma
);

402 
i
 = 0; i < 
iod
->
≈ages
; i++) {

403 
__À64
 *
¥p_li°
 = 
li°
[
i
];

404 
dma_addr_t
 
√xt_¥p_dma
 = 
	`À64_to_˝u
(
¥p_li°
[
œ°_¥p
]);

405 
	`dma_poﬁ_‰ì
(
dev
->
¥p_∑ge_poﬁ
, 
¥p_li°
, 
¥p_dma
);

406 
¥p_dma
 = 
√xt_¥p_dma
;

408 
	`k‰ì
(
iod
);

409 
	}
}

411 
	$nvme_îr‹_°©us
(
u16
 
°©us
)

413 
°©us
 & 0x7ff) {

414 
NVME_SC_SUCCESS
:

416 
NVME_SC_CAP_EXCEEDED
:

417  -
ENOSPC
;

419  -
EIO
;

421 
	}
}

423 
	$ªq_com∂ëi⁄
(
nvme_queue
 *
nvmeq
, *
˘x
,

424 
nvme_com∂ëi⁄
 *
cqe
)

426 
nvme_iod
 *
iod
 = 
˘x
;

427 
ªque°
 *
ªq
 = 
iod
->
¥iv©e
;

428 
nvme_cmd_öfo
 *
cmd_rq
 = 
	`blk_mq_rq_to_pdu
(
ªq
);

430 
u16
 
°©us
 = 
	`À16_to_˝up
(&
cqe
->status) >> 1;

432 i‡(
	`u∆ikñy
(
°©us
)) {

433 i‡(!(
°©us
 & 
NVME_SC_DNR
 || 
	`blk_n‹ëry_ªque°
(
ªq
))

434 && (
jiffõs
 - 
ªq
->
°¨t_time
Ë<Ñeq->
timeout
) {

435 
Êags
;

437 
	`blk_mq_ªqueue_ªque°
(
ªq
);

438 
	`•ö_lock_úqßve
(
ªq
->
q
->
queue_lock
, 
Êags
);

439 i‡(!
	`blk_queue_°›≥d
(
ªq
->
q
))

440 
	`blk_mq_kick_ªqueue_li°
(
ªq
->
q
);

441 
	`•ö_u∆ock_úqª°‹e
(
ªq
->
q
->
queue_lock
, 
Êags
);

444 
ªq
->
îr‹s
 = 
	`nvme_îr‹_°©us
(
°©us
);

446 
ªq
->
îr‹s
 = 0;

448 i‡(
cmd_rq
->
ab‹ãd
)

449 
	`dev_w¨n
(&
nvmeq
->
dev
->
pci_dev
->dev,

451 
°©us
);

453 i‡(
iod
->
√¡s
)

454 
	`dma_unm≠_sg
(&
nvmeq
->
dev
->
pci_dev
->dev, 
iod
->
sg
, iod->
√¡s
,

455 
	`rq_d©a_dú
(
ªq
Ë? 
DMA_TO_DEVICE
 : 
DMA_FROM_DEVICE
);

456 
	`nvme_‰ì_iod
(
nvmeq
->
dev
, 
iod
);

458 
	`blk_mq_com∂ëe_ªque°
(
ªq
);

459 
	}
}

462 
	$nvme_£tup_¥ps
(
nvme_dev
 *
dev
, 
nvme_iod
 *
iod
, 
tŸÆ_Àn
,

463 
gÂ_t
 
gÂ
)

465 
dma_poﬁ
 *
poﬁ
;

466 
Àngth
 = 
tŸÆ_Àn
;

467 
sˇâîli°
 *
sg
 = 
iod
->sg;

468 
dma_Àn
 = 
	`sg_dma_Àn
(
sg
);

469 
u64
 
dma_addr
 = 
	`sg_dma_addªss
(
sg
);

470 
off£t
 = 
	`off£t_ö_∑ge
(
dma_addr
);

471 
__À64
 *
¥p_li°
;

472 
__À64
 **
li°
 = 
	`iod_li°
(
iod
);

473 
dma_addr_t
 
¥p_dma
;

474 
≈Ωs
, 
i
;

475 
u32
 
∑ge_size
 = 
dev
->page_size;

477 
Àngth
 -(
∑ge_size
 - 
off£t
);

478 i‡(
Àngth
 <= 0)

479  
tŸÆ_Àn
;

481 
dma_Àn
 -(
∑ge_size
 - 
off£t
);

482 i‡(
dma_Àn
) {

483 
dma_addr
 +(
∑ge_size
 - 
off£t
);

485 
sg
 = 
	`sg_√xt
(sg);

486 
dma_addr
 = 
	`sg_dma_addªss
(
sg
);

487 
dma_Àn
 = 
	`sg_dma_Àn
(
sg
);

490 i‡(
Àngth
 <
∑ge_size
) {

491 
iod
->
fú°_dma
 = 
dma_addr
;

492  
tŸÆ_Àn
;

495 
≈Ωs
 = 
	`DIV_ROUND_UP
(
Àngth
, 
∑ge_size
);

496 i‡(
≈Ωs
 <= (256 / 8)) {

497 
poﬁ
 = 
dev
->
¥p_smÆl_poﬁ
;

498 
iod
->
≈ages
 = 0;

500 
poﬁ
 = 
dev
->
¥p_∑ge_poﬁ
;

501 
iod
->
≈ages
 = 1;

504 
¥p_li°
 = 
	`dma_poﬁ_Æloc
(
poﬁ
, 
gÂ
, &
¥p_dma
);

505 i‡(!
¥p_li°
) {

506 
iod
->
fú°_dma
 = 
dma_addr
;

507 
iod
->
≈ages
 = -1;

508  (
tŸÆ_Àn
 - 
Àngth
Ë+ 
∑ge_size
;

510 
li°
[0] = 
¥p_li°
;

511 
iod
->
fú°_dma
 = 
¥p_dma
;

512 
i
 = 0;

514 i‡(
i
 =
∑ge_size
 >> 3) {

515 
__À64
 *
ﬁd_¥p_li°
 = 
¥p_li°
;

516 
¥p_li°
 = 
	`dma_poﬁ_Æloc
(
poﬁ
, 
gÂ
, &
¥p_dma
);

517 i‡(!
¥p_li°
)

518  
tŸÆ_Àn
 - 
Àngth
;

519 
li°
[
iod
->
≈ages
++] = 
¥p_li°
;

520 
¥p_li°
[0] = 
ﬁd_¥p_li°
[
i
 - 1];

521 
ﬁd_¥p_li°
[
i
 - 1] = 
	`˝u_to_À64
(
¥p_dma
);

522 
i
 = 1;

524 
¥p_li°
[
i
++] = 
	`˝u_to_À64
(
dma_addr
);

525 
dma_Àn
 -
∑ge_size
;

526 
dma_addr
 +
∑ge_size
;

527 
Àngth
 -
∑ge_size
;

528 i‡(
Àngth
 <= 0)

530 i‡(
dma_Àn
 > 0)

532 
	`BUG_ON
(
dma_Àn
 < 0);

533 
sg
 = 
	`sg_√xt
(sg);

534 
dma_addr
 = 
	`sg_dma_addªss
(
sg
);

535 
dma_Àn
 = 
	`sg_dma_Àn
(
sg
);

538  
tŸÆ_Àn
;

539 
	}
}

546 
	$nvme_submô_disˇrd
(
nvme_queue
 *
nvmeq
, 
nvme_ns
 *
ns
,

547 
ªque°
 *
ªq
, 
nvme_iod
 *
iod
)

549 
nvme_dsm_ønge
 *
ønge
 =

550 (
nvme_dsm_ønge
 *)
	`iod_li°
(
iod
)[0];

551 
nvme_comm™d
 *
cmnd
 = &
nvmeq
->
sq_cmds
[nvmeq->
sq_èû
];

553 
ønge
->
ˇâr
 = 
	`˝u_to_À32
(0);

554 
ønge
->
∆b
 = 
	`˝u_to_À32
(
	`blk_rq_byãs
(
ªq
Ë>> 
ns
->
lba_shi·
);

555 
ønge
->
¶ba
 = 
	`˝u_to_À64
(
	`nvme_block_ƒ
(
ns
, 
	`blk_rq_pos
(
ªq
)));

557 
	`mem£t
(
cmnd
, 0, (*cmnd));

558 
cmnd
->
dsm
.
›code
 = 
nvme_cmd_dsm
;

559 
cmnd
->
dsm
.
comm™d_id
 = 
ªq
->
èg
;

560 
cmnd
->
dsm
.
nsid
 = 
	`˝u_to_À32
(
ns
->
ns_id
);

561 
cmnd
->
dsm
.
¥p1
 = 
	`˝u_to_À64
(
iod
->
fú°_dma
);

562 
cmnd
->
dsm
.
ƒ
 = 0;

563 
cmnd
->
dsm
.
©åibuãs
 = 
	`˝u_to_À32
(
NVME_DSMGMT_AD
);

565 i‡(++
nvmeq
->
sq_èû
 =nvmeq->
q_dïth
)

566 
nvmeq
->
sq_èû
 = 0;

567 
	`wrôñ
(
nvmeq
->
sq_èû
,Çvmeq->
q_db
);

568 
	}
}

570 
	$nvme_submô_Êush
(
nvme_queue
 *
nvmeq
, 
nvme_ns
 *
ns
,

571 
cmdid
)

573 
nvme_comm™d
 *
cmnd
 = &
nvmeq
->
sq_cmds
[nvmeq->
sq_èû
];

575 
	`mem£t
(
cmnd
, 0, (*cmnd));

576 
cmnd
->
comm⁄
.
›code
 = 
nvme_cmd_Êush
;

577 
cmnd
->
comm⁄
.
comm™d_id
 = 
cmdid
;

578 
cmnd
->
comm⁄
.
nsid
 = 
	`˝u_to_À32
(
ns
->
ns_id
);

580 i‡(++
nvmeq
->
sq_èû
 =nvmeq->
q_dïth
)

581 
nvmeq
->
sq_èû
 = 0;

582 
	`wrôñ
(
nvmeq
->
sq_èû
,Çvmeq->
q_db
);

583 
	}
}

585 
	$nvme_submô_iod
(
nvme_queue
 *
nvmeq
, 
nvme_iod
 *
iod
,

586 
nvme_ns
 *
ns
)

588 
ªque°
 *
ªq
 = 
iod
->
¥iv©e
;

589 
nvme_comm™d
 *
cmnd
;

590 
u16
 
c⁄åﬁ
 = 0;

591 
u32
 
dsmgmt
 = 0;

593 i‡(
ªq
->
cmd_Êags
 & 
REQ_FUA
)

594 
c⁄åﬁ
 |
NVME_RW_FUA
;

595 i‡(
ªq
->
cmd_Êags
 & (
REQ_FAILFAST_DEV
 | 
REQ_RAHEAD
))

596 
c⁄åﬁ
 |
NVME_RW_LR
;

598 i‡(
ªq
->
cmd_Êags
 & 
REQ_RAHEAD
)

599 
dsmgmt
 |
NVME_RW_DSM_FREQ_PREFETCH
;

601 
cmnd
 = &
nvmeq
->
sq_cmds
[nvmeq->
sq_èû
];

602 
	`mem£t
(
cmnd
, 0, (*cmnd));

604 
cmnd
->
rw
.
›code
 = (
	`rq_d©a_dú
(
ªq
Ë? 
nvme_cmd_wrôe
 : 
nvme_cmd_ªad
);

605 
cmnd
->
rw
.
comm™d_id
 = 
ªq
->
èg
;

606 
cmnd
->
rw
.
nsid
 = 
	`˝u_to_À32
(
ns
->
ns_id
);

607 
cmnd
->
rw
.
¥p1
 = 
	`˝u_to_À64
(
	`sg_dma_addªss
(
iod
->
sg
));

608 
cmnd
->
rw
.
¥p2
 = 
	`˝u_to_À64
(
iod
->
fú°_dma
);

609 
cmnd
->
rw
.
¶ba
 = 
	`˝u_to_À64
(
	`nvme_block_ƒ
(
ns
, 
	`blk_rq_pos
(
ªq
)));

610 
cmnd
->
rw
.
Àngth
 = 
	`˝u_to_À16
((
	`blk_rq_byãs
(
ªq
Ë>> 
ns
->
lba_shi·
) - 1);

611 
cmnd
->
rw
.
c⁄åﬁ
 = 
	`˝u_to_À16
(control);

612 
cmnd
->
rw
.
dsmgmt
 = 
	`˝u_to_À32
(dsmgmt);

614 i‡(++
nvmeq
->
sq_èû
 =nvmeq->
q_dïth
)

615 
nvmeq
->
sq_èû
 = 0;

616 
	`wrôñ
(
nvmeq
->
sq_èû
,Çvmeq->
q_db
);

619 
	}
}

621 
	$nvme_queue_rq
(
blk_mq_hw_˘x
 *
h˘x
,

622 c⁄° 
blk_mq_queue_d©a
 *
bd
)

624 
nvme_ns
 *
ns
 = 
h˘x
->
queue
->
queued©a
;

625 
nvme_queue
 *
nvmeq
 = 
h˘x
->
drivî_d©a
;

626 
ªque°
 *
ªq
 = 
bd
->
rq
;

627 
nvme_cmd_öfo
 *
cmd
 = 
	`blk_mq_rq_to_pdu
(
ªq
);

628 
nvme_iod
 *
iod
;

629 
p£gs
 = 
ªq
->
ƒ_phys_£gmíts
;

630 
dma_d©a_dúe˘i⁄
 
dma_dú
;

631 
size
 = !(
ªq
->
cmd_Êags
 & 
REQ_DISCARD
Ë? 
	`blk_rq_byãs
(req) :

632 (
nvme_dsm_ønge
);

634 
iod
 = 
	`nvme_Æloc_iod
(
p£gs
, 
size
, 
ns
->
dev
, 
GFP_ATOMIC
);

635 i‡(!
iod
)

636  
BLK_MQ_RQ_QUEUE_BUSY
;

638 
iod
->
¥iv©e
 = 
ªq
;

640 i‡(
ªq
->
cmd_Êags
 & 
REQ_DISCARD
) {

641 *
ønge
;

647 
ønge
 = 
	`dma_poﬁ_Æloc
(
nvmeq
->
dev
->
¥p_smÆl_poﬁ
,

648 
GFP_ATOMIC
,

649 &
iod
->
fú°_dma
);

650 i‡(!
ønge
)

651 
ªåy_cmd
;

652 
	`iod_li°
(
iod
)[0] = (
__À64
 *)
ønge
;

653 
iod
->
≈ages
 = 0;

654 } i‡(
p£gs
) {

655 
dma_dú
 = 
	`rq_d©a_dú
(
ªq
Ë? 
DMA_TO_DEVICE
 : 
DMA_FROM_DEVICE
;

657 
	`sg_öô_èbÀ
(
iod
->
sg
, 
p£gs
);

658 
iod
->
√¡s
 = 
	`blk_rq_m≠_sg
(
ªq
->
q
,Ñeq, iod->
sg
);

659 i‡(!
iod
->
√¡s
)

660 
îr‹_cmd
;

662 i‡(!
	`dma_m≠_sg
(
nvmeq
->
q_dmadev
, 
iod
->
sg
, iod->
√¡s
, 
dma_dú
))

663 
ªåy_cmd
;

665 i‡(
	`blk_rq_byãs
(
ªq
) !=

666 
	`nvme_£tup_¥ps
(
nvmeq
->
dev
, 
iod
, 
	`blk_rq_byãs
(
ªq
), 
GFP_ATOMIC
)) {

667 
	`dma_unm≠_sg
(&
nvmeq
->
dev
->
pci_dev
->dev, 
iod
->
sg
,

668 
iod
->
√¡s
, 
dma_dú
);

669 
ªåy_cmd
;

673 
	`nvme_£t_öfo
(
cmd
, 
iod
, 
ªq_com∂ëi⁄
);

674 
	`•ö_lock_úq
(&
nvmeq
->
q_lock
);

675 i‡(
ªq
->
cmd_Êags
 & 
REQ_DISCARD
)

676 
	`nvme_submô_disˇrd
(
nvmeq
, 
ns
, 
ªq
, 
iod
);

677 i‡(
ªq
->
cmd_Êags
 & 
REQ_FLUSH
)

678 
	`nvme_submô_Êush
(
nvmeq
, 
ns
, 
ªq
->
èg
);

680 
	`nvme_submô_iod
(
nvmeq
, 
iod
, 
ns
);

682 
	`nvme_¥o˚ss_cq
(
nvmeq
);

683 
	`•ö_u∆ock_úq
(&
nvmeq
->
q_lock
);

684  
BLK_MQ_RQ_QUEUE_OK
;

686 
îr‹_cmd
:

687 
	`nvme_‰ì_iod
(
nvmeq
->
dev
, 
iod
);

688  
BLK_MQ_RQ_QUEUE_ERROR
;

689 
ªåy_cmd
:

690 
	`nvme_‰ì_iod
(
nvmeq
->
dev
, 
iod
);

691  
BLK_MQ_RQ_QUEUE_BUSY
;

692 
	}
}

694 
	$nvme_¥o˚ss_cq
(
nvme_queue
 *
nvmeq
)

696 
u16
 
hód
, 
pha£
;

698 
hód
 = 
nvmeq
->
cq_hód
;

699 
pha£
 = 
nvmeq
->
cq_pha£
;

702 *
˘x
;

703 
nvme_com∂ëi⁄_‚
 
‚
;

704 
nvme_com∂ëi⁄
 
cqe
 = 
nvmeq
->
cqes
[
hód
];

705 i‡((
	`À16_to_˝u
(
cqe
.
°©us
Ë& 1Ë!
pha£
)

707 
nvmeq
->
sq_hód
 = 
	`À16_to_˝u
(
cqe
.sq_head);

708 i‡(++
hód
 =
nvmeq
->
q_dïth
) {

709 
hód
 = 0;

710 
pha£
 = !phase;

712 
˘x
 = 
	`nvme_föish_cmd
(
nvmeq
, 
cqe
.
comm™d_id
, &
‚
);

713 
	`‚
(
nvmeq
, 
˘x
, &
cqe
);

722 i‡(
hód
 =
nvmeq
->
cq_hód
 && 
pha£
 =nvmeq->
cq_pha£
)

725 
	`wrôñ
(
hód
, 
nvmeq
->
q_db
 +Çvmeq->
dev
->
db_°ride
);

726 
nvmeq
->
cq_hód
 = 
hód
;

727 
nvmeq
->
cq_pha£
 = 
pha£
;

729 
nvmeq
->
cqe_£í
 = 1;

731 
	}
}

735 
	$nvme_admö_queue_rq
(
blk_mq_hw_˘x
 *
h˘x
,

736 c⁄° 
blk_mq_queue_d©a
 *
bd
)

738 
	`WARN_ON_ONCE
(1);

739  
BLK_MQ_RQ_QUEUE_ERROR
;

740 
	}
}

742 
úqªtu∫_t
 
	$nvme_úq
(
úq
, *
d©a
)

744 
úqªtu∫_t
 
ªsu…
;

745 
nvme_queue
 *
nvmeq
 = 
d©a
;

746 
	`•ö_lock
(&
nvmeq
->
q_lock
);

747 
	`nvme_¥o˚ss_cq
(
nvmeq
);

748 
ªsu…
 = 
nvmeq
->
cqe_£í
 ? 
IRQ_HANDLED
 : 
IRQ_NONE
;

749 
nvmeq
->
cqe_£í
 = 0;

750 
	`•ö_u∆ock
(&
nvmeq
->
q_lock
);

751  
ªsu…
;

752 
	}
}

754 
úqªtu∫_t
 
	$nvme_úq_check
(
úq
, *
d©a
)

756 
nvme_queue
 *
nvmeq
 = 
d©a
;

757 
nvme_com∂ëi⁄
 
cqe
 = 
nvmeq
->
cqes
[nvmeq->
cq_hód
];

758 i‡((
	`À16_to_˝u
(
cqe
.
°©us
Ë& 1Ë!
nvmeq
->
cq_pha£
)

759  
IRQ_NONE
;

760  
IRQ_WAKE_THREAD
;

761 
	}
}

763 
	$nvme_ab‹t_cmd_öfo
(
nvme_queue
 *
nvmeq
, 
nvme_cmd_öfo
 *

764 
cmd_öfo
)

766 
	`•ö_lock_úq
(&
nvmeq
->
q_lock
);

767 
	`ˇn˚l_cmd_öfo
(
cmd_öfo
, 
NULL
);

768 
	`•ö_u∆ock_úq
(&
nvmeq
->
q_lock
);

769 
	}
}

771 
	ssync_cmd_öfo
 {

772 
èsk_°ru˘
 *
	mèsk
;

773 
u32
 
	mªsu…
;

774 
	m°©us
;

777 
	$sync_com∂ëi⁄
(
nvme_queue
 *
nvmeq
, *
˘x
,

778 
nvme_com∂ëi⁄
 *
cqe
)

780 
sync_cmd_öfo
 *
cmdöfo
 = 
˘x
;

781 
cmdöfo
->
ªsu…
 = 
	`À32_to_˝up
(&
cqe
->result);

782 
cmdöfo
->
°©us
 = 
	`À16_to_˝up
(&
cqe
->status) >> 1;

783 
	`wake_up_¥o˚ss
(
cmdöfo
->
èsk
);

784 
	}
}

790 
	$nvme_submô_sync_cmd
(
ªque°
 *
ªq
, 
nvme_comm™d
 *
cmd
,

791 
u32
 *
ªsu…
, 
timeout
)

793 
ªt
;

794 
sync_cmd_öfo
 
cmdöfo
;

795 
nvme_cmd_öfo
 *
cmd_rq
 = 
	`blk_mq_rq_to_pdu
(
ªq
);

796 
nvme_queue
 *
nvmeq
 = 
cmd_rq
->nvmeq;

798 
cmdöfo
.
èsk
 = 
cuºít
;

799 
cmdöfo
.
°©us
 = -
EINTR
;

801 
cmd
->
comm⁄
.
comm™d_id
 = 
ªq
->
èg
;

803 
	`nvme_£t_öfo
(
cmd_rq
, &
cmdöfo
, 
sync_com∂ëi⁄
);

805 
	`£t_cuºít_°©e
(
TASK_KILLABLE
);

806 
ªt
 = 
	`nvme_submô_cmd
(
nvmeq
, 
cmd
);

807 i‡(
ªt
) {

808 
	`nvme_föish_cmd
(
nvmeq
, 
ªq
->
èg
, 
NULL
);

809 
	`£t_cuºít_°©e
(
TASK_RUNNING
);

811 
ªt
 = 
	`scheduÀ_timeout
(
timeout
);

817 
	`nvme_ab‹t_cmd_öfo
(
nvmeq
, 
	`blk_mq_rq_to_pdu
(
ªq
));

822 i‡(
cmdöfo
.
°©us
 =-
EINTR
)

823  -
EINTR
;

825 i‡(
ªsu…
)

826 *
ªsu…
 = 
cmdöfo
.result;

828  
cmdöfo
.
°©us
;

829 
	}
}

831 
	$nvme_submô_async_admö_ªq
(
nvme_dev
 *
dev
)

833 
nvme_queue
 *
nvmeq
 = 
dev
->
queues
[0];

834 
nvme_comm™d
 
c
;

835 
nvme_cmd_öfo
 *
cmd_öfo
;

836 
ªque°
 *
ªq
;

838 
ªq
 = 
	`blk_mq_Æloc_ªque°
(
dev
->
admö_q
, 
WRITE
, 
GFP_ATOMIC
, 
Ál£
);

839 i‡(
	`IS_ERR
(
ªq
))

840  
	`PTR_ERR
(
ªq
);

842 
ªq
->
cmd_Êags
 |
REQ_NO_TIMEOUT
;

843 
cmd_öfo
 = 
	`blk_mq_rq_to_pdu
(
ªq
);

844 
	`nvme_£t_öfo
(
cmd_öfo
, 
ªq
, 
async_ªq_com∂ëi⁄
);

846 
	`mem£t
(&
c
, 0, (c));

847 
c
.
comm⁄
.
›code
 = 
nvme_admö_async_evít
;

848 
c
.
comm⁄
.
comm™d_id
 = 
ªq
->
èg
;

850  
	`__nvme_submô_cmd
(
nvmeq
, &
c
);

851 
	}
}

853 
	$nvme_submô_admö_async_cmd
(
nvme_dev
 *
dev
,

854 
nvme_comm™d
 *
cmd
,

855 
async_cmd_öfo
 *
cmdöfo
, 
timeout
)

857 
nvme_queue
 *
nvmeq
 = 
dev
->
queues
[0];

858 
ªque°
 *
ªq
;

859 
nvme_cmd_öfo
 *
cmd_rq
;

861 
ªq
 = 
	`blk_mq_Æloc_ªque°
(
dev
->
admö_q
, 
WRITE
, 
GFP_KERNEL
, 
Ál£
);

862 i‡(
	`IS_ERR
(
ªq
))

863  
	`PTR_ERR
(
ªq
);

865 
ªq
->
timeout
 =Åimeout;

866 
cmd_rq
 = 
	`blk_mq_rq_to_pdu
(
ªq
);

867 
cmdöfo
->
ªq
 =Ñeq;

868 
	`nvme_£t_öfo
(
cmd_rq
, 
cmdöfo
, 
async_com∂ëi⁄
);

869 
cmdöfo
->
°©us
 = -
EINTR
;

871 
cmd
->
comm⁄
.
comm™d_id
 = 
ªq
->
èg
;

873  
	`nvme_submô_cmd
(
nvmeq
, 
cmd
);

874 
	}
}

876 
	$__nvme_submô_admö_cmd
(
nvme_dev
 *
dev
, 
nvme_comm™d
 *
cmd
,

877 
u32
 *
ªsu…
, 
timeout
)

879 
ªs
;

880 
ªque°
 *
ªq
;

882 
ªq
 = 
	`blk_mq_Æloc_ªque°
(
dev
->
admö_q
, 
WRITE
, 
GFP_KERNEL
, 
Ál£
);

883 i‡(
	`IS_ERR
(
ªq
))

884  
	`PTR_ERR
(
ªq
);

885 
ªs
 = 
	`nvme_submô_sync_cmd
(
ªq
, 
cmd
, 
ªsu…
, 
timeout
);

886 
	`blk_mq_‰ì_ªque°
(
ªq
);

887  
ªs
;

888 
	}
}

890 
	$nvme_submô_admö_cmd
(
nvme_dev
 *
dev
, 
nvme_comm™d
 *
cmd
,

891 
u32
 *
ªsu…
)

893  
	`__nvme_submô_admö_cmd
(
dev
, 
cmd
, 
ªsu…
, 
ADMIN_TIMEOUT
);

894 
	}
}

896 
	$nvme_submô_io_cmd
(
nvme_dev
 *
dev
, 
nvme_ns
 *
ns
,

897 
nvme_comm™d
 *
cmd
, 
u32
 *
ªsu…
)

899 
ªs
;

900 
ªque°
 *
ªq
;

902 
ªq
 = 
	`blk_mq_Æloc_ªque°
(
ns
->
queue
, 
WRITE
, (
GFP_KERNEL
|
__GFP_WAIT
),

903 
Ál£
);

904 i‡(
	`IS_ERR
(
ªq
))

905  
	`PTR_ERR
(
ªq
);

906 
ªs
 = 
	`nvme_submô_sync_cmd
(
ªq
, 
cmd
, 
ªsu…
, 
NVME_IO_TIMEOUT
);

907 
	`blk_mq_‰ì_ªque°
(
ªq
);

908  
ªs
;

909 
	}
}

911 
	$ad≠ãr_dñëe_queue
(
nvme_dev
 *
dev
, 
u8
 
›code
, 
u16
 
id
)

913 
nvme_comm™d
 
c
;

915 
	`mem£t
(&
c
, 0, (c));

916 
c
.
dñëe_queue
.
›code
 = opcode;

917 
c
.
dñëe_queue
.
qid
 = 
	`˝u_to_À16
(
id
);

919  
	`nvme_submô_admö_cmd
(
dev
, &
c
, 
NULL
);

920 
	}
}

922 
	$ad≠ãr_Æloc_cq
(
nvme_dev
 *
dev
, 
u16
 
qid
,

923 
nvme_queue
 *
nvmeq
)

925 
nvme_comm™d
 
c
;

926 
Êags
 = 
NVME_QUEUE_PHYS_CONTIG
 | 
NVME_CQ_IRQ_ENABLED
;

928 
	`mem£t
(&
c
, 0, (c));

929 
c
.
¸óã_cq
.
›code
 = 
nvme_admö_¸óã_cq
;

930 
c
.
¸óã_cq
.
¥p1
 = 
	`˝u_to_À64
(
nvmeq
->
cq_dma_addr
);

931 
c
.
¸óã_cq
.
cqid
 = 
	`˝u_to_À16
(
qid
);

932 
c
.
¸óã_cq
.
qsize
 = 
	`˝u_to_À16
(
nvmeq
->
q_dïth
 - 1);

933 
c
.
¸óã_cq
.
cq_Êags
 = 
	`˝u_to_À16
(
Êags
);

934 
c
.
¸óã_cq
.
úq_ve˘‹
 = 
	`˝u_to_À16
(
nvmeq
->
cq_ve˘‹
);

936  
	`nvme_submô_admö_cmd
(
dev
, &
c
, 
NULL
);

937 
	}
}

939 
	$ad≠ãr_Æloc_sq
(
nvme_dev
 *
dev
, 
u16
 
qid
,

940 
nvme_queue
 *
nvmeq
)

942 
nvme_comm™d
 
c
;

943 
Êags
 = 
NVME_QUEUE_PHYS_CONTIG
 | 
NVME_SQ_PRIO_MEDIUM
;

945 
	`mem£t
(&
c
, 0, (c));

946 
c
.
¸óã_sq
.
›code
 = 
nvme_admö_¸óã_sq
;

947 
c
.
¸óã_sq
.
¥p1
 = 
	`˝u_to_À64
(
nvmeq
->
sq_dma_addr
);

948 
c
.
¸óã_sq
.
sqid
 = 
	`˝u_to_À16
(
qid
);

949 
c
.
¸óã_sq
.
qsize
 = 
	`˝u_to_À16
(
nvmeq
->
q_dïth
 - 1);

950 
c
.
¸óã_sq
.
sq_Êags
 = 
	`˝u_to_À16
(
Êags
);

951 
c
.
¸óã_sq
.
cqid
 = 
	`˝u_to_À16
(
qid
);

953  
	`nvme_submô_admö_cmd
(
dev
, &
c
, 
NULL
);

954 
	}
}

956 
	$ad≠ãr_dñëe_cq
(
nvme_dev
 *
dev
, 
u16
 
cqid
)

958  
	`ad≠ãr_dñëe_queue
(
dev
, 
nvme_admö_dñëe_cq
, 
cqid
);

959 
	}
}

961 
	$ad≠ãr_dñëe_sq
(
nvme_dev
 *
dev
, 
u16
 
sqid
)

963  
	`ad≠ãr_dñëe_queue
(
dev
, 
nvme_admö_dñëe_sq
, 
sqid
);

964 
	}
}

966 
	$nvme_idítify
(
nvme_dev
 *
dev
, 
nsid
, 
˙s
,

967 
dma_addr_t
 
dma_addr
)

969 
nvme_comm™d
 
c
;

971 
	`mem£t
(&
c
, 0, (c));

972 
c
.
idítify
.
›code
 = 
nvme_admö_idítify
;

973 
c
.
idítify
.
nsid
 = 
	`˝u_to_À32
(nsid);

974 
c
.
idítify
.
¥p1
 = 
	`˝u_to_À64
(
dma_addr
);

975 
c
.
idítify
.
˙s
 = 
	`˝u_to_À32
(cns);

977  
	`nvme_submô_admö_cmd
(
dev
, &
c
, 
NULL
);

978 
	}
}

980 
	$nvme_gë_„©uªs
(
nvme_dev
 *
dev
, 
fid
, 
nsid
,

981 
dma_addr_t
 
dma_addr
, 
u32
 *
ªsu…
)

983 
nvme_comm™d
 
c
;

985 
	`mem£t
(&
c
, 0, (c));

986 
c
.
„©uªs
.
›code
 = 
nvme_admö_gë_„©uªs
;

987 
c
.
„©uªs
.
nsid
 = 
	`˝u_to_À32
(nsid);

988 
c
.
„©uªs
.
¥p1
 = 
	`˝u_to_À64
(
dma_addr
);

989 
c
.
„©uªs
.
fid
 = 
	`˝u_to_À32
(fid);

991  
	`nvme_submô_admö_cmd
(
dev
, &
c
, 
ªsu…
);

992 
	}
}

994 
	$nvme_£t_„©uªs
(
nvme_dev
 *
dev
, 
fid
, 
dw‹d11
,

995 
dma_addr_t
 
dma_addr
, 
u32
 *
ªsu…
)

997 
nvme_comm™d
 
c
;

999 
	`mem£t
(&
c
, 0, (c));

1000 
c
.
„©uªs
.
›code
 = 
nvme_admö_£t_„©uªs
;

1001 
c
.
„©uªs
.
¥p1
 = 
	`˝u_to_À64
(
dma_addr
);

1002 
c
.
„©uªs
.
fid
 = 
	`˝u_to_À32
(fid);

1003 
c
.
„©uªs
.
dw‹d11
 = 
	`˝u_to_À32
(dword11);

1005  
	`nvme_submô_admö_cmd
(
dev
, &
c
, 
ªsu…
);

1006 
	}
}

1014 
	$nvme_ab‹t_ªq
(
ªque°
 *
ªq
)

1016 
nvme_cmd_öfo
 *
cmd_rq
 = 
	`blk_mq_rq_to_pdu
(
ªq
);

1017 
nvme_queue
 *
nvmeq
 = 
cmd_rq
->nvmeq;

1018 
nvme_dev
 *
dev
 = 
nvmeq
->dev;

1019 
ªque°
 *
ab‹t_ªq
;

1020 
nvme_cmd_öfo
 *
ab‹t_cmd
;

1021 
nvme_comm™d
 
cmd
;

1023 i‡(!
nvmeq
->
qid
 || 
cmd_rq
->
ab‹ãd
) {

1024 
Êags
;

1026 
	`•ö_lock_úqßve
(&
dev_li°_lock
, 
Êags
);

1027 i‡(
	`w‹k_busy
(&
dev
->
ª£t_w‹k
))

1028 
out
;

1029 
	`li°_dñ_öô
(&
dev
->
node
);

1030 
	`dev_w¨n
(&
dev
->
pci_dev
->dev,

1032 
ªq
->
èg
, 
nvmeq
->
qid
);

1033 
dev
->
ª£t_w‹k‚
 = 
nvme_ª£t_Áûed_dev
;

1034 
	`queue_w‹k
(
nvme_w‹kq
, &
dev
->
ª£t_w‹k
);

1035 
out
:

1036 
	`•ö_u∆ock_úqª°‹e
(&
dev_li°_lock
, 
Êags
);

1040 i‡(!
dev
->
ab‹t_limô
)

1043 
ab‹t_ªq
 = 
	`blk_mq_Æloc_ªque°
(
dev
->
admö_q
, 
WRITE
, 
GFP_ATOMIC
,

1044 
Ál£
);

1045 i‡(
	`IS_ERR
(
ab‹t_ªq
))

1048 
ab‹t_cmd
 = 
	`blk_mq_rq_to_pdu
(
ab‹t_ªq
);

1049 
	`nvme_£t_öfo
(
ab‹t_cmd
, 
ab‹t_ªq
, 
ab‹t_com∂ëi⁄
);

1051 
	`mem£t
(&
cmd
, 0, (cmd));

1052 
cmd
.
ab‹t
.
›code
 = 
nvme_admö_ab‹t_cmd
;

1053 
cmd
.
ab‹t
.
cid
 = 
ªq
->
èg
;

1054 
cmd
.
ab‹t
.
sqid
 = 
	`˝u_to_À16
(
nvmeq
->
qid
);

1055 
cmd
.
ab‹t
.
comm™d_id
 = 
ab‹t_ªq
->
èg
;

1057 --
dev
->
ab‹t_limô
;

1058 
cmd_rq
->
ab‹ãd
 = 1;

1060 
	`dev_w¨n
(
nvmeq
->
q_dmadev
, "Ab‹tög I/O %d QID %d\n", 
ªq
->
èg
,

1061 
nvmeq
->
qid
);

1062 i‡(
	`nvme_submô_cmd
(
dev
->
queues
[0], &
cmd
) < 0) {

1063 
	`dev_w¨n
(
nvmeq
->
q_dmadev
,

1065 
ªq
->
èg
, 
nvmeq
->
qid
);

1066 
	`blk_mq_‰ì_ªque°
(
ab‹t_ªq
);

1068 
	}
}

1070 
	$nvme_ˇn˚l_queue_ios
(
blk_mq_hw_˘x
 *
h˘x
,

1071 
ªque°
 *
ªq
, *
d©a
, 
boﬁ
 
ª£rved
)

1073 
nvme_queue
 *
nvmeq
 = 
d©a
;

1074 *
˘x
;

1075 
nvme_com∂ëi⁄_‚
 
‚
;

1076 
nvme_cmd_öfo
 *
cmd
;

1077 
nvme_com∂ëi⁄
 
cqe
;

1079 i‡(!
	`blk_mq_ªque°_°¨ãd
(
ªq
))

1082 
cmd
 = 
	`blk_mq_rq_to_pdu
(
ªq
);

1084 i‡(
cmd
->
˘x
 =
CMD_CTX_CANCELLED
)

1087 i‡(
	`blk_queue_dyög
(
ªq
->
q
))

1088 
cqe
.
°©us
 = 
	`˝u_to_À16
((
NVME_SC_ABORT_REQ
 | 
NVME_SC_DNR
) << 1);

1090 
cqe
.
°©us
 = 
	`˝u_to_À16
(
NVME_SC_ABORT_REQ
 << 1);

1093 
	`dev_w¨n
(
nvmeq
->
q_dmadev
, "Cancelling I/O %d QID %d\n",

1094 
ªq
->
èg
, 
nvmeq
->
qid
);

1095 
˘x
 = 
	`ˇn˚l_cmd_öfo
(
cmd
, &
‚
);

1096 
	`‚
(
nvmeq
, 
˘x
, &
cqe
);

1097 
	}
}

1099 
blk_eh_timî_ªtu∫
 
	$nvme_timeout
(
ªque°
 *
ªq
, 
boﬁ
 
ª£rved
)

1101 
nvme_cmd_öfo
 *
cmd
 = 
	`blk_mq_rq_to_pdu
(
ªq
);

1102 
nvme_queue
 *
nvmeq
 = 
cmd
->nvmeq;

1109 
ªt
 = 
BLK_EH_RESET_TIMER
;

1111 
	`dev_w¨n
(
nvmeq
->
q_dmadev
, "TimeouàI/O %d QID %d\n", 
ªq
->
èg
,

1112 
nvmeq
->
qid
);

1114 
	`•ö_lock_úq
(&
nvmeq
->
q_lock
);

1115 i‡(!
nvmeq
->
dev
->
öôülized
) {

1120 
	`nvme_ˇn˚l_queue_ios
(
nvmeq
->
h˘x
, 
ªq
,Çvmeq, 
ª£rved
);

1121 
ªt
 = 
BLK_EH_NOT_HANDLED
;

1123 
	`nvme_ab‹t_ªq
(
ªq
);

1124 
	`•ö_u∆ock_úq
(&
nvmeq
->
q_lock
);

1126  
ªt
;

1127 
	}
}

1129 
	$nvme_‰ì_queue
(
nvme_queue
 *
nvmeq
)

1131 
	`dma_‰ì_cohîít
(
nvmeq
->
q_dmadev
, 
	`CQ_SIZE
“vmeq->
q_dïth
),

1132 (*)
nvmeq
->
cqes
,Çvmeq->
cq_dma_addr
);

1133 
	`dma_‰ì_cohîít
(
nvmeq
->
q_dmadev
, 
	`SQ_SIZE
“vmeq->
q_dïth
),

1134 
nvmeq
->
sq_cmds
,Çvmeq->
sq_dma_addr
);

1135 
	`k‰ì
(
nvmeq
);

1136 
	}
}

1138 
	$nvme_‰ì_queues
(
nvme_dev
 *
dev
, 
lowe°
)

1140 
	`LLIST_HEAD
(
q_li°
);

1141 
nvme_queue
 *
nvmeq
, *
√xt
;

1142 
Œi°_node
 *
íåy
;

1143 
i
;

1145 
i
 = 
dev
->
queue_cou¡
 - 1; i >
lowe°
; i--) {

1146 
nvme_queue
 *
nvmeq
 = 
dev
->
queues
[
i
];

1147 
	`Œi°_add
(&
nvmeq
->
node
, &
q_li°
);

1148 
dev
->
queue_cou¡
--;

1149 
dev
->
queues
[
i
] = 
NULL
;

1151 
	`synchr⁄ize_rcu
();

1152 
íåy
 = 
	`Œi°_dñ_Æl
(&
q_li°
);

1153 
	`Œi°_f‹_óch_íåy_ß„
(
nvmeq
, 
√xt
, 
íåy
, 
node
)

1154 
	`nvme_‰ì_queue
(
nvmeq
);

1155 
	}
}

1161 
	$nvme_su•íd_queue
(
nvme_queue
 *
nvmeq
)

1163 
ve˘‹
;

1165 
	`•ö_lock_úq
(&
nvmeq
->
q_lock
);

1166 i‡(
nvmeq
->
cq_ve˘‹
 == -1) {

1167 
	`•ö_u∆ock_úq
(&
nvmeq
->
q_lock
);

1170 
ve˘‹
 = 
nvmeq
->
dev
->
íåy
[nvmeq->
cq_ve˘‹
].vector;

1171 
nvmeq
->
dev
->
⁄löe_queues
--;

1172 
nvmeq
->
cq_ve˘‹
 = -1;

1173 
	`•ö_u∆ock_úq
(&
nvmeq
->
q_lock
);

1175 
	`úq_£t_afföôy_höt
(
ve˘‹
, 
NULL
);

1176 
	`‰ì_úq
(
ve˘‹
, 
nvmeq
);

1179 
	}
}

1181 
	$nvme_˛ór_queue
(
nvme_queue
 *
nvmeq
)

1183 
blk_mq_hw_˘x
 *
h˘x
 = 
nvmeq
->hctx;

1185 
	`•ö_lock_úq
(&
nvmeq
->
q_lock
);

1186 
	`nvme_¥o˚ss_cq
(
nvmeq
);

1187 i‡(
h˘x
 && h˘x->
ègs
)

1188 
	`blk_mq_èg_busy_ôî
(
h˘x
, 
nvme_ˇn˚l_queue_ios
, 
nvmeq
);

1189 
	`•ö_u∆ock_úq
(&
nvmeq
->
q_lock
);

1190 
	}
}

1192 
	$nvme_dißbÀ_queue
(
nvme_dev
 *
dev
, 
qid
)

1194 
nvme_queue
 *
nvmeq
 = 
dev
->
queues
[
qid
];

1196 i‡(!
nvmeq
)

1198 i‡(
	`nvme_su•íd_queue
(
nvmeq
))

1203 i‡(
qid
 && 
	`ªadl
(&
dev
->
b¨
->
c°s
) != -1) {

1204 
	`ad≠ãr_dñëe_sq
(
dev
, 
qid
);

1205 
	`ad≠ãr_dñëe_cq
(
dev
, 
qid
);

1207 i‡(!
qid
 && 
dev
->
admö_q
)

1208 
	`blk_mq_‰ìze_queue_°¨t
(
dev
->
admö_q
);

1209 
	`nvme_˛ór_queue
(
nvmeq
);

1210 
	}
}

1212 
nvme_queue
 *
	$nvme_Æloc_queue
(
nvme_dev
 *
dev
, 
qid
,

1213 
dïth
)

1215 
devi˚
 *
dmadev
 = &
dev
->
pci_dev
->dev;

1216 
nvme_queue
 *
nvmeq
 = 
	`kzÆloc
((*nvmeq), 
GFP_KERNEL
);

1217 i‡(!
nvmeq
)

1218  
NULL
;

1220 
nvmeq
->
cqes
 = 
	`dma_zÆloc_cohîít
(
dmadev
, 
	`CQ_SIZE
(
dïth
),

1221 &
nvmeq
->
cq_dma_addr
, 
GFP_KERNEL
);

1222 i‡(!
nvmeq
->
cqes
)

1223 
‰ì_nvmeq
;

1225 
nvmeq
->
sq_cmds
 = 
	`dma_Æloc_cohîít
(
dmadev
, 
	`SQ_SIZE
(
dïth
),

1226 &
nvmeq
->
sq_dma_addr
, 
GFP_KERNEL
);

1227 i‡(!
nvmeq
->
sq_cmds
)

1228 
‰ì_cqdma
;

1230 
nvmeq
->
q_dmadev
 = 
dmadev
;

1231 
nvmeq
->
dev
 = dev;

1232 
	`¢¥ötf
(
nvmeq
->
úq«me
, (nvmeq->irqname), "nvme%dq%d",

1233 
dev
->
ö°™˚
, 
qid
);

1234 
	`•ö_lock_öô
(&
nvmeq
->
q_lock
);

1235 
nvmeq
->
cq_hód
 = 0;

1236 
nvmeq
->
cq_pha£
 = 1;

1237 
nvmeq
->
q_db
 = &
dev
->
dbs
[
qid
 * 2 * dev->
db_°ride
];

1238 
nvmeq
->
q_dïth
 = 
dïth
;

1239 
nvmeq
->
qid
 = qid;

1240 
dev
->
queue_cou¡
++;

1241 
dev
->
queues
[
qid
] = 
nvmeq
;

1243  
nvmeq
;

1245 
‰ì_cqdma
:

1246 
	`dma_‰ì_cohîít
(
dmadev
, 
	`CQ_SIZE
(
dïth
), (*)
nvmeq
->
cqes
,

1247 
nvmeq
->
cq_dma_addr
);

1248 
‰ì_nvmeq
:

1249 
	`k‰ì
(
nvmeq
);

1250  
NULL
;

1251 
	}
}

1253 
	$queue_ªque°_úq
(
nvme_dev
 *
dev
, 
nvme_queue
 *
nvmeq
,

1254 c⁄° *
«me
)

1256 i‡(
u£_thªaded_öãºu±s
)

1257  
	`ªque°_thªaded_úq
(
dev
->
íåy
[
nvmeq
->
cq_ve˘‹
].
ve˘‹
,

1258 
nvme_úq_check
, 
nvme_úq
, 
IRQF_SHARED
,

1259 
«me
, 
nvmeq
);

1260  
	`ªque°_úq
(
dev
->
íåy
[
nvmeq
->
cq_ve˘‹
].
ve˘‹
, 
nvme_úq
,

1261 
IRQF_SHARED
, 
«me
, 
nvmeq
);

1262 
	}
}

1264 
	$nvme_öô_queue
(
nvme_queue
 *
nvmeq
, 
u16
 
qid
)

1266 
nvme_dev
 *
dev
 = 
nvmeq
->dev;

1268 
	`•ö_lock_úq
(&
nvmeq
->
q_lock
);

1269 
nvmeq
->
sq_èû
 = 0;

1270 
nvmeq
->
cq_hód
 = 0;

1271 
nvmeq
->
cq_pha£
 = 1;

1272 
nvmeq
->
q_db
 = &
dev
->
dbs
[
qid
 * 2 * dev->
db_°ride
];

1273 
	`mem£t
((*)
nvmeq
->
cqes
, 0, 
	`CQ_SIZE
“vmeq->
q_dïth
));

1274 
dev
->
⁄löe_queues
++;

1275 
	`•ö_u∆ock_úq
(&
nvmeq
->
q_lock
);

1276 
	}
}

1278 
	$nvme_¸óã_queue
(
nvme_queue
 *
nvmeq
, 
qid
)

1280 
nvme_dev
 *
dev
 = 
nvmeq
->dev;

1281 
ªsu…
;

1283 
nvmeq
->
cq_ve˘‹
 = 
qid
 - 1;

1284 
ªsu…
 = 
	`ad≠ãr_Æloc_cq
(
dev
, 
qid
, 
nvmeq
);

1285 i‡(
ªsu…
 < 0)

1286  
ªsu…
;

1288 
ªsu…
 = 
	`ad≠ãr_Æloc_sq
(
dev
, 
qid
, 
nvmeq
);

1289 i‡(
ªsu…
 < 0)

1290 
ªÀa£_cq
;

1292 
ªsu…
 = 
	`queue_ªque°_úq
(
dev
, 
nvmeq
,Çvmeq->
úq«me
);

1293 i‡(
ªsu…
 < 0)

1294 
ªÀa£_sq
;

1296 
	`nvme_öô_queue
(
nvmeq
, 
qid
);

1297  
ªsu…
;

1299 
ªÀa£_sq
:

1300 
	`ad≠ãr_dñëe_sq
(
dev
, 
qid
);

1301 
ªÀa£_cq
:

1302 
	`ad≠ãr_dñëe_cq
(
dev
, 
qid
);

1303  
ªsu…
;

1304 
	}
}

1306 
	$nvme_waô_ªady
(
nvme_dev
 *
dev
, 
u64
 
ˇp
, 
boﬁ
 
íabÀd
)

1308 
timeout
;

1309 
u32
 
bô
 = 
íabÀd
 ? 
NVME_CSTS_RDY
 : 0;

1311 
timeout
 = ((
	`NVME_CAP_TIMEOUT
(
ˇp
Ë+ 1Ë* 
HZ
 / 2Ë+ 
jiffõs
;

1313 (
	`ªadl
(&
dev
->
b¨
->
c°s
Ë& 
NVME_CSTS_RDY
Ë!
bô
) {

1314 
	`m¶ìp
(100);

1315 i‡(
	`Áèl_sig«l_≥ndög
(
cuºít
))

1316  -
EINTR
;

1317 i‡(
	`time_a·î
(
jiffõs
, 
timeout
)) {

1318 
	`dev_îr
(&
dev
->
pci_dev
->dev,

1319 "Devi˚ÇŸÑódy;áb‹tög %s\n", 
íabÀd
 ?

1321  -
ENODEV
;

1326 
	}
}

1334 
	$nvme_dißbÀ_˘æ
(
nvme_dev
 *
dev
, 
u64
 
ˇp
)

1336 
dev
->
˘æ_c⁄fig
 &~
NVME_CC_SHN_MASK
;

1337 
dev
->
˘æ_c⁄fig
 &~
NVME_CC_ENABLE
;

1338 
	`wrôñ
(
dev
->
˘æ_c⁄fig
, &dev->
b¨
->
cc
);

1340  
	`nvme_waô_ªady
(
dev
, 
ˇp
, 
Ál£
);

1341 
	}
}

1343 
	$nvme_íabÀ_˘æ
(
nvme_dev
 *
dev
, 
u64
 
ˇp
)

1345 
dev
->
˘æ_c⁄fig
 &~
NVME_CC_SHN_MASK
;

1346 
dev
->
˘æ_c⁄fig
 |
NVME_CC_ENABLE
;

1347 
	`wrôñ
(
dev
->
˘æ_c⁄fig
, &dev->
b¨
->
cc
);

1349  
	`nvme_waô_ªady
(
dev
, 
ˇp
, 
åue
);

1350 
	}
}

1352 
	$nvme_shutdown_˘æ
(
nvme_dev
 *
dev
)

1354 
timeout
;

1356 
dev
->
˘æ_c⁄fig
 &~
NVME_CC_SHN_MASK
;

1357 
dev
->
˘æ_c⁄fig
 |
NVME_CC_SHN_NORMAL
;

1359 
	`wrôñ
(
dev
->
˘æ_c⁄fig
, &dev->
b¨
->
cc
);

1361 
timeout
 = 
SHUTDOWN_TIMEOUT
 + 
jiffõs
;

1362 (
	`ªadl
(&
dev
->
b¨
->
c°s
Ë& 
NVME_CSTS_SHST_MASK
) !=

1363 
NVME_CSTS_SHST_CMPLT
) {

1364 
	`m¶ìp
(100);

1365 i‡(
	`Áèl_sig«l_≥ndög
(
cuºít
))

1366  -
EINTR
;

1367 i‡(
	`time_a·î
(
jiffõs
, 
timeout
)) {

1368 
	`dev_îr
(&
dev
->
pci_dev
->dev,

1370  -
ENODEV
;

1375 
	}
}

1377 
blk_mq_›s
 
	gnvme_mq_admö_›s
 = {

1378 .
queue_rq
 = 
nvme_admö_queue_rq
,

1379 .
	gm≠_queue
 = 
blk_mq_m≠_queue
,

1380 .
	göô_h˘x
 = 
nvme_admö_öô_h˘x
,

1381 .
	gexô_h˘x
 = 
nvme_exô_h˘x
,

1382 .
	göô_ªque°
 = 
nvme_admö_öô_ªque°
,

1383 .
	gtimeout
 = 
nvme_timeout
,

1386 
blk_mq_›s
 
	gnvme_mq_›s
 = {

1387 .
queue_rq
 = 
nvme_queue_rq
,

1388 .
	gm≠_queue
 = 
blk_mq_m≠_queue
,

1389 .
	göô_h˘x
 = 
nvme_öô_h˘x
,

1390 .
	gexô_h˘x
 = 
nvme_exô_h˘x
,

1391 .
	göô_ªque°
 = 
nvme_öô_ªque°
,

1392 .
	gtimeout
 = 
nvme_timeout
,

1395 
	$nvme_dev_ªmove_admö
(
nvme_dev
 *
dev
)

1397 i‡(
dev
->
admö_q
 && !
	`blk_queue_dyög
(dev->admin_q)) {

1398 
	`blk_˛ónup_queue
(
dev
->
admö_q
);

1399 
	`blk_mq_‰ì_èg_£t
(&
dev
->
admö_èg£t
);

1401 
	}
}

1403 
	$nvme_Æloc_admö_ègs
(
nvme_dev
 *
dev
)

1405 i‡(!
dev
->
admö_q
) {

1406 
dev
->
admö_èg£t
.
›s
 = &
nvme_mq_admö_›s
;

1407 
dev
->
admö_èg£t
.
ƒ_hw_queues
 = 1;

1408 
dev
->
admö_èg£t
.
queue_dïth
 = 
NVME_AQ_DEPTH
 - 1;

1409 
dev
->
admö_èg£t
.
timeout
 = 
ADMIN_TIMEOUT
;

1410 
dev
->
admö_èg£t
.
numa_node
 = 
	`dev_to_node
(&dev->
pci_dev
->dev);

1411 
dev
->
admö_èg£t
.
cmd_size
 = (
nvme_cmd_öfo
);

1412 
dev
->
admö_èg£t
.
drivî_d©a
 = dev;

1414 i‡(
	`blk_mq_Æloc_èg_£t
(&
dev
->
admö_èg£t
))

1415  -
ENOMEM
;

1417 
dev
->
admö_q
 = 
	`blk_mq_öô_queue
(&dev->
admö_èg£t
);

1418 i‡(
	`IS_ERR
(
dev
->
admö_q
)) {

1419 
	`blk_mq_‰ì_èg_£t
(&
dev
->
admö_èg£t
);

1420  -
ENOMEM
;

1422 i‡(!
	`blk_gë_queue
(
dev
->
admö_q
)) {

1423 
	`nvme_dev_ªmove_admö
(
dev
);

1424  -
ENODEV
;

1427 
	`blk_mq_un‰ìze_queue
(
dev
->
admö_q
);

1430 
	}
}

1432 
	$nvme_c⁄figuª_admö_queue
(
nvme_dev
 *
dev
)

1434 
ªsu…
;

1435 
u32
 
aqa
;

1436 
u64
 
ˇp
 = 
	`ªadq
(&
dev
->
b¨
->cap);

1437 
nvme_queue
 *
nvmeq
;

1438 
∑ge_shi·
 = 
PAGE_SHIFT
;

1439 
dev_∑ge_mö
 = 
	`NVME_CAP_MPSMIN
(
ˇp
) + 12;

1440 
dev_∑ge_max
 = 
	`NVME_CAP_MPSMAX
(
ˇp
) + 12;

1442 i‡(
∑ge_shi·
 < 
dev_∑ge_mö
) {

1443 
	`dev_îr
(&
dev
->
pci_dev
->dev,

1445 "ho° (%u)\n", 1 << 
dev_∑ge_mö
,

1446 1 << 
∑ge_shi·
);

1447  -
ENODEV
;

1449 i‡(
∑ge_shi·
 > 
dev_∑ge_max
) {

1450 
	`dev_öfo
(&
dev
->
pci_dev
->dev,

1453 1 << 
dev_∑ge_max
, 1 << 
∑ge_shi·
);

1454 
∑ge_shi·
 = 
dev_∑ge_max
;

1457 
ªsu…
 = 
	`nvme_dißbÀ_˘æ
(
dev
, 
ˇp
);

1458 i‡(
ªsu…
 < 0)

1459  
ªsu…
;

1461 
nvmeq
 = 
dev
->
queues
[0];

1462 i‡(!
nvmeq
) {

1463 
nvmeq
 = 
	`nvme_Æloc_queue
(
dev
, 0, 
NVME_AQ_DEPTH
);

1464 i‡(!
nvmeq
)

1465  -
ENOMEM
;

1468 
aqa
 = 
nvmeq
->
q_dïth
 - 1;

1469 
aqa
 |=áqa << 16;

1471 
dev
->
∑ge_size
 = 1 << 
∑ge_shi·
;

1473 
dev
->
˘æ_c⁄fig
 = 
NVME_CC_CSS_NVM
;

1474 
dev
->
˘æ_c⁄fig
 |(
∑ge_shi·
 - 12Ë<< 
NVME_CC_MPS_SHIFT
;

1475 
dev
->
˘æ_c⁄fig
 |
NVME_CC_ARB_RR
 | 
NVME_CC_SHN_NONE
;

1476 
dev
->
˘æ_c⁄fig
 |
NVME_CC_IOSQES
 | 
NVME_CC_IOCQES
;

1478 
	`wrôñ
(
aqa
, &
dev
->
b¨
->aqa);

1479 
	`wrôeq
(
nvmeq
->
sq_dma_addr
, &
dev
->
b¨
->
asq
);

1480 
	`wrôeq
(
nvmeq
->
cq_dma_addr
, &
dev
->
b¨
->
acq
);

1482 
ªsu…
 = 
	`nvme_íabÀ_˘æ
(
dev
, 
ˇp
);

1483 i‡(
ªsu…
)

1484 
‰ì_nvmeq
;

1486 
nvmeq
->
cq_ve˘‹
 = 0;

1487 
ªsu…
 = 
	`queue_ªque°_úq
(
dev
, 
nvmeq
,Çvmeq->
úq«me
);

1488 i‡(
ªsu…
)

1489 
‰ì_nvmeq
;

1491  
ªsu…
;

1493 
‰ì_nvmeq
:

1494 
	`nvme_‰ì_queues
(
dev
, 0);

1495  
ªsu…
;

1496 
	}
}

1498 
nvme_iod
 *
	$nvme_m≠_u£r_∑ges
(
nvme_dev
 *
dev
, 
wrôe
,

1499 
addr
, 
Àngth
)

1501 
i
, 
îr
, 
cou¡
, 
√¡s
, 
off£t
;

1502 
sˇâîli°
 *
sg
;

1503 
∑ge
 **
∑ges
;

1504 
nvme_iod
 *
iod
;

1506 i‡(
addr
 & 3)

1507  
	`ERR_PTR
(-
EINVAL
);

1508 i‡(!
Àngth
 ||Üígth > 
INT_MAX
 - 
PAGE_SIZE
)

1509  
	`ERR_PTR
(-
EINVAL
);

1511 
off£t
 = 
	`off£t_ö_∑ge
(
addr
);

1512 
cou¡
 = 
	`DIV_ROUND_UP
(
off£t
 + 
Àngth
, 
PAGE_SIZE
);

1513 
∑ges
 = 
	`kˇŒoc
(
cou¡
, (*∑ges), 
GFP_KERNEL
);

1514 i‡(!
∑ges
)

1515  
	`ERR_PTR
(-
ENOMEM
);

1517 
îr
 = 
	`gë_u£r_∑ges_Á°
(
addr
, 
cou¡
, 1, 
∑ges
);

1518 i‡(
îr
 < 
cou¡
) {

1519 
cou¡
 = 
îr
;

1520 
îr
 = -
EFAULT
;

1521 
put_∑ges
;

1524 
îr
 = -
ENOMEM
;

1525 
iod
 = 
	`nvme_Æloc_iod
(
cou¡
, 
Àngth
, 
dev
, 
GFP_KERNEL
);

1526 i‡(!
iod
)

1527 
put_∑ges
;

1529 
sg
 = 
iod
->sg;

1530 
	`sg_öô_èbÀ
(
sg
, 
cou¡
);

1531 
i
 = 0; i < 
cou¡
; i++) {

1532 
	`sg_£t_∑ge
(&
sg
[
i
], 
∑ges
[i],

1533 
	`mö_t
(, 
Àngth
, 
PAGE_SIZE
 - 
off£t
),

1534 
off£t
);

1535 
Àngth
 -(
PAGE_SIZE
 - 
off£t
);

1536 
off£t
 = 0;

1538 
	`sg_m¨k_íd
(&
sg
[
i
 - 1]);

1539 
iod
->
√¡s
 = 
cou¡
;

1541 
√¡s
 = 
	`dma_m≠_sg
(&
dev
->
pci_dev
->dev, 
sg
, 
cou¡
,

1542 
wrôe
 ? 
DMA_TO_DEVICE
 : 
DMA_FROM_DEVICE
);

1543 i‡(!
√¡s
)

1544 
‰ì_iod
;

1546 
	`k‰ì
(
∑ges
);

1547  
iod
;

1549 
‰ì_iod
:

1550 
	`k‰ì
(
iod
);

1551 
put_∑ges
:

1552 
i
 = 0; i < 
cou¡
; i++)

1553 
	`put_∑ge
(
∑ges
[
i
]);

1554 
	`k‰ì
(
∑ges
);

1555  
	`ERR_PTR
(
îr
);

1556 
	}
}

1558 
	$nvme_unm≠_u£r_∑ges
(
nvme_dev
 *
dev
, 
wrôe
,

1559 
nvme_iod
 *
iod
)

1561 
i
;

1563 
	`dma_unm≠_sg
(&
dev
->
pci_dev
->dev, 
iod
->
sg
, iod->
√¡s
,

1564 
wrôe
 ? 
DMA_TO_DEVICE
 : 
DMA_FROM_DEVICE
);

1566 
i
 = 0; i < 
iod
->
√¡s
; i++)

1567 
	`put_∑ge
(
	`sg_∑ge
(&
iod
->
sg
[
i
]));

1568 
	}
}

1570 
	$nvme_submô_io
(
nvme_ns
 *
ns
, 
nvme_u£r_io
 
__u£r
 *
uio
)

1572 
nvme_dev
 *
dev
 = 
ns
->dev;

1573 
nvme_u£r_io
 
io
;

1574 
nvme_comm™d
 
c
;

1575 
Àngth
, 
mëa_Àn
;

1576 
°©us
, 
i
;

1577 
nvme_iod
 *
iod
, *
mëa_iod
 = 
NULL
;

1578 
dma_addr_t
 
mëa_dma_addr
;

1579 *
mëa
, *
	`unöôülized_v¨
(
mëa_mem
);

1581 i‡(
	`c›y_‰om_u£r
(&
io
, 
uio
, (io)))

1582  -
EFAULT
;

1583 
Àngth
 = (
io
.
nblocks
 + 1Ë<< 
ns
->
lba_shi·
;

1584 
mëa_Àn
 = (
io
.
nblocks
 + 1Ë* 
ns
->
ms
;

1586 i‡(
mëa_Àn
 && ((
io
.
mëad©a
 & 3) || !io.metadata))

1587  -
EINVAL
;

1589 
io
.
›code
) {

1590 
nvme_cmd_wrôe
:

1591 
nvme_cmd_ªad
:

1592 
nvme_cmd_com∑ª
:

1593 
iod
 = 
	`nvme_m≠_u£r_∑ges
(
dev
, 
io
.
›code
 & 1, io.
addr
, 
Àngth
);

1596  -
EINVAL
;

1599 i‡(
	`IS_ERR
(
iod
))

1600  
	`PTR_ERR
(
iod
);

1602 
	`mem£t
(&
c
, 0, (c));

1603 
c
.
rw
.
›code
 = 
io
.opcode;

1604 
c
.
rw
.
Êags
 = 
io
.flags;

1605 
c
.
rw
.
nsid
 = 
	`˝u_to_À32
(
ns
->
ns_id
);

1606 
c
.
rw
.
¶ba
 = 
	`˝u_to_À64
(
io
.slba);

1607 
c
.
rw
.
Àngth
 = 
	`˝u_to_À16
(
io
.
nblocks
);

1608 
c
.
rw
.
c⁄åﬁ
 = 
	`˝u_to_À16
(
io
.control);

1609 
c
.
rw
.
dsmgmt
 = 
	`˝u_to_À32
(
io
.dsmgmt);

1610 
c
.
rw
.
ª·ag
 = 
	`˝u_to_À32
(
io
.reftag);

1611 
c
.
rw
.
≠±ag
 = 
	`˝u_to_À16
(
io
.apptag);

1612 
c
.
rw
.
≠pmask
 = 
	`˝u_to_À16
(
io
.appmask);

1614 i‡(
mëa_Àn
) {

1615 
mëa_iod
 = 
	`nvme_m≠_u£r_∑ges
(
dev
, 
io
.
›code
 & 1, io.
mëad©a
,

1616 
mëa_Àn
);

1617 i‡(
	`IS_ERR
(
mëa_iod
)) {

1618 
°©us
 = 
	`PTR_ERR
(
mëa_iod
);

1619 
mëa_iod
 = 
NULL
;

1620 
unm≠
;

1623 
mëa_mem
 = 
	`dma_Æloc_cohîít
(&
dev
->
pci_dev
->dev, 
mëa_Àn
,

1624 &
mëa_dma_addr
, 
GFP_KERNEL
);

1625 i‡(!
mëa_mem
) {

1626 
°©us
 = -
ENOMEM
;

1627 
unm≠
;

1630 i‡(
io
.
›code
 & 1) {

1631 
mëa_off£t
 = 0;

1633 
i
 = 0; i < 
mëa_iod
->
√¡s
; i++) {

1634 
mëa
 = 
	`km≠_©omic
(
	`sg_∑ge
(&
mëa_iod
->
sg
[
i
])) +

1635 
mëa_iod
->
sg
[
i
].
off£t
;

1636 
	`mem˝y
(
mëa_mem
 + 
mëa_off£t
, 
mëa
,

1637 
mëa_iod
->
sg
[
i
].
Àngth
);

1638 
	`kunm≠_©omic
(
mëa
);

1639 
mëa_off£t
 +
mëa_iod
->
sg
[
i
].
Àngth
;

1643 
c
.
rw
.
mëad©a
 = 
	`˝u_to_À64
(
mëa_dma_addr
);

1646 
Àngth
 = 
	`nvme_£tup_¥ps
(
dev
, 
iod
,Üígth, 
GFP_KERNEL
);

1647 
c
.
rw
.
¥p1
 = 
	`˝u_to_À64
(
	`sg_dma_addªss
(
iod
->
sg
));

1648 
c
.
rw
.
¥p2
 = 
	`˝u_to_À64
(
iod
->
fú°_dma
);

1650 i‡(
Àngth
 !(
io
.
nblocks
 + 1Ë<< 
ns
->
lba_shi·
)

1651 
°©us
 = -
ENOMEM
;

1653 
°©us
 = 
	`nvme_submô_io_cmd
(
dev
, 
ns
, &
c
, 
NULL
);

1655 i‡(
mëa_Àn
) {

1656 i‡(
°©us
 =
NVME_SC_SUCCESS
 && !(
io
.
›code
 & 1)) {

1657 
mëa_off£t
 = 0;

1659 
i
 = 0; i < 
mëa_iod
->
√¡s
; i++) {

1660 
mëa
 = 
	`km≠_©omic
(
	`sg_∑ge
(&
mëa_iod
->
sg
[
i
])) +

1661 
mëa_iod
->
sg
[
i
].
off£t
;

1662 
	`mem˝y
(
mëa
, 
mëa_mem
 + 
mëa_off£t
,

1663 
mëa_iod
->
sg
[
i
].
Àngth
);

1664 
	`kunm≠_©omic
(
mëa
);

1665 
mëa_off£t
 +
mëa_iod
->
sg
[
i
].
Àngth
;

1669 
	`dma_‰ì_cohîít
(&
dev
->
pci_dev
->dev, 
mëa_Àn
, 
mëa_mem
,

1670 
mëa_dma_addr
);

1673 
unm≠
:

1674 
	`nvme_unm≠_u£r_∑ges
(
dev
, 
io
.
›code
 & 1, 
iod
);

1675 
	`nvme_‰ì_iod
(
dev
, 
iod
);

1677 i‡(
mëa_iod
) {

1678 
	`nvme_unm≠_u£r_∑ges
(
dev
, 
io
.
›code
 & 1, 
mëa_iod
);

1679 
	`nvme_‰ì_iod
(
dev
, 
mëa_iod
);

1682  
°©us
;

1683 
	}
}

1685 
	$nvme_u£r_cmd
(
nvme_dev
 *
dev
, 
nvme_ns
 *
ns
,

1686 
nvme_∑s°hru_cmd
 
__u£r
 *
ucmd
)

1688 
nvme_∑s°hru_cmd
 
cmd
;

1689 
nvme_comm™d
 
c
;

1690 
°©us
, 
Àngth
;

1691 
nvme_iod
 *
	`unöôülized_v¨
(
iod
);

1692 
timeout
;

1694 i‡(!
	`ˇ∑bÀ
(
CAP_SYS_ADMIN
))

1695  -
EACCES
;

1696 i‡(
	`c›y_‰om_u£r
(&
cmd
, 
ucmd
, (cmd)))

1697  -
EFAULT
;

1699 
	`mem£t
(&
c
, 0, (c));

1700 
c
.
comm⁄
.
›code
 = 
cmd
.opcode;

1701 
c
.
comm⁄
.
Êags
 = 
cmd
.flags;

1702 
c
.
comm⁄
.
nsid
 = 
	`˝u_to_À32
(
cmd
.nsid);

1703 
c
.
comm⁄
.
cdw2
[0] = 
	`˝u_to_À32
(
cmd
.cdw2);

1704 
c
.
comm⁄
.
cdw2
[1] = 
	`˝u_to_À32
(
cmd
.
cdw3
);

1705 
c
.
comm⁄
.
cdw10
[0] = 
	`˝u_to_À32
(
cmd
.cdw10);

1706 
c
.
comm⁄
.
cdw10
[1] = 
	`˝u_to_À32
(
cmd
.
cdw11
);

1707 
c
.
comm⁄
.
cdw10
[2] = 
	`˝u_to_À32
(
cmd
.
cdw12
);

1708 
c
.
comm⁄
.
cdw10
[3] = 
	`˝u_to_À32
(
cmd
.
cdw13
);

1709 
c
.
comm⁄
.
cdw10
[4] = 
	`˝u_to_À32
(
cmd
.
cdw14
);

1710 
c
.
comm⁄
.
cdw10
[5] = 
	`˝u_to_À32
(
cmd
.
cdw15
);

1712 
Àngth
 = 
cmd
.
d©a_Àn
;

1713 i‡(
cmd
.
d©a_Àn
) {

1714 
iod
 = 
	`nvme_m≠_u£r_∑ges
(
dev
, 
cmd
.
›code
 & 1, cmd.
addr
,

1715 
Àngth
);

1716 i‡(
	`IS_ERR
(
iod
))

1717  
	`PTR_ERR
(
iod
);

1718 
Àngth
 = 
	`nvme_£tup_¥ps
(
dev
, 
iod
,Üígth, 
GFP_KERNEL
);

1719 
c
.
comm⁄
.
¥p1
 = 
	`˝u_to_À64
(
	`sg_dma_addªss
(
iod
->
sg
));

1720 
c
.
comm⁄
.
¥p2
 = 
	`˝u_to_À64
(
iod
->
fú°_dma
);

1723 
timeout
 = 
cmd
.
timeout_ms
 ? 
	`m£cs_to_jiffõs
(cmd.timeout_ms) :

1724 
ADMIN_TIMEOUT
;

1726 i‡(
Àngth
 !
cmd
.
d©a_Àn
)

1727 
°©us
 = -
ENOMEM
;

1728 i‡(
ns
) {

1729 
ªque°
 *
ªq
;

1731 
ªq
 = 
	`blk_mq_Æloc_ªque°
(
ns
->
queue
, 
WRITE
,

1732 (
GFP_KERNEL
|
__GFP_WAIT
), 
Ál£
);

1733 i‡(
	`IS_ERR
(
ªq
))

1734 
°©us
 = 
	`PTR_ERR
(
ªq
);

1736 
°©us
 = 
	`nvme_submô_sync_cmd
(
ªq
, &
c
, &
cmd
.
ªsu…
,

1737 
timeout
);

1738 
	`blk_mq_‰ì_ªque°
(
ªq
);

1741 
°©us
 = 
	`__nvme_submô_admö_cmd
(
dev
, &
c
, &
cmd
.
ªsu…
, 
timeout
);

1743 i‡(
cmd
.
d©a_Àn
) {

1744 
	`nvme_unm≠_u£r_∑ges
(
dev
, 
cmd
.
›code
 & 1, 
iod
);

1745 
	`nvme_‰ì_iod
(
dev
, 
iod
);

1748 i‡((
°©us
 >0Ë&& 
	`c›y_to_u£r
(&
ucmd
->
ªsu…
, &
cmd
.result,

1749 (
cmd
.
ªsu…
)))

1750 
°©us
 = -
EFAULT
;

1752  
°©us
;

1753 
	}
}

1755 
	$nvme_io˘l
(
block_devi˚
 *
bdev
, 
fmode_t
 
mode
, 
cmd
,

1756 
¨g
)

1758 
nvme_ns
 *
ns
 = 
bdev
->
bd_disk
->
¥iv©e_d©a
;

1760 
cmd
) {

1761 
NVME_IOCTL_ID
:

1762 
	`f‹˚_suc˚ssful_sysˇŒ_ªtu∫
();

1763  
ns
->
ns_id
;

1764 
NVME_IOCTL_ADMIN_CMD
:

1765  
	`nvme_u£r_cmd
(
ns
->
dev
, 
NULL
, (
__u£r
 *)
¨g
);

1766 
NVME_IOCTL_IO_CMD
:

1767  
	`nvme_u£r_cmd
(
ns
->
dev
,Çs, (
__u£r
 *)
¨g
);

1768 
NVME_IOCTL_SUBMIT_IO
:

1769  
	`nvme_submô_io
(
ns
, (
__u£r
 *)
¨g
);

1770 
SG_GET_VERSION_NUM
:

1771  
	`nvme_sg_gë_vîsi⁄_num
((
__u£r
 *)
¨g
);

1772 
SG_IO
:

1773  
	`nvme_sg_io
(
ns
, (
__u£r
 *)
¨g
);

1775  -
ENOTTY
;

1777 
	}
}

1779 #ifde‡
CONFIG_COMPAT


1780 
	$nvme_com∑t_io˘l
(
block_devi˚
 *
bdev
, 
fmode_t
 
mode
,

1781 
cmd
, 
¨g
)

1783 
cmd
) {

1784 
SG_IO
:

1785  -
ENOIOCTLCMD
;

1787  
	`nvme_io˘l
(
bdev
, 
mode
, 
cmd
, 
¨g
);

1788 
	}
}

1790 
	#nvme_com∑t_io˘l
 
NULL


	)

1793 
	$nvme_›í
(
block_devi˚
 *
bdev
, 
fmode_t
 
mode
)

1795 
ªt
 = 0;

1796 
nvme_ns
 *
ns
;

1798 
	`•ö_lock
(&
dev_li°_lock
);

1799 
ns
 = 
bdev
->
bd_disk
->
¥iv©e_d©a
;

1800 i‡(!
ns
)

1801 
ªt
 = -
ENXIO
;

1802 i‡(!
	`kªf_gë_u∆ess_zîo
(&
ns
->
dev
->
kªf
))

1803 
ªt
 = -
ENXIO
;

1804 
	`•ö_u∆ock
(&
dev_li°_lock
);

1806  
ªt
;

1807 
	}
}

1809 
nvme_‰ì_dev
(
kªf
 *kref);

1811 
	$nvme_ªÀa£
(
gídisk
 *
disk
, 
fmode_t
 
mode
)

1813 
nvme_ns
 *
ns
 = 
disk
->
¥iv©e_d©a
;

1814 
nvme_dev
 *
dev
 = 
ns
->dev;

1816 
	`kªf_put
(&
dev
->
kªf
, 
nvme_‰ì_dev
);

1817 
	}
}

1819 
	$nvme_gëgeo
(
block_devi˚
 *
bd
, 
hd_geomëry
 *
geo
)

1822 
geo
->
hóds
 = 1 << 6;

1823 
geo
->
£˘‹s
 = 1 << 5;

1824 
geo
->
cylödîs
 = 
	`gë_ˇ∑côy
(
bd
->
bd_disk
) >> 11;

1826 
	}
}

1828 
	$nvme_ªvÆid©e_disk
(
gídisk
 *
disk
)

1830 
nvme_ns
 *
ns
 = 
disk
->
¥iv©e_d©a
;

1831 
nvme_dev
 *
dev
 = 
ns
->dev;

1832 
nvme_id_ns
 *
id
;

1833 
dma_addr_t
 
dma_addr
;

1834 
lbaf
;

1836 
id
 = 
	`dma_Æloc_cohîít
(&
dev
->
pci_dev
->dev, 4096, &
dma_addr
,

1837 
GFP_KERNEL
);

1838 i‡(!
id
) {

1839 
	`dev_w¨n
(&
dev
->
pci_dev
->dev, "%s: Memoryálocation failure\n",

1840 
__func__
);

1844 i‡(
	`nvme_idítify
(
dev
, 
ns
->
ns_id
, 0, 
dma_addr
))

1845 
‰ì
;

1847 
lbaf
 = 
id
->
Êbas
 & 0xf;

1848 
ns
->
lba_shi·
 = 
id
->
lbaf
[lbaf].
ds
;

1850 
	`blk_queue_logiˇl_block_size
(
ns
->
queue
, 1 <<Çs->
lba_shi·
);

1851 
	`£t_ˇ∑côy
(
disk
, 
	`À64_to_˝up
(&
id
->
nsze
Ë<< (
ns
->
lba_shi·
 - 9));

1852 
‰ì
:

1853 
	`dma_‰ì_cohîít
(&
dev
->
pci_dev
->dev, 4096, 
id
, 
dma_addr
);

1855 
	}
}

1857 c⁄° 
block_devi˚_›î©i⁄s
 
	gnvme_f›s
 = {

1858 .
ow√r
 = 
THIS_MODULE
,

1859 .
	gio˘l
 = 
nvme_io˘l
,

1860 .
	gcom∑t_io˘l
 = 
nvme_com∑t_io˘l
,

1861 .
	g›í
 = 
nvme_›í
,

1862 .
	gªÀa£
 = 
nvme_ªÀa£
,

1863 .
	ggëgeo
 = 
nvme_gëgeo
,

1864 .
	gªvÆid©e_disk

nvme_ªvÆid©e_disk
,

1867 
	$nvme_kthªad
(*
d©a
)

1869 
nvme_dev
 *
dev
, *
√xt
;

1871 !
	`kthªad_should_°›
()) {

1872 
	`£t_cuºít_°©e
(
TASK_INTERRUPTIBLE
);

1873 
	`•ö_lock
(&
dev_li°_lock
);

1874 
	`li°_f‹_óch_íåy_ß„
(
dev
, 
√xt
, &
dev_li°
, 
node
) {

1875 
i
;

1876 i‡(
	`ªadl
(&
dev
->
b¨
->
c°s
Ë& 
NVME_CSTS_CFS
 &&

1877 
dev
->
öôülized
) {

1878 i‡(
	`w‹k_busy
(&
dev
->
ª£t_w‹k
))

1880 
	`li°_dñ_öô
(&
dev
->
node
);

1881 
	`dev_w¨n
(&
dev
->
pci_dev
->dev,

1883 
	`ªadl
(&
dev
->
b¨
->
c°s
));

1884 
dev
->
ª£t_w‹k‚
 = 
nvme_ª£t_Áûed_dev
;

1885 
	`queue_w‹k
(
nvme_w‹kq
, &
dev
->
ª£t_w‹k
);

1888 
i
 = 0; i < 
dev
->
queue_cou¡
; i++) {

1889 
nvme_queue
 *
nvmeq
 = 
dev
->
queues
[
i
];

1890 i‡(!
nvmeq
)

1892 
	`•ö_lock_úq
(&
nvmeq
->
q_lock
);

1893 
	`nvme_¥o˚ss_cq
(
nvmeq
);

1895 (
i
 =0Ë&& (
dev
->
evít_limô
 > 0)) {

1896 i‡(
	`nvme_submô_async_admö_ªq
(
dev
))

1898 
dev
->
evít_limô
--;

1900 
	`•ö_u∆ock_úq
(&
nvmeq
->
q_lock
);

1903 
	`•ö_u∆ock
(&
dev_li°_lock
);

1904 
	`scheduÀ_timeout
(
	`round_jiffõs_ªœtive
(
HZ
));

1907 
	}
}

1909 
	$nvme_c⁄fig_disˇrd
(
nvme_ns
 *
ns
)

1911 
u32
 
logiˇl_block_size
 = 
	`queue_logiˇl_block_size
(
ns
->
queue
);

1912 
ns
->
queue
->
limôs
.
disˇrd_zî€s_d©a
 = 0;

1913 
ns
->
queue
->
limôs
.
disˇrd_Æignmít
 = 
logiˇl_block_size
;

1914 
ns
->
queue
->
limôs
.
disˇrd_gønuœrôy
 = 
logiˇl_block_size
;

1915 
ns
->
queue
->
limôs
.
max_disˇrd_£˘‹s
 = 0xffffffff;

1916 
	`queue_Êag_£t_u∆ocked
(
QUEUE_FLAG_DISCARD
, 
ns
->
queue
);

1917 
	}
}

1919 
nvme_ns
 *
	$nvme_Æloc_ns
(
nvme_dev
 *
dev
, 
nsid
,

1920 
nvme_id_ns
 *
id
, 
nvme_lba_ønge_ty≥
 *
π
)

1922 
nvme_ns
 *
ns
;

1923 
gídisk
 *
disk
;

1924 
node
 = 
	`dev_to_node
(&
dev
->
pci_dev
->dev);

1925 
lbaf
;

1927 i‡(
π
->
©åibuãs
 & 
NVME_LBART_ATTRIB_HIDE
)

1928  
NULL
;

1930 
ns
 = 
	`kzÆloc_node
((*ns), 
GFP_KERNEL
, 
node
);

1931 i‡(!
ns
)

1932  
NULL
;

1933 
ns
->
queue
 = 
	`blk_mq_öô_queue
(&
dev
->
èg£t
);

1934 i‡(
	`IS_ERR
(
ns
->
queue
))

1935 
out_‰ì_ns
;

1936 
	`queue_Êag_£t_u∆ocked
(
QUEUE_FLAG_NOMERGES
, 
ns
->
queue
);

1937 
	`queue_Êag_£t_u∆ocked
(
QUEUE_FLAG_NONROT
, 
ns
->
queue
);

1938 
	`queue_Êag_£t_u∆ocked
(
QUEUE_FLAG_SG_GAPS
, 
ns
->
queue
);

1939 
ns
->
dev
 = dev;

1940 
ns
->
queue
->
queued©a
 =Çs;

1942 
disk
 = 
	`Æloc_disk_node
(0, 
node
);

1943 i‡(!
disk
)

1944 
out_‰ì_queue
;

1946 
ns
->
ns_id
 = 
nsid
;

1947 
ns
->
disk
 = disk;

1948 
lbaf
 = 
id
->
Êbas
 & 0xf;

1949 
ns
->
lba_shi·
 = 
id
->
lbaf
[lbaf].
ds
;

1950 
ns
->
ms
 = 
	`À16_to_˝u
(
id
->
lbaf
[lbaf].ms);

1951 
	`blk_queue_logiˇl_block_size
(
ns
->
queue
, 1 <<Çs->
lba_shi·
);

1952 i‡(
dev
->
max_hw_£˘‹s
)

1953 
	`blk_queue_max_hw_£˘‹s
(
ns
->
queue
, 
dev
->
max_hw_£˘‹s
);

1954 i‡(
dev
->
°rùe_size
)

1955 
	`blk_queue_chunk_£˘‹s
(
ns
->
queue
, 
dev
->
°rùe_size
 >> 9);

1956 i‡(
dev
->
vwc
 & 
NVME_CTRL_VWC_PRESENT
)

1957 
	`blk_queue_Êush
(
ns
->
queue
, 
REQ_FLUSH
 | 
REQ_FUA
);

1959 
disk
->
maj‹
 = 
nvme_maj‹
;

1960 
disk
->
fú°_mö‹
 = 0;

1961 
disk
->
f›s
 = &
nvme_f›s
;

1962 
disk
->
¥iv©e_d©a
 = 
ns
;

1963 
disk
->
queue
 = 
ns
->queue;

1964 
disk
->
drivîfs_dev
 = &
dev
->
pci_dev
->dev;

1965 
disk
->
Êags
 = 
GENHD_FL_EXT_DEVT
;

1966 
	`•rötf
(
disk
->
disk_«me
, "nvme%dn%d", 
dev
->
ö°™˚
, 
nsid
);

1967 
	`£t_ˇ∑côy
(
disk
, 
	`À64_to_˝up
(&
id
->
nsze
Ë<< (
ns
->
lba_shi·
 - 9));

1969 i‡(
dev
->
⁄cs
 & 
NVME_CTRL_ONCS_DSM
)

1970 
	`nvme_c⁄fig_disˇrd
(
ns
);

1972  
ns
;

1974 
out_‰ì_queue
:

1975 
	`blk_˛ónup_queue
(
ns
->
queue
);

1976 
out_‰ì_ns
:

1977 
	`k‰ì
(
ns
);

1978  
NULL
;

1979 
	}
}

1981 
	$nvme_¸óã_io_queues
(
nvme_dev
 *
dev
)

1983 
i
;

1985 
i
 = 
dev
->
queue_cou¡
; i <dev->
max_qid
; i++)

1986 i‡(!
	`nvme_Æloc_queue
(
dev
, 
i
, dev->
q_dïth
))

1989 
i
 = 
dev
->
⁄löe_queues
; i <dev->
queue_cou¡
 - 1; i++)

1990 i‡(
	`nvme_¸óã_queue
(
dev
->
queues
[
i
], i))

1992 
	}
}

1994 
	$£t_queue_cou¡
(
nvme_dev
 *
dev
, 
cou¡
)

1996 
°©us
;

1997 
u32
 
ªsu…
;

1998 
u32
 
q_cou¡
 = (
cou¡
 - 1) | ((count - 1) << 16);

2000 
°©us
 = 
	`nvme_£t_„©uªs
(
dev
, 
NVME_FEAT_NUM_QUEUES
, 
q_cou¡
, 0,

2001 &
ªsu…
);

2002 i‡(
°©us
 < 0)

2003  
°©us
;

2004 i‡(
°©us
 > 0) {

2005 
	`dev_îr
(&
dev
->
pci_dev
->dev, "CouldÇot set queue count (%d)\n",

2006 
°©us
);

2009  
	`mö
(
ªsu…
 & 0xffff,Ñesult >> 16) + 1;

2010 
	}
}

2012 
size_t
 
	$db_b¨_size
(
nvme_dev
 *
dev
, 
ƒ_io_queues
)

2014  4096 + ((
ƒ_io_queues
 + 1Ë* 8 * 
dev
->
db_°ride
);

2015 
	}
}

2017 
	$nvme_£tup_io_queues
(
nvme_dev
 *
dev
)

2019 
nvme_queue
 *
admöq
 = 
dev
->
queues
[0];

2020 
pci_dev
 *
pdev
 = 
dev
->pci_dev;

2021 
ªsu…
, 
i
, 
vecs
, 
ƒ_io_queues
, 
size
;

2023 
ƒ_io_queues
 = 
	`num_possibÀ_˝us
();

2024 
ªsu…
 = 
	`£t_queue_cou¡
(
dev
, 
ƒ_io_queues
);

2025 i‡(
ªsu…
 <= 0)

2026  
ªsu…
;

2027 i‡(
ªsu…
 < 
ƒ_io_queues
)

2028 
ƒ_io_queues
 = 
ªsu…
;

2030 
size
 = 
	`db_b¨_size
(
dev
, 
ƒ_io_queues
);

2031 i‡(
size
 > 8192) {

2032 
	`iounm≠
(
dev
->
b¨
);

2034 
dev
->
b¨
 = 
	`i‹em≠
(
	`pci_ªsour˚_°¨t
(
pdev
, 0), 
size
);

2035 i‡(
dev
->
b¨
)

2037 i‡(!--
ƒ_io_queues
)

2038  -
ENOMEM
;

2039 
size
 = 
	`db_b¨_size
(
dev
, 
ƒ_io_queues
);

2041 
dev
->
dbs
 = ((
__iomem
 *)dev->
b¨
) + 4096;

2042 
admöq
->
q_db
 = 
dev
->
dbs
;

2046 
	`‰ì_úq
(
dev
->
íåy
[0].
ve˘‹
, 
admöq
);

2052 i‡(!
pdev
->
úq
)

2053 
	`pci_dißbÀ_msix
(
pdev
);

2055 
i
 = 0; i < 
ƒ_io_queues
; i++)

2056 
dev
->
íåy
[
i
].entry = i;

2057 
vecs
 = 
	`pci_íabÀ_msix_ønge
(
pdev
, 
dev
->
íåy
, 1, 
ƒ_io_queues
);

2058 i‡(
vecs
 < 0) {

2059 
vecs
 = 
	`pci_íabÀ_msi_ønge
(
pdev
, 1, 
	`mö
(
ƒ_io_queues
, 32));

2060 i‡(
vecs
 < 0) {

2061 
vecs
 = 1;

2063 
i
 = 0; i < 
vecs
; i++)

2064 
dev
->
íåy
[
i
].
ve˘‹
 = i + 
pdev
->
úq
;

2074 
ƒ_io_queues
 = 
vecs
;

2075 
dev
->
max_qid
 = 
ƒ_io_queues
;

2077 
ªsu…
 = 
	`queue_ªque°_úq
(
dev
, 
admöq
,ádmöq->
úq«me
);

2078 i‡(
ªsu…
)

2079 
‰ì_queues
;

2082 
	`nvme_‰ì_queues
(
dev
, 
ƒ_io_queues
 + 1);

2083 
	`nvme_¸óã_io_queues
(
dev
);

2087 
‰ì_queues
:

2088 
	`nvme_‰ì_queues
(
dev
, 1);

2089  
ªsu…
;

2090 
	}
}

2098 
	$nvme_dev_add
(
nvme_dev
 *
dev
)

2100 
pci_dev
 *
pdev
 = 
dev
->pci_dev;

2101 
ªs
;

2102 
¬
, 
i
;

2103 
nvme_ns
 *
ns
;

2104 
nvme_id_˘æ
 *
˘æ
;

2105 
nvme_id_ns
 *
id_ns
;

2106 *
mem
;

2107 
dma_addr_t
 
dma_addr
;

2108 
shi·
 = 
	`NVME_CAP_MPSMIN
(
	`ªadq
(&
dev
->
b¨
->
ˇp
)) + 12;

2110 
mem
 = 
	`dma_Æloc_cohîít
(&
pdev
->
dev
, 8192, &
dma_addr
, 
GFP_KERNEL
);

2111 i‡(!
mem
)

2112  -
ENOMEM
;

2114 
ªs
 = 
	`nvme_idítify
(
dev
, 0, 1, 
dma_addr
);

2115 i‡(
ªs
) {

2116 
	`dev_îr
(&
pdev
->
dev
, "Idítify C⁄åﬁÀ∏Áûed (%d)\n", 
ªs
);

2117 
ªs
 = -
EIO
;

2118 
out
;

2121 
˘æ
 = 
mem
;

2122 
¬
 = 
	`À32_to_˝up
(&
˘æ
->nn);

2123 
dev
->
⁄cs
 = 
	`À16_to_˝up
(&
˘æ
->oncs);

2124 
dev
->
ab‹t_limô
 = 
˘æ
->
a˛
 + 1;

2125 
dev
->
vwc
 = 
˘æ
->vwc;

2126 
dev
->
evít_limô
 = 
	`mö
(
˘æ
->
´æ
 + 1, 8);

2127 
	`mem˝y
(
dev
->
£rül
, 
˘æ
->
¢
, (ctrl->sn));

2128 
	`mem˝y
(
dev
->
modñ
, 
˘æ
->
mn
, (ctrl->mn));

2129 
	`mem˝y
(
dev
->
fúmw¨e_ªv
, 
˘æ
->
‰
, (ctrl->fr));

2130 i‡(
˘æ
->
mdts
)

2131 
dev
->
max_hw_£˘‹s
 = 1 << (
˘æ
->
mdts
 + 
shi·
 - 9);

2132 i‡((
pdev
->
víd‹
 =
PCI_VENDOR_ID_INTEL
) &&

2133 (
pdev
->
devi˚
 =0x0953Ë&& 
˘æ
->
vs
[3]) {

2134 
max_hw_£˘‹s
;

2136 
dev
->
°rùe_size
 = 1 << (
˘æ
->
vs
[3] + 
shi·
);

2137 
max_hw_£˘‹s
 = 
dev
->
°rùe_size
 >> (
shi·
 - 9);

2138 i‡(
dev
->
max_hw_£˘‹s
) {

2139 
dev
->
max_hw_£˘‹s
 = 
	`mö
(max_hw_sectors,

2140 
dev
->
max_hw_£˘‹s
);

2142 
dev
->
max_hw_£˘‹s
 = max_hw_sectors;

2145 
dev
->
èg£t
.
›s
 = &
nvme_mq_›s
;

2146 
dev
->
èg£t
.
ƒ_hw_queues
 = dev->
⁄löe_queues
 - 1;

2147 
dev
->
èg£t
.
timeout
 = 
NVME_IO_TIMEOUT
;

2148 
dev
->
èg£t
.
numa_node
 = 
	`dev_to_node
(&dev->
pci_dev
->dev);

2149 
dev
->
èg£t
.
queue_dïth
 =

2150 
	`mö_t
(, 
dev
->
q_dïth
, 
BLK_MQ_MAX_DEPTH
) - 1;

2151 
dev
->
èg£t
.
cmd_size
 = (
nvme_cmd_öfo
);

2152 
dev
->
èg£t
.
Êags
 = 
BLK_MQ_F_SHOULD_MERGE
;

2153 
dev
->
èg£t
.
drivî_d©a
 = dev;

2155 i‡(
	`blk_mq_Æloc_èg_£t
(&
dev
->
èg£t
))

2156 
out
;

2158 
id_ns
 = 
mem
;

2159 
i
 = 1; i <
¬
; i++) {

2160 
ªs
 = 
	`nvme_idítify
(
dev
, 
i
, 0, 
dma_addr
);

2161 i‡(
ªs
)

2164 i‡(
id_ns
->
nˇp
 == 0)

2167 
ªs
 = 
	`nvme_gë_„©uªs
(
dev
, 
NVME_FEAT_LBA_RANGE
, 
i
,

2168 
dma_addr
 + 4096, 
NULL
);

2169 i‡(
ªs
)

2170 
	`mem£t
(
mem
 + 4096, 0, 4096);

2172 
ns
 = 
	`nvme_Æloc_ns
(
dev
, 
i
, 
mem
, mem + 4096);

2173 i‡(
ns
)

2174 
	`li°_add_èû
(&
ns
->
li°
, &
dev
->
«me•a˚s
);

2176 
	`li°_f‹_óch_íåy
(
ns
, &
dev
->
«me•a˚s
, 
li°
)

2177 
	`add_disk
(
ns
->
disk
);

2178 
ªs
 = 0;

2180 
out
:

2181 
	`dma_‰ì_cohîít
(&
dev
->
pci_dev
->dev, 8192, 
mem
, 
dma_addr
);

2182  
ªs
;

2183 
	}
}

2185 
	$nvme_dev_m≠
(
nvme_dev
 *
dev
)

2187 
u64
 
ˇp
;

2188 
b¨s
, 
ªsu…
 = -
ENOMEM
;

2189 
pci_dev
 *
pdev
 = 
dev
->pci_dev;

2191 i‡(
	`pci_íabÀ_devi˚_mem
(
pdev
))

2192  
ªsu…
;

2194 
dev
->
íåy
[0].
ve˘‹
 = 
pdev
->
úq
;

2195 
	`pci_£t_ma°î
(
pdev
);

2196 
b¨s
 = 
	`pci_£À˘_b¨s
(
pdev
, 
IORESOURCE_MEM
);

2197 i‡(!
b¨s
)

2198 
dißbÀ_pci
;

2200 i‡(
	`pci_ªque°_£À˘ed_ªgi⁄s
(
pdev
, 
b¨s
, "nvme"))

2201 
dißbÀ_pci
;

2203 i‡(
	`dma_£t_mask_™d_cohîít
(&
pdev
->
dev
, 
	`DMA_BIT_MASK
(64)) &&

2204 
	`dma_£t_mask_™d_cohîít
(&
pdev
->
dev
, 
	`DMA_BIT_MASK
(32)))

2205 
dißbÀ
;

2207 
dev
->
b¨
 = 
	`i‹em≠
(
	`pci_ªsour˚_°¨t
(
pdev
, 0), 8192);

2208 i‡(!
dev
->
b¨
)

2209 
dißbÀ
;

2211 i‡(
	`ªadl
(&
dev
->
b¨
->
c°s
) == -1) {

2212 
ªsu…
 = -
ENODEV
;

2213 
unm≠
;

2220 i‡(!
pdev
->
úq
) {

2221 
ªsu…
 = 
	`pci_íabÀ_msix
(
pdev
, 
dev
->
íåy
, 1);

2222 i‡(
ªsu…
 < 0)

2223 
unm≠
;

2226 
ˇp
 = 
	`ªadq
(&
dev
->
b¨
->cap);

2227 
dev
->
q_dïth
 = 
	`mö_t
(, 
	`NVME_CAP_MQES
(
ˇp
Ë+ 1, 
NVME_Q_DEPTH
);

2228 
dev
->
db_°ride
 = 1 << 
	`NVME_CAP_STRIDE
(
ˇp
);

2229 
dev
->
dbs
 = ((
__iomem
 *)dev->
b¨
) + 4096;

2233 
unm≠
:

2234 
	`iounm≠
(
dev
->
b¨
);

2235 
dev
->
b¨
 = 
NULL
;

2236 
dißbÀ
:

2237 
	`pci_ªÀa£_ªgi⁄s
(
pdev
);

2238 
dißbÀ_pci
:

2239 
	`pci_dißbÀ_devi˚
(
pdev
);

2240  
ªsu…
;

2241 
	}
}

2243 
	$nvme_dev_unm≠
(
nvme_dev
 *
dev
)

2245 i‡(
dev
->
pci_dev
->
msi_íabÀd
)

2246 
	`pci_dißbÀ_msi
(
dev
->
pci_dev
);

2247 i‡(
dev
->
pci_dev
->
msix_íabÀd
)

2248 
	`pci_dißbÀ_msix
(
dev
->
pci_dev
);

2250 i‡(
dev
->
b¨
) {

2251 
	`iounm≠
(
dev
->
b¨
);

2252 
dev
->
b¨
 = 
NULL
;

2253 
	`pci_ªÀa£_ªgi⁄s
(
dev
->
pci_dev
);

2256 i‡(
	`pci_is_íabÀd
(
dev
->
pci_dev
))

2257 
	`pci_dißbÀ_devi˚
(
dev
->
pci_dev
);

2258 
	}
}

2260 
	snvme_dñq_˘x
 {

2261 
èsk_°ru˘
 *
	mwaôî
;

2262 
kthªad_w‹kî
 *
	mw‹kî
;

2263 
©omic_t
 
	mªfcou¡
;

2266 
	$nvme_waô_dq
(
nvme_dñq_˘x
 *
dq
, 
nvme_dev
 *
dev
)

2268 
dq
->
waôî
 = 
cuºít
;

2269 
	`mb
();

2272 
	`£t_cuºít_°©e
(
TASK_KILLABLE
);

2273 i‡(!
	`©omic_ªad
(&
dq
->
ªfcou¡
))

2275 i‡(!
	`scheduÀ_timeout
(
ADMIN_TIMEOUT
) ||

2276 
	`Áèl_sig«l_≥ndög
(
cuºít
)) {

2284 
	`£t_cuºít_°©e
(
TASK_RUNNING
);

2285 
	`nvme_dißbÀ_˘æ
(
dev
, 
	`ªadq
(&dev->
b¨
->
ˇp
));

2286 
	`nvme_˛ór_queue
(
dev
->
queues
[0]);

2287 
	`Êush_kthªad_w‹kî
(
dq
->
w‹kî
);

2288 
	`nvme_dißbÀ_queue
(
dev
, 0);

2292 
	`£t_cuºít_°©e
(
TASK_RUNNING
);

2293 
	}
}

2295 
	$nvme_put_dq
(
nvme_dñq_˘x
 *
dq
)

2297 
	`©omic_dec
(&
dq
->
ªfcou¡
);

2298 i‡(
dq
->
waôî
)

2299 
	`wake_up_¥o˚ss
(
dq
->
waôî
);

2300 
	}
}

2302 
nvme_dñq_˘x
 *
	$nvme_gë_dq
(
nvme_dñq_˘x
 *
dq
)

2304 
	`©omic_öc
(&
dq
->
ªfcou¡
);

2305  
dq
;

2306 
	}
}

2308 
	$nvme_dñ_queue_íd
(
nvme_queue
 *
nvmeq
)

2310 
nvme_dñq_˘x
 *
dq
 = 
nvmeq
->
cmdöfo
.
˘x
;

2312 
	`nvme_˛ór_queue
(
nvmeq
);

2313 
	`nvme_put_dq
(
dq
);

2314 
	}
}

2316 
	$ad≠ãr_async_dñ_queue
(
nvme_queue
 *
nvmeq
, 
u8
 
›code
,

2317 
kthªad_w‹k_func_t
 
‚
)

2319 
nvme_comm™d
 
c
;

2321 
	`mem£t
(&
c
, 0, (c));

2322 
c
.
dñëe_queue
.
›code
 = opcode;

2323 
c
.
dñëe_queue
.
qid
 = 
	`˝u_to_À16
(
nvmeq
->qid);

2325 
	`öô_kthªad_w‹k
(&
nvmeq
->
cmdöfo
.
w‹k
, 
‚
);

2326  
	`nvme_submô_admö_async_cmd
(
nvmeq
->
dev
, &
c
, &nvmeq->
cmdöfo
,

2327 
ADMIN_TIMEOUT
);

2328 
	}
}

2330 
	$nvme_dñ_cq_w‹k_h™dÀr
(
kthªad_w‹k
 *
w‹k
)

2332 
nvme_queue
 *
nvmeq
 = 
	`c⁄èöî_of
(
w‹k
, nvme_queue,

2333 
cmdöfo
.
w‹k
);

2334 
	`nvme_dñ_queue_íd
(
nvmeq
);

2335 
	}
}

2337 
	$nvme_dñëe_cq
(
nvme_queue
 *
nvmeq
)

2339  
	`ad≠ãr_async_dñ_queue
(
nvmeq
, 
nvme_admö_dñëe_cq
,

2340 
nvme_dñ_cq_w‹k_h™dÀr
);

2341 
	}
}

2343 
	$nvme_dñ_sq_w‹k_h™dÀr
(
kthªad_w‹k
 *
w‹k
)

2345 
nvme_queue
 *
nvmeq
 = 
	`c⁄èöî_of
(
w‹k
, nvme_queue,

2346 
cmdöfo
.
w‹k
);

2347 
°©us
 = 
nvmeq
->
cmdöfo
.status;

2349 i‡(!
°©us
)

2350 
°©us
 = 
	`nvme_dñëe_cq
(
nvmeq
);

2351 i‡(
°©us
)

2352 
	`nvme_dñ_queue_íd
(
nvmeq
);

2353 
	}
}

2355 
	$nvme_dñëe_sq
(
nvme_queue
 *
nvmeq
)

2357  
	`ad≠ãr_async_dñ_queue
(
nvmeq
, 
nvme_admö_dñëe_sq
,

2358 
nvme_dñ_sq_w‹k_h™dÀr
);

2359 
	}
}

2361 
	$nvme_dñ_queue_°¨t
(
kthªad_w‹k
 *
w‹k
)

2363 
nvme_queue
 *
nvmeq
 = 
	`c⁄èöî_of
(
w‹k
, nvme_queue,

2364 
cmdöfo
.
w‹k
);

2365 i‡(
	`nvme_dñëe_sq
(
nvmeq
))

2366 
	`nvme_dñ_queue_íd
(
nvmeq
);

2367 
	}
}

2369 
	$nvme_dißbÀ_io_queues
(
nvme_dev
 *
dev
)

2371 
i
;

2372 
	`DEFINE_KTHREAD_WORKER_ONSTACK
(
w‹kî
);

2373 
nvme_dñq_˘x
 
dq
;

2374 
èsk_°ru˘
 *
kw‹kî_èsk
 = 
	`kthªad_run
(
kthªad_w‹kî_‚
,

2375 &
w‹kî
, "nvme%d", 
dev
->
ö°™˚
);

2377 i‡(
	`IS_ERR
(
kw‹kî_èsk
)) {

2378 
	`dev_îr
(&
dev
->
pci_dev
->dev,

2380 
i
 = 
dev
->
queue_cou¡
 - 1; i > 0; i--)

2381 
	`nvme_dißbÀ_queue
(
dev
, 
i
);

2385 
dq
.
waôî
 = 
NULL
;

2386 
	`©omic_£t
(&
dq
.
ªfcou¡
, 0);

2387 
dq
.
w‹kî
 = &worker;

2388 
i
 = 
dev
->
queue_cou¡
 - 1; i > 0; i--) {

2389 
nvme_queue
 *
nvmeq
 = 
dev
->
queues
[
i
];

2391 i‡(
	`nvme_su•íd_queue
(
nvmeq
))

2393 
nvmeq
->
cmdöfo
.
˘x
 = 
	`nvme_gë_dq
(&
dq
);

2394 
nvmeq
->
cmdöfo
.
w‹kî
 = 
dq
.worker;

2395 
	`öô_kthªad_w‹k
(&
nvmeq
->
cmdöfo
.
w‹k
, 
nvme_dñ_queue_°¨t
);

2396 
	`queue_kthªad_w‹k
(
dq
.
w‹kî
, &
nvmeq
->
cmdöfo
.
w‹k
);

2398 
	`nvme_waô_dq
(&
dq
, 
dev
);

2399 
	`kthªad_°›
(
kw‹kî_èsk
);

2400 
	}
}

2406 
	$nvme_dev_li°_ªmove
(
nvme_dev
 *
dev
)

2408 
èsk_°ru˘
 *
tmp
 = 
NULL
;

2410 
	`•ö_lock
(&
dev_li°_lock
);

2411 
	`li°_dñ_öô
(&
dev
->
node
);

2412 i‡(
	`li°_em±y
(&
dev_li°
Ë&& !
	`IS_ERR_OR_NULL
(
nvme_thªad
)) {

2413 
tmp
 = 
nvme_thªad
;

2414 
nvme_thªad
 = 
NULL
;

2416 
	`•ö_u∆ock
(&
dev_li°_lock
);

2418 i‡(
tmp
)

2419 
	`kthªad_°›
(
tmp
);

2420 
	}
}

2422 
	$nvme_‰ìze_queues
(
nvme_dev
 *
dev
)

2424 
nvme_ns
 *
ns
;

2426 
	`li°_f‹_óch_íåy
(
ns
, &
dev
->
«me•a˚s
, 
li°
) {

2427 
	`blk_mq_‰ìze_queue_°¨t
(
ns
->
queue
);

2429 
	`•ö_lock
(
ns
->
queue
->
queue_lock
);

2430 
	`queue_Êag_£t
(
QUEUE_FLAG_STOPPED
, 
ns
->
queue
);

2431 
	`•ö_u∆ock
(
ns
->
queue
->
queue_lock
);

2433 
	`blk_mq_ˇn˚l_ªqueue_w‹k
(
ns
->
queue
);

2434 
	`blk_mq_°›_hw_queues
(
ns
->
queue
);

2436 
	}
}

2438 
	$nvme_un‰ìze_queues
(
nvme_dev
 *
dev
)

2440 
nvme_ns
 *
ns
;

2442 
	`li°_f‹_óch_íåy
(
ns
, &
dev
->
«me•a˚s
, 
li°
) {

2443 
	`queue_Êag_˛ór_u∆ocked
(
QUEUE_FLAG_STOPPED
, 
ns
->
queue
);

2444 
	`blk_mq_un‰ìze_queue
(
ns
->
queue
);

2445 
	`blk_mq_°¨t_°›≥d_hw_queues
(
ns
->
queue
, 
åue
);

2446 
	`blk_mq_kick_ªqueue_li°
(
ns
->
queue
);

2448 
	}
}

2450 
	$nvme_dev_shutdown
(
nvme_dev
 *
dev
)

2452 
i
;

2453 
u32
 
c°s
 = -1;

2455 
dev
->
öôülized
 = 0;

2456 
	`nvme_dev_li°_ªmove
(
dev
);

2458 i‡(
dev
->
b¨
) {

2459 
	`nvme_‰ìze_queues
(
dev
);

2460 
c°s
 = 
	`ªadl
(&
dev
->
b¨
->csts);

2462 i‡(
c°s
 & 
NVME_CSTS_CFS
 || !(c°†& 
NVME_CSTS_RDY
)) {

2463 
i
 = 
dev
->
queue_cou¡
 - 1; i >= 0; i--) {

2464 
nvme_queue
 *
nvmeq
 = 
dev
->
queues
[
i
];

2465 
	`nvme_su•íd_queue
(
nvmeq
);

2466 
	`nvme_˛ór_queue
(
nvmeq
);

2469 
	`nvme_dißbÀ_io_queues
(
dev
);

2470 
	`nvme_shutdown_˘æ
(
dev
);

2471 
	`nvme_dißbÀ_queue
(
dev
, 0);

2473 
	`nvme_dev_unm≠
(
dev
);

2474 
	}
}

2476 
	$nvme_dev_ªmove
(
nvme_dev
 *
dev
)

2478 
nvme_ns
 *
ns
;

2480 
	`li°_f‹_óch_íåy
(
ns
, &
dev
->
«me•a˚s
, 
li°
) {

2481 i‡(
ns
->
disk
->
Êags
 & 
GENHD_FL_UP
)

2482 
	`dñ_gídisk
(
ns
->
disk
);

2483 i‡(!
	`blk_queue_dyög
(
ns
->
queue
)) {

2484 
	`blk_mq_ab‹t_ªqueue_li°
(
ns
->
queue
);

2485 
	`blk_˛ónup_queue
(
ns
->
queue
);

2488 
	}
}

2490 
	$nvme_£tup_¥p_poﬁs
(
nvme_dev
 *
dev
)

2492 
devi˚
 *
dmadev
 = &
dev
->
pci_dev
->dev;

2493 
dev
->
¥p_∑ge_poﬁ
 = 
	`dma_poﬁ_¸óã
("¥∞li°Öage", 
dmadev
,

2494 
PAGE_SIZE
, PAGE_SIZE, 0);

2495 i‡(!
dev
->
¥p_∑ge_poﬁ
)

2496  -
ENOMEM
;

2499 
dev
->
¥p_smÆl_poﬁ
 = 
	`dma_poﬁ_¸óã
("¥∞li° 256", 
dmadev
,

2501 i‡(!
dev
->
¥p_smÆl_poﬁ
) {

2502 
	`dma_poﬁ_de°roy
(
dev
->
¥p_∑ge_poﬁ
);

2503  -
ENOMEM
;

2506 
	}
}

2508 
	$nvme_ªÀa£_¥p_poﬁs
(
nvme_dev
 *
dev
)

2510 
	`dma_poﬁ_de°roy
(
dev
->
¥p_∑ge_poﬁ
);

2511 
	`dma_poﬁ_de°roy
(
dev
->
¥p_smÆl_poﬁ
);

2512 
	}
}

2514 
DEFINE_IDA
(
nvme_ö°™˚_ida
);

2516 
	$nvme_£t_ö°™˚
(
nvme_dev
 *
dev
)

2518 
ö°™˚
, 
îr‹
;

2521 i‡(!
	`ida_¥e_gë
(&
nvme_ö°™˚_ida
, 
GFP_KERNEL
))

2522  -
ENODEV
;

2524 
	`•ö_lock
(&
dev_li°_lock
);

2525 
îr‹
 = 
	`ida_gë_√w
(&
nvme_ö°™˚_ida
, &
ö°™˚
);

2526 
	`•ö_u∆ock
(&
dev_li°_lock
);

2527 } 
îr‹
 =-
EAGAIN
);

2529 i‡(
îr‹
)

2530  -
ENODEV
;

2532 
dev
->
ö°™˚
 = instance;

2534 
	}
}

2536 
	$nvme_ªÀa£_ö°™˚
(
nvme_dev
 *
dev
)

2538 
	`•ö_lock
(&
dev_li°_lock
);

2539 
	`ida_ªmove
(&
nvme_ö°™˚_ida
, 
dev
->
ö°™˚
);

2540 
	`•ö_u∆ock
(&
dev_li°_lock
);

2541 
	}
}

2543 
	$nvme_‰ì_«me•a˚s
(
nvme_dev
 *
dev
)

2545 
nvme_ns
 *
ns
, *
√xt
;

2547 
	`li°_f‹_óch_íåy_ß„
(
ns
, 
√xt
, &
dev
->
«me•a˚s
, 
li°
) {

2548 
	`li°_dñ
(&
ns
->
li°
);

2550 
	`•ö_lock
(&
dev_li°_lock
);

2551 
ns
->
disk
->
¥iv©e_d©a
 = 
NULL
;

2552 
	`•ö_u∆ock
(&
dev_li°_lock
);

2554 
	`put_disk
(
ns
->
disk
);

2555 
	`k‰ì
(
ns
);

2557 
	}
}

2559 
	$nvme_‰ì_dev
(
kªf
 *kref)

2561 
nvme_dev
 *
dev
 = 
	`c⁄èöî_of
(
kªf
, nvme_dev, kref);

2563 
	`pci_dev_put
(
dev
->
pci_dev
);

2564 
	`nvme_‰ì_«me•a˚s
(
dev
);

2565 
	`nvme_ªÀa£_ö°™˚
(
dev
);

2566 
	`blk_mq_‰ì_èg_£t
(&
dev
->
èg£t
);

2567 
	`blk_put_queue
(
dev
->
admö_q
);

2568 
	`k‰ì
(
dev
->
queues
);

2569 
	`k‰ì
(
dev
->
íåy
);

2570 
	`k‰ì
(
dev
);

2571 
	}
}

2573 
	$nvme_dev_›í
(
öode
 *öode, 
fûe
 *
f
)

2575 
nvme_dev
 *
dev
 = 
	`c⁄èöî_of
(
f
->
¥iv©e_d©a
, nvme_dev,

2576 
miscdev
);

2577 
	`kªf_gë
(&
dev
->
kªf
);

2578 
f
->
¥iv©e_d©a
 = 
dev
;

2580 
	}
}

2582 
	$nvme_dev_ªÀa£
(
öode
 *öode, 
fûe
 *
f
)

2584 
nvme_dev
 *
dev
 = 
f
->
¥iv©e_d©a
;

2585 
	`kªf_put
(&
dev
->
kªf
, 
nvme_‰ì_dev
);

2587 
	}
}

2589 
	$nvme_dev_io˘l
(
fûe
 *
f
, 
cmd
, 
¨g
)

2591 
nvme_dev
 *
dev
 = 
f
->
¥iv©e_d©a
;

2592 
nvme_ns
 *
ns
;

2594 
cmd
) {

2595 
NVME_IOCTL_ADMIN_CMD
:

2596  
	`nvme_u£r_cmd
(
dev
, 
NULL
, (
__u£r
 *)
¨g
);

2597 
NVME_IOCTL_IO_CMD
:

2598 i‡(
	`li°_em±y
(&
dev
->
«me•a˚s
))

2599  -
ENOTTY
;

2600 
ns
 = 
	`li°_fú°_íåy
(&
dev
->
«me•a˚s
, 
nvme_ns
, 
li°
);

2601  
	`nvme_u£r_cmd
(
dev
, 
ns
, (
__u£r
 *)
¨g
);

2603  -
ENOTTY
;

2605 
	}
}

2607 c⁄° 
fûe_›î©i⁄s
 
	gnvme_dev_f›s
 = {

2608 .
ow√r
 = 
THIS_MODULE
,

2609 .
	g›í
 = 
nvme_dev_›í
,

2610 .
	gªÀa£
 = 
nvme_dev_ªÀa£
,

2611 .
	gu∆ocked_io˘l
 = 
nvme_dev_io˘l
,

2612 .
	gcom∑t_io˘l
 = 
nvme_dev_io˘l
,

2615 
	$nvme_£t_úq_höts
(
nvme_dev
 *
dev
)

2617 
nvme_queue
 *
nvmeq
;

2618 
i
;

2620 
i
 = 0; i < 
dev
->
⁄löe_queues
; i++) {

2621 
nvmeq
 = 
dev
->
queues
[
i
];

2623 i‡(!
nvmeq
->
h˘x
)

2626 
	`úq_£t_afföôy_höt
(
dev
->
íåy
[
nvmeq
->
cq_ve˘‹
].
ve˘‹
,

2627 
nvmeq
->
h˘x
->
˝umask
);

2629 
	}
}

2631 
	$nvme_dev_°¨t
(
nvme_dev
 *
dev
)

2633 
ªsu…
;

2634 
boﬁ
 
°¨t_thªad
 = 
Ál£
;

2636 
ªsu…
 = 
	`nvme_dev_m≠
(
dev
);

2637 i‡(
ªsu…
)

2638  
ªsu…
;

2640 
ªsu…
 = 
	`nvme_c⁄figuª_admö_queue
(
dev
);

2641 i‡(
ªsu…
)

2642 
unm≠
;

2644 
	`•ö_lock
(&
dev_li°_lock
);

2645 i‡(
	`li°_em±y
(&
dev_li°
Ë&& 
	`IS_ERR_OR_NULL
(
nvme_thªad
)) {

2646 
°¨t_thªad
 = 
åue
;

2647 
nvme_thªad
 = 
NULL
;

2649 
	`li°_add
(&
dev
->
node
, &
dev_li°
);

2650 
	`•ö_u∆ock
(&
dev_li°_lock
);

2652 i‡(
°¨t_thªad
) {

2653 
nvme_thªad
 = 
	`kthªad_run
(
nvme_kthªad
, 
NULL
, "nvme");

2654 
	`wake_up_Æl
(&
nvme_kthªad_waô
);

2656 
	`waô_evít_kûœbÀ
(
nvme_kthªad_waô
, 
nvme_thªad
);

2658 i‡(
	`IS_ERR_OR_NULL
(
nvme_thªad
)) {

2659 
ªsu…
 = 
nvme_thªad
 ? 
	`PTR_ERR
“vme_thªadË: -
EINTR
;

2660 
dißbÀ
;

2663 
	`nvme_öô_queue
(
dev
->
queues
[0], 0);

2664 
ªsu…
 = 
	`nvme_Æloc_admö_ègs
(
dev
);

2665 i‡(
ªsu…
)

2666 
dißbÀ
;

2668 
ªsu…
 = 
	`nvme_£tup_io_queues
(
dev
);

2669 i‡(
ªsu…
)

2670 
‰ì_ègs
;

2672 
	`nvme_£t_úq_höts
(
dev
);

2674  
ªsu…
;

2676 
‰ì_ègs
:

2677 
	`nvme_dev_ªmove_admö
(
dev
);

2678 
dißbÀ
:

2679 
	`nvme_dißbÀ_queue
(
dev
, 0);

2680 
	`nvme_dev_li°_ªmove
(
dev
);

2681 
unm≠
:

2682 
	`nvme_dev_unm≠
(
dev
);

2683  
ªsu…
;

2684 
	}
}

2686 
	$nvme_ªmove_dód_˘æ
(*
¨g
)

2688 
nvme_dev
 *
dev
 = (nvme_dev *)
¨g
;

2689 
pci_dev
 *
pdev
 = 
dev
->pci_dev;

2691 i‡(
	`pci_gë_drvd©a
(
pdev
))

2692 
	`pci_°›_™d_ªmove_bus_devi˚_locked
(
pdev
);

2693 
	`kªf_put
(&
dev
->
kªf
, 
nvme_‰ì_dev
);

2695 
	}
}

2697 
	$nvme_ªmove_disks
(
w‹k_°ru˘
 *
ws
)

2699 
nvme_dev
 *
dev
 = 
	`c⁄èöî_of
(
ws
, nvme_dev, 
ª£t_w‹k
);

2701 
	`nvme_‰ì_queues
(
dev
, 1);

2702 
	`nvme_dev_ªmove
(
dev
);

2703 
	}
}

2705 
	$nvme_dev_ªsume
(
nvme_dev
 *
dev
)

2707 
ªt
;

2709 
ªt
 = 
	`nvme_dev_°¨t
(
dev
);

2710 i‡(
ªt
)

2711  
ªt
;

2712 i‡(
dev
->
⁄löe_queues
 < 2) {

2713 
	`•ö_lock
(&
dev_li°_lock
);

2714 
dev
->
ª£t_w‹k‚
 = 
nvme_ªmove_disks
;

2715 
	`queue_w‹k
(
nvme_w‹kq
, &
dev
->
ª£t_w‹k
);

2716 
	`•ö_u∆ock
(&
dev_li°_lock
);

2718 
	`nvme_un‰ìze_queues
(
dev
);

2719 
	`nvme_£t_úq_höts
(
dev
);

2721 
dev
->
öôülized
 = 1;

2723 
	}
}

2725 
	$nvme_dev_ª£t
(
nvme_dev
 *
dev
)

2727 
	`nvme_dev_shutdown
(
dev
);

2728 i‡(
	`nvme_dev_ªsume
(
dev
)) {

2729 
	`dev_w¨n
(&
dev
->
pci_dev
->dev, "Device failedÅoÑesume\n");

2730 
	`kªf_gë
(&
dev
->
kªf
);

2731 i‡(
	`IS_ERR
(
	`kthªad_run
(
nvme_ªmove_dód_˘æ
, 
dev
, "nvme%d",

2732 
dev
->
ö°™˚
))) {

2733 
	`dev_îr
(&
dev
->
pci_dev
->dev,

2735 
	`kªf_put
(&
dev
->
kªf
, 
nvme_‰ì_dev
);

2738 
	}
}

2740 
	$nvme_ª£t_Áûed_dev
(
w‹k_°ru˘
 *
ws
)

2742 
nvme_dev
 *
dev
 = 
	`c⁄èöî_of
(
ws
, nvme_dev, 
ª£t_w‹k
);

2743 
	`nvme_dev_ª£t
(
dev
);

2744 
	}
}

2746 
	$nvme_ª£t_w‹k‚
(
w‹k_°ru˘
 *
w‹k
)

2748 
nvme_dev
 *
dev
 = 
	`c⁄èöî_of
(
w‹k
, nvme_dev, 
ª£t_w‹k
);

2749 
dev
->
	`ª£t_w‹k‚
(
w‹k
);

2750 
	}
}

2752 
	$nvme_¥obe
(
pci_dev
 *
pdev
, c⁄° 
pci_devi˚_id
 *
id
)

2754 
node
, 
ªsu…
 = -
ENOMEM
;

2755 
nvme_dev
 *
dev
;

2757 
node
 = 
	`dev_to_node
(&
pdev
->
dev
);

2758 i‡(
node
 =
NUMA_NO_NODE
)

2759 
	`£t_dev_node
(&
pdev
->
dev
, 0);

2761 
dev
 = 
	`kzÆloc_node
((*dev), 
GFP_KERNEL
, 
node
);

2762 i‡(!
dev
)

2763  -
ENOMEM
;

2764 
dev
->
íåy
 = 
	`kzÆloc_node
(
	`num_possibÀ_˝us
() * (*dev->entry),

2765 
GFP_KERNEL
, 
node
);

2766 i‡(!
dev
->
íåy
)

2767 
‰ì
;

2768 
dev
->
queues
 = 
	`kzÆloc_node
((
	`num_possibÀ_˝us
() + 1) * (*),

2769 
GFP_KERNEL
, 
node
);

2770 i‡(!
dev
->
queues
)

2771 
‰ì
;

2773 
	`INIT_LIST_HEAD
(&
dev
->
«me•a˚s
);

2774 
dev
->
ª£t_w‹k‚
 = 
nvme_ª£t_Áûed_dev
;

2775 
	`INIT_WORK
(&
dev
->
ª£t_w‹k
, 
nvme_ª£t_w‹k‚
);

2776 
dev
->
pci_dev
 = 
	`pci_dev_gë
(
pdev
);

2777 
	`pci_£t_drvd©a
(
pdev
, 
dev
);

2778 
ªsu…
 = 
	`nvme_£t_ö°™˚
(
dev
);

2779 i‡(
ªsu…
)

2780 
put_pci
;

2782 
ªsu…
 = 
	`nvme_£tup_¥p_poﬁs
(
dev
);

2783 i‡(
ªsu…
)

2784 
ªÀa£
;

2786 
	`kªf_öô
(&
dev
->
kªf
);

2787 
ªsu…
 = 
	`nvme_dev_°¨t
(
dev
);

2788 i‡(
ªsu…
)

2789 
ªÀa£_poﬁs
;

2791 i‡(
dev
->
⁄löe_queues
 > 1)

2792 
ªsu…
 = 
	`nvme_dev_add
(
dev
);

2793 i‡(
ªsu…
)

2794 
shutdown
;

2796 
	`s˙¥ötf
(
dev
->
«me
, (dev->«me), "nvme%d", dev->
ö°™˚
);

2797 
dev
->
miscdev
.
mö‹
 = 
MISC_DYNAMIC_MINOR
;

2798 
dev
->
miscdev
.
∑ª¡
 = &
pdev
->dev;

2799 
dev
->
miscdev
.
«me
 = dev->name;

2800 
dev
->
miscdev
.
f›s
 = &
nvme_dev_f›s
;

2801 
ªsu…
 = 
	`misc_ªgi°î
(&
dev
->
miscdev
);

2802 i‡(
ªsu…
)

2803 
ªmove
;

2805 
	`nvme_£t_úq_höts
(
dev
);

2807 
dev
->
öôülized
 = 1;

2810 
ªmove
:

2811 
	`nvme_dev_ªmove
(
dev
);

2812 
	`nvme_dev_ªmove_admö
(
dev
);

2813 
	`nvme_‰ì_«me•a˚s
(
dev
);

2814 
shutdown
:

2815 
	`nvme_dev_shutdown
(
dev
);

2816 
ªÀa£_poﬁs
:

2817 
	`nvme_‰ì_queues
(
dev
, 0);

2818 
	`nvme_ªÀa£_¥p_poﬁs
(
dev
);

2819 
ªÀa£
:

2820 
	`nvme_ªÀa£_ö°™˚
(
dev
);

2821 
put_pci
:

2822 
	`pci_dev_put
(
dev
->
pci_dev
);

2823 
‰ì
:

2824 
	`k‰ì
(
dev
->
queues
);

2825 
	`k‰ì
(
dev
->
íåy
);

2826 
	`k‰ì
(
dev
);

2827  
ªsu…
;

2828 
	}
}

2830 
	$nvme_ª£t_nŸify
(
pci_dev
 *
pdev
, 
boﬁ
 
¥ï¨e
)

2832 
nvme_dev
 *
dev
 = 
	`pci_gë_drvd©a
(
pdev
);

2834 i‡(
¥ï¨e
)

2835 
	`nvme_dev_shutdown
(
dev
);

2837 
	`nvme_dev_ªsume
(
dev
);

2838 
	}
}

2840 
	$nvme_shutdown
(
pci_dev
 *
pdev
)

2842 
nvme_dev
 *
dev
 = 
	`pci_gë_drvd©a
(
pdev
);

2843 
	`nvme_dev_shutdown
(
dev
);

2844 
	}
}

2846 
	$nvme_ªmove
(
pci_dev
 *
pdev
)

2848 
nvme_dev
 *
dev
 = 
	`pci_gë_drvd©a
(
pdev
);

2850 
	`•ö_lock
(&
dev_li°_lock
);

2851 
	`li°_dñ_öô
(&
dev
->
node
);

2852 
	`•ö_u∆ock
(&
dev_li°_lock
);

2854 
	`pci_£t_drvd©a
(
pdev
, 
NULL
);

2855 
	`Êush_w‹k
(&
dev
->
ª£t_w‹k
);

2856 
	`misc_dîegi°î
(&
dev
->
miscdev
);

2857 
	`nvme_dev_shutdown
(
dev
);

2858 
	`nvme_dev_ªmove
(
dev
);

2859 
	`nvme_dev_ªmove_admö
(
dev
);

2860 
	`nvme_‰ì_queues
(
dev
, 0);

2861 
	`nvme_ªÀa£_¥p_poﬁs
(
dev
);

2862 
	`kªf_put
(&
dev
->
kªf
, 
nvme_‰ì_dev
);

2863 
	}
}

2866 
	#nvme_îr‹_dëe˘ed
 
NULL


	)

2867 
	#nvme_dump_ªgi°îs
 
NULL


	)

2868 
	#nvme_lök_ª£t
 
NULL


	)

2869 
	#nvme_¶Ÿ_ª£t
 
NULL


	)

2870 
	#nvme_îr‹_ªsume
 
NULL


	)

2872 #ifde‡
CONFIG_PM_SLEEP


2873 
	$nvme_su•íd
(
devi˚
 *
dev
)

2875 
pci_dev
 *
pdev
 = 
	`to_pci_dev
(
dev
);

2876 
nvme_dev
 *
ndev
 = 
	`pci_gë_drvd©a
(
pdev
);

2878 
	`nvme_dev_shutdown
(
ndev
);

2880 
	}
}

2882 
	$nvme_ªsume
(
devi˚
 *
dev
)

2884 
pci_dev
 *
pdev
 = 
	`to_pci_dev
(
dev
);

2885 
nvme_dev
 *
ndev
 = 
	`pci_gë_drvd©a
(
pdev
);

2887 i‡(
	`nvme_dev_ªsume
(
ndev
Ë&& !
	`w‹k_busy
(&ndev->
ª£t_w‹k
)) {

2888 
ndev
->
ª£t_w‹k‚
 = 
nvme_ª£t_Áûed_dev
;

2889 
	`queue_w‹k
(
nvme_w‹kq
, &
ndev
->
ª£t_w‹k
);

2892 
	}
}

2895 
SIMPLE_DEV_PM_OPS
(
nvme_dev_pm_›s
, 
nvme_su•íd
, 
nvme_ªsume
);

2897 c⁄° 
pci_îr‹_h™dÀrs
 
	gnvme_îr_h™dÀr
 = {

2898 .
îr‹_dëe˘ed
 = 
nvme_îr‹_dëe˘ed
,

2899 .
	gmmio_íabÀd
 = 
nvme_dump_ªgi°îs
,

2900 .
	glök_ª£t
 = 
nvme_lök_ª£t
,

2901 .
	g¶Ÿ_ª£t
 = 
nvme_¶Ÿ_ª£t
,

2902 .
	gªsume
 = 
nvme_îr‹_ªsume
,

2903 .
	gª£t_nŸify
 = 
nvme_ª£t_nŸify
,

2907 
	#PCI_CLASS_STORAGE_EXPRESS
 0x010802

	)

2909 c⁄° 
pci_devi˚_id
 
	gnvme_id_èbÀ
[] = {

2910 { 
PCI_DEVICE_CLASS
(
PCI_CLASS_STORAGE_EXPRESS
, 0xffffff) },

2913 
MODULE_DEVICE_TABLE
(
pci
, 
nvme_id_èbÀ
);

2915 
pci_drivî
 
	gnvme_drivî
 = {

2916 .
«me
 = "nvme",

2917 .
	gid_èbÀ
 = 
nvme_id_èbÀ
,

2918 .
	g¥obe
 = 
nvme_¥obe
,

2919 .
	gªmove
 = 
nvme_ªmove
,

2920 .
	gshutdown
 = 
nvme_shutdown
,

2921 .
	gdrivî
 = {

2922 .
pm
 = &
nvme_dev_pm_›s
,

2924 .
	gîr_h™dÀr
 = &
nvme_îr_h™dÀr
,

2927 
__öô
 
	$nvme_öô
()

2929 
ªsu…
;

2931 
	`öô_waôqueue_hód
(&
nvme_kthªad_waô
);

2933 
nvme_w‹kq
 = 
	`¸óã_sögÀthªad_w‹kqueue
("nvme");

2934 i‡(!
nvme_w‹kq
)

2935  -
ENOMEM
;

2937 
ªsu…
 = 
	`ªgi°î_blkdev
(
nvme_maj‹
, "nvme");

2938 i‡(
ªsu…
 < 0)

2939 
kûl_w‹kq
;

2940 i‡(
ªsu…
 > 0)

2941 
nvme_maj‹
 = 
ªsu…
;

2943 
ªsu…
 = 
	`pci_ªgi°î_drivî
(&
nvme_drivî
);

2944 i‡(
ªsu…
)

2945 
uƒegi°î_blkdev
;

2948 
uƒegi°î_blkdev
:

2949 
	`uƒegi°î_blkdev
(
nvme_maj‹
, "nvme");

2950 
kûl_w‹kq
:

2951 
	`de°roy_w‹kqueue
(
nvme_w‹kq
);

2952  
ªsu…
;

2953 
	}
}

2955 
__exô
 
	$nvme_exô
()

2957 
	`pci_uƒegi°î_drivî
(&
nvme_drivî
);

2958 
	`uƒegi°î_hŸ˝u_nŸifõr
(&
nvme_nb
);

2959 
	`uƒegi°î_blkdev
(
nvme_maj‹
, "nvme");

2960 
	`de°roy_w‹kqueue
(
nvme_w‹kq
);

2961 
	`BUG_ON
(
nvme_thªad
 && !
	`IS_ERR
(nvme_thread));

2962 
	`_nvme_check_size
();

2963 
	}
}

2965 
MODULE_AUTHOR
("Matthew Wilcox <willy@linux.intel.com>");

2966 
MODULE_LICENSE
("GPL");

2967 
MODULE_VERSION
("1.0");

2968 
moduÀ_öô
(
nvme_öô
);

2969 
moduÀ_exô
(
nvme_exô
);

	@nvme-scsi.c

20 
	~<löux/nvme.h
>

21 
	~<löux/bio.h
>

22 
	~<löux/bô›s.h
>

23 
	~<löux/blkdev.h
>

24 
	~<löux/com∑t.h
>

25 
	~<löux/dñay.h
>

26 
	~<löux/î∫o.h
>

27 
	~<löux/fs.h
>

28 
	~<löux/gíhd.h
>

29 
	~<löux/idr.h
>

30 
	~<löux/öô.h
>

31 
	~<löux/öãºu±.h
>

32 
	~<löux/io.h
>

33 
	~<löux/kdev_t.h
>

34 
	~<löux/kthªad.h
>

35 
	~<löux/kî√l.h
>

36 
	~<löux/mm.h
>

37 
	~<löux/moduÀ.h
>

38 
	~<löux/moduÀ∑øm.h
>

39 
	~<löux/pci.h
>

40 
	~<löux/pois⁄.h
>

41 
	~<löux/sched.h
>

42 
	~<löux/¶ab.h
>

43 
	~<löux/ty≥s.h
>

44 
	~<scsi/sg.h
>

45 
	~<scsi/scsi.h
>

46 
	~<löux/¥ötk.h
>

49 
	gsg_vîsi⁄_num
 = 30534;

51 
	#SNTI_TRANSLATION_SUCCESS
 0

	)

52 
	#SNTI_INTERNAL_ERROR
 1

	)

55 
	#VPD_SUPPORTED_PAGES
 0x00

	)

56 
	#VPD_SERIAL_NUMBER
 0x80

	)

57 
	#VPD_DEVICE_IDENTIFIERS
 0x83

	)

58 
	#VPD_EXTENDED_INQUIRY
 0x86

	)

59 
	#VPD_BLOCK_DEV_CHARACTERISTICS
 0xB1

	)

62 
	#REPORT_LUNS_CDB_ALLOC_LENGTH_OFFSET
 6

	)

63 
	#REPORT_LUNS_SR_OFFSET
 2

	)

64 
	#READ_CAP_16_CDB_ALLOC_LENGTH_OFFSET
 10

	)

65 
	#REQUEST_SENSE_CDB_ALLOC_LENGTH_OFFSET
 4

	)

66 
	#REQUEST_SENSE_DESC_OFFSET
 1

	)

67 
	#REQUEST_SENSE_DESC_MASK
 0x01

	)

68 
	#DESCRIPTOR_FORMAT_SENSE_DATA_TYPE
 1

	)

69 
	#INQUIRY_EVPD_BYTE_OFFSET
 1

	)

70 
	#INQUIRY_PAGE_CODE_BYTE_OFFSET
 2

	)

71 
	#INQUIRY_EVPD_BIT_MASK
 1

	)

72 
	#INQUIRY_CDB_ALLOCATION_LENGTH_OFFSET
 3

	)

73 
	#START_STOP_UNIT_CDB_IMMED_OFFSET
 1

	)

74 
	#START_STOP_UNIT_CDB_IMMED_MASK
 0x1

	)

75 
	#START_STOP_UNIT_CDB_POWER_COND_MOD_OFFSET
 3

	)

76 
	#START_STOP_UNIT_CDB_POWER_COND_MOD_MASK
 0xF

	)

77 
	#START_STOP_UNIT_CDB_POWER_COND_OFFSET
 4

	)

78 
	#START_STOP_UNIT_CDB_POWER_COND_MASK
 0xF0

	)

79 
	#START_STOP_UNIT_CDB_NO_FLUSH_OFFSET
 4

	)

80 
	#START_STOP_UNIT_CDB_NO_FLUSH_MASK
 0x4

	)

81 
	#START_STOP_UNIT_CDB_START_OFFSET
 4

	)

82 
	#START_STOP_UNIT_CDB_START_MASK
 0x1

	)

83 
	#WRITE_BUFFER_CDB_MODE_OFFSET
 1

	)

84 
	#WRITE_BUFFER_CDB_MODE_MASK
 0x1F

	)

85 
	#WRITE_BUFFER_CDB_BUFFER_ID_OFFSET
 2

	)

86 
	#WRITE_BUFFER_CDB_BUFFER_OFFSET_OFFSET
 3

	)

87 
	#WRITE_BUFFER_CDB_PARM_LIST_LENGTH_OFFSET
 6

	)

88 
	#FORMAT_UNIT_CDB_FORMAT_PROT_INFO_OFFSET
 1

	)

89 
	#FORMAT_UNIT_CDB_FORMAT_PROT_INFO_MASK
 0xC0

	)

90 
	#FORMAT_UNIT_CDB_FORMAT_PROT_INFO_SHIFT
 6

	)

91 
	#FORMAT_UNIT_CDB_LONG_LIST_OFFSET
 1

	)

92 
	#FORMAT_UNIT_CDB_LONG_LIST_MASK
 0x20

	)

93 
	#FORMAT_UNIT_CDB_FORMAT_DATA_OFFSET
 1

	)

94 
	#FORMAT_UNIT_CDB_FORMAT_DATA_MASK
 0x10

	)

95 
	#FORMAT_UNIT_SHORT_PARM_LIST_LEN
 4

	)

96 
	#FORMAT_UNIT_LONG_PARM_LIST_LEN
 8

	)

97 
	#FORMAT_UNIT_PROT_INT_OFFSET
 3

	)

98 
	#FORMAT_UNIT_PROT_FIELD_USAGE_OFFSET
 0

	)

99 
	#FORMAT_UNIT_PROT_FIELD_USAGE_MASK
 0x07

	)

100 
	#UNMAP_CDB_PARAM_LIST_LENGTH_OFFSET
 7

	)

103 
	#NIBBLE_SHIFT
 4

	)

104 
	#FIXED_SENSE_DATA
 0x70

	)

105 
	#DESC_FORMAT_SENSE_DATA
 0x72

	)

106 
	#FIXED_SENSE_DATA_ADD_LENGTH
 10

	)

107 
	#LUN_ENTRY_SIZE
 8

	)

108 
	#LUN_DATA_HEADER_SIZE
 8

	)

109 
	#ALL_LUNS_RETURNED
 0x02

	)

110 
	#ALL_WELL_KNOWN_LUNS_RETURNED
 0x01

	)

111 
	#RESTRICTED_LUNS_RETURNED
 0x00

	)

112 
	#NVME_POWER_STATE_START_VALID
 0x00

	)

113 
	#NVME_POWER_STATE_ACTIVE
 0x01

	)

114 
	#NVME_POWER_STATE_IDLE
 0x02

	)

115 
	#NVME_POWER_STATE_STANDBY
 0x03

	)

116 
	#NVME_POWER_STATE_LU_CONTROL
 0x07

	)

117 
	#POWER_STATE_0
 0

	)

118 
	#POWER_STATE_1
 1

	)

119 
	#POWER_STATE_2
 2

	)

120 
	#POWER_STATE_3
 3

	)

121 
	#DOWNLOAD_SAVE_ACTIVATE
 0x05

	)

122 
	#DOWNLOAD_SAVE_DEFER_ACTIVATE
 0x0E

	)

123 
	#ACTIVATE_DEFERRED_MICROCODE
 0x0F

	)

124 
	#FORMAT_UNIT_IMMED_MASK
 0x2

	)

125 
	#FORMAT_UNIT_IMMED_OFFSET
 1

	)

126 
	#KELVIN_TEMP_FACTOR
 273

	)

127 
	#FIXED_FMT_SENSE_DATA_SIZE
 18

	)

128 
	#DESC_FMT_SENSE_DATA_SIZE
 8

	)

131 
	#INQ_STANDARD_INQUIRY_PAGE
 0x00

	)

132 
	#INQ_SUPPORTED_VPD_PAGES_PAGE
 0x00

	)

133 
	#INQ_UNIT_SERIAL_NUMBER_PAGE
 0x80

	)

134 
	#INQ_DEVICE_IDENTIFICATION_PAGE
 0x83

	)

135 
	#INQ_EXTENDED_INQUIRY_DATA_PAGE
 0x86

	)

136 
	#INQ_BDEV_CHARACTERISTICS_PAGE
 0xB1

	)

137 
	#INQ_SERIAL_NUMBER_LENGTH
 0x14

	)

138 
	#INQ_NUM_SUPPORTED_VPD_PAGES
 5

	)

139 
	#VERSION_SPC_4
 0x06

	)

140 
	#ACA_UNSUPPORTED
 0

	)

141 
	#STANDARD_INQUIRY_LENGTH
 36

	)

142 
	#ADDITIONAL_STD_INQ_LENGTH
 31

	)

143 
	#EXTENDED_INQUIRY_DATA_PAGE_LENGTH
 0x3C

	)

144 
	#RESERVED_FIELD
 0

	)

147 
	#IO_CDB_WP_MASK
 0xE0

	)

148 
	#IO_CDB_WP_SHIFT
 5

	)

149 
	#IO_CDB_FUA_MASK
 0x8

	)

150 
	#IO_6_CDB_LBA_OFFSET
 0

	)

151 
	#IO_6_CDB_LBA_MASK
 0x001FFFFF

	)

152 
	#IO_6_CDB_TX_LEN_OFFSET
 4

	)

153 
	#IO_6_DEFAULT_TX_LEN
 256

	)

154 
	#IO_10_CDB_LBA_OFFSET
 2

	)

155 
	#IO_10_CDB_TX_LEN_OFFSET
 7

	)

156 
	#IO_10_CDB_WP_OFFSET
 1

	)

157 
	#IO_10_CDB_FUA_OFFSET
 1

	)

158 
	#IO_12_CDB_LBA_OFFSET
 2

	)

159 
	#IO_12_CDB_TX_LEN_OFFSET
 6

	)

160 
	#IO_12_CDB_WP_OFFSET
 1

	)

161 
	#IO_12_CDB_FUA_OFFSET
 1

	)

162 
	#IO_16_CDB_FUA_OFFSET
 1

	)

163 
	#IO_16_CDB_WP_OFFSET
 1

	)

164 
	#IO_16_CDB_LBA_OFFSET
 2

	)

165 
	#IO_16_CDB_TX_LEN_OFFSET
 10

	)

168 
	#MODE_PAGE_INFO_EXCEP
 0x1C

	)

169 
	#MODE_PAGE_CACHING
 0x08

	)

170 
	#MODE_PAGE_CONTROL
 0x0A

	)

171 
	#MODE_PAGE_POWER_CONDITION
 0x1A

	)

172 
	#MODE_PAGE_RETURN_ALL
 0x3F

	)

173 
	#MODE_PAGE_BLK_DES_LEN
 0x08

	)

174 
	#MODE_PAGE_LLBAA_BLK_DES_LEN
 0x10

	)

175 
	#MODE_PAGE_CACHING_LEN
 0x14

	)

176 
	#MODE_PAGE_CONTROL_LEN
 0x0C

	)

177 
	#MODE_PAGE_POW_CND_LEN
 0x28

	)

178 
	#MODE_PAGE_INF_EXC_LEN
 0x0C

	)

179 
	#MODE_PAGE_ALL_LEN
 0x54

	)

180 
	#MODE_SENSE6_MPH_SIZE
 4

	)

181 
	#MODE_SENSE6_ALLOC_LEN_OFFSET
 4

	)

182 
	#MODE_SENSE_PAGE_CONTROL_OFFSET
 2

	)

183 
	#MODE_SENSE_PAGE_CONTROL_MASK
 0xC0

	)

184 
	#MODE_SENSE_PAGE_CODE_OFFSET
 2

	)

185 
	#MODE_SENSE_PAGE_CODE_MASK
 0x3F

	)

186 
	#MODE_SENSE_LLBAA_OFFSET
 1

	)

187 
	#MODE_SENSE_LLBAA_MASK
 0x10

	)

188 
	#MODE_SENSE_LLBAA_SHIFT
 4

	)

189 
	#MODE_SENSE_DBD_OFFSET
 1

	)

190 
	#MODE_SENSE_DBD_MASK
 8

	)

191 
	#MODE_SENSE_DBD_SHIFT
 3

	)

192 
	#MODE_SENSE10_MPH_SIZE
 8

	)

193 
	#MODE_SENSE10_ALLOC_LEN_OFFSET
 7

	)

194 
	#MODE_SELECT_CDB_PAGE_FORMAT_OFFSET
 1

	)

195 
	#MODE_SELECT_CDB_SAVE_PAGES_OFFSET
 1

	)

196 
	#MODE_SELECT_6_CDB_PARAM_LIST_LENGTH_OFFSET
 4

	)

197 
	#MODE_SELECT_10_CDB_PARAM_LIST_LENGTH_OFFSET
 7

	)

198 
	#MODE_SELECT_CDB_PAGE_FORMAT_MASK
 0x10

	)

199 
	#MODE_SELECT_CDB_SAVE_PAGES_MASK
 0x1

	)

200 
	#MODE_SELECT_6_BD_OFFSET
 3

	)

201 
	#MODE_SELECT_10_BD_OFFSET
 6

	)

202 
	#MODE_SELECT_10_LLBAA_OFFSET
 4

	)

203 
	#MODE_SELECT_10_LLBAA_MASK
 1

	)

204 
	#MODE_SELECT_6_MPH_SIZE
 4

	)

205 
	#MODE_SELECT_10_MPH_SIZE
 8

	)

206 
	#CACHING_MODE_PAGE_WCE_MASK
 0x04

	)

207 
	#MODE_SENSE_BLK_DESC_ENABLED
 0

	)

208 
	#MODE_SENSE_BLK_DESC_COUNT
 1

	)

209 
	#MODE_SELECT_PAGE_CODE_MASK
 0x3F

	)

210 
	#SHORT_DESC_BLOCK
 8

	)

211 
	#LONG_DESC_BLOCK
 16

	)

212 
	#MODE_PAGE_POW_CND_LEN_FIELD
 0x26

	)

213 
	#MODE_PAGE_INF_EXC_LEN_FIELD
 0x0A

	)

214 
	#MODE_PAGE_CACHING_LEN_FIELD
 0x12

	)

215 
	#MODE_PAGE_CONTROL_LEN_FIELD
 0x0A

	)

216 
	#MODE_SENSE_PC_CURRENT_VALUES
 0

	)

219 
	#LOG_PAGE_SUPPORTED_LOG_PAGES_PAGE
 0x00

	)

220 
	#LOG_PAGE_SUPPORTED_LOG_PAGES_LENGTH
 0x07

	)

221 
	#LOG_PAGE_INFORMATIONAL_EXCEPTIONS_PAGE
 0x2F

	)

222 
	#LOG_PAGE_TEMPERATURE_PAGE
 0x0D

	)

223 
	#LOG_SENSE_CDB_SP_OFFSET
 1

	)

224 
	#LOG_SENSE_CDB_SP_NOT_ENABLED
 0

	)

225 
	#LOG_SENSE_CDB_PC_OFFSET
 2

	)

226 
	#LOG_SENSE_CDB_PC_MASK
 0xC0

	)

227 
	#LOG_SENSE_CDB_PC_SHIFT
 6

	)

228 
	#LOG_SENSE_CDB_PC_CUMULATIVE_VALUES
 1

	)

229 
	#LOG_SENSE_CDB_PAGE_CODE_MASK
 0x3F

	)

230 
	#LOG_SENSE_CDB_ALLOC_LENGTH_OFFSET
 7

	)

231 
	#REMAINING_INFO_EXCP_PAGE_LENGTH
 0x8

	)

232 
	#LOG_INFO_EXCP_PAGE_LENGTH
 0xC

	)

233 
	#REMAINING_TEMP_PAGE_LENGTH
 0xC

	)

234 
	#LOG_TEMP_PAGE_LENGTH
 0x10

	)

235 
	#LOG_TEMP_UNKNOWN
 0xFF

	)

236 
	#SUPPORTED_LOG_PAGES_PAGE_LENGTH
 0x3

	)

239 
	#READ_CAP_10_RESP_SIZE
 8

	)

240 
	#READ_CAP_16_RESP_SIZE
 32

	)

243 
	#BYTES_TO_DWORDS
 4

	)

244 
	#NVME_MAX_FIRMWARE_SLOT
 7

	)

247 
	#REPORT_LUNS_FIRST_LUN_OFFSET
 8

	)

251 
	#SCSI_ASC_NO_SENSE
 0x00

	)

252 
	#SCSI_ASC_PERIPHERAL_DEV_WRITE_FAULT
 0x03

	)

253 
	#SCSI_ASC_LUN_NOT_READY
 0x04

	)

254 
	#SCSI_ASC_WARNING
 0x0B

	)

255 
	#SCSI_ASC_LOG_BLOCK_GUARD_CHECK_FAILED
 0x10

	)

256 
	#SCSI_ASC_LOG_BLOCK_APPTAG_CHECK_FAILED
 0x10

	)

257 
	#SCSI_ASC_LOG_BLOCK_REFTAG_CHECK_FAILED
 0x10

	)

258 
	#SCSI_ASC_UNRECOVERED_READ_ERROR
 0x11

	)

259 
	#SCSI_ASC_MISCOMPARE_DURING_VERIFY
 0x1D

	)

260 
	#SCSI_ASC_ACCESS_DENIED_INVALID_LUN_ID
 0x20

	)

261 
	#SCSI_ASC_ILLEGAL_COMMAND
 0x20

	)

262 
	#SCSI_ASC_ILLEGAL_BLOCK
 0x21

	)

263 
	#SCSI_ASC_INVALID_CDB
 0x24

	)

264 
	#SCSI_ASC_INVALID_LUN
 0x25

	)

265 
	#SCSI_ASC_INVALID_PARAMETER
 0x26

	)

266 
	#SCSI_ASC_FORMAT_COMMAND_FAILED
 0x31

	)

267 
	#SCSI_ASC_INTERNAL_TARGET_FAILURE
 0x44

	)

271 
	#SCSI_ASCQ_CAUSE_NOT_REPORTABLE
 0x00

	)

272 
	#SCSI_ASCQ_FORMAT_COMMAND_FAILED
 0x01

	)

273 
	#SCSI_ASCQ_LOG_BLOCK_GUARD_CHECK_FAILED
 0x01

	)

274 
	#SCSI_ASCQ_LOG_BLOCK_APPTAG_CHECK_FAILED
 0x02

	)

275 
	#SCSI_ASCQ_LOG_BLOCK_REFTAG_CHECK_FAILED
 0x03

	)

276 
	#SCSI_ASCQ_FORMAT_IN_PROGRESS
 0x04

	)

277 
	#SCSI_ASCQ_POWER_LOSS_EXPECTED
 0x08

	)

278 
	#SCSI_ASCQ_INVALID_LUN_ID
 0x09

	)

284 
	#DEVICE_SPECIFIC_PARAMETER
 0

	)

285 
	#VPD_ID_DESCRIPTOR_LENGTH
 (
VPD_IDENTIFICATION_DESCRIPTOR
)

	)

289 
	#GET_OPCODE
(
cdb
Ëcdb[0]

	)

291 
	#GET_U8_FROM_CDB
(
cdb
, 
ödex
Ë(cdb[ödex] << 0)

	)

293 
	#GET_U16_FROM_CDB
(
cdb
, 
ödex
Ë((cdb[ödex] << 8Ë| (cdb[ödex + 1] << 0))

	)

295 
	#GET_U24_FROM_CDB
(
cdb
, 
ödex
) ((cdb[index] << 16) | \

296 (
cdb
[
ödex
 + 1] << 8) | \

297 (
cdb
[
ödex
 + 2] << 0))

	)

299 
	#GET_U32_FROM_CDB
(
cdb
, 
ödex
) ((cdb[index] << 24) | \

300 (
cdb
[
ödex
 + 1] << 16) | \

301 (
cdb
[
ödex
 + 2] << 8) | \

302 (
cdb
[
ödex
 + 3] << 0))

	)

304 
	#GET_U64_FROM_CDB
(
cdb
, 
ödex
Ë((((
u64
)cdb[index]) << 56) | \

305 (((
u64
)
cdb
[
ödex
 + 1]) << 48) | \

306 (((
u64
)
cdb
[
ödex
 + 2]) << 40) | \

307 (((
u64
)
cdb
[
ödex
 + 3]) << 32) | \

308 (((
u64
)
cdb
[
ödex
 + 4]) << 24) | \

309 (((
u64
)
cdb
[
ödex
 + 5]) << 16) | \

310 (((
u64
)
cdb
[
ödex
 + 6]) << 8) | \

311 (((
u64
)
cdb
[
ödex
 + 7]Ë<< 0))

	)

314 
	#GET_INQ_EVPD_BIT
(
cdb
) \

315 ((
	`GET_U8_FROM_CDB
(
cdb
, 
INQUIRY_EVPD_BYTE_OFFSET
) & \

316 
INQUIRY_EVPD_BIT_MASK
Ë? 1 : 0)

	)

318 
	#GET_INQ_PAGE_CODE
(
cdb
) \

319 (
	`GET_U8_FROM_CDB
(
cdb
, 
INQUIRY_PAGE_CODE_BYTE_OFFSET
))

	)

321 
	#GET_INQ_ALLOC_LENGTH
(
cdb
) \

322 (
	`GET_U16_FROM_CDB
(
cdb
, 
INQUIRY_CDB_ALLOCATION_LENGTH_OFFSET
))

	)

325 
	#GET_REPORT_LUNS_ALLOC_LENGTH
(
cdb
) \

326 (
	`GET_U32_FROM_CDB
(
cdb
, 
REPORT_LUNS_CDB_ALLOC_LENGTH_OFFSET
))

	)

329 
	#GET_READ_CAP_16_ALLOC_LENGTH
(
cdb
) \

330 (
	`GET_U32_FROM_CDB
(
cdb
, 
READ_CAP_16_CDB_ALLOC_LENGTH_OFFSET
))

	)

332 
	#IS_READ_CAP_16
(
cdb
) \

333 ((
cdb
[0] =
SERVICE_ACTION_IN_16
 && cdb[1] =
SAI_READ_CAPACITY_16
Ë? 1 : 0)

	)

336 
	#GET_REQUEST_SENSE_ALLOC_LENGTH
(
cdb
) \

337 (
	`GET_U8_FROM_CDB
(
cdb
, 
REQUEST_SENSE_CDB_ALLOC_LENGTH_OFFSET
))

	)

340 
	#GET_MODE_SENSE_DBD
(
cdb
) \

341 ((
	`GET_U8_FROM_CDB
(
cdb
, 
MODE_SENSE_DBD_OFFSET
Ë& 
MODE_SENSE_DBD_MASK
) >> \

342 
MODE_SENSE_DBD_SHIFT
)

	)

344 
	#GET_MODE_SENSE_LLBAA
(
cdb
) \

345 ((
	`GET_U8_FROM_CDB
(
cdb
, 
MODE_SENSE_LLBAA_OFFSET
) & \

346 
MODE_SENSE_LLBAA_MASK
Ë>> 
MODE_SENSE_LLBAA_SHIFT
)

	)

348 
	#GET_MODE_SENSE_MPH_SIZE
(
cdb10
) \

349 (
cdb10
 ? 
MODE_SENSE10_MPH_SIZE
 : 
MODE_SENSE6_MPH_SIZE
)

	)

355 
	snvme_å™s_io_cdb
 {

356 
u8
 
	mfua
;

357 
u8
 
	m¥Ÿ_öfo
;

358 
u64
 
	mlba
;

359 
u32
 
	mx„r_Àn
;

368 
	$nvme_å™s_c›y_to_u£r
(
sg_io_hdr
 *
hdr
, *
‰om
,

369 
n
)

371 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

372 
nŸ_c›õd
;

373 
i
;

374 *
ödex
 = 
‰om
;

375 
size_t
 
ªmaöög
 = 
n
;

376 
size_t
 
x„r_Àn
;

378 i‡(
hdr
->
iovec_cou¡
 > 0) {

379 
sg_iovec
 
sgl
;

381 
i
 = 0; i < 
hdr
->
iovec_cou¡
; i++) {

382 
nŸ_c›õd
 = 
	`c›y_‰om_u£r
(&
sgl
, 
hdr
->
dx„Ω
 +

383 
i
 * (
sg_iovec
),

384 (
sg_iovec
));

385 i‡(
nŸ_c›õd
)

386  -
EFAULT
;

387 
x„r_Àn
 = 
	`mö
(
ªmaöög
, 
sgl
.
iov_Àn
);

388 
nŸ_c›õd
 = 
	`c›y_to_u£r
(
sgl
.
iov_ba£
, 
ödex
,

389 
x„r_Àn
);

390 i‡(
nŸ_c›õd
) {

391 
ªs
 = -
EFAULT
;

394 
ödex
 +
x„r_Àn
;

395 
ªmaöög
 -
x„r_Àn
;

396 i‡(
ªmaöög
 == 0)

399  
ªs
;

401 
nŸ_c›õd
 = 
	`c›y_to_u£r
(
hdr
->
dx„Ω
, 
‰om
, 
n
);

402 i‡(
nŸ_c›õd
)

403 
ªs
 = -
EFAULT
;

404  
ªs
;

405 
	}
}

409 
	$nvme_å™s_c›y_‰om_u£r
(
sg_io_hdr
 *
hdr
, *
to
,

410 
n
)

412 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

413 
nŸ_c›õd
;

414 
i
;

415 *
ödex
 = 
to
;

416 
size_t
 
ªmaöög
 = 
n
;

417 
size_t
 
x„r_Àn
;

419 i‡(
hdr
->
iovec_cou¡
 > 0) {

420 
sg_iovec
 
sgl
;

422 
i
 = 0; i < 
hdr
->
iovec_cou¡
; i++) {

423 
nŸ_c›õd
 = 
	`c›y_‰om_u£r
(&
sgl
, 
hdr
->
dx„Ω
 +

424 
i
 * (
sg_iovec
),

425 (
sg_iovec
));

426 i‡(
nŸ_c›õd
)

427  -
EFAULT
;

428 
x„r_Àn
 = 
	`mö
(
ªmaöög
, 
sgl
.
iov_Àn
);

429 
nŸ_c›õd
 = 
	`c›y_‰om_u£r
(
ödex
, 
sgl
.
iov_ba£
,

430 
x„r_Àn
);

431 i‡(
nŸ_c›õd
) {

432 
ªs
 = -
EFAULT
;

435 
ödex
 +
x„r_Àn
;

436 
ªmaöög
 -
x„r_Àn
;

437 i‡(
ªmaöög
 == 0)

440  
ªs
;

443 
nŸ_c›õd
 = 
	`c›y_‰om_u£r
(
to
, 
hdr
->
dx„Ω
, 
n
);

444 i‡(
nŸ_c›õd
)

445 
ªs
 = -
EFAULT
;

446  
ªs
;

447 
	}
}

451 
	$nvme_å™s_com∂ëi⁄
(
sg_io_hdr
 *
hdr
, 
u8
 
°©us
, u8 
£n£_key
,

452 
u8
 
asc
, u8 
ascq
)

454 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

455 
u8
 
x„r_Àn
;

456 
u8
 
ª•
[
DESC_FMT_SENSE_DATA_SIZE
];

458 i‡(
	`scsi_°©us_is_good
(
°©us
)) {

459 
hdr
->
°©us
 = 
SAM_STAT_GOOD
;

460 
hdr
->
masked_°©us
 = 
GOOD
;

461 
hdr
->
ho°_°©us
 = 
DID_OK
;

462 
hdr
->
drivî_°©us
 = 
DRIVER_OK
;

463 
hdr
->
sb_Àn_wr
 = 0;

465 
hdr
->
°©us
 = status;

466 
hdr
->
masked_°©us
 = 
°©us
 >> 1;

467 
hdr
->
ho°_°©us
 = 
DID_OK
;

468 
hdr
->
drivî_°©us
 = 
DRIVER_OK
;

470 
	`mem£t
(
ª•
, 0, 
DESC_FMT_SENSE_DATA_SIZE
);

471 
ª•
[0] = 
DESC_FORMAT_SENSE_DATA
;

472 
ª•
[1] = 
£n£_key
;

473 
ª•
[2] = 
asc
;

474 
ª•
[3] = 
ascq
;

476 
x„r_Àn
 = 
	`mö_t
(
u8
, 
hdr
->
mx_sb_Àn
, 
DESC_FMT_SENSE_DATA_SIZE
);

477 
hdr
->
sb_Àn_wr
 = 
x„r_Àn
;

478 i‡(
	`c›y_to_u£r
(
hdr
->
sbp
, 
ª•
, 
x„r_Àn
) > 0)

479 
ªs
 = -
EFAULT
;

482  
ªs
;

483 
	}
}

485 
	$nvme_å™s_°©us_code
(
sg_io_hdr
 *
hdr
, 
nvme_sc
)

487 
u8
 
°©us
, 
£n£_key
, 
asc
, 
ascq
;

488 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

491 i‡(
nvme_sc
 < 0)

492  
nvme_sc
;

495 
nvme_sc
 &= 0x7FF;

497 
nvme_sc
) {

499 
NVME_SC_SUCCESS
:

500 
°©us
 = 
SAM_STAT_GOOD
;

501 
£n£_key
 = 
NO_SENSE
;

502 
asc
 = 
SCSI_ASC_NO_SENSE
;

503 
ascq
 = 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
;

505 
NVME_SC_INVALID_OPCODE
:

506 
°©us
 = 
SAM_STAT_CHECK_CONDITION
;

507 
£n£_key
 = 
ILLEGAL_REQUEST
;

508 
asc
 = 
SCSI_ASC_ILLEGAL_COMMAND
;

509 
ascq
 = 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
;

511 
NVME_SC_INVALID_FIELD
:

512 
°©us
 = 
SAM_STAT_CHECK_CONDITION
;

513 
£n£_key
 = 
ILLEGAL_REQUEST
;

514 
asc
 = 
SCSI_ASC_INVALID_CDB
;

515 
ascq
 = 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
;

517 
NVME_SC_DATA_XFER_ERROR
:

518 
°©us
 = 
SAM_STAT_CHECK_CONDITION
;

519 
£n£_key
 = 
MEDIUM_ERROR
;

520 
asc
 = 
SCSI_ASC_NO_SENSE
;

521 
ascq
 = 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
;

523 
NVME_SC_POWER_LOSS
:

524 
°©us
 = 
SAM_STAT_TASK_ABORTED
;

525 
£n£_key
 = 
ABORTED_COMMAND
;

526 
asc
 = 
SCSI_ASC_WARNING
;

527 
ascq
 = 
SCSI_ASCQ_POWER_LOSS_EXPECTED
;

529 
NVME_SC_INTERNAL
:

530 
°©us
 = 
SAM_STAT_CHECK_CONDITION
;

531 
£n£_key
 = 
HARDWARE_ERROR
;

532 
asc
 = 
SCSI_ASC_INTERNAL_TARGET_FAILURE
;

533 
ascq
 = 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
;

535 
NVME_SC_ABORT_REQ
:

536 
°©us
 = 
SAM_STAT_TASK_ABORTED
;

537 
£n£_key
 = 
ABORTED_COMMAND
;

538 
asc
 = 
SCSI_ASC_NO_SENSE
;

539 
ascq
 = 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
;

541 
NVME_SC_ABORT_QUEUE
:

542 
°©us
 = 
SAM_STAT_TASK_ABORTED
;

543 
£n£_key
 = 
ABORTED_COMMAND
;

544 
asc
 = 
SCSI_ASC_NO_SENSE
;

545 
ascq
 = 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
;

547 
NVME_SC_FUSED_FAIL
:

548 
°©us
 = 
SAM_STAT_TASK_ABORTED
;

549 
£n£_key
 = 
ABORTED_COMMAND
;

550 
asc
 = 
SCSI_ASC_NO_SENSE
;

551 
ascq
 = 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
;

553 
NVME_SC_FUSED_MISSING
:

554 
°©us
 = 
SAM_STAT_TASK_ABORTED
;

555 
£n£_key
 = 
ABORTED_COMMAND
;

556 
asc
 = 
SCSI_ASC_NO_SENSE
;

557 
ascq
 = 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
;

559 
NVME_SC_INVALID_NS
:

560 
°©us
 = 
SAM_STAT_CHECK_CONDITION
;

561 
£n£_key
 = 
ILLEGAL_REQUEST
;

562 
asc
 = 
SCSI_ASC_ACCESS_DENIED_INVALID_LUN_ID
;

563 
ascq
 = 
SCSI_ASCQ_INVALID_LUN_ID
;

565 
NVME_SC_LBA_RANGE
:

566 
°©us
 = 
SAM_STAT_CHECK_CONDITION
;

567 
£n£_key
 = 
ILLEGAL_REQUEST
;

568 
asc
 = 
SCSI_ASC_ILLEGAL_BLOCK
;

569 
ascq
 = 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
;

571 
NVME_SC_CAP_EXCEEDED
:

572 
°©us
 = 
SAM_STAT_CHECK_CONDITION
;

573 
£n£_key
 = 
MEDIUM_ERROR
;

574 
asc
 = 
SCSI_ASC_NO_SENSE
;

575 
ascq
 = 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
;

577 
NVME_SC_NS_NOT_READY
:

578 
°©us
 = 
SAM_STAT_CHECK_CONDITION
;

579 
£n£_key
 = 
NOT_READY
;

580 
asc
 = 
SCSI_ASC_LUN_NOT_READY
;

581 
ascq
 = 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
;

585 
NVME_SC_INVALID_FORMAT
:

586 
°©us
 = 
SAM_STAT_CHECK_CONDITION
;

587 
£n£_key
 = 
ILLEGAL_REQUEST
;

588 
asc
 = 
SCSI_ASC_FORMAT_COMMAND_FAILED
;

589 
ascq
 = 
SCSI_ASCQ_FORMAT_COMMAND_FAILED
;

591 
NVME_SC_BAD_ATTRIBUTES
:

592 
°©us
 = 
SAM_STAT_CHECK_CONDITION
;

593 
£n£_key
 = 
ILLEGAL_REQUEST
;

594 
asc
 = 
SCSI_ASC_INVALID_CDB
;

595 
ascq
 = 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
;

599 
NVME_SC_WRITE_FAULT
:

600 
°©us
 = 
SAM_STAT_CHECK_CONDITION
;

601 
£n£_key
 = 
MEDIUM_ERROR
;

602 
asc
 = 
SCSI_ASC_PERIPHERAL_DEV_WRITE_FAULT
;

603 
ascq
 = 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
;

605 
NVME_SC_READ_ERROR
:

606 
°©us
 = 
SAM_STAT_CHECK_CONDITION
;

607 
£n£_key
 = 
MEDIUM_ERROR
;

608 
asc
 = 
SCSI_ASC_UNRECOVERED_READ_ERROR
;

609 
ascq
 = 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
;

611 
NVME_SC_GUARD_CHECK
:

612 
°©us
 = 
SAM_STAT_CHECK_CONDITION
;

613 
£n£_key
 = 
MEDIUM_ERROR
;

614 
asc
 = 
SCSI_ASC_LOG_BLOCK_GUARD_CHECK_FAILED
;

615 
ascq
 = 
SCSI_ASCQ_LOG_BLOCK_GUARD_CHECK_FAILED
;

617 
NVME_SC_APPTAG_CHECK
:

618 
°©us
 = 
SAM_STAT_CHECK_CONDITION
;

619 
£n£_key
 = 
MEDIUM_ERROR
;

620 
asc
 = 
SCSI_ASC_LOG_BLOCK_APPTAG_CHECK_FAILED
;

621 
ascq
 = 
SCSI_ASCQ_LOG_BLOCK_APPTAG_CHECK_FAILED
;

623 
NVME_SC_REFTAG_CHECK
:

624 
°©us
 = 
SAM_STAT_CHECK_CONDITION
;

625 
£n£_key
 = 
MEDIUM_ERROR
;

626 
asc
 = 
SCSI_ASC_LOG_BLOCK_REFTAG_CHECK_FAILED
;

627 
ascq
 = 
SCSI_ASCQ_LOG_BLOCK_REFTAG_CHECK_FAILED
;

629 
NVME_SC_COMPARE_FAILED
:

630 
°©us
 = 
SAM_STAT_CHECK_CONDITION
;

631 
£n£_key
 = 
MISCOMPARE
;

632 
asc
 = 
SCSI_ASC_MISCOMPARE_DURING_VERIFY
;

633 
ascq
 = 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
;

635 
NVME_SC_ACCESS_DENIED
:

636 
°©us
 = 
SAM_STAT_CHECK_CONDITION
;

637 
£n£_key
 = 
ILLEGAL_REQUEST
;

638 
asc
 = 
SCSI_ASC_ACCESS_DENIED_INVALID_LUN_ID
;

639 
ascq
 = 
SCSI_ASCQ_INVALID_LUN_ID
;

643 
NVME_SC_CMDID_CONFLICT
:

644 
NVME_SC_CMD_SEQ_ERROR
:

645 
NVME_SC_CQ_INVALID
:

646 
NVME_SC_QID_INVALID
:

647 
NVME_SC_QUEUE_SIZE
:

648 
NVME_SC_ABORT_LIMIT
:

649 
NVME_SC_ABORT_MISSING
:

650 
NVME_SC_ASYNC_LIMIT
:

651 
NVME_SC_FIRMWARE_SLOT
:

652 
NVME_SC_FIRMWARE_IMAGE
:

653 
NVME_SC_INVALID_VECTOR
:

654 
NVME_SC_INVALID_LOG_PAGE
:

656 
°©us
 = 
SAM_STAT_CHECK_CONDITION
;

657 
£n£_key
 = 
ILLEGAL_REQUEST
;

658 
asc
 = 
SCSI_ASC_NO_SENSE
;

659 
ascq
 = 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
;

663 
ªs
 = 
	`nvme_å™s_com∂ëi⁄
(
hdr
, 
°©us
, 
£n£_key
, 
asc
, 
ascq
);

665  
ªs
;

666 
	}
}

670 
	$nvme_å™s_°™d¨d_öquúy_∑ge
(
nvme_ns
 *
ns
,

671 
sg_io_hdr
 *
hdr
, 
u8
 *
öq_ª•⁄£
,

672 
Æloc_Àn
)

674 
nvme_dev
 *
dev
 = 
ns
->dev;

675 
dma_addr_t
 
dma_addr
;

676 *
mem
;

677 
nvme_id_ns
 *
id_ns
;

678 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

679 
nvme_sc
;

680 
x„r_Àn
;

681 
u8
 
ª•_d©a_f‹m©
 = 0x02;

682 
u8
 
¥Ÿe˘
;

683 
u8
 
cmdque
 = 0x01 << 1;

684 
u8
 
fw_off£t
 = (
dev
->
fúmw¨e_ªv
);

686 
mem
 = 
	`dma_Æloc_cohîít
(&
dev
->
pci_dev
->dev, (
nvme_id_ns
),

687 &
dma_addr
, 
GFP_KERNEL
);

688 i‡(
mem
 =
NULL
) {

689 
ªs
 = -
ENOMEM
;

690 
out_dma
;

694 
nvme_sc
 = 
	`nvme_idítify
(
dev
, 
ns
->
ns_id
, 0, 
dma_addr
);

695 
ªs
 = 
	`nvme_å™s_°©us_code
(
hdr
, 
nvme_sc
);

703 i‡(
ªs
)

704 
out_‰ì
;

705 i‡(
nvme_sc
) {

706 
ªs
 = 
nvme_sc
;

707 
out_‰ì
;

709 
id_ns
 = 
mem
;

710 (
id_ns
->
dps
Ë? (
¥Ÿe˘
 = 0x01) : (protect = 0);

712 
	`mem£t
(
öq_ª•⁄£
, 0, 
STANDARD_INQUIRY_LENGTH
);

713 
öq_ª•⁄£
[2] = 
VERSION_SPC_4
;

714 
öq_ª•⁄£
[3] = 
ª•_d©a_f‹m©
;

715 
öq_ª•⁄£
[4] = 
ADDITIONAL_STD_INQ_LENGTH
;

716 
öq_ª•⁄£
[5] = 
¥Ÿe˘
;

717 
öq_ª•⁄£
[7] = 
cmdque
;

718 
	`°∫˝y
(&
öq_ª•⁄£
[8], "NVMe ", 8);

719 
	`°∫˝y
(&
öq_ª•⁄£
[16], 
dev
->
modñ
, 16);

721 
dev
->
fúmw¨e_ªv
[
fw_off£t
 - 1] == ' ' && fw_offset > 4)

722 
fw_off£t
--;

723 
fw_off£t
 -= 4;

724 
	`°∫˝y
(&
öq_ª•⁄£
[32], 
dev
->
fúmw¨e_ªv
 + 
fw_off£t
, 4);

726 
x„r_Àn
 = 
	`mö
(
Æloc_Àn
, 
STANDARD_INQUIRY_LENGTH
);

727 
ªs
 = 
	`nvme_å™s_c›y_to_u£r
(
hdr
, 
öq_ª•⁄£
, 
x„r_Àn
);

729 
out_‰ì
:

730 
	`dma_‰ì_cohîít
(&
dev
->
pci_dev
->dev, (
nvme_id_ns
), 
mem
,

731 
dma_addr
);

732 
out_dma
:

733  
ªs
;

734 
	}
}

736 
	$nvme_å™s_suµ‹ãd_vpd_∑ges
(
nvme_ns
 *
ns
,

737 
sg_io_hdr
 *
hdr
, 
u8
 *
öq_ª•⁄£
,

738 
Æloc_Àn
)

740 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

741 
x„r_Àn
;

743 
	`mem£t
(
öq_ª•⁄£
, 0, 
STANDARD_INQUIRY_LENGTH
);

744 
öq_ª•⁄£
[1] = 
INQ_SUPPORTED_VPD_PAGES_PAGE
;

745 
öq_ª•⁄£
[3] = 
INQ_NUM_SUPPORTED_VPD_PAGES
;

746 
öq_ª•⁄£
[4] = 
INQ_SUPPORTED_VPD_PAGES_PAGE
;

747 
öq_ª•⁄£
[5] = 
INQ_UNIT_SERIAL_NUMBER_PAGE
;

748 
öq_ª•⁄£
[6] = 
INQ_DEVICE_IDENTIFICATION_PAGE
;

749 
öq_ª•⁄£
[7] = 
INQ_EXTENDED_INQUIRY_DATA_PAGE
;

750 
öq_ª•⁄£
[8] = 
INQ_BDEV_CHARACTERISTICS_PAGE
;

752 
x„r_Àn
 = 
	`mö
(
Æloc_Àn
, 
STANDARD_INQUIRY_LENGTH
);

753 
ªs
 = 
	`nvme_å™s_c›y_to_u£r
(
hdr
, 
öq_ª•⁄£
, 
x„r_Àn
);

755  
ªs
;

756 
	}
}

758 
	$nvme_å™s_unô_£rül_∑ge
(
nvme_ns
 *
ns
,

759 
sg_io_hdr
 *
hdr
, 
u8
 *
öq_ª•⁄£
,

760 
Æloc_Àn
)

762 
nvme_dev
 *
dev
 = 
ns
->dev;

763 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

764 
x„r_Àn
;

766 
	`mem£t
(
öq_ª•⁄£
, 0, 
STANDARD_INQUIRY_LENGTH
);

767 
öq_ª•⁄£
[1] = 
INQ_UNIT_SERIAL_NUMBER_PAGE
;

768 
öq_ª•⁄£
[3] = 
INQ_SERIAL_NUMBER_LENGTH
;

769 
	`°∫˝y
(&
öq_ª•⁄£
[4], 
dev
->
£rül
, 
INQ_SERIAL_NUMBER_LENGTH
);

771 
x„r_Àn
 = 
	`mö
(
Æloc_Àn
, 
STANDARD_INQUIRY_LENGTH
);

772 
ªs
 = 
	`nvme_å™s_c›y_to_u£r
(
hdr
, 
öq_ª•⁄£
, 
x„r_Àn
);

774  
ªs
;

775 
	}
}

777 
	$nvme_å™s_devi˚_id_∑ge
(
nvme_ns
 *
ns
, 
sg_io_hdr
 *
hdr
,

778 
u8
 *
öq_ª•⁄£
, 
Æloc_Àn
)

780 
nvme_dev
 *
dev
 = 
ns
->dev;

781 
dma_addr_t
 
dma_addr
;

782 *
mem
;

783 
nvme_id_˘æ
 *
id_˘æ
;

784 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

785 
nvme_sc
;

786 
u8
 
õì
[4];

787 
x„r_Àn
;

788 
__be32
 
tmp_id
 = 
	`˝u_to_be32
(
ns
->
ns_id
);

790 
mem
 = 
	`dma_Æloc_cohîít
(&
dev
->
pci_dev
->dev, (
nvme_id_ns
),

791 &
dma_addr
, 
GFP_KERNEL
);

792 i‡(
mem
 =
NULL
) {

793 
ªs
 = -
ENOMEM
;

794 
out_dma
;

798 
nvme_sc
 = 
	`nvme_idítify
(
dev
, 0, 1, 
dma_addr
);

799 
ªs
 = 
	`nvme_å™s_°©us_code
(
hdr
, 
nvme_sc
);

800 i‡(
ªs
)

801 
out_‰ì
;

802 i‡(
nvme_sc
) {

803 
ªs
 = 
nvme_sc
;

804 
out_‰ì
;

806 
id_˘æ
 = 
mem
;

809 
õì
[0] = 
id_˘æ
->ieee[0] << 4;

810 
õì
[1] = 
id_˘æ
->ieee[0] >> 4 | id_ctrl->ieee[1] << 4;

811 
õì
[2] = 
id_˘æ
->ieee[1] >> 4 | id_ctrl->ieee[2] << 4;

812 
õì
[3] = 
id_˘æ
->ieee[2] >> 4;

814 
	`mem£t
(
öq_ª•⁄£
, 0, 
STANDARD_INQUIRY_LENGTH
);

815 
öq_ª•⁄£
[1] = 
INQ_DEVICE_IDENTIFICATION_PAGE
;

816 
öq_ª•⁄£
[3] = 20;

818 
öq_ª•⁄£
[4] = 0x01;

819 
öq_ª•⁄£
[5] = 0x03;

820 
öq_ª•⁄£
[6] = 0x00;

821 
öq_ª•⁄£
[7] = 16;

823 
öq_ª•⁄£
[8] = 0x60 | 
õì
[3];

824 
öq_ª•⁄£
[9] = 
õì
[2];

825 
öq_ª•⁄£
[10] = 
õì
[1];

826 
öq_ª•⁄£
[11] = 
õì
[0];

827 
öq_ª•⁄£
[12] = (
dev
->
pci_dev
->
víd‹
 & 0xFF00) >> 8;

828 
öq_ª•⁄£
[13] = (
dev
->
pci_dev
->
víd‹
 & 0x00FF);

829 
öq_ª•⁄£
[14] = 
dev
->
£rül
[0];

830 
öq_ª•⁄£
[15] = 
dev
->
£rül
[1];

831 
öq_ª•⁄£
[16] = 
dev
->
modñ
[0];

832 
öq_ª•⁄£
[17] = 
dev
->
modñ
[1];

833 
	`mem˝y
(&
öq_ª•⁄£
[18], &
tmp_id
, (
u32
));

836 
x„r_Àn
 = 
	`mö
(
Æloc_Àn
, 
STANDARD_INQUIRY_LENGTH
);

837 
ªs
 = 
	`nvme_å™s_c›y_to_u£r
(
hdr
, 
öq_ª•⁄£
, 
x„r_Àn
);

839 
out_‰ì
:

840 
	`dma_‰ì_cohîít
(&
dev
->
pci_dev
->dev, (
nvme_id_ns
), 
mem
,

841 
dma_addr
);

842 
out_dma
:

843  
ªs
;

844 
	}
}

846 
	$nvme_å™s_ext_öq_∑ge
(
nvme_ns
 *
ns
, 
sg_io_hdr
 *
hdr
,

847 
Æloc_Àn
)

849 
u8
 *
öq_ª•⁄£
;

850 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

851 
nvme_sc
;

852 
nvme_dev
 *
dev
 = 
ns
->dev;

853 
dma_addr_t
 
dma_addr
;

854 *
mem
;

855 
nvme_id_˘æ
 *
id_˘æ
;

856 
nvme_id_ns
 *
id_ns
;

857 
x„r_Àn
;

858 
u8
 
mi¸ocode
 = 0x80;

859 
u8
 
•t
;

860 
u8
 
•t_lut
[8] = {0, 0, 2, 1, 4, 6, 5, 7};

861 
u8
 
grd_chk
, 
≠p_chk
, 
ªf_chk
, 
¥Ÿe˘
;

862 
u8
 
uask_sup
 = 0x20;

863 
u8
 
v_sup
;

864 
u8
 
lui˛r
 = 0x01;

866 
öq_ª•⁄£
 = 
	`kmÆloc
(
EXTENDED_INQUIRY_DATA_PAGE_LENGTH
, 
GFP_KERNEL
);

867 i‡(
öq_ª•⁄£
 =
NULL
) {

868 
ªs
 = -
ENOMEM
;

869 
out_mem
;

872 
mem
 = 
	`dma_Æloc_cohîít
(&
dev
->
pci_dev
->dev, (
nvme_id_ns
),

873 &
dma_addr
, 
GFP_KERNEL
);

874 i‡(
mem
 =
NULL
) {

875 
ªs
 = -
ENOMEM
;

876 
out_dma
;

880 
nvme_sc
 = 
	`nvme_idítify
(
dev
, 
ns
->
ns_id
, 0, 
dma_addr
);

881 
ªs
 = 
	`nvme_å™s_°©us_code
(
hdr
, 
nvme_sc
);

882 i‡(
ªs
)

883 
out_‰ì
;

884 i‡(
nvme_sc
) {

885 
ªs
 = 
nvme_sc
;

886 
out_‰ì
;

888 
id_ns
 = 
mem
;

889 
•t
 = 
•t_lut
[(
id_ns
->
dpc
) & 0x07] << 3;

890 (
id_ns
->
dps
Ë? (
¥Ÿe˘
 = 0x01) : (protect = 0);

891 
grd_chk
 = 
¥Ÿe˘
 << 2;

892 
≠p_chk
 = 
¥Ÿe˘
 << 1;

893 
ªf_chk
 = 
¥Ÿe˘
;

896 
nvme_sc
 = 
	`nvme_idítify
(
dev
, 0, 1, 
dma_addr
);

897 
ªs
 = 
	`nvme_å™s_°©us_code
(
hdr
, 
nvme_sc
);

898 i‡(
ªs
)

899 
out_‰ì
;

900 i‡(
nvme_sc
) {

901 
ªs
 = 
nvme_sc
;

902 
out_‰ì
;

904 
id_˘æ
 = 
mem
;

905 
v_sup
 = 
id_˘æ
->
vwc
;

907 
	`mem£t
(
öq_ª•⁄£
, 0, 
EXTENDED_INQUIRY_DATA_PAGE_LENGTH
);

908 
öq_ª•⁄£
[1] = 
INQ_EXTENDED_INQUIRY_DATA_PAGE
;

909 
öq_ª•⁄£
[2] = 0x00;

910 
öq_ª•⁄£
[3] = 0x3C;

911 
öq_ª•⁄£
[4] = 
mi¸ocode
 | 
•t
 | 
grd_chk
 | 
≠p_chk
 | 
ªf_chk
;

912 
öq_ª•⁄£
[5] = 
uask_sup
;

913 
öq_ª•⁄£
[6] = 
v_sup
;

914 
öq_ª•⁄£
[7] = 
lui˛r
;

915 
öq_ª•⁄£
[8] = 0;

916 
öq_ª•⁄£
[9] = 0;

918 
x„r_Àn
 = 
	`mö
(
Æloc_Àn
, 
EXTENDED_INQUIRY_DATA_PAGE_LENGTH
);

919 
ªs
 = 
	`nvme_å™s_c›y_to_u£r
(
hdr
, 
öq_ª•⁄£
, 
x„r_Àn
);

921 
out_‰ì
:

922 
	`dma_‰ì_cohîít
(&
dev
->
pci_dev
->dev, (
nvme_id_ns
), 
mem
,

923 
dma_addr
);

924 
out_dma
:

925 
	`k‰ì
(
öq_ª•⁄£
);

926 
out_mem
:

927  
ªs
;

928 
	}
}

930 
	$nvme_å™s_bdev_ch¨_∑ge
(
nvme_ns
 *
ns
, 
sg_io_hdr
 *
hdr
,

931 
Æloc_Àn
)

933 
u8
 *
öq_ª•⁄£
;

934 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

935 
x„r_Àn
;

937 
öq_ª•⁄£
 = 
	`kzÆloc
(
EXTENDED_INQUIRY_DATA_PAGE_LENGTH
, 
GFP_KERNEL
);

938 i‡(
öq_ª•⁄£
 =
NULL
) {

939 
ªs
 = -
ENOMEM
;

940 
out_mem
;

943 
öq_ª•⁄£
[1] = 
INQ_BDEV_CHARACTERISTICS_PAGE
;

944 
öq_ª•⁄£
[2] = 0x00;

945 
öq_ª•⁄£
[3] = 0x3C;

946 
öq_ª•⁄£
[4] = 0x00;

947 
öq_ª•⁄£
[5] = 0x01;

948 
öq_ª•⁄£
[6] = 0x00;

950 
x„r_Àn
 = 
	`mö
(
Æloc_Àn
, 
EXTENDED_INQUIRY_DATA_PAGE_LENGTH
);

951 
ªs
 = 
	`nvme_å™s_c›y_to_u£r
(
hdr
, 
öq_ª•⁄£
, 
x„r_Àn
);

953 
	`k‰ì
(
öq_ª•⁄£
);

954 
out_mem
:

955  
ªs
;

956 
	}
}

960 
	$nvme_å™s_log_suµ_∑ges
(
nvme_ns
 *
ns
, 
sg_io_hdr
 *
hdr
,

961 
Æloc_Àn
)

963 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

964 
x„r_Àn
;

965 
u8
 *
log_ª•⁄£
;

967 
log_ª•⁄£
 = 
	`kzÆloc
(
LOG_PAGE_SUPPORTED_LOG_PAGES_LENGTH
, 
GFP_KERNEL
);

968 i‡(
log_ª•⁄£
 =
NULL
) {

969 
ªs
 = -
ENOMEM
;

970 
out_mem
;

973 
log_ª•⁄£
[0] = 
LOG_PAGE_SUPPORTED_LOG_PAGES_PAGE
;

975 
log_ª•⁄£
[3] = 
SUPPORTED_LOG_PAGES_PAGE_LENGTH
;

976 
log_ª•⁄£
[4] = 
LOG_PAGE_SUPPORTED_LOG_PAGES_PAGE
;

977 
log_ª•⁄£
[5] = 
LOG_PAGE_INFORMATIONAL_EXCEPTIONS_PAGE
;

978 
log_ª•⁄£
[6] = 
LOG_PAGE_TEMPERATURE_PAGE
;

980 
x„r_Àn
 = 
	`mö
(
Æloc_Àn
, 
LOG_PAGE_SUPPORTED_LOG_PAGES_LENGTH
);

981 
ªs
 = 
	`nvme_å™s_c›y_to_u£r
(
hdr
, 
log_ª•⁄£
, 
x„r_Àn
);

983 
	`k‰ì
(
log_ª•⁄£
);

984 
out_mem
:

985  
ªs
;

986 
	}
}

988 
	$nvme_å™s_log_öfo_ex˚±i⁄s
(
nvme_ns
 *
ns
,

989 
sg_io_hdr
 *
hdr
, 
Æloc_Àn
)

991 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

992 
x„r_Àn
;

993 
u8
 *
log_ª•⁄£
;

994 
nvme_comm™d
 
c
;

995 
nvme_dev
 *
dev
 = 
ns
->dev;

996 
nvme_sm¨t_log
 *
sm¨t_log
;

997 
dma_addr_t
 
dma_addr
;

998 *
mem
;

999 
u8
 
ãmp_c
;

1000 
u16
 
ãmp_k
;

1002 
log_ª•⁄£
 = 
	`kzÆloc
(
LOG_INFO_EXCP_PAGE_LENGTH
, 
GFP_KERNEL
);

1003 i‡(
log_ª•⁄£
 =
NULL
) {

1004 
ªs
 = -
ENOMEM
;

1005 
out_mem
;

1008 
mem
 = 
	`dma_Æloc_cohîít
(&
dev
->
pci_dev
->dev,

1009 (
nvme_sm¨t_log
),

1010 &
dma_addr
, 
GFP_KERNEL
);

1011 i‡(
mem
 =
NULL
) {

1012 
ªs
 = -
ENOMEM
;

1013 
out_dma
;

1017 
	`mem£t
(&
c
, 0, (c));

1018 
c
.
comm⁄
.
›code
 = 
nvme_admö_gë_log_∑ge
;

1019 
c
.
comm⁄
.
nsid
 = 
	`˝u_to_À32
(0xFFFFFFFF);

1020 
c
.
comm⁄
.
¥p1
 = 
	`˝u_to_À64
(
dma_addr
);

1021 
c
.
comm⁄
.
cdw10
[0] = 
	`˝u_to_À32
(((((
nvme_sm¨t_log
) /

1022 
BYTES_TO_DWORDS
Ë- 1Ë<< 16Ë| 
NVME_LOG_SMART
);

1023 
ªs
 = 
	`nvme_submô_admö_cmd
(
dev
, &
c
, 
NULL
);

1024 i‡(
ªs
 !
NVME_SC_SUCCESS
) {

1025 
ãmp_c
 = 
LOG_TEMP_UNKNOWN
;

1027 
sm¨t_log
 = 
mem
;

1028 
ãmp_k
 = (
sm¨t_log
->
ãm≥øtuª
[1] << 8) +

1029 (
sm¨t_log
->
ãm≥øtuª
[0]);

1030 
ãmp_c
 = 
ãmp_k
 - 
KELVIN_TEMP_FACTOR
;

1033 
log_ª•⁄£
[0] = 
LOG_PAGE_INFORMATIONAL_EXCEPTIONS_PAGE
;

1035 
log_ª•⁄£
[3] = 
REMAINING_INFO_EXCP_PAGE_LENGTH
;

1038 
log_ª•⁄£
[6] = 0x23;

1039 
log_ª•⁄£
[7] = 0x04;

1042 
log_ª•⁄£
[10] = 
ãmp_c
;

1044 
x„r_Àn
 = 
	`mö
(
Æloc_Àn
, 
LOG_INFO_EXCP_PAGE_LENGTH
);

1045 
ªs
 = 
	`nvme_å™s_c›y_to_u£r
(
hdr
, 
log_ª•⁄£
, 
x„r_Àn
);

1047 
	`dma_‰ì_cohîít
(&
dev
->
pci_dev
->dev, (
nvme_sm¨t_log
),

1048 
mem
, 
dma_addr
);

1049 
out_dma
:

1050 
	`k‰ì
(
log_ª•⁄£
);

1051 
out_mem
:

1052  
ªs
;

1053 
	}
}

1055 
	$nvme_å™s_log_ãm≥øtuª
(
nvme_ns
 *
ns
, 
sg_io_hdr
 *
hdr
,

1056 
Æloc_Àn
)

1058 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

1059 
x„r_Àn
;

1060 
u8
 *
log_ª•⁄£
;

1061 
nvme_comm™d
 
c
;

1062 
nvme_dev
 *
dev
 = 
ns
->dev;

1063 
nvme_sm¨t_log
 *
sm¨t_log
;

1064 
dma_addr_t
 
dma_addr
;

1065 *
mem
;

1066 
u32
 
„©uª_ª•
;

1067 
u8
 
ãmp_c_cur
, 
ãmp_c_thªsh
;

1068 
u16
 
ãmp_k
;

1070 
log_ª•⁄£
 = 
	`kzÆloc
(
LOG_TEMP_PAGE_LENGTH
, 
GFP_KERNEL
);

1071 i‡(
log_ª•⁄£
 =
NULL
) {

1072 
ªs
 = -
ENOMEM
;

1073 
out_mem
;

1076 
mem
 = 
	`dma_Æloc_cohîít
(&
dev
->
pci_dev
->dev,

1077 (
nvme_sm¨t_log
),

1078 &
dma_addr
, 
GFP_KERNEL
);

1079 i‡(
mem
 =
NULL
) {

1080 
ªs
 = -
ENOMEM
;

1081 
out_dma
;

1085 
	`mem£t
(&
c
, 0, (c));

1086 
c
.
comm⁄
.
›code
 = 
nvme_admö_gë_log_∑ge
;

1087 
c
.
comm⁄
.
nsid
 = 
	`˝u_to_À32
(0xFFFFFFFF);

1088 
c
.
comm⁄
.
¥p1
 = 
	`˝u_to_À64
(
dma_addr
);

1089 
c
.
comm⁄
.
cdw10
[0] = 
	`˝u_to_À32
(((((
nvme_sm¨t_log
) /

1090 
BYTES_TO_DWORDS
Ë- 1Ë<< 16Ë| 
NVME_LOG_SMART
);

1091 
ªs
 = 
	`nvme_submô_admö_cmd
(
dev
, &
c
, 
NULL
);

1092 i‡(
ªs
 !
NVME_SC_SUCCESS
) {

1093 
ãmp_c_cur
 = 
LOG_TEMP_UNKNOWN
;

1095 
sm¨t_log
 = 
mem
;

1096 
ãmp_k
 = (
sm¨t_log
->
ãm≥øtuª
[1] << 8) +

1097 (
sm¨t_log
->
ãm≥øtuª
[0]);

1098 
ãmp_c_cur
 = 
ãmp_k
 - 
KELVIN_TEMP_FACTOR
;

1102 
ªs
 = 
	`nvme_gë_„©uªs
(
dev
, 
NVME_FEAT_TEMP_THRESH
, 0, 0,

1103 &
„©uª_ª•
);

1104 i‡(
ªs
 !
NVME_SC_SUCCESS
)

1105 
ãmp_c_thªsh
 = 
LOG_TEMP_UNKNOWN
;

1107 
ãmp_c_thªsh
 = (
„©uª_ª•
 & 0xFFFFË- 
KELVIN_TEMP_FACTOR
;

1109 
log_ª•⁄£
[0] = 
LOG_PAGE_TEMPERATURE_PAGE
;

1111 
log_ª•⁄£
[3] = 
REMAINING_TEMP_PAGE_LENGTH
;

1114 
log_ª•⁄£
[6] = 0x01;

1115 
log_ª•⁄£
[7] = 0x02;

1117 
log_ª•⁄£
[9] = 
ãmp_c_cur
;

1119 
log_ª•⁄£
[11] = 0x01;

1120 
log_ª•⁄£
[12] = 0x01;

1121 
log_ª•⁄£
[13] = 0x02;

1123 
log_ª•⁄£
[15] = 
ãmp_c_thªsh
;

1125 
x„r_Àn
 = 
	`mö
(
Æloc_Àn
, 
LOG_TEMP_PAGE_LENGTH
);

1126 
ªs
 = 
	`nvme_å™s_c›y_to_u£r
(
hdr
, 
log_ª•⁄£
, 
x„r_Àn
);

1128 
	`dma_‰ì_cohîít
(&
dev
->
pci_dev
->dev, (
nvme_sm¨t_log
),

1129 
mem
, 
dma_addr
);

1130 
out_dma
:

1131 
	`k‰ì
(
log_ª•⁄£
);

1132 
out_mem
:

1133  
ªs
;

1134 
	}
}

1138 
	$nvme_å™s_fûl_mode_∑rm_hdr
(
u8
 *
ª•
, 
Àn
, u8 
cdb10
, u8 
ŒbØ
,

1139 
u16
 
mode_d©a_Àngth
, u16 
blk_desc_Àn
)

1142 i‡((
cdb10
 && 
Àn
 < 8) || (!cdb10 &&Üen < 4))

1143  
SNTI_INTERNAL_ERROR
;

1145 i‡(
cdb10
) {

1146 
ª•
[0] = (
mode_d©a_Àngth
 & 0xFF00) >> 8;

1147 
ª•
[1] = (
mode_d©a_Àngth
 & 0x00FF);

1149 
ª•
[4] = 
ŒbØ
;

1150 
ª•
[5] = 
RESERVED_FIELD
;

1151 
ª•
[6] = (
blk_desc_Àn
 & 0xFF00) >> 8;

1152 
ª•
[7] = (
blk_desc_Àn
 & 0x00FF);

1154 
ª•
[0] = (
mode_d©a_Àngth
 & 0x00FF);

1156 
ª•
[3] = (
blk_desc_Àn
 & 0x00FF);

1159  
SNTI_TRANSLATION_SUCCESS
;

1160 
	}
}

1162 
	$nvme_å™s_fûl_blk_desc
(
nvme_ns
 *
ns
, 
sg_io_hdr
 *
hdr
,

1163 
u8
 *
ª•
, 
Àn
, u8 
ŒbØ
)

1165 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

1166 
nvme_sc
;

1167 
nvme_dev
 *
dev
 = 
ns
->dev;

1168 
dma_addr_t
 
dma_addr
;

1169 *
mem
;

1170 
nvme_id_ns
 *
id_ns
;

1171 
u8
 
Êbas
;

1172 
u32
 
lba_Àngth
;

1174 i‡(
ŒbØ
 =0 && 
Àn
 < 
MODE_PAGE_BLK_DES_LEN
)

1175  
SNTI_INTERNAL_ERROR
;

1176 i‡(
ŒbØ
 > 0 && 
Àn
 < 
MODE_PAGE_LLBAA_BLK_DES_LEN
)

1177  
SNTI_INTERNAL_ERROR
;

1179 
mem
 = 
	`dma_Æloc_cohîít
(&
dev
->
pci_dev
->dev, (
nvme_id_ns
),

1180 &
dma_addr
, 
GFP_KERNEL
);

1181 i‡(
mem
 =
NULL
) {

1182 
ªs
 = -
ENOMEM
;

1183 
out
;

1187 
nvme_sc
 = 
	`nvme_idítify
(
dev
, 
ns
->
ns_id
, 0, 
dma_addr
);

1188 
ªs
 = 
	`nvme_å™s_°©us_code
(
hdr
, 
nvme_sc
);

1189 i‡(
ªs
)

1190 
out_dma
;

1191 i‡(
nvme_sc
) {

1192 
ªs
 = 
nvme_sc
;

1193 
out_dma
;

1195 
id_ns
 = 
mem
;

1196 
Êbas
 = (
id_ns
->flbas) & 0x0F;

1197 
lba_Àngth
 = (1 << (
id_ns
->
lbaf
[
Êbas
].
ds
));

1199 i‡(
ŒbØ
 == 0) {

1200 
__be32
 
tmp_ˇp
 = 
	`˝u_to_be32
(
	`À64_to_˝u
(
id_ns
->
nˇp
));

1202 
__be32
 
tmp_Àn
 = 
	`˝u_to_be32
(
lba_Àngth
 & 0x00FFFFFF);

1204 
	`mem˝y
(
ª•
, &
tmp_ˇp
, (
u32
));

1205 
	`mem˝y
(&
ª•
[4], &
tmp_Àn
, (
u32
));

1207 
__be64
 
tmp_ˇp
 = 
	`˝u_to_be64
(
	`À64_to_˝u
(
id_ns
->
nˇp
));

1208 
__be32
 
tmp_Àn
 = 
	`˝u_to_be32
(
lba_Àngth
);

1210 
	`mem˝y
(
ª•
, &
tmp_ˇp
, (
u64
));

1212 
	`mem˝y
(&
ª•
[12], &
tmp_Àn
, (
u32
));

1215 
out_dma
:

1216 
	`dma_‰ì_cohîít
(&
dev
->
pci_dev
->dev, (
nvme_id_ns
), 
mem
,

1217 
dma_addr
);

1218 
out
:

1219  
ªs
;

1220 
	}
}

1222 
	$nvme_å™s_fûl_c⁄åﬁ_∑ge
(
nvme_ns
 *
ns
,

1223 
sg_io_hdr
 *
hdr
, 
u8
 *
ª•
,

1224 
Àn
)

1226 i‡(
Àn
 < 
MODE_PAGE_CONTROL_LEN
)

1227  
SNTI_INTERNAL_ERROR
;

1229 
ª•
[0] = 
MODE_PAGE_CONTROL
;

1230 
ª•
[1] = 
MODE_PAGE_CONTROL_LEN_FIELD
;

1231 
ª•
[2] = 0x0E;

1233 
ª•
[3] = 0x12;

1235 
ª•
[5] = 0x40;

1237 
ª•
[8] = 0xFF;

1238 
ª•
[9] = 0xFF;

1241  
SNTI_TRANSLATION_SUCCESS
;

1242 
	}
}

1244 
	$nvme_å™s_fûl_ˇchög_∑ge
(
nvme_ns
 *
ns
,

1245 
sg_io_hdr
 *
hdr
,

1246 
u8
 *
ª•
, 
Àn
)

1248 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

1249 
nvme_sc
;

1250 
nvme_dev
 *
dev
 = 
ns
->dev;

1251 
u32
 
„©uª_ª•
;

1252 
u8
 
vwc
;

1254 i‡(
Àn
 < 
MODE_PAGE_CACHING_LEN
)

1255  
SNTI_INTERNAL_ERROR
;

1257 
nvme_sc
 = 
	`nvme_gë_„©uªs
(
dev
, 
NVME_FEAT_VOLATILE_WC
, 0, 0,

1258 &
„©uª_ª•
);

1259 
ªs
 = 
	`nvme_å™s_°©us_code
(
hdr
, 
nvme_sc
);

1260 i‡(
ªs
)

1261 
out
;

1262 i‡(
nvme_sc
) {

1263 
ªs
 = 
nvme_sc
;

1264 
out
;

1266 
vwc
 = 
„©uª_ª•
 & 0x00000001;

1268 
ª•
[0] = 
MODE_PAGE_CACHING
;

1269 
ª•
[1] = 
MODE_PAGE_CACHING_LEN_FIELD
;

1270 
ª•
[2] = 
vwc
 << 2;

1272 
out
:

1273  
ªs
;

1274 
	}
}

1276 
	$nvme_å™s_fûl_pow_˙d_∑ge
(
nvme_ns
 *
ns
,

1277 
sg_io_hdr
 *
hdr
, 
u8
 *
ª•
,

1278 
Àn
)

1280 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

1282 i‡(
Àn
 < 
MODE_PAGE_POW_CND_LEN
)

1283  
SNTI_INTERNAL_ERROR
;

1285 
ª•
[0] = 
MODE_PAGE_POWER_CONDITION
;

1286 
ª•
[1] = 
MODE_PAGE_POW_CND_LEN_FIELD
;

1289  
ªs
;

1290 
	}
}

1292 
	$nvme_å™s_fûl_öf_exc_∑ge
(
nvme_ns
 *
ns
,

1293 
sg_io_hdr
 *
hdr
, 
u8
 *
ª•
,

1294 
Àn
)

1296 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

1298 i‡(
Àn
 < 
MODE_PAGE_INF_EXC_LEN
)

1299  
SNTI_INTERNAL_ERROR
;

1301 
ª•
[0] = 
MODE_PAGE_INFO_EXCEP
;

1302 
ª•
[1] = 
MODE_PAGE_INF_EXC_LEN_FIELD
;

1303 
ª•
[2] = 0x88;

1306  
ªs
;

1307 
	}
}

1309 
	$nvme_å™s_fûl_Æl_∑ges
(
nvme_ns
 *
ns
, 
sg_io_hdr
 *
hdr
,

1310 
u8
 *
ª•
, 
Àn
)

1312 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

1313 
u16
 
mode_∑ges_off£t_1
 = 0;

1314 
u16
 
mode_∑ges_off£t_2
, 
mode_∑ges_off£t_3
, 
mode_∑ges_off£t_4
;

1316 
mode_∑ges_off£t_2
 = 
mode_∑ges_off£t_1
 + 
MODE_PAGE_CACHING_LEN
;

1317 
mode_∑ges_off£t_3
 = 
mode_∑ges_off£t_2
 + 
MODE_PAGE_CONTROL_LEN
;

1318 
mode_∑ges_off£t_4
 = 
mode_∑ges_off£t_3
 + 
MODE_PAGE_POW_CND_LEN
;

1320 
ªs
 = 
	`nvme_å™s_fûl_ˇchög_∑ge
(
ns
, 
hdr
, &
ª•
[
mode_∑ges_off£t_1
],

1321 
MODE_PAGE_CACHING_LEN
);

1322 i‡(
ªs
 !
SNTI_TRANSLATION_SUCCESS
)

1323 
out
;

1324 
ªs
 = 
	`nvme_å™s_fûl_c⁄åﬁ_∑ge
(
ns
, 
hdr
, &
ª•
[
mode_∑ges_off£t_2
],

1325 
MODE_PAGE_CONTROL_LEN
);

1326 i‡(
ªs
 !
SNTI_TRANSLATION_SUCCESS
)

1327 
out
;

1328 
ªs
 = 
	`nvme_å™s_fûl_pow_˙d_∑ge
(
ns
, 
hdr
, &
ª•
[
mode_∑ges_off£t_3
],

1329 
MODE_PAGE_POW_CND_LEN
);

1330 i‡(
ªs
 !
SNTI_TRANSLATION_SUCCESS
)

1331 
out
;

1332 
ªs
 = 
	`nvme_å™s_fûl_öf_exc_∑ge
(
ns
, 
hdr
, &
ª•
[
mode_∑ges_off£t_4
],

1333 
MODE_PAGE_INF_EXC_LEN
);

1334 i‡(
ªs
 !
SNTI_TRANSLATION_SUCCESS
)

1335 
out
;

1337 
out
:

1338  
ªs
;

1339 
	}
}

1341 
ölöe
 
	$nvme_å™s_gë_blk_desc_Àn
(
u8
 
dbd
, u8 
ŒbØ
)

1343 i‡(
dbd
 =
MODE_SENSE_BLK_DESC_ENABLED
) {

1345  8 * (
ŒbØ
 + 1Ë* 
MODE_SENSE_BLK_DESC_COUNT
;

1349 
	}
}

1351 
nvme_å™s_mode_∑ge_¸óã
(
nvme_ns
 *
ns
,

1352 
sg_io_hdr
 *
hdr
, 
u8
 *
cmd
,

1353 
u16
 
Æloc_Àn
, 
u8
 
cdb10
,

1354 (*
mode_∑ge_fûl_func
)

1355 (
nvme_ns
 *,

1356 
sg_io_hdr
 *
hdr
, 
u8
 *, ),

1357 
u16
 
mode_∑ges_tŸ_Àn
)

1359 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

1360 
x„r_Àn
;

1361 
u8
 *
ª•⁄£
;

1362 
u8
 
dbd
, 
ŒbØ
;

1363 
u16
 
ª•_size
;

1364 
mph_size
;

1365 
u16
 
mode_∑ges_off£t_1
;

1366 
u16
 
blk_desc_Àn
, 
blk_desc_off£t
, 
mode_d©a_Àngth
;

1368 
dbd
 = 
	`GET_MODE_SENSE_DBD
(
cmd
);

1369 
ŒbØ
 = 
	`GET_MODE_SENSE_LLBAA
(
cmd
);

1370 
mph_size
 = 
	`GET_MODE_SENSE_MPH_SIZE
(
cdb10
);

1371 
blk_desc_Àn
 = 
	`nvme_å™s_gë_blk_desc_Àn
(
dbd
, 
ŒbØ
);

1373 
ª•_size
 = 
mph_size
 + 
blk_desc_Àn
 + 
mode_∑ges_tŸ_Àn
;

1375 
mode_d©a_Àngth
 = 3 + (3 * 
cdb10
Ë+ 
blk_desc_Àn
 + 
mode_∑ges_tŸ_Àn
;

1377 
blk_desc_off£t
 = 
mph_size
;

1378 
mode_∑ges_off£t_1
 = 
blk_desc_off£t
 + 
blk_desc_Àn
;

1380 
ª•⁄£
 = 
	`kzÆloc
(
ª•_size
, 
GFP_KERNEL
);

1381 i‡(
ª•⁄£
 =
NULL
) {

1382 
ªs
 = -
ENOMEM
;

1383 
out_mem
;

1386 
ªs
 = 
	`nvme_å™s_fûl_mode_∑rm_hdr
(&
ª•⁄£
[0], 
mph_size
, 
cdb10
,

1387 
ŒbØ
, 
mode_d©a_Àngth
, 
blk_desc_Àn
);

1388 i‡(
ªs
 !
SNTI_TRANSLATION_SUCCESS
)

1389 
out_‰ì
;

1390 i‡(
blk_desc_Àn
 > 0) {

1391 
ªs
 = 
	`nvme_å™s_fûl_blk_desc
(
ns
, 
hdr
,

1392 &
ª•⁄£
[
blk_desc_off£t
],

1393 
blk_desc_Àn
, 
ŒbØ
);

1394 i‡(
ªs
 !
SNTI_TRANSLATION_SUCCESS
)

1395 
out_‰ì
;

1397 
ªs
 = 
	`mode_∑ge_fûl_func
(
ns
, 
hdr
, &
ª•⁄£
[
mode_∑ges_off£t_1
],

1398 
mode_∑ges_tŸ_Àn
);

1399 i‡(
ªs
 !
SNTI_TRANSLATION_SUCCESS
)

1400 
out_‰ì
;

1402 
x„r_Àn
 = 
	`mö
(
Æloc_Àn
, 
ª•_size
);

1403 
ªs
 = 
	`nvme_å™s_c›y_to_u£r
(
hdr
, 
ª•⁄£
, 
x„r_Àn
);

1405 
out_‰ì
:

1406 
	`k‰ì
(
ª•⁄£
);

1407 
out_mem
:

1408  
ªs
;

1409 
	}
}

1413 
	$nvme_å™s_fûl_ªad_ˇp
(
u8
 *
ª•⁄£
, 
nvme_id_ns
 *
id_ns
,

1414 
u8
 
cdb16
)

1416 
u8
 
Êbas
;

1417 
u32
 
lba_Àngth
;

1418 
u64
 
æba
;

1419 
u8
 
¥Ÿ_í
;

1420 
u8
 
p_ty≥_lut
[4] = {0, 0, 1, 2};

1421 
__be64
 
tmp_æba
;

1422 
__be32
 
tmp_æba_32
;

1423 
__be32
 
tmp_Àn
;

1425 
Êbas
 = (
id_ns
->flbas) & 0x0F;

1426 
lba_Àngth
 = (1 << (
id_ns
->
lbaf
[
Êbas
].
ds
));

1427 
æba
 = 
	`À64_to_˝up
(&
id_ns
->
nsze
) - 1;

1428 (
id_ns
->
dps
Ë? (
¥Ÿ_í
 = 0x01) : (prot_en = 0);

1430 i‡(!
cdb16
) {

1431 i‡(
æba
 > 0xFFFFFFFF)

1432 
æba
 = 0xFFFFFFFF;

1433 
tmp_æba_32
 = 
	`˝u_to_be32
(
æba
);

1434 
tmp_Àn
 = 
	`˝u_to_be32
(
lba_Àngth
);

1435 
	`mem˝y
(
ª•⁄£
, &
tmp_æba_32
, (
u32
));

1436 
	`mem˝y
(&
ª•⁄£
[4], &
tmp_Àn
, (
u32
));

1438 
tmp_æba
 = 
	`˝u_to_be64
(
æba
);

1439 
tmp_Àn
 = 
	`˝u_to_be32
(
lba_Àngth
);

1440 
	`mem˝y
(
ª•⁄£
, &
tmp_æba
, (
u64
));

1441 
	`mem˝y
(&
ª•⁄£
[8], &
tmp_Àn
, (
u32
));

1442 
ª•⁄£
[12] = (
p_ty≥_lut
[
id_ns
->
dps
 & 0x3] << 1Ë| 
¥Ÿ_í
;

1447 
	}
}

1451 
	$nvme_å™s_powî_°©e
(
nvme_ns
 *
ns
, 
sg_io_hdr
 *
hdr
,

1452 
u8
 
pc
, u8 
pcmod
, u8 
°¨t
)

1454 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

1455 
nvme_sc
;

1456 
nvme_dev
 *
dev
 = 
ns
->dev;

1457 
dma_addr_t
 
dma_addr
;

1458 *
mem
;

1459 
nvme_id_˘æ
 *
id_˘æ
;

1460 
lowe°_pow_°
;

1461 
ps_desúed
 = 0;

1464 
mem
 = 
	`dma_Æloc_cohîít
(&
dev
->
pci_dev
->dev,

1465 (
nvme_id_˘æ
),

1466 &
dma_addr
, 
GFP_KERNEL
);

1467 i‡(
mem
 =
NULL
) {

1468 
ªs
 = -
ENOMEM
;

1469 
out
;

1471 
nvme_sc
 = 
	`nvme_idítify
(
dev
, 0, 1, 
dma_addr
);

1472 
ªs
 = 
	`nvme_å™s_°©us_code
(
hdr
, 
nvme_sc
);

1473 i‡(
ªs
)

1474 
out_dma
;

1475 i‡(
nvme_sc
) {

1476 
ªs
 = 
nvme_sc
;

1477 
out_dma
;

1479 
id_˘æ
 = 
mem
;

1480 
lowe°_pow_°
 = 
	`max
(
POWER_STATE_0
, ()(
id_˘æ
->
≈ss
 - 1));

1482 
pc
) {

1483 
NVME_POWER_STATE_START_VALID
:

1485 i‡(
pcmod
 =0 && 
°¨t
 == 0x1)

1486 
ps_desúed
 = 
POWER_STATE_0
;

1487 i‡(
pcmod
 =0 && 
°¨t
 == 0x0)

1488 
ps_desúed
 = 
lowe°_pow_°
;

1490 
NVME_POWER_STATE_ACTIVE
:

1492 i‡(
pcmod
 == 0)

1493 
ps_desúed
 = 
POWER_STATE_0
;

1495 
NVME_POWER_STATE_IDLE
:

1497 i‡(
pcmod
 == 0x0)

1498 
ps_desúed
 = 
POWER_STATE_1
;

1499 i‡(
pcmod
 == 0x1)

1500 
ps_desúed
 = 
POWER_STATE_2
;

1501 i‡(
pcmod
 == 0x2)

1502 
ps_desúed
 = 
POWER_STATE_3
;

1504 
NVME_POWER_STATE_STANDBY
:

1506 i‡(
pcmod
 == 0x0)

1507 
ps_desúed
 = 
	`max
(
POWER_STATE_0
, (
lowe°_pow_°
 - 2));

1508 i‡(
pcmod
 == 0x1)

1509 
ps_desúed
 = 
	`max
(
POWER_STATE_0
, (
lowe°_pow_°
 - 1));

1511 
NVME_POWER_STATE_LU_CONTROL
:

1513 
ªs
 = 
	`nvme_å™s_com∂ëi⁄
(
hdr
, 
SAM_STAT_CHECK_CONDITION
,

1514 
ILLEGAL_REQUEST
, 
SCSI_ASC_INVALID_CDB
,

1515 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
);

1518 
nvme_sc
 = 
	`nvme_£t_„©uªs
(
dev
, 
NVME_FEAT_POWER_MGMT
, 
ps_desúed
, 0,

1519 
NULL
);

1520 
ªs
 = 
	`nvme_å™s_°©us_code
(
hdr
, 
nvme_sc
);

1521 i‡(
ªs
)

1522 
out_dma
;

1523 i‡(
nvme_sc
)

1524 
ªs
 = 
nvme_sc
;

1525 
out_dma
:

1526 
	`dma_‰ì_cohîít
(&
dev
->
pci_dev
->dev, (
nvme_id_˘æ
), 
mem
,

1527 
dma_addr
);

1528 
out
:

1529  
ªs
;

1530 
	}
}

1535 
	$nvme_å™s_£nd_fw_cmd
(
nvme_ns
 *
ns
, 
sg_io_hdr
 *
hdr
,

1536 
u8
 
›code
, 
u32
 
tŸ_Àn
, u32 
off£t
,

1537 
u8
 
buf„r_id
)

1539 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

1540 
nvme_sc
;

1541 
nvme_dev
 *
dev
 = 
ns
->dev;

1542 
nvme_comm™d
 
c
;

1543 
nvme_iod
 *
iod
 = 
NULL
;

1544 
Àngth
;

1546 
	`mem£t
(&
c
, 0, (c));

1547 
c
.
comm⁄
.
›code
 = opcode;

1548 i‡(
›code
 =
nvme_admö_dow∆ﬂd_fw
) {

1549 i‡(
hdr
->
iovec_cou¡
 > 0) {

1551 
ªs
 = 
	`nvme_å™s_com∂ëi⁄
(
hdr
,

1552 
SAM_STAT_CHECK_CONDITION
,

1553 
ILLEGAL_REQUEST
,

1554 
SCSI_ASC_INVALID_CDB
,

1555 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
);

1556 
out
;

1558 
iod
 = 
	`nvme_m≠_u£r_∑ges
(
dev
, 
DMA_TO_DEVICE
,

1559 ()
hdr
->
dx„Ω
, 
tŸ_Àn
);

1560 i‡(
	`IS_ERR
(
iod
)) {

1561 
ªs
 = 
	`PTR_ERR
(
iod
);

1562 
out
;

1564 
Àngth
 = 
	`nvme_£tup_¥ps
(
dev
, 
iod
, 
tŸ_Àn
, 
GFP_KERNEL
);

1565 i‡(
Àngth
 !
tŸ_Àn
) {

1566 
ªs
 = -
ENOMEM
;

1567 
out_unm≠
;

1570 
c
.
dlfw
.
¥p1
 = 
	`˝u_to_À64
(
	`sg_dma_addªss
(
iod
->
sg
));

1571 
c
.
dlfw
.
¥p2
 = 
	`˝u_to_À64
(
iod
->
fú°_dma
);

1572 
c
.
dlfw
.
numd
 = 
	`˝u_to_À32
((
tŸ_Àn
/
BYTES_TO_DWORDS
) - 1);

1573 
c
.
dlfw
.
off£t
 = 
	`˝u_to_À32
(off£t/
BYTES_TO_DWORDS
);

1574 } i‡(
›code
 =
nvme_admö_a˘iv©e_fw
) {

1575 
u32
 
cdw10
 = 
buf„r_id
 | 
NVME_FWACT_REPL_ACTV
;

1576 
c
.
comm⁄
.
cdw10
[0] = 
	`˝u_to_À32
(cdw10);

1579 
nvme_sc
 = 
	`nvme_submô_admö_cmd
(
dev
, &
c
, 
NULL
);

1580 
ªs
 = 
	`nvme_å™s_°©us_code
(
hdr
, 
nvme_sc
);

1581 i‡(
ªs
)

1582 
out_unm≠
;

1583 i‡(
nvme_sc
)

1584 
ªs
 = 
nvme_sc
;

1586 
out_unm≠
:

1587 i‡(
›code
 =
nvme_admö_dow∆ﬂd_fw
) {

1588 
	`nvme_unm≠_u£r_∑ges
(
dev
, 
DMA_TO_DEVICE
, 
iod
);

1589 
	`nvme_‰ì_iod
(
dev
, 
iod
);

1591 
out
:

1592  
ªs
;

1593 
	}
}

1597 
ölöe
 
	$nvme_å™s_mode£l_gë_bd_Àn
(
u8
 *
∑rm_li°
, u8 
cdb10
,

1598 
u16
 *
bd_Àn
, 
u8
 *
ŒbØ
)

1600 i‡(
cdb10
) {

1602 *
bd_Àn
 = (
∑rm_li°
[
MODE_SELECT_10_BD_OFFSET
] << 8) +

1603 
∑rm_li°
[
MODE_SELECT_10_BD_OFFSET
 + 1];

1604 *
ŒbØ
 = 
∑rm_li°
[
MODE_SELECT_10_LLBAA_OFFSET
] &&

1605 
MODE_SELECT_10_LLBAA_MASK
;

1608 *
bd_Àn
 = 
∑rm_li°
[
MODE_SELECT_6_BD_OFFSET
];

1610 
	}
}

1612 
	$nvme_å™s_mode£l_ßve_bd
(
nvme_ns
 *
ns
, 
u8
 *
∑rm_li°
,

1613 
u16
 
idx
, u16 
bd_Àn
, 
u8
 
ŒbØ
)

1615 
u16
 
bd_num
;

1617 
bd_num
 = 
bd_Àn
 / ((
ŒbØ
 == 0) ?

1618 
SHORT_DESC_BLOCK
 : 
LONG_DESC_BLOCK
);

1621 i‡(
ŒbØ
 == 0) {

1623 
ns
->
mode_£À˘_num_blocks
 =

1624 (
∑rm_li°
[
idx
 + 1] << 16) +

1625 (
∑rm_li°
[
idx
 + 2] << 8) +

1626 (
∑rm_li°
[
idx
 + 3]);

1628 
ns
->
mode_£À˘_block_Àn
 =

1629 (
∑rm_li°
[
idx
 + 5] << 16) +

1630 (
∑rm_li°
[
idx
 + 6] << 8) +

1631 (
∑rm_li°
[
idx
 + 7]);

1634 
ns
->
mode_£À˘_num_blocks
 =

1635 (((
u64
)
∑rm_li°
[
idx
 + 0]) << 56) +

1636 (((
u64
)
∑rm_li°
[
idx
 + 1]) << 48) +

1637 (((
u64
)
∑rm_li°
[
idx
 + 2]) << 40) +

1638 (((
u64
)
∑rm_li°
[
idx
 + 3]) << 32) +

1639 (((
u64
)
∑rm_li°
[
idx
 + 4]) << 24) +

1640 (((
u64
)
∑rm_li°
[
idx
 + 5]) << 16) +

1641 (((
u64
)
∑rm_li°
[
idx
 + 6]) << 8) +

1642 ((
u64
)
∑rm_li°
[
idx
 + 7]);

1644 
ns
->
mode_£À˘_block_Àn
 =

1645 (
∑rm_li°
[
idx
 + 12] << 24) +

1646 (
∑rm_li°
[
idx
 + 13] << 16) +

1647 (
∑rm_li°
[
idx
 + 14] << 8) +

1648 (
∑rm_li°
[
idx
 + 15]);

1650 
	}
}

1652 
	$nvme_å™s_mode£l_gë_mp
(
nvme_ns
 *
ns
, 
sg_io_hdr
 *
hdr
,

1653 
u8
 *
mode_∑ge
, u8 
∑ge_code
)

1655 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

1656 
nvme_sc
;

1657 
nvme_dev
 *
dev
 = 
ns
->dev;

1658 
dw‹d11
;

1660 
∑ge_code
) {

1661 
MODE_PAGE_CACHING
:

1662 
dw‹d11
 = ((
mode_∑ge
[2] & 
CACHING_MODE_PAGE_WCE_MASK
) ? 1 : 0);

1663 
nvme_sc
 = 
	`nvme_£t_„©uªs
(
dev
, 
NVME_FEAT_VOLATILE_WC
, 
dw‹d11
,

1664 0, 
NULL
);

1665 
ªs
 = 
	`nvme_å™s_°©us_code
(
hdr
, 
nvme_sc
);

1666 i‡(
ªs
)

1668 i‡(
nvme_sc
) {

1669 
ªs
 = 
nvme_sc
;

1673 
MODE_PAGE_CONTROL
:

1675 
MODE_PAGE_POWER_CONDITION
:

1677 i‡((
mode_∑ge
[2] & 0x01) != 0 || (mode_page[3] & 0x0F) != 0) {

1678 
ªs
 = 
	`nvme_å™s_com∂ëi⁄
(
hdr
,

1679 
SAM_STAT_CHECK_CONDITION
,

1680 
ILLEGAL_REQUEST
,

1681 
SCSI_ASC_INVALID_PARAMETER
,

1682 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
);

1683 i‡(!
ªs
)

1684 
ªs
 = 
SNTI_INTERNAL_ERROR
;

1689 
ªs
 = 
	`nvme_å™s_com∂ëi⁄
(
hdr
, 
SAM_STAT_CHECK_CONDITION
,

1690 
ILLEGAL_REQUEST
, 
SCSI_ASC_INVALID_CDB
,

1691 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
);

1692 i‡(!
ªs
)

1693 
ªs
 = 
SNTI_INTERNAL_ERROR
;

1697  
ªs
;

1698 
	}
}

1700 
	$nvme_å™s_mode£l_d©a
(
nvme_ns
 *
ns
, 
sg_io_hdr
 *
hdr
,

1701 
u8
 *
cmd
, 
u16
 
∑rm_li°_Àn
, u8 
pf
,

1702 
u8
 
•
, u8 
cdb10
)

1704 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

1705 
u8
 *
∑rm_li°
;

1706 
u16
 
bd_Àn
;

1707 
u8
 
ŒbØ
 = 0;

1708 
u16
 
ödex
, 
ßved_ödex
;

1709 
u8
 
∑ge_code
;

1710 
u16
 
mp_size
;

1713 
∑rm_li°
 = 
	`kmÆloc
(
∑rm_li°_Àn
, 
GFP_KERNEL
);

1714 i‡(
∑rm_li°
 =
NULL
) {

1715 
ªs
 = -
ENOMEM
;

1716 
out
;

1719 
ªs
 = 
	`nvme_å™s_c›y_‰om_u£r
(
hdr
, 
∑rm_li°
, 
∑rm_li°_Àn
);

1720 i‡(
ªs
 !
SNTI_TRANSLATION_SUCCESS
)

1721 
out_mem
;

1723 
	`nvme_å™s_mode£l_gë_bd_Àn
(
∑rm_li°
, 
cdb10
, &
bd_Àn
, &
ŒbØ
);

1724 
ödex
 = (
cdb10
Ë? (
MODE_SELECT_10_MPH_SIZE
Ë: (
MODE_SELECT_6_MPH_SIZE
);

1726 i‡(
bd_Àn
 != 0) {

1728 
	`nvme_å™s_mode£l_ßve_bd
(
ns
, 
∑rm_li°
, 
ödex
, 
bd_Àn
, 
ŒbØ
);

1729 
ödex
 +
bd_Àn
;

1731 
ßved_ödex
 = 
ödex
;

1736 
∑ge_code
 = 
∑rm_li°
[
ödex
] & 
MODE_SELECT_PAGE_CODE_MASK
;

1737 
mp_size
 = 
∑rm_li°
[
ödex
 + 1] + 2;

1738 i‡((
∑ge_code
 !
MODE_PAGE_CACHING
) &&

1739 (
∑ge_code
 !
MODE_PAGE_CONTROL
) &&

1740 (
∑ge_code
 !
MODE_PAGE_POWER_CONDITION
)) {

1741 
ªs
 = 
	`nvme_å™s_com∂ëi⁄
(
hdr
,

1742 
SAM_STAT_CHECK_CONDITION
,

1743 
ILLEGAL_REQUEST
,

1744 
SCSI_ASC_INVALID_CDB
,

1745 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
);

1746 
out_mem
;

1748 
ödex
 +
mp_size
;

1749 } 
ödex
 < 
∑rm_li°_Àn
);

1752 
ödex
 = 
ßved_ödex
;

1754 
∑ge_code
 = 
∑rm_li°
[
ödex
] & 
MODE_SELECT_PAGE_CODE_MASK
;

1755 
mp_size
 = 
∑rm_li°
[
ödex
 + 1] + 2;

1756 
ªs
 = 
	`nvme_å™s_mode£l_gë_mp
(
ns
, 
hdr
, &
∑rm_li°
[
ödex
],

1757 
∑ge_code
);

1758 i‡(
ªs
 !
SNTI_TRANSLATION_SUCCESS
)

1760 
ödex
 +
mp_size
;

1761 } 
ödex
 < 
∑rm_li°_Àn
);

1763 
out_mem
:

1764 
	`k‰ì
(
∑rm_li°
);

1765 
out
:

1766  
ªs
;

1767 
	}
}

1771 
	$nvme_å™s_fmt_£t_blk_size_cou¡
(
nvme_ns
 *
ns
,

1772 
sg_io_hdr
 *
hdr
)

1774 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

1775 
nvme_sc
;

1776 
nvme_dev
 *
dev
 = 
ns
->dev;

1777 
dma_addr_t
 
dma_addr
;

1778 *
mem
;

1779 
nvme_id_ns
 *
id_ns
;

1780 
u8
 
Êbas
;

1789 i‡(
ns
->
mode_£À˘_num_blocks
 =0 ||Çs->
mode_£À˘_block_Àn
 == 0) {

1790 
mem
 = 
	`dma_Æloc_cohîít
(&
dev
->
pci_dev
->dev,

1791 (
nvme_id_ns
), &
dma_addr
, 
GFP_KERNEL
);

1792 i‡(
mem
 =
NULL
) {

1793 
ªs
 = -
ENOMEM
;

1794 
out
;

1797 
nvme_sc
 = 
	`nvme_idítify
(
dev
, 
ns
->
ns_id
, 0, 
dma_addr
);

1798 
ªs
 = 
	`nvme_å™s_°©us_code
(
hdr
, 
nvme_sc
);

1799 i‡(
ªs
)

1800 
out_dma
;

1801 i‡(
nvme_sc
) {

1802 
ªs
 = 
nvme_sc
;

1803 
out_dma
;

1805 
id_ns
 = 
mem
;

1807 i‡(
ns
->
mode_£À˘_num_blocks
 == 0)

1808 
ns
->
mode_£À˘_num_blocks
 = 
	`À64_to_˝u
(
id_ns
->
nˇp
);

1809 i‡(
ns
->
mode_£À˘_block_Àn
 == 0) {

1810 
Êbas
 = (
id_ns
->flbas) & 0x0F;

1811 
ns
->
mode_£À˘_block_Àn
 =

1812 (1 << (
id_ns
->
lbaf
[
Êbas
].
ds
));

1814 
out_dma
:

1815 
	`dma_‰ì_cohîít
(&
dev
->
pci_dev
->dev, (
nvme_id_ns
),

1816 
mem
, 
dma_addr
);

1818 
out
:

1819  
ªs
;

1820 
	}
}

1822 
	$nvme_å™s_fmt_gë_∑rm_hódî
(
sg_io_hdr
 *
hdr
, 
u8
 
Àn
,

1823 
u8
 
f‹m©_¥Ÿ_öfo
, u8 *
nvme_pf_code
)

1825 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

1826 
u8
 *
∑rm_li°
;

1827 
u8
 
pf_ußge
, 
pf_code
;

1829 
∑rm_li°
 = 
	`kmÆloc
(
Àn
, 
GFP_KERNEL
);

1830 i‡(
∑rm_li°
 =
NULL
) {

1831 
ªs
 = -
ENOMEM
;

1832 
out
;

1834 
ªs
 = 
	`nvme_å™s_c›y_‰om_u£r
(
hdr
, 
∑rm_li°
, 
Àn
);

1835 i‡(
ªs
 !
SNTI_TRANSLATION_SUCCESS
)

1836 
out_mem
;

1838 i‡((
∑rm_li°
[
FORMAT_UNIT_IMMED_OFFSET
] &

1839 
FORMAT_UNIT_IMMED_MASK
) != 0) {

1840 
ªs
 = 
	`nvme_å™s_com∂ëi⁄
(
hdr
, 
SAM_STAT_CHECK_CONDITION
,

1841 
ILLEGAL_REQUEST
, 
SCSI_ASC_INVALID_CDB
,

1842 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
);

1843 
out_mem
;

1846 i‡(
Àn
 =
FORMAT_UNIT_LONG_PARM_LIST_LEN
 &&

1847 (
∑rm_li°
[
FORMAT_UNIT_PROT_INT_OFFSET
] & 0x0F) != 0) {

1848 
ªs
 = 
	`nvme_å™s_com∂ëi⁄
(
hdr
, 
SAM_STAT_CHECK_CONDITION
,

1849 
ILLEGAL_REQUEST
, 
SCSI_ASC_INVALID_CDB
,

1850 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
);

1851 
out_mem
;

1853 
pf_ußge
 = 
∑rm_li°
[
FORMAT_UNIT_PROT_FIELD_USAGE_OFFSET
] &

1854 
FORMAT_UNIT_PROT_FIELD_USAGE_MASK
;

1855 
pf_code
 = (
pf_ußge
 << 2Ë| 
f‹m©_¥Ÿ_öfo
;

1856 
pf_code
) {

1858 *
nvme_pf_code
 = 0;

1861 *
nvme_pf_code
 = 1;

1864 *
nvme_pf_code
 = 2;

1867 *
nvme_pf_code
 = 3;

1870 
ªs
 = 
	`nvme_å™s_com∂ëi⁄
(
hdr
, 
SAM_STAT_CHECK_CONDITION
,

1871 
ILLEGAL_REQUEST
, 
SCSI_ASC_INVALID_CDB
,

1872 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
);

1876 
out_mem
:

1877 
	`k‰ì
(
∑rm_li°
);

1878 
out
:

1879  
ªs
;

1880 
	}
}

1882 
	$nvme_å™s_fmt_£nd_cmd
(
nvme_ns
 *
ns
, 
sg_io_hdr
 *
hdr
,

1883 
u8
 
¥Ÿ_öfo
)

1885 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

1886 
nvme_sc
;

1887 
nvme_dev
 *
dev
 = 
ns
->dev;

1888 
dma_addr_t
 
dma_addr
;

1889 *
mem
;

1890 
nvme_id_ns
 *
id_ns
;

1891 
u8
 
i
;

1892 
u8
 
Êbas
, 
∆baf
;

1893 
u8
 
£À˘ed_lbaf
 = 0xFF;

1894 
u32
 
cdw10
 = 0;

1895 
nvme_comm™d
 
c
;

1898 
mem
 = 
	`dma_Æloc_cohîít
(&
dev
->
pci_dev
->dev, (
nvme_id_ns
),

1899 &
dma_addr
, 
GFP_KERNEL
);

1900 i‡(
mem
 =
NULL
) {

1901 
ªs
 = -
ENOMEM
;

1902 
out
;

1905 
nvme_sc
 = 
	`nvme_idítify
(
dev
, 
ns
->
ns_id
, 0, 
dma_addr
);

1906 
ªs
 = 
	`nvme_å™s_°©us_code
(
hdr
, 
nvme_sc
);

1907 i‡(
ªs
)

1908 
out_dma
;

1909 i‡(
nvme_sc
) {

1910 
ªs
 = 
nvme_sc
;

1911 
out_dma
;

1913 
id_ns
 = 
mem
;

1914 
Êbas
 = (
id_ns
->flbas) & 0x0F;

1915 
∆baf
 = 
id_ns
->nlbaf;

1917 
i
 = 0; i < 
∆baf
; i++) {

1918 i‡(
ns
->
mode_£À˘_block_Àn
 =(1 << (
id_ns
->
lbaf
[
i
].
ds
))) {

1919 
£À˘ed_lbaf
 = 
i
;

1923 i‡(
£À˘ed_lbaf
 > 0x0F) {

1924 
ªs
 = 
	`nvme_å™s_com∂ëi⁄
(
hdr
, 
SAM_STAT_CHECK_CONDITION
,

1925 
ILLEGAL_REQUEST
, 
SCSI_ASC_INVALID_PARAMETER
,

1926 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
);

1928 i‡(
ns
->
mode_£À˘_num_blocks
 !
	`À64_to_˝u
(
id_ns
->
nˇp
)) {

1929 
ªs
 = 
	`nvme_å™s_com∂ëi⁄
(
hdr
, 
SAM_STAT_CHECK_CONDITION
,

1930 
ILLEGAL_REQUEST
, 
SCSI_ASC_INVALID_PARAMETER
,

1931 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
);

1934 
cdw10
 |
¥Ÿ_öfo
 << 5;

1935 
cdw10
 |
£À˘ed_lbaf
 & 0x0F;

1936 
	`mem£t
(&
c
, 0, (c));

1937 
c
.
f‹m©
.
›code
 = 
nvme_admö_f‹m©_nvm
;

1938 
c
.
f‹m©
.
nsid
 = 
	`˝u_to_À32
(
ns
->
ns_id
);

1939 
c
.
f‹m©
.
cdw10
 = 
	`˝u_to_À32
(cdw10);

1941 
nvme_sc
 = 
	`nvme_submô_admö_cmd
(
dev
, &
c
, 
NULL
);

1942 
ªs
 = 
	`nvme_å™s_°©us_code
(
hdr
, 
nvme_sc
);

1943 i‡(
ªs
)

1944 
out_dma
;

1945 i‡(
nvme_sc
)

1946 
ªs
 = 
nvme_sc
;

1948 
out_dma
:

1949 
	`dma_‰ì_cohîít
(&
dev
->
pci_dev
->dev, (
nvme_id_ns
), 
mem
,

1950 
dma_addr
);

1951 
out
:

1952  
ªs
;

1953 
	}
}

1957 
ölöe
 
	$nvme_å™s_gë_io_cdb6
(
u8
 *
cmd
,

1958 
nvme_å™s_io_cdb
 *
cdb_öfo
)

1960 
cdb_öfo
->
fua
 = 0;

1961 
cdb_öfo
->
¥Ÿ_öfo
 = 0;

1962 
cdb_öfo
->
lba
 = 
	`GET_U32_FROM_CDB
(
cmd
, 
IO_6_CDB_LBA_OFFSET
) &

1963 
IO_6_CDB_LBA_MASK
;

1964 
cdb_öfo
->
x„r_Àn
 = 
	`GET_U8_FROM_CDB
(
cmd
, 
IO_6_CDB_TX_LEN_OFFSET
);

1967 i‡(
cdb_öfo
->
x„r_Àn
 == 0)

1968 
cdb_öfo
->
x„r_Àn
 = 
IO_6_DEFAULT_TX_LEN
;

1969 
	}
}

1971 
ölöe
 
	$nvme_å™s_gë_io_cdb10
(
u8
 *
cmd
,

1972 
nvme_å™s_io_cdb
 *
cdb_öfo
)

1974 
cdb_öfo
->
fua
 = 
	`GET_U8_FROM_CDB
(
cmd
, 
IO_10_CDB_FUA_OFFSET
) &

1975 
IO_CDB_FUA_MASK
;

1976 
cdb_öfo
->
¥Ÿ_öfo
 = 
	`GET_U8_FROM_CDB
(
cmd
, 
IO_10_CDB_WP_OFFSET
) &

1977 
IO_CDB_WP_MASK
 >> 
IO_CDB_WP_SHIFT
;

1978 
cdb_öfo
->
lba
 = 
	`GET_U32_FROM_CDB
(
cmd
, 
IO_10_CDB_LBA_OFFSET
);

1979 
cdb_öfo
->
x„r_Àn
 = 
	`GET_U16_FROM_CDB
(
cmd
, 
IO_10_CDB_TX_LEN_OFFSET
);

1980 
	}
}

1982 
ölöe
 
	$nvme_å™s_gë_io_cdb12
(
u8
 *
cmd
,

1983 
nvme_å™s_io_cdb
 *
cdb_öfo
)

1985 
cdb_öfo
->
fua
 = 
	`GET_U8_FROM_CDB
(
cmd
, 
IO_12_CDB_FUA_OFFSET
) &

1986 
IO_CDB_FUA_MASK
;

1987 
cdb_öfo
->
¥Ÿ_öfo
 = 
	`GET_U8_FROM_CDB
(
cmd
, 
IO_12_CDB_WP_OFFSET
) &

1988 
IO_CDB_WP_MASK
 >> 
IO_CDB_WP_SHIFT
;

1989 
cdb_öfo
->
lba
 = 
	`GET_U32_FROM_CDB
(
cmd
, 
IO_12_CDB_LBA_OFFSET
);

1990 
cdb_öfo
->
x„r_Àn
 = 
	`GET_U32_FROM_CDB
(
cmd
, 
IO_12_CDB_TX_LEN_OFFSET
);

1991 
	}
}

1993 
ölöe
 
	$nvme_å™s_gë_io_cdb16
(
u8
 *
cmd
,

1994 
nvme_å™s_io_cdb
 *
cdb_öfo
)

1996 
cdb_öfo
->
fua
 = 
	`GET_U8_FROM_CDB
(
cmd
, 
IO_16_CDB_FUA_OFFSET
) &

1997 
IO_CDB_FUA_MASK
;

1998 
cdb_öfo
->
¥Ÿ_öfo
 = 
	`GET_U8_FROM_CDB
(
cmd
, 
IO_16_CDB_WP_OFFSET
) &

1999 
IO_CDB_WP_MASK
 >> 
IO_CDB_WP_SHIFT
;

2000 
cdb_öfo
->
lba
 = 
	`GET_U64_FROM_CDB
(
cmd
, 
IO_16_CDB_LBA_OFFSET
);

2001 
cdb_öfo
->
x„r_Àn
 = 
	`GET_U32_FROM_CDB
(
cmd
, 
IO_16_CDB_TX_LEN_OFFSET
);

2002 
	}
}

2004 
ölöe
 
u32
 
	$nvme_å™s_io_gë_num_cmds
(
sg_io_hdr
 *
hdr
,

2005 
nvme_å™s_io_cdb
 *
cdb_öfo
,

2006 
u32
 
max_blocks
)

2009 i‡(
hdr
->
iovec_cou¡
 > 0)

2010  
hdr
->
iovec_cou¡
;

2011 i‡(
cdb_öfo
->
x„r_Àn
 > 
max_blocks
)

2012  ((
cdb_öfo
->
x„r_Àn
 - 1Ë/ 
max_blocks
) + 1;

2015 
	}
}

2017 
u16
 
	$nvme_å™s_io_gë_c⁄åﬁ
(
nvme_ns
 *
ns
,

2018 
nvme_å™s_io_cdb
 *
cdb_öfo
)

2020 
u16
 
c⁄åﬁ
 = 0;

2024 i‡(
cdb_öfo
->
fua
 > 0)

2025 
c⁄åﬁ
 |
NVME_RW_FUA
;

2027  
c⁄åﬁ
;

2028 
	}
}

2030 
	$nvme_å™s_do_nvme_io
(
nvme_ns
 *
ns
, 
sg_io_hdr
 *
hdr
,

2031 
nvme_å™s_io_cdb
 *
cdb_öfo
, 
u8
 
is_wrôe
)

2033 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

2034 
nvme_sc
;

2035 
nvme_dev
 *
dev
 = 
ns
->dev;

2036 
u32
 
num_cmds
;

2037 
nvme_iod
 *
iod
;

2038 
u64
 
unô_Àn
;

2039 
u64
 
unô_num_blocks
;

2040 
u32
 
ªtcode
;

2041 
u32
 
i
 = 0;

2042 
u64
 
nvme_off£t
 = 0;

2043 
__u£r
 *
√xt_m≠pög_addr
;

2044 
nvme_comm™d
 
c
;

2045 
u8
 
›code
 = (
is_wrôe
 ? 
nvme_cmd_wrôe
 : 
nvme_cmd_ªad
);

2046 
u16
 
c⁄åﬁ
;

2047 
u32
 
max_blocks
 = 
	`queue_max_hw_£˘‹s
(
ns
->
queue
);

2049 
num_cmds
 = 
	`nvme_å™s_io_gë_num_cmds
(
hdr
, 
cdb_öfo
, 
max_blocks
);

2060 
i
 = 0; i < 
num_cmds
; i++) {

2061 
	`mem£t
(&
c
, 0, (c));

2062 i‡(
hdr
->
iovec_cou¡
 > 0) {

2063 
sg_iovec
 
sgl
;

2065 
ªtcode
 = 
	`c›y_‰om_u£r
(&
sgl
, 
hdr
->
dx„Ω
 +

2066 
i
 * (
sg_iovec
),

2067 (
sg_iovec
));

2068 i‡(
ªtcode
)

2069  -
EFAULT
;

2070 
unô_Àn
 = 
sgl
.
iov_Àn
;

2071 
unô_num_blocks
 = 
unô_Àn
 >> 
ns
->
lba_shi·
;

2072 
√xt_m≠pög_addr
 = 
sgl
.
iov_ba£
;

2074 
unô_num_blocks
 = 
	`mö
((
u64
)
max_blocks
,

2075 (
cdb_öfo
->
x„r_Àn
 - 
nvme_off£t
));

2076 
unô_Àn
 = 
unô_num_blocks
 << 
ns
->
lba_shi·
;

2077 
√xt_m≠pög_addr
 = 
hdr
->
dx„Ω
 +

2078 ((1 << 
ns
->
lba_shi·
Ë* 
nvme_off£t
);

2081 
c
.
rw
.
›code
 = opcode;

2082 
c
.
rw
.
nsid
 = 
	`˝u_to_À32
(
ns
->
ns_id
);

2083 
c
.
rw
.
¶ba
 = 
	`˝u_to_À64
(
cdb_öfo
->
lba
 + 
nvme_off£t
);

2084 
c
.
rw
.
Àngth
 = 
	`˝u_to_À16
(
unô_num_blocks
 - 1);

2085 
c⁄åﬁ
 = 
	`nvme_å™s_io_gë_c⁄åﬁ
(
ns
, 
cdb_öfo
);

2086 
c
.
rw
.
c⁄åﬁ
 = 
	`˝u_to_À16
(control);

2088 
iod
 = 
	`nvme_m≠_u£r_∑ges
(
dev
,

2089 (
is_wrôe
Ë? 
DMA_TO_DEVICE
 : 
DMA_FROM_DEVICE
,

2090 ()
√xt_m≠pög_addr
, 
unô_Àn
);

2091 i‡(
	`IS_ERR
(
iod
)) {

2092 
ªs
 = 
	`PTR_ERR
(
iod
);

2093 
out
;

2095 
ªtcode
 = 
	`nvme_£tup_¥ps
(
dev
, 
iod
, 
unô_Àn
, 
GFP_KERNEL
);

2096 i‡(
ªtcode
 !
unô_Àn
) {

2097 
	`nvme_unm≠_u£r_∑ges
(
dev
,

2098 (
is_wrôe
Ë? 
DMA_TO_DEVICE
 : 
DMA_FROM_DEVICE
,

2099 
iod
);

2100 
	`nvme_‰ì_iod
(
dev
, 
iod
);

2101 
ªs
 = -
ENOMEM
;

2102 
out
;

2104 
c
.
rw
.
¥p1
 = 
	`˝u_to_À64
(
	`sg_dma_addªss
(
iod
->
sg
));

2105 
c
.
rw
.
¥p2
 = 
	`˝u_to_À64
(
iod
->
fú°_dma
);

2107 
nvme_off£t
 +
unô_num_blocks
;

2109 
nvme_sc
 = 
	`nvme_submô_io_cmd
(
dev
, 
ns
, &
c
, 
NULL
);

2110 i‡(
nvme_sc
 !
NVME_SC_SUCCESS
) {

2111 
	`nvme_unm≠_u£r_∑ges
(
dev
,

2112 (
is_wrôe
Ë? 
DMA_TO_DEVICE
 : 
DMA_FROM_DEVICE
,

2113 
iod
);

2114 
	`nvme_‰ì_iod
(
dev
, 
iod
);

2115 
ªs
 = 
	`nvme_å™s_°©us_code
(
hdr
, 
nvme_sc
);

2116 
out
;

2118 
	`nvme_unm≠_u£r_∑ges
(
dev
,

2119 (
is_wrôe
Ë? 
DMA_TO_DEVICE
 : 
DMA_FROM_DEVICE
,

2120 
iod
);

2121 
	`nvme_‰ì_iod
(
dev
, 
iod
);

2123 
ªs
 = 
	`nvme_å™s_°©us_code
(
hdr
, 
NVME_SC_SUCCESS
);

2125 
out
:

2126  
ªs
;

2127 
	}
}

2132 
	$nvme_å™s_io
(
nvme_ns
 *
ns
, 
sg_io_hdr
 *
hdr
, 
u8
 
is_wrôe
,

2133 
u8
 *
cmd
)

2135 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

2136 
nvme_å™s_io_cdb
 
cdb_öfo
;

2137 
u8
 
›code
 = 
cmd
[0];

2138 
u64
 
x„r_byãs
;

2139 
u64
 
sum_iov_Àn
 = 0;

2140 
sg_iovec
 
sgl
;

2141 
i
;

2142 
size_t
 
nŸ_c›õd
;

2145 
›code
) {

2146 
WRITE_6
:

2147 
READ_6
:

2148 
	`nvme_å™s_gë_io_cdb6
(
cmd
, &
cdb_öfo
);

2150 
WRITE_10
:

2151 
READ_10
:

2152 
	`nvme_å™s_gë_io_cdb10
(
cmd
, &
cdb_öfo
);

2154 
WRITE_12
:

2155 
READ_12
:

2156 
	`nvme_å™s_gë_io_cdb12
(
cmd
, &
cdb_öfo
);

2158 
WRITE_16
:

2159 
READ_16
:

2160 
	`nvme_å™s_gë_io_cdb16
(
cmd
, &
cdb_öfo
);

2164 
ªs
 = 
SNTI_INTERNAL_ERROR
;

2165 
out
;

2169 i‡(
hdr
->
iovec_cou¡
 > 0) {

2170 
i
 = 0; i < 
hdr
->
iovec_cou¡
; i++) {

2171 
nŸ_c›õd
 = 
	`c›y_‰om_u£r
(&
sgl
, 
hdr
->
dx„Ω
 +

2172 
i
 * (
sg_iovec
),

2173 (
sg_iovec
));

2174 i‡(
nŸ_c›õd
)

2175  -
EFAULT
;

2176 
sum_iov_Àn
 +
sgl
.
iov_Àn
;

2178 i‡(
sgl
.
iov_Àn
 % (1 << 
ns
->
lba_shi·
) != 0) {

2179 
ªs
 = 
	`nvme_å™s_com∂ëi⁄
(
hdr
,

2180 
SAM_STAT_CHECK_CONDITION
,

2181 
ILLEGAL_REQUEST
,

2182 
SCSI_ASC_INVALID_PARAMETER
,

2183 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
);

2184 
out
;

2188 
sum_iov_Àn
 = 
hdr
->
dx„r_Àn
;

2192 
x„r_byãs
 = 
	`mö
(((
u64
)
hdr
->
dx„r_Àn
), 
sum_iov_Àn
);

2195 i‡(
x„r_byãs
 !(
cdb_öfo
.
x„r_Àn
 << 
ns
->
lba_shi·
)) {

2196 
ªs
 = -
EINVAL
;

2197 
out
;

2201 i‡(
cdb_öfo
.
x„r_Àn
 == 0)

2202 
out
;

2205 
ªs
 = 
	`nvme_å™s_do_nvme_io
(
ns
, 
hdr
, &
cdb_öfo
, 
is_wrôe
);

2206 i‡(
ªs
 !
SNTI_TRANSLATION_SUCCESS
)

2207 
out
;

2209 
out
:

2210  
ªs
;

2211 
	}
}

2213 
	$nvme_å™s_öquúy
(
nvme_ns
 *
ns
, 
sg_io_hdr
 *
hdr
,

2214 
u8
 *
cmd
)

2216 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

2217 
u8
 
evpd
;

2218 
u8
 
∑ge_code
;

2219 
Æloc_Àn
;

2220 
u8
 *
öq_ª•⁄£
;

2222 
evpd
 = 
	`GET_INQ_EVPD_BIT
(
cmd
);

2223 
∑ge_code
 = 
	`GET_INQ_PAGE_CODE
(
cmd
);

2224 
Æloc_Àn
 = 
	`GET_INQ_ALLOC_LENGTH
(
cmd
);

2226 
öq_ª•⁄£
 = 
	`kmÆloc
(
STANDARD_INQUIRY_LENGTH
, 
GFP_KERNEL
);

2227 i‡(
öq_ª•⁄£
 =
NULL
) {

2228 
ªs
 = -
ENOMEM
;

2229 
out_mem
;

2232 i‡(
evpd
 == 0) {

2233 i‡(
∑ge_code
 =
INQ_STANDARD_INQUIRY_PAGE
) {

2234 
ªs
 = 
	`nvme_å™s_°™d¨d_öquúy_∑ge
(
ns
, 
hdr
,

2235 
öq_ª•⁄£
, 
Æloc_Àn
);

2237 
ªs
 = 
	`nvme_å™s_com∂ëi⁄
(
hdr
,

2238 
SAM_STAT_CHECK_CONDITION
,

2239 
ILLEGAL_REQUEST
,

2240 
SCSI_ASC_INVALID_CDB
,

2241 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
);

2244 
∑ge_code
) {

2245 
VPD_SUPPORTED_PAGES
:

2246 
ªs
 = 
	`nvme_å™s_suµ‹ãd_vpd_∑ges
(
ns
, 
hdr
,

2247 
öq_ª•⁄£
, 
Æloc_Àn
);

2249 
VPD_SERIAL_NUMBER
:

2250 
ªs
 = 
	`nvme_å™s_unô_£rül_∑ge
(
ns
, 
hdr
, 
öq_ª•⁄£
,

2251 
Æloc_Àn
);

2253 
VPD_DEVICE_IDENTIFIERS
:

2254 
ªs
 = 
	`nvme_å™s_devi˚_id_∑ge
(
ns
, 
hdr
, 
öq_ª•⁄£
,

2255 
Æloc_Àn
);

2257 
VPD_EXTENDED_INQUIRY
:

2258 
ªs
 = 
	`nvme_å™s_ext_öq_∑ge
(
ns
, 
hdr
, 
Æloc_Àn
);

2260 
VPD_BLOCK_DEV_CHARACTERISTICS
:

2261 
ªs
 = 
	`nvme_å™s_bdev_ch¨_∑ge
(
ns
, 
hdr
, 
Æloc_Àn
);

2264 
ªs
 = 
	`nvme_å™s_com∂ëi⁄
(
hdr
,

2265 
SAM_STAT_CHECK_CONDITION
,

2266 
ILLEGAL_REQUEST
,

2267 
SCSI_ASC_INVALID_CDB
,

2268 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
);

2272 
	`k‰ì
(
öq_ª•⁄£
);

2273 
out_mem
:

2274  
ªs
;

2275 
	}
}

2277 
	$nvme_å™s_log_£n£
(
nvme_ns
 *
ns
, 
sg_io_hdr
 *
hdr
,

2278 
u8
 *
cmd
)

2280 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

2281 
u16
 
Æloc_Àn
;

2282 
u8
 
•
;

2283 
u8
 
pc
;

2284 
u8
 
∑ge_code
;

2286 
•
 = 
	`GET_U8_FROM_CDB
(
cmd
, 
LOG_SENSE_CDB_SP_OFFSET
);

2287 i‡(
•
 !
LOG_SENSE_CDB_SP_NOT_ENABLED
) {

2288 
ªs
 = 
	`nvme_å™s_com∂ëi⁄
(
hdr
, 
SAM_STAT_CHECK_CONDITION
,

2289 
ILLEGAL_REQUEST
, 
SCSI_ASC_INVALID_CDB
,

2290 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
);

2291 
out
;

2293 
pc
 = 
	`GET_U8_FROM_CDB
(
cmd
, 
LOG_SENSE_CDB_PC_OFFSET
);

2294 
∑ge_code
 = 
pc
 & 
LOG_SENSE_CDB_PAGE_CODE_MASK
;

2295 
pc
 = (p¯& 
LOG_SENSE_CDB_PC_MASK
Ë>> 
LOG_SENSE_CDB_PC_SHIFT
;

2296 i‡(
pc
 !
LOG_SENSE_CDB_PC_CUMULATIVE_VALUES
) {

2297 
ªs
 = 
	`nvme_å™s_com∂ëi⁄
(
hdr
, 
SAM_STAT_CHECK_CONDITION
,

2298 
ILLEGAL_REQUEST
, 
SCSI_ASC_INVALID_CDB
,

2299 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
);

2300 
out
;

2302 
Æloc_Àn
 = 
	`GET_U16_FROM_CDB
(
cmd
, 
LOG_SENSE_CDB_ALLOC_LENGTH_OFFSET
);

2303 
∑ge_code
) {

2304 
LOG_PAGE_SUPPORTED_LOG_PAGES_PAGE
:

2305 
ªs
 = 
	`nvme_å™s_log_suµ_∑ges
(
ns
, 
hdr
, 
Æloc_Àn
);

2307 
LOG_PAGE_INFORMATIONAL_EXCEPTIONS_PAGE
:

2308 
ªs
 = 
	`nvme_å™s_log_öfo_ex˚±i⁄s
(
ns
, 
hdr
, 
Æloc_Àn
);

2310 
LOG_PAGE_TEMPERATURE_PAGE
:

2311 
ªs
 = 
	`nvme_å™s_log_ãm≥øtuª
(
ns
, 
hdr
, 
Æloc_Àn
);

2314 
ªs
 = 
	`nvme_å™s_com∂ëi⁄
(
hdr
, 
SAM_STAT_CHECK_CONDITION
,

2315 
ILLEGAL_REQUEST
, 
SCSI_ASC_INVALID_CDB
,

2316 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
);

2320 
out
:

2321  
ªs
;

2322 
	}
}

2324 
	$nvme_å™s_mode_£À˘
(
nvme_ns
 *
ns
, 
sg_io_hdr
 *
hdr
,

2325 
u8
 *
cmd
)

2327 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

2328 
u8
 
cdb10
 = 0;

2329 
u16
 
∑rm_li°_Àn
;

2330 
u8
 
∑ge_f‹m©
;

2331 
u8
 
ßve_∑ges
;

2333 
∑ge_f‹m©
 = 
	`GET_U8_FROM_CDB
(
cmd
, 
MODE_SELECT_CDB_PAGE_FORMAT_OFFSET
);

2334 
∑ge_f‹m©
 &
MODE_SELECT_CDB_PAGE_FORMAT_MASK
;

2336 
ßve_∑ges
 = 
	`GET_U8_FROM_CDB
(
cmd
, 
MODE_SELECT_CDB_SAVE_PAGES_OFFSET
);

2337 
ßve_∑ges
 &
MODE_SELECT_CDB_SAVE_PAGES_MASK
;

2339 i‡(
	`GET_OPCODE
(
cmd
Ë=
MODE_SELECT
) {

2340 
∑rm_li°_Àn
 = 
	`GET_U8_FROM_CDB
(
cmd
,

2341 
MODE_SELECT_6_CDB_PARAM_LIST_LENGTH_OFFSET
);

2343 
∑rm_li°_Àn
 = 
	`GET_U16_FROM_CDB
(
cmd
,

2344 
MODE_SELECT_10_CDB_PARAM_LIST_LENGTH_OFFSET
);

2345 
cdb10
 = 1;

2348 i‡(
∑rm_li°_Àn
 != 0) {

2353 
ªs
 = 
	`nvme_å™s_mode£l_d©a
(
ns
, 
hdr
, 
cmd
, 
∑rm_li°_Àn
,

2354 
∑ge_f‹m©
, 
ßve_∑ges
, 
cdb10
);

2357  
ªs
;

2358 
	}
}

2360 
	$nvme_å™s_mode_£n£
(
nvme_ns
 *
ns
, 
sg_io_hdr
 *
hdr
,

2361 
u8
 *
cmd
)

2363 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

2364 
u16
 
Æloc_Àn
;

2365 
u8
 
cdb10
 = 0;

2366 
u8
 
∑ge_code
;

2367 
u8
 
pc
;

2369 i‡(
	`GET_OPCODE
(
cmd
Ë=
MODE_SENSE
) {

2370 
Æloc_Àn
 = 
	`GET_U8_FROM_CDB
(
cmd
, 
MODE_SENSE6_ALLOC_LEN_OFFSET
);

2372 
Æloc_Àn
 = 
	`GET_U16_FROM_CDB
(
cmd
,

2373 
MODE_SENSE10_ALLOC_LEN_OFFSET
);

2374 
cdb10
 = 1;

2377 
pc
 = 
	`GET_U8_FROM_CDB
(
cmd
, 
MODE_SENSE_PAGE_CONTROL_OFFSET
) &

2378 
MODE_SENSE_PAGE_CONTROL_MASK
;

2379 i‡(
pc
 !
MODE_SENSE_PC_CURRENT_VALUES
) {

2380 
ªs
 = 
	`nvme_å™s_com∂ëi⁄
(
hdr
, 
SAM_STAT_CHECK_CONDITION
,

2381 
ILLEGAL_REQUEST
, 
SCSI_ASC_INVALID_CDB
,

2382 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
);

2383 
out
;

2386 
∑ge_code
 = 
	`GET_U8_FROM_CDB
(
cmd
, 
MODE_SENSE_PAGE_CODE_OFFSET
) &

2387 
MODE_SENSE_PAGE_CODE_MASK
;

2388 
∑ge_code
) {

2389 
MODE_PAGE_CACHING
:

2390 
ªs
 = 
	`nvme_å™s_mode_∑ge_¸óã
(
ns
, 
hdr
, 
cmd
, 
Æloc_Àn
,

2391 
cdb10
,

2392 &
nvme_å™s_fûl_ˇchög_∑ge
,

2393 
MODE_PAGE_CACHING_LEN
);

2395 
MODE_PAGE_CONTROL
:

2396 
ªs
 = 
	`nvme_å™s_mode_∑ge_¸óã
(
ns
, 
hdr
, 
cmd
, 
Æloc_Àn
,

2397 
cdb10
,

2398 &
nvme_å™s_fûl_c⁄åﬁ_∑ge
,

2399 
MODE_PAGE_CONTROL_LEN
);

2401 
MODE_PAGE_POWER_CONDITION
:

2402 
ªs
 = 
	`nvme_å™s_mode_∑ge_¸óã
(
ns
, 
hdr
, 
cmd
, 
Æloc_Àn
,

2403 
cdb10
,

2404 &
nvme_å™s_fûl_pow_˙d_∑ge
,

2405 
MODE_PAGE_POW_CND_LEN
);

2407 
MODE_PAGE_INFO_EXCEP
:

2408 
ªs
 = 
	`nvme_å™s_mode_∑ge_¸óã
(
ns
, 
hdr
, 
cmd
, 
Æloc_Àn
,

2409 
cdb10
,

2410 &
nvme_å™s_fûl_öf_exc_∑ge
,

2411 
MODE_PAGE_INF_EXC_LEN
);

2413 
MODE_PAGE_RETURN_ALL
:

2414 
ªs
 = 
	`nvme_å™s_mode_∑ge_¸óã
(
ns
, 
hdr
, 
cmd
, 
Æloc_Àn
,

2415 
cdb10
,

2416 &
nvme_å™s_fûl_Æl_∑ges
,

2417 
MODE_PAGE_ALL_LEN
);

2420 
ªs
 = 
	`nvme_å™s_com∂ëi⁄
(
hdr
, 
SAM_STAT_CHECK_CONDITION
,

2421 
ILLEGAL_REQUEST
, 
SCSI_ASC_INVALID_CDB
,

2422 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
);

2426 
out
:

2427  
ªs
;

2428 
	}
}

2430 
	$nvme_å™s_ªad_ˇ∑côy
(
nvme_ns
 *
ns
, 
sg_io_hdr
 *
hdr
,

2431 
u8
 *
cmd
)

2433 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

2434 
nvme_sc
;

2435 
u32
 
Æloc_Àn
 = 
READ_CAP_10_RESP_SIZE
;

2436 
u32
 
ª•_size
 = 
READ_CAP_10_RESP_SIZE
;

2437 
u32
 
x„r_Àn
;

2438 
u8
 
cdb16
;

2439 
nvme_dev
 *
dev
 = 
ns
->dev;

2440 
dma_addr_t
 
dma_addr
;

2441 *
mem
;

2442 
nvme_id_ns
 *
id_ns
;

2443 
u8
 *
ª•⁄£
;

2445 
cdb16
 = 
	`IS_READ_CAP_16
(
cmd
);

2446 i‡(
cdb16
) {

2447 
Æloc_Àn
 = 
	`GET_READ_CAP_16_ALLOC_LENGTH
(
cmd
);

2448 
ª•_size
 = 
READ_CAP_16_RESP_SIZE
;

2451 
mem
 = 
	`dma_Æloc_cohîít
(&
dev
->
pci_dev
->dev, (
nvme_id_ns
),

2452 &
dma_addr
, 
GFP_KERNEL
);

2453 i‡(
mem
 =
NULL
) {

2454 
ªs
 = -
ENOMEM
;

2455 
out
;

2458 
nvme_sc
 = 
	`nvme_idítify
(
dev
, 
ns
->
ns_id
, 0, 
dma_addr
);

2459 
ªs
 = 
	`nvme_å™s_°©us_code
(
hdr
, 
nvme_sc
);

2460 i‡(
ªs
)

2461 
out_dma
;

2462 i‡(
nvme_sc
) {

2463 
ªs
 = 
nvme_sc
;

2464 
out_dma
;

2466 
id_ns
 = 
mem
;

2468 
ª•⁄£
 = 
	`kzÆloc
(
ª•_size
, 
GFP_KERNEL
);

2469 i‡(
ª•⁄£
 =
NULL
) {

2470 
ªs
 = -
ENOMEM
;

2471 
out_dma
;

2473 
	`nvme_å™s_fûl_ªad_ˇp
(
ª•⁄£
, 
id_ns
, 
cdb16
);

2475 
x„r_Àn
 = 
	`mö
(
Æloc_Àn
, 
ª•_size
);

2476 
ªs
 = 
	`nvme_å™s_c›y_to_u£r
(
hdr
, 
ª•⁄£
, 
x„r_Àn
);

2478 
	`k‰ì
(
ª•⁄£
);

2479 
out_dma
:

2480 
	`dma_‰ì_cohîít
(&
dev
->
pci_dev
->dev, (
nvme_id_ns
), 
mem
,

2481 
dma_addr
);

2482 
out
:

2483  
ªs
;

2484 
	}
}

2486 
	$nvme_å™s_ªp‹t_luns
(
nvme_ns
 *
ns
, 
sg_io_hdr
 *
hdr
,

2487 
u8
 *
cmd
)

2489 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

2490 
nvme_sc
;

2491 
u32
 
Æloc_Àn
, 
x„r_Àn
, 
ª•_size
;

2492 
u8
 
£À˘_ªp‹t
;

2493 
u8
 *
ª•⁄£
;

2494 
nvme_dev
 *
dev
 = 
ns
->dev;

2495 
dma_addr_t
 
dma_addr
;

2496 *
mem
;

2497 
nvme_id_˘æ
 *
id_˘æ
;

2498 
u32
 
Œ_Àngth
, 
lun_id
;

2499 
u8
 
lun_id_off£t
 = 
REPORT_LUNS_FIRST_LUN_OFFSET
;

2500 
__be32
 
tmp_Àn
;

2502 
Æloc_Àn
 = 
	`GET_REPORT_LUNS_ALLOC_LENGTH
(
cmd
);

2503 
£À˘_ªp‹t
 = 
	`GET_U8_FROM_CDB
(
cmd
, 
REPORT_LUNS_SR_OFFSET
);

2505 i‡((
£À˘_ªp‹t
 !
ALL_LUNS_RETURNED
) &&

2506 (
£À˘_ªp‹t
 !
ALL_WELL_KNOWN_LUNS_RETURNED
) &&

2507 (
£À˘_ªp‹t
 !
RESTRICTED_LUNS_RETURNED
)) {

2508 
ªs
 = 
	`nvme_å™s_com∂ëi⁄
(
hdr
, 
SAM_STAT_CHECK_CONDITION
,

2509 
ILLEGAL_REQUEST
, 
SCSI_ASC_INVALID_CDB
,

2510 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
);

2511 
out
;

2514 
mem
 = 
	`dma_Æloc_cohîít
(&
dev
->
pci_dev
->dev,

2515 (
nvme_id_˘æ
),

2516 &
dma_addr
, 
GFP_KERNEL
);

2517 i‡(
mem
 =
NULL
) {

2518 
ªs
 = -
ENOMEM
;

2519 
out
;

2521 
nvme_sc
 = 
	`nvme_idítify
(
dev
, 0, 1, 
dma_addr
);

2522 
ªs
 = 
	`nvme_å™s_°©us_code
(
hdr
, 
nvme_sc
);

2523 i‡(
ªs
)

2524 
out_dma
;

2525 i‡(
nvme_sc
) {

2526 
ªs
 = 
nvme_sc
;

2527 
out_dma
;

2529 
id_˘æ
 = 
mem
;

2530 
Œ_Àngth
 = 
	`À32_to_˝u
(
id_˘æ
->
¬
Ë* 
LUN_ENTRY_SIZE
;

2531 
ª•_size
 = 
Œ_Àngth
 + 
LUN_DATA_HEADER_SIZE
;

2533 i‡(
Æloc_Àn
 < 
ª•_size
) {

2534 
ªs
 = 
	`nvme_å™s_com∂ëi⁄
(
hdr
,

2535 
SAM_STAT_CHECK_CONDITION
,

2536 
ILLEGAL_REQUEST
, 
SCSI_ASC_INVALID_CDB
,

2537 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
);

2538 
out_dma
;

2541 
ª•⁄£
 = 
	`kzÆloc
(
ª•_size
, 
GFP_KERNEL
);

2542 i‡(
ª•⁄£
 =
NULL
) {

2543 
ªs
 = -
ENOMEM
;

2544 
out_dma
;

2548 
lun_id
 = 0;Üun_id < 
	`À32_to_˝u
(
id_˘æ
->
¬
);Üun_id++) {

2553 
__be64
 
tmp_id
 = 
	`˝u_to_be64
(
lun_id
);

2554 
	`mem˝y
(&
ª•⁄£
[
lun_id_off£t
], &
tmp_id
, (
u64
));

2555 
lun_id_off£t
 +
LUN_ENTRY_SIZE
;

2557 
tmp_Àn
 = 
	`˝u_to_be32
(
Œ_Àngth
);

2558 
	`mem˝y
(
ª•⁄£
, &
tmp_Àn
, (
u32
));

2561 
x„r_Àn
 = 
	`mö
(
Æloc_Àn
, 
ª•_size
);

2562 
ªs
 = 
	`nvme_å™s_c›y_to_u£r
(
hdr
, 
ª•⁄£
, 
x„r_Àn
);

2564 
	`k‰ì
(
ª•⁄£
);

2565 
out_dma
:

2566 
	`dma_‰ì_cohîít
(&
dev
->
pci_dev
->dev, (
nvme_id_˘æ
), 
mem
,

2567 
dma_addr
);

2568 
out
:

2569  
ªs
;

2570 
	}
}

2572 
	$nvme_å™s_ªque°_£n£
(
nvme_ns
 *
ns
, 
sg_io_hdr
 *
hdr
,

2573 
u8
 *
cmd
)

2575 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

2576 
u8
 
Æloc_Àn
, 
x„r_Àn
, 
ª•_size
;

2577 
u8
 
desc_f‹m©
;

2578 
u8
 *
ª•⁄£
;

2580 
Æloc_Àn
 = 
	`GET_REQUEST_SENSE_ALLOC_LENGTH
(
cmd
);

2581 
desc_f‹m©
 = 
	`GET_U8_FROM_CDB
(
cmd
, 
REQUEST_SENSE_DESC_OFFSET
);

2582 
desc_f‹m©
 &
REQUEST_SENSE_DESC_MASK
;

2584 
ª•_size
 = ((
desc_f‹m©
Ë? (
DESC_FMT_SENSE_DATA_SIZE
) :

2585 (
FIXED_FMT_SENSE_DATA_SIZE
));

2586 
ª•⁄£
 = 
	`kzÆloc
(
ª•_size
, 
GFP_KERNEL
);

2587 i‡(
ª•⁄£
 =
NULL
) {

2588 
ªs
 = -
ENOMEM
;

2589 
out
;

2592 i‡(
desc_f‹m©
 =
DESCRIPTOR_FORMAT_SENSE_DATA_TYPE
) {

2594 
ª•⁄£
[0] = 
DESC_FORMAT_SENSE_DATA
;

2595 
ª•⁄£
[1] = 
NO_SENSE
;

2597 
ª•⁄£
[2] = 
SCSI_ASC_NO_SENSE
;

2598 
ª•⁄£
[3] = 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
;

2602 
ª•⁄£
[0] = 
FIXED_SENSE_DATA
;

2604 
ª•⁄£
[2] = 
NO_SENSE
;

2606 
ª•⁄£
[7] = 
FIXED_SENSE_DATA_ADD_LENGTH
;

2608 
ª•⁄£
[12] = 
SCSI_ASC_NO_SENSE
;

2609 
ª•⁄£
[13] = 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
;

2614 
x„r_Àn
 = 
	`mö
(
Æloc_Àn
, 
ª•_size
);

2615 
ªs
 = 
	`nvme_å™s_c›y_to_u£r
(
hdr
, 
ª•⁄£
, 
x„r_Àn
);

2617 
	`k‰ì
(
ª•⁄£
);

2618 
out
:

2619  
ªs
;

2620 
	}
}

2622 
	$nvme_å™s_£curôy_¥Ÿocﬁ
(
nvme_ns
 *
ns
,

2623 
sg_io_hdr
 *
hdr
,

2624 
u8
 *
cmd
)

2626  
	`nvme_å™s_com∂ëi⁄
(
hdr
, 
SAM_STAT_CHECK_CONDITION
,

2627 
ILLEGAL_REQUEST
, 
SCSI_ASC_ILLEGAL_COMMAND
,

2628 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
);

2629 
	}
}

2631 
	$nvme_å™s_°¨t_°›
(
nvme_ns
 *
ns
, 
sg_io_hdr
 *
hdr
,

2632 
u8
 *
cmd
)

2634 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

2635 
nvme_sc
;

2636 
nvme_comm™d
 
c
;

2637 
u8
 
immed
, 
pcmod
, 
pc
, 
no_Êush
, 
°¨t
;

2639 
immed
 = 
	`GET_U8_FROM_CDB
(
cmd
, 
START_STOP_UNIT_CDB_IMMED_OFFSET
);

2640 
pcmod
 = 
	`GET_U8_FROM_CDB
(
cmd
, 
START_STOP_UNIT_CDB_POWER_COND_MOD_OFFSET
);

2641 
pc
 = 
	`GET_U8_FROM_CDB
(
cmd
, 
START_STOP_UNIT_CDB_POWER_COND_OFFSET
);

2642 
no_Êush
 = 
	`GET_U8_FROM_CDB
(
cmd
, 
START_STOP_UNIT_CDB_NO_FLUSH_OFFSET
);

2643 
°¨t
 = 
	`GET_U8_FROM_CDB
(
cmd
, 
START_STOP_UNIT_CDB_START_OFFSET
);

2645 
immed
 &
START_STOP_UNIT_CDB_IMMED_MASK
;

2646 
pcmod
 &
START_STOP_UNIT_CDB_POWER_COND_MOD_MASK
;

2647 
pc
 = (p¯& 
START_STOP_UNIT_CDB_POWER_COND_MASK
Ë>> 
NIBBLE_SHIFT
;

2648 
no_Êush
 &
START_STOP_UNIT_CDB_NO_FLUSH_MASK
;

2649 
°¨t
 &
START_STOP_UNIT_CDB_START_MASK
;

2651 i‡(
immed
 != 0) {

2652 
ªs
 = 
	`nvme_å™s_com∂ëi⁄
(
hdr
, 
SAM_STAT_CHECK_CONDITION
,

2653 
ILLEGAL_REQUEST
, 
SCSI_ASC_INVALID_CDB
,

2654 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
);

2656 i‡(
no_Êush
 == 0) {

2658 
	`mem£t
(&
c
, 0, (c));

2659 
c
.
comm⁄
.
›code
 = 
nvme_cmd_Êush
;

2660 
c
.
comm⁄
.
nsid
 = 
	`˝u_to_À32
(
ns
->
ns_id
);

2662 
nvme_sc
 = 
	`nvme_submô_io_cmd
(
ns
->
dev
,Çs, &
c
, 
NULL
);

2663 
ªs
 = 
	`nvme_å™s_°©us_code
(
hdr
, 
nvme_sc
);

2664 i‡(
ªs
)

2665 
out
;

2666 i‡(
nvme_sc
) {

2667 
ªs
 = 
nvme_sc
;

2668 
out
;

2672 
ªs
 = 
	`nvme_å™s_powî_°©e
(
ns
, 
hdr
, 
pc
, 
pcmod
, 
°¨t
);

2675 
out
:

2676  
ªs
;

2677 
	}
}

2679 
	$nvme_å™s_synchr⁄ize_ˇche
(
nvme_ns
 *
ns
,

2680 
sg_io_hdr
 *
hdr
, 
u8
 *
cmd
)

2682 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

2683 
nvme_sc
;

2684 
nvme_comm™d
 
c
;

2686 
	`mem£t
(&
c
, 0, (c));

2687 
c
.
comm⁄
.
›code
 = 
nvme_cmd_Êush
;

2688 
c
.
comm⁄
.
nsid
 = 
	`˝u_to_À32
(
ns
->
ns_id
);

2690 
nvme_sc
 = 
	`nvme_submô_io_cmd
(
ns
->
dev
,Çs, &
c
, 
NULL
);

2692 
ªs
 = 
	`nvme_å™s_°©us_code
(
hdr
, 
nvme_sc
);

2693 i‡(
ªs
)

2694 
out
;

2695 i‡(
nvme_sc
)

2696 
ªs
 = 
nvme_sc
;

2698 
out
:

2699  
ªs
;

2700 
	}
}

2702 
	$nvme_å™s_f‹m©_unô
(
nvme_ns
 *
ns
, 
sg_io_hdr
 *
hdr
,

2703 
u8
 *
cmd
)

2705 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

2706 
u8
 
∑rm_hdr_Àn
 = 0;

2707 
u8
 
nvme_pf_code
 = 0;

2708 
u8
 
f‹m©_¥Ÿ_öfo
, 
l⁄g_li°
, 
f‹m©_d©a
;

2710 
f‹m©_¥Ÿ_öfo
 = 
	`GET_U8_FROM_CDB
(
cmd
,

2711 
FORMAT_UNIT_CDB_FORMAT_PROT_INFO_OFFSET
);

2712 
l⁄g_li°
 = 
	`GET_U8_FROM_CDB
(
cmd
, 
FORMAT_UNIT_CDB_LONG_LIST_OFFSET
);

2713 
f‹m©_d©a
 = 
	`GET_U8_FROM_CDB
(
cmd
, 
FORMAT_UNIT_CDB_FORMAT_DATA_OFFSET
);

2715 
f‹m©_¥Ÿ_öfo
 = (format_prot_info &

2716 
FORMAT_UNIT_CDB_FORMAT_PROT_INFO_MASK
) >>

2717 
FORMAT_UNIT_CDB_FORMAT_PROT_INFO_SHIFT
;

2718 
l⁄g_li°
 &
FORMAT_UNIT_CDB_LONG_LIST_MASK
;

2719 
f‹m©_d©a
 &
FORMAT_UNIT_CDB_FORMAT_DATA_MASK
;

2721 i‡(
f‹m©_d©a
 != 0) {

2722 i‡(
f‹m©_¥Ÿ_öfo
 != 0) {

2723 i‡(
l⁄g_li°
 == 0)

2724 
∑rm_hdr_Àn
 = 
FORMAT_UNIT_SHORT_PARM_LIST_LEN
;

2726 
∑rm_hdr_Àn
 = 
FORMAT_UNIT_LONG_PARM_LIST_LEN
;

2728 } i‡(
f‹m©_d©a
 =0 && 
f‹m©_¥Ÿ_öfo
 != 0) {

2729 
ªs
 = 
	`nvme_å™s_com∂ëi⁄
(
hdr
, 
SAM_STAT_CHECK_CONDITION
,

2730 
ILLEGAL_REQUEST
, 
SCSI_ASC_INVALID_CDB
,

2731 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
);

2732 
out
;

2740 i‡(
∑rm_hdr_Àn
 > 0) {

2741 
ªs
 = 
	`nvme_å™s_fmt_gë_∑rm_hódî
(
hdr
, 
∑rm_hdr_Àn
,

2742 
f‹m©_¥Ÿ_öfo
, &
nvme_pf_code
);

2743 i‡(
ªs
 !
SNTI_TRANSLATION_SUCCESS
)

2744 
out
;

2748 
ªs
 = 
	`nvme_å™s_£nd_fw_cmd
(
ns
, 
hdr
, 
nvme_admö_a˘iv©e_fw
, 0, 0, 0);

2751 
ªs
 = 
	`nvme_å™s_fmt_£t_blk_size_cou¡
(
ns
, 
hdr
);

2752 i‡(
ªs
 !
SNTI_TRANSLATION_SUCCESS
)

2753 
out
;

2755 
ªs
 = 
	`nvme_å™s_fmt_£nd_cmd
(
ns
, 
hdr
, 
nvme_pf_code
);

2757 
out
:

2758  
ªs
;

2759 
	}
}

2761 
	$nvme_å™s_ã°_unô_ªady
(
nvme_ns
 *
ns
,

2762 
sg_io_hdr
 *
hdr
,

2763 
u8
 *
cmd
)

2765 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

2766 
nvme_dev
 *
dev
 = 
ns
->dev;

2768 i‡(!(
	`ªadl
(&
dev
->
b¨
->
c°s
Ë& 
NVME_CSTS_RDY
))

2769 
ªs
 = 
	`nvme_å™s_com∂ëi⁄
(
hdr
, 
SAM_STAT_CHECK_CONDITION
,

2770 
NOT_READY
, 
SCSI_ASC_LUN_NOT_READY
,

2771 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
);

2773 
ªs
 = 
	`nvme_å™s_com∂ëi⁄
(
hdr
, 
SAM_STAT_GOOD
, 
NO_SENSE
, 0, 0);

2775  
ªs
;

2776 
	}
}

2778 
	$nvme_å™s_wrôe_buf„r
(
nvme_ns
 *
ns
, 
sg_io_hdr
 *
hdr
,

2779 
u8
 *
cmd
)

2781 
ªs
 = 
SNTI_TRANSLATION_SUCCESS
;

2782 
u32
 
buf„r_off£t
, 
∑rm_li°_Àngth
;

2783 
u8
 
buf„r_id
, 
mode
;

2785 
∑rm_li°_Àngth
 =

2786 
	`GET_U24_FROM_CDB
(
cmd
, 
WRITE_BUFFER_CDB_PARM_LIST_LENGTH_OFFSET
);

2787 
	`¥ötk
(
KERN_DEBUG
 "Pas£d %s\∆ígth : %u\tdw‹d†: %u\n",
__func__
,
∑rm_li°_Àngth
,
BYTES_TO_DWORDS
);

2788 
	`¥ötk
(
KERN_DEBUG
 "Üígth mod dw‹d†: %d\n",
∑rm_li°_Àngth
 % 
BYTES_TO_DWORDS
);

2789 i‡(
∑rm_li°_Àngth
 % 
BYTES_TO_DWORDS
 != 0) {

2791 
ªs
 = 
	`nvme_å™s_com∂ëi⁄
(
hdr
, 
SAM_STAT_CHECK_CONDITION
,

2792 
ILLEGAL_REQUEST
, 
SCSI_ASC_INVALID_CDB
,

2793 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
);

2794 
out
;

2796 
buf„r_id
 = 
	`GET_U8_FROM_CDB
(
cmd
, 
WRITE_BUFFER_CDB_BUFFER_ID_OFFSET
);

2797 i‡(
buf„r_id
 > 
NVME_MAX_FIRMWARE_SLOT
) {

2798 
ªs
 = 
	`nvme_å™s_com∂ëi⁄
(
hdr
, 
SAM_STAT_CHECK_CONDITION
,

2799 
ILLEGAL_REQUEST
, 
SCSI_ASC_INVALID_CDB
,

2800 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
);

2801 
out
;

2803 
mode
 = 
	`GET_U8_FROM_CDB
(
cmd
, 
WRITE_BUFFER_CDB_MODE_OFFSET
) &

2804 
WRITE_BUFFER_CDB_MODE_MASK
;

2805 
buf„r_off£t
 =

2806 
	`GET_U24_FROM_CDB
(
cmd
, 
WRITE_BUFFER_CDB_BUFFER_OFFSET_OFFSET
);

2808 
mode
) {

2809 
DOWNLOAD_SAVE_ACTIVATE
:

2810 
	`¥ötk
(
KERN_DEBUG
 " Download saveáctivate \n");

2811 
ªs
 = 
	`nvme_å™s_£nd_fw_cmd
(
ns
, 
hdr
, 
nvme_admö_dow∆ﬂd_fw
,

2812 
∑rm_li°_Àngth
, 
buf„r_off£t
,

2813 
buf„r_id
);

2814 i‡(
ªs
 !
SNTI_TRANSLATION_SUCCESS
)

2815 
out
;

2816 
ªs
 = 
	`nvme_å™s_£nd_fw_cmd
(
ns
, 
hdr
, 
nvme_admö_a˘iv©e_fw
,

2817 
∑rm_li°_Àngth
, 
buf„r_off£t
,

2818 
buf„r_id
);

2820 
DOWNLOAD_SAVE_DEFER_ACTIVATE
:

2821 
	`¥ötk
(
KERN_DEBUG
 " Download save deferáctivate \n");

2822 
ªs
 = 
	`nvme_å™s_£nd_fw_cmd
(
ns
, 
hdr
, 
nvme_admö_dow∆ﬂd_fw
,

2823 
∑rm_li°_Àngth
, 
buf„r_off£t
,

2824 
buf„r_id
);

2826 
ACTIVATE_DEFERRED_MICROCODE
:

2827 
	`¥ötk
(
KERN_DEBUG
 "áctivate deferred microcode \n");

2828 
ªs
 = 
	`nvme_å™s_£nd_fw_cmd
(
ns
, 
hdr
, 
nvme_admö_a˘iv©e_fw
,

2829 
∑rm_li°_Àngth
, 
buf„r_off£t
,

2830 
buf„r_id
);

2833 
	`¥ötk
(
KERN_DEBUG
 "default \n");

2834 
ªs
 = 
	`nvme_å™s_com∂ëi⁄
(
hdr
, 
SAM_STAT_CHECK_CONDITION
,

2835 
ILLEGAL_REQUEST
, 
SCSI_ASC_INVALID_CDB
,

2836 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
);

2840 
out
:

2841  
ªs
;

2842 
	}
}

2844 
	sscsi_unm≠_blk_desc
 {

2845 
__be64
 
	m¶ba
;

2846 
__be32
 
	m∆b
;

2847 
u32
 
	mªsv
;

2850 
	sscsi_unm≠_∑rm_li°
 {

2851 
__be16
 
	munm≠_d©a_Àn
;

2852 
__be16
 
	munm≠_blk_desc_d©a_Àn
;

2853 
u32
 
	mªsv
;

2854 
scsi_unm≠_blk_desc
 
	mdesc
[0];

2857 
	$nvme_å™s_unm≠
(
nvme_ns
 *
ns
, 
sg_io_hdr
 *
hdr
,

2858 
u8
 *
cmd
)

2860 
nvme_dev
 *
dev
 = 
ns
->dev;

2861 
scsi_unm≠_∑rm_li°
 *
∂i°
;

2862 
nvme_dsm_ønge
 *
ønge
;

2863 
nvme_comm™d
 
c
;

2864 
i
, 
nvme_sc
, 
ªs
 = -
ENOMEM
;

2865 
u16
 
ndesc
, 
li°_Àn
;

2866 
dma_addr_t
 
dma_addr
;

2868 
li°_Àn
 = 
	`GET_U16_FROM_CDB
(
cmd
, 
UNMAP_CDB_PARAM_LIST_LENGTH_OFFSET
);

2869 i‡(!
li°_Àn
)

2870  -
EINVAL
;

2872 
∂i°
 = 
	`kmÆloc
(
li°_Àn
, 
GFP_KERNEL
);

2873 i‡(!
∂i°
)

2874  -
ENOMEM
;

2876 
ªs
 = 
	`nvme_å™s_c›y_‰om_u£r
(
hdr
, 
∂i°
, 
li°_Àn
);

2877 i‡(
ªs
 !
SNTI_TRANSLATION_SUCCESS
)

2878 
out
;

2880 
ndesc
 = 
	`be16_to_˝u
(
∂i°
->
unm≠_blk_desc_d©a_Àn
) >> 4;

2881 i‡(!
ndesc
 ||Çdesc > 256) {

2882 
ªs
 = -
EINVAL
;

2883 
out
;

2886 
ønge
 = 
	`dma_Æloc_cohîít
(&
dev
->
pci_dev
->dev, 
ndesc
 * (*range),

2887 &
dma_addr
, 
GFP_KERNEL
);

2888 i‡(!
ønge
)

2889 
out
;

2891 
i
 = 0; i < 
ndesc
; i++) {

2892 
ønge
[
i
].
∆b
 = 
	`˝u_to_À32
(
	`be32_to_˝u
(
∂i°
->
desc
[i].nlb));

2893 
ønge
[
i
].
¶ba
 = 
	`˝u_to_À64
(
	`be64_to_˝u
(
∂i°
->
desc
[i].slba));

2894 
ønge
[
i
].
ˇâr
 = 0;

2897 
	`mem£t
(&
c
, 0, (c));

2898 
c
.
dsm
.
›code
 = 
nvme_cmd_dsm
;

2899 
c
.
dsm
.
nsid
 = 
	`˝u_to_À32
(
ns
->
ns_id
);

2900 
c
.
dsm
.
¥p1
 = 
	`˝u_to_À64
(
dma_addr
);

2901 
c
.
dsm
.
ƒ
 = 
	`˝u_to_À32
(
ndesc
 - 1);

2902 
c
.
dsm
.
©åibuãs
 = 
	`˝u_to_À32
(
NVME_DSMGMT_AD
);

2904 
nvme_sc
 = 
	`nvme_submô_io_cmd
(
dev
, 
ns
, &
c
, 
NULL
);

2905 
ªs
 = 
	`nvme_å™s_°©us_code
(
hdr
, 
nvme_sc
);

2907 
	`dma_‰ì_cohîít
(&
dev
->
pci_dev
->dev, 
ndesc
 * (*
ønge
),

2908 
ønge
, 
dma_addr
);

2909 
out
:

2910 
	`k‰ì
(
∂i°
);

2911  
ªs
;

2912 
	}
}

2914 
	$nvme_scsi_å™¶©e
(
nvme_ns
 *
ns
, 
sg_io_hdr
 *
hdr
)

2916 
u8
 
cmd
[
BLK_MAX_CDB
];

2917 
ªtcode
;

2918 
›code
;

2919 
	`¥ötk
(
KERN_DEBUG
 "Pas£d %s\n",
__func__
);

2920 i‡(
hdr
->
cmdp
 =
NULL
)

2921  -
EMSGSIZE
;

2922 i‡(
	`c›y_‰om_u£r
(
cmd
, 
hdr
->
cmdp
, hdr->
cmd_Àn
))

2923  -
EFAULT
;

2929 
ªtcode
 = 
	`nvme_å™s_°©us_code
(
hdr
, 
NVME_SC_SUCCESS
);

2930 i‡(
ªtcode
)

2931  
ªtcode
;

2933 
›code
 = 
cmd
[0];

2935 
›code
) {

2936 
READ_6
:

2937 
READ_10
:

2938 
READ_12
:

2939 
READ_16
:

2940 
	`¥ötk
(
KERN_DEBUG
 "READ_16 : %d\n",
__LINE__
);

2941 
ªtcode
 = 
	`nvme_å™s_io
(
ns
, 
hdr
, 0, 
cmd
);

2943 
WRITE_6
:

2944 
WRITE_10
:

2945 
WRITE_12
:

2946 
WRITE_16
:

2947 
	`¥ötk
(
KERN_DEBUG
 "WRITE_16 : %d\n",
__LINE__
);

2948 
ªtcode
 = 
	`nvme_å™s_io
(
ns
, 
hdr
, 1, 
cmd
);

2950 
INQUIRY
:

2951 
	`¥ötk
(
KERN_DEBUG
 "INQUIRY : %d\n",
__LINE__
);

2952 
ªtcode
 = 
	`nvme_å™s_öquúy
(
ns
, 
hdr
, 
cmd
);

2954 
LOG_SENSE
:

2955 
	`¥ötk
(
KERN_DEBUG
 "LOG_SENSE : %d\n",
__LINE__
);

2956 
ªtcode
 = 
	`nvme_å™s_log_£n£
(
ns
, 
hdr
, 
cmd
);

2958 
MODE_SELECT
:

2959 
MODE_SELECT_10
:

2960 
	`¥ötk
(
KERN_DEBUG
 "MODE_SELECT : %d\n",
__LINE__
);

2961 
ªtcode
 = 
	`nvme_å™s_mode_£À˘
(
ns
, 
hdr
, 
cmd
);

2963 
MODE_SENSE
:

2964 
MODE_SENSE_10
:

2965 
	`¥ötk
(
KERN_DEBUG
 "MODE_SENSE : %d\n",
__LINE__
);

2966 
ªtcode
 = 
	`nvme_å™s_mode_£n£
(
ns
, 
hdr
, 
cmd
);

2968 
READ_CAPACITY
:

2969 
	`¥ötk
(
KERN_DEBUG
 "READ_CAPACITY : %d\n",
__LINE__
);

2970 
ªtcode
 = 
	`nvme_å™s_ªad_ˇ∑côy
(
ns
, 
hdr
, 
cmd
);

2972 
SERVICE_ACTION_IN_16
:

2973 
	`¥ötk
(
KERN_DEBUG
 "SERVICE_ACTION_IN : %d\n",
__LINE__
);

2974 i‡(
	`IS_READ_CAP_16
(
cmd
))

2975 
ªtcode
 = 
	`nvme_å™s_ªad_ˇ∑côy
(
ns
, 
hdr
, 
cmd
);

2977 
out
;

2979 
REPORT_LUNS
:

2980 
	`¥ötk
(
KERN_DEBUG
 "REPORT_LUNS : %d\n",
__LINE__
);

2981 
ªtcode
 = 
	`nvme_å™s_ªp‹t_luns
(
ns
, 
hdr
, 
cmd
);

2983 
REQUEST_SENSE
:

2984 
	`¥ötk
(
KERN_DEBUG
 "REQUEST_SENSE : %d\n",
__LINE__
);

2985 
ªtcode
 = 
	`nvme_å™s_ªque°_£n£
(
ns
, 
hdr
, 
cmd
);

2987 
SECURITY_PROTOCOL_IN
:

2988 
SECURITY_PROTOCOL_OUT
:

2989 
	`¥ötk
(
KERN_DEBUG
 "SECURITY_PROTOCOL_OUT : %d\n",
__LINE__
);

2990 
ªtcode
 = 
	`nvme_å™s_£curôy_¥Ÿocﬁ
(
ns
, 
hdr
, 
cmd
);

2992 
START_STOP
:

2993 
	`¥ötk
(
KERN_DEBUG
 "START_STOP : %d\n",
__LINE__
);

2994 
ªtcode
 = 
	`nvme_å™s_°¨t_°›
(
ns
, 
hdr
, 
cmd
);

2996 
SYNCHRONIZE_CACHE
:

2997 
	`¥ötk
(
KERN_DEBUG
 "SYNCHRONIZE_CACHE : %d\n",
__LINE__
);

2998 
ªtcode
 = 
	`nvme_å™s_synchr⁄ize_ˇche
(
ns
, 
hdr
, 
cmd
);

3000 
FORMAT_UNIT
:

3001 
	`¥ötk
(
KERN_DEBUG
 "FORMAT_UNIT : %d\n",
__LINE__
);

3002 
ªtcode
 = 
	`nvme_å™s_f‹m©_unô
(
ns
, 
hdr
, 
cmd
);

3004 
TEST_UNIT_READY
:

3005 
	`¥ötk
(
KERN_DEBUG
 "TEST_UNIT_READY : %d\n",
__LINE__
);

3006 
ªtcode
 = 
	`nvme_å™s_ã°_unô_ªady
(
ns
, 
hdr
, 
cmd
);

3008 
WRITE_BUFFER
:

3009 
	`¥ötk
(
KERN_DEBUG
 "WRITE_BUFFER : %d\n",
__LINE__
);

3010 
ªtcode
 = 
	`nvme_å™s_wrôe_buf„r
(
ns
, 
hdr
, 
cmd
);

3012 
UNMAP
:

3013 
	`¥ötk
(
KERN_DEBUG
 "UNMAP : %d\n",
__LINE__
);

3014 
ªtcode
 = 
	`nvme_å™s_unm≠
(
ns
, 
hdr
, 
cmd
);

3017 
out
:

3018 
	`¥ötk
(
KERN_DEBUG
 "deÁu…/ouà : %d\n",
__LINE__
);

3019 
ªtcode
 = 
	`nvme_å™s_com∂ëi⁄
(
hdr
, 
SAM_STAT_CHECK_CONDITION
,

3020 
ILLEGAL_REQUEST
, 
SCSI_ASC_ILLEGAL_COMMAND
,

3021 
SCSI_ASCQ_CAUSE_NOT_REPORTABLE
);

3024  
ªtcode
;

3025 
	}
}

3027 
	$nvme_sg_io
(
nvme_ns
 *
ns
, 
sg_io_hdr
 
__u£r
 *
u_hdr
)

3029 
sg_io_hdr
 
hdr
;

3030 
ªtcode
;

3032 i‡(!
	`ˇ∑bÀ
(
CAP_SYS_ADMIN
))

3033  -
EACCES
;

3034 i‡(
	`c›y_‰om_u£r
(&
hdr
, 
u_hdr
, (hdr)))

3035  -
EFAULT
;

3036 i‡(
hdr
.
öãrÁ˚_id
 != 'S')

3037  -
EINVAL
;

3038 i‡(
hdr
.
cmd_Àn
 > 
BLK_MAX_CDB
)

3039  -
EINVAL
;

3041 
ªtcode
 = 
	`nvme_scsi_å™¶©e
(
ns
, &
hdr
);

3042 i‡(
ªtcode
 < 0)

3043  
ªtcode
;

3044 i‡(
ªtcode
 > 0)

3045 
ªtcode
 = 
SNTI_TRANSLATION_SUCCESS
;

3046 i‡(
	`c›y_to_u£r
(
u_hdr
, &
hdr
, (
sg_io_hdr_t
)) > 0)

3047  -
EFAULT
;

3049  
ªtcode
;

3050 
	}
}

3052 
	$nvme_sg_gë_vîsi⁄_num
(
__u£r
 *
ù
)

3054  
	`put_u£r
(
sg_vîsi⁄_num
, 
ù
);

3055 
	}
}

	@/usr/include/linux/errno.h

1 
	~<asm/î∫o.h
>

	@/usr/include/linux/fs.h

1 #i‚de‡
_LINUX_FS_H


2 
	#_LINUX_FS_H


	)

9 
	~<löux/limôs.h
>

10 
	~<löux/io˘l.h
>

11 
	~<löux/ty≥s.h
>

24 #unde‡
NR_OPEN


25 
	#INR_OPEN_CUR
 1024

	)

26 
	#INR_OPEN_MAX
 4096

	)

28 
	#BLOCK_SIZE_BITS
 10

	)

29 
	#BLOCK_SIZE
 (1<<
BLOCK_SIZE_BITS
)

	)

31 
	#SEEK_SET
 0

	)

32 
	#SEEK_CUR
 1

	)

33 
	#SEEK_END
 2

	)

34 
	#SEEK_DATA
 3

	)

35 
	#SEEK_HOLE
 4

	)

36 
	#SEEK_MAX
 
SEEK_HOLE


	)

38 
	sf°rim_ønge
 {

39 
__u64
 
	m°¨t
;

40 
__u64
 
	mÀn
;

41 
__u64
 
	mmöÀn
;

45 
	sfûes_°©_°ru˘
 {

46 
	mƒ_fûes
;

47 
	mƒ_‰ì_fûes
;

48 
	mmax_fûes
;

51 
	söodes_°©_t
 {

52 
	mƒ_öodes
;

53 
	mƒ_unu£d
;

54 
	mdummy
[5];

58 
	#NR_FILE
 8192

	)

64 
	#MS_RDONLY
 1

	)

65 
	#MS_NOSUID
 2

	)

66 
	#MS_NODEV
 4

	)

67 
	#MS_NOEXEC
 8

	)

68 
	#MS_SYNCHRONOUS
 16

	)

69 
	#MS_REMOUNT
 32

	)

70 
	#MS_MANDLOCK
 64

	)

71 
	#MS_DIRSYNC
 128

	)

72 
	#MS_NOATIME
 1024

	)

73 
	#MS_NODIRATIME
 2048

	)

74 
	#MS_BIND
 4096

	)

75 
	#MS_MOVE
 8192

	)

76 
	#MS_REC
 16384

	)

77 
	#MS_VERBOSE
 32768

	)

79 
	#MS_SILENT
 32768

	)

80 
	#MS_POSIXACL
 (1<<16Ë

	)

81 
	#MS_UNBINDABLE
 (1<<17Ë

	)

82 
	#MS_PRIVATE
 (1<<18Ë

	)

83 
	#MS_SLAVE
 (1<<19Ë

	)

84 
	#MS_SHARED
 (1<<20Ë

	)

85 
	#MS_RELATIME
 (1<<21Ë

	)

86 
	#MS_KERNMOUNT
 (1<<22Ë

	)

87 
	#MS_I_VERSION
 (1<<23Ë

	)

88 
	#MS_STRICTATIME
 (1<<24Ë

	)

91 
	#MS_NOSEC
 (1<<28)

	)

92 
	#MS_BORN
 (1<<29)

	)

93 
	#MS_ACTIVE
 (1<<30)

	)

94 
	#MS_NOUSER
 (1<<31)

	)

99 
	#MS_RMT_MASK
 (
MS_RDONLY
|
MS_SYNCHRONOUS
|
MS_MANDLOCK
|
MS_I_VERSION
)

	)

104 
	#MS_MGC_VAL
 0xC0ED0000

	)

105 
	#MS_MGC_MSK
 0xffff0000

	)

110 
	#BLKROSET
 
	`_IO
(0x12,93Ë

	)

111 
	#BLKROGET
 
	`_IO
(0x12,94Ë

	)

112 
	#BLKRRPART
 
	`_IO
(0x12,95Ë

	)

113 
	#BLKGETSIZE
 
	`_IO
(0x12,96Ë

	)

114 
	#BLKFLSBUF
 
	`_IO
(0x12,97Ë

	)

115 
	#BLKRASET
 
	`_IO
(0x12,98Ë

	)

116 
	#BLKRAGET
 
	`_IO
(0x12,99Ë

	)

117 
	#BLKFRASET
 
	`_IO
(0x12,100)

	)

118 
	#BLKFRAGET
 
	`_IO
(0x12,101)

	)

119 
	#BLKSECTSET
 
	`_IO
(0x12,102)

	)

120 
	#BLKSECTGET
 
	`_IO
(0x12,103)

	)

121 
	#BLKSSZGET
 
	`_IO
(0x12,104)

	)

123 
	#BLKPG
 
	`_IO
(0x12,105)

	)

127 
	#BLKELVGET
 
	`_IOR
(0x12,106,
size_t
)

	)

128 
	#BLKELVSET
 
	`_IOW
(0x12,107,
size_t
)

	)

133 
	#BLKBSZGET
 
	`_IOR
(0x12,112,
size_t
)

	)

134 
	#BLKBSZSET
 
	`_IOW
(0x12,113,
size_t
)

	)

135 
	#BLKGETSIZE64
 
	`_IOR
(0x12,114,
size_t
Ë

	)

136 
	#BLKTRACESETUP
 
	`_IOWR
(0x12,115,
blk_u£r_åa˚_£tup
)

	)

137 
	#BLKTRACESTART
 
	`_IO
(0x12,116)

	)

138 
	#BLKTRACESTOP
 
	`_IO
(0x12,117)

	)

139 
	#BLKTRACETEARDOWN
 
	`_IO
(0x12,118)

	)

140 
	#BLKDISCARD
 
	`_IO
(0x12,119)

	)

141 
	#BLKIOMIN
 
	`_IO
(0x12,120)

	)

142 
	#BLKIOOPT
 
	`_IO
(0x12,121)

	)

143 
	#BLKALIGNOFF
 
	`_IO
(0x12,122)

	)

144 
	#BLKPBSZGET
 
	`_IO
(0x12,123)

	)

145 
	#BLKDISCARDZEROES
 
	`_IO
(0x12,124)

	)

146 
	#BLKSECDISCARD
 
	`_IO
(0x12,125)

	)

147 
	#BLKROTATIONAL
 
	`_IO
(0x12,126)

	)

148 
	#BLKZEROOUT
 
	`_IO
(0x12,127)

	)

150 
	#BMAP_IOCTL
 1

	)

151 
	#FIBMAP
 
	`_IO
(0x00,1Ë

	)

152 
	#FIGETBSZ
 
	`_IO
(0x00,2Ë

	)

153 
	#FIFREEZE
 
	`_IOWR
('X', 119, Ë

	)

154 
	#FITHAW
 
	`_IOWR
('X', 120, Ë

	)

155 
	#FITRIM
 
	`_IOWR
('X', 121, 
f°rim_ønge
Ë

	)

157 
	#FS_IOC_GETFLAGS
 
	`_IOR
('f', 1, )

	)

158 
	#FS_IOC_SETFLAGS
 
	`_IOW
('f', 2, )

	)

159 
	#FS_IOC_GETVERSION
 
	`_IOR
('v', 1, )

	)

160 
	#FS_IOC_SETVERSION
 
	`_IOW
('v', 2, )

	)

161 
	#FS_IOC_FIEMAP
 
	`_IOWR
('f', 11, 
fõm≠
)

	)

162 
	#FS_IOC32_GETFLAGS
 
	`_IOR
('f', 1, )

	)

163 
	#FS_IOC32_SETFLAGS
 
	`_IOW
('f', 2, )

	)

164 
	#FS_IOC32_GETVERSION
 
	`_IOR
('v', 1, )

	)

165 
	#FS_IOC32_SETVERSION
 
	`_IOW
('v', 2, )

	)

170 
	#FS_SECRM_FL
 0x00000001

	)

171 
	#FS_UNRM_FL
 0x00000002

	)

172 
	#FS_COMPR_FL
 0x00000004

	)

173 
	#FS_SYNC_FL
 0x00000008

	)

174 
	#FS_IMMUTABLE_FL
 0x00000010

	)

175 
	#FS_APPEND_FL
 0x00000020

	)

176 
	#FS_NODUMP_FL
 0x00000040

	)

177 
	#FS_NOATIME_FL
 0x00000080

	)

179 
	#FS_DIRTY_FL
 0x00000100

	)

180 
	#FS_COMPRBLK_FL
 0x00000200

	)

181 
	#FS_NOCOMP_FL
 0x00000400

	)

182 
	#FS_ECOMPR_FL
 0x00000800

	)

184 
	#FS_BTREE_FL
 0x00001000

	)

185 
	#FS_INDEX_FL
 0x00001000

	)

186 
	#FS_IMAGIC_FL
 0x00002000

	)

187 
	#FS_JOURNAL_DATA_FL
 0x00004000

	)

188 
	#FS_NOTAIL_FL
 0x00008000

	)

189 
	#FS_DIRSYNC_FL
 0x00010000

	)

190 
	#FS_TOPDIR_FL
 0x00020000

	)

191 
	#FS_EXTENT_FL
 0x00080000

	)

192 
	#FS_DIRECTIO_FL
 0x00100000

	)

193 
	#FS_NOCOW_FL
 0x00800000

	)

194 
	#FS_RESERVED_FL
 0x80000000

	)

196 
	#FS_FL_USER_VISIBLE
 0x0003DFFF

	)

197 
	#FS_FL_USER_MODIFIABLE
 0x000380FF

	)

200 
	#SYNC_FILE_RANGE_WAIT_BEFORE
 1

	)

201 
	#SYNC_FILE_RANGE_WRITE
 2

	)

202 
	#SYNC_FILE_RANGE_WAIT_AFTER
 4

	)

	@/usr/include/linux/hdreg.h

1 #i‚de‡
_LINUX_HDREG_H


2 
	#_LINUX_HDREG_H


	)

4 
	~<löux/ty≥s.h
>

10 
	#HDIO_DRIVE_CMD_HDR_SIZE
 (4 * (
__u8
))

	)

11 
	#HDIO_DRIVE_HOB_HDR_SIZE
 (8 * (
__u8
))

	)

12 
	#HDIO_DRIVE_TASK_HDR_SIZE
 (8 * (
__u8
))

	)

14 
	#IDE_DRIVE_TASK_NO_DATA
 0

	)

15 
	#IDE_DRIVE_TASK_INVALID
 -1

	)

16 
	#IDE_DRIVE_TASK_SET_XFER
 1

	)

17 
	#IDE_DRIVE_TASK_IN
 2

	)

18 
	#IDE_DRIVE_TASK_OUT
 3

	)

19 
	#IDE_DRIVE_TASK_RAW_WRITE
 4

	)

24 
	#IDE_TASKFILE_STD_IN_FLAGS
 0xFE

	)

25 
	#IDE_HOB_STD_IN_FLAGS
 0x3C

	)

26 
	#IDE_TASKFILE_STD_OUT_FLAGS
 0xFE

	)

27 
	#IDE_HOB_STD_OUT_FLAGS
 0x3C

	)

29 
	tèsk_i‹eg_t
;

30 
	tßè_i‹eg_t
;

32 
	uide_ªg_vÆid_s
 {

33 
	mÆl
 : 16;

35 
	md©a
 : 1;

36 
	mîr‹_„©uª
 : 1;

37 
	m£˘‹
 : 1;

38 
	mn£˘‹
 : 1;

39 
	mlcyl
 : 1;

40 
	mhcyl
 : 1;

41 
	m£À˘
 : 1;

42 
	m°©us_comm™d
 : 1;

44 
	md©a_hob
 : 1;

45 
	mîr‹_„©uª_hob
 : 1;

46 
	m£˘‹_hob
 : 1;

47 
	mn£˘‹_hob
 : 1;

48 
	mlcyl_hob
 : 1;

49 
	mhcyl_hob
 : 1;

50 
	m£À˘_hob
 : 1;

51 
	mc⁄åﬁ_hob
 : 1;

52 } 
	mb
;

53 } 
	tide_ªg_vÆid_t
;

55 
	side_èsk_ªque°_s
 {

56 
__u8
 
	mio_p‹ts
[8];

57 
__u8
 
	mhob_p‹ts
[8];

58 
ide_ªg_vÆid_t
 
	mout_Êags
;

59 
ide_ªg_vÆid_t
 
	mö_Êags
;

60 
	md©a_pha£
;

61 
	mªq_cmd
;

62 
	mout_size
;

63 
	mö_size
;

64 } 
	tide_èsk_ªque°_t
;

66 
	side_io˘l_ªque°_s
 {

67 
ide_èsk_ªque°_t
 *
	mèsk_ªque°
;

68 *
	mout_buf„r
;

69 *
	mö_buf„r
;

70 } 
	tide_io˘l_ªque°_t
;

72 
	shd_drive_cmd_hdr
 {

73 
__u8
 
	mcomm™d
;

74 
__u8
 
	m£˘‹_numbî
;

75 
__u8
 
	m„©uª
;

76 
__u8
 
	m£˘‹_cou¡
;

79 
	shd_drive_èsk_hdr
 {

80 
__u8
 
	md©a
;

81 
__u8
 
	m„©uª
;

82 
__u8
 
	m£˘‹_cou¡
;

83 
__u8
 
	m£˘‹_numbî
;

84 
__u8
 
	mlow_cylödî
;

85 
__u8
 
	mhigh_cylödî
;

86 
__u8
 
	mdevi˚_hód
;

87 
__u8
 
	mcomm™d
;

88 } 
	tèsk_°ru˘_t
;

90 
	shd_drive_hob_hdr
 {

91 
__u8
 
	md©a
;

92 
__u8
 
	m„©uª
;

93 
__u8
 
	m£˘‹_cou¡
;

94 
__u8
 
	m£˘‹_numbî
;

95 
__u8
 
	mlow_cylödî
;

96 
__u8
 
	mhigh_cylödî
;

97 
__u8
 
	mdevi˚_hód
;

98 
__u8
 
	mc⁄åﬁ
;

99 } 
	thob_°ru˘_t
;

101 
	#TASKFILE_NO_DATA
 0x0000

	)

103 
	#TASKFILE_IN
 0x0001

	)

104 
	#TASKFILE_MULTI_IN
 0x0002

	)

106 
	#TASKFILE_OUT
 0x0004

	)

107 
	#TASKFILE_MULTI_OUT
 0x0008

	)

108 
	#TASKFILE_IN_OUT
 0x0010

	)

110 
	#TASKFILE_IN_DMA
 0x0020

	)

111 
	#TASKFILE_OUT_DMA
 0x0040

	)

112 
	#TASKFILE_IN_DMAQ
 0x0080

	)

113 
	#TASKFILE_OUT_DMAQ
 0x0100

	)

115 
	#TASKFILE_P_IN
 0x0200

	)

116 
	#TASKFILE_P_OUT
 0x0400

	)

117 
	#TASKFILE_P_IN_DMA
 0x0800

	)

118 
	#TASKFILE_P_OUT_DMA
 0x1000

	)

119 
	#TASKFILE_P_IN_DMAQ
 0x2000

	)

120 
	#TASKFILE_P_OUT_DMAQ
 0x4000

	)

121 
	#TASKFILE_48
 0x8000

	)

122 
	#TASKFILE_INVALID
 0x7fff

	)

125 
	#WIN_NOP
 0x00

	)

129 
	#CFA_REQ_EXT_ERROR_CODE
 0x03

	)

133 
	#WIN_SRST
 0x08

	)

134 
	#WIN_DEVICE_RESET
 0x08

	)

138 
	#WIN_RECAL
 0x10

	)

139 
	#WIN_RESTORE
 
WIN_RECAL


	)

143 
	#WIN_READ
 0x20

	)

144 
	#WIN_READ_ONCE
 0x21

	)

145 
	#WIN_READ_LONG
 0x22

	)

146 
	#WIN_READ_LONG_ONCE
 0x23

	)

147 
	#WIN_READ_EXT
 0x24

	)

148 
	#WIN_READDMA_EXT
 0x25

	)

149 
	#WIN_READDMA_QUEUED_EXT
 0x26

	)

150 
	#WIN_READ_NATIVE_MAX_EXT
 0x27

	)

154 
	#WIN_MULTREAD_EXT
 0x29

	)

158 
	#WIN_WRITE
 0x30

	)

159 
	#WIN_WRITE_ONCE
 0x31

	)

160 
	#WIN_WRITE_LONG
 0x32

	)

161 
	#WIN_WRITE_LONG_ONCE
 0x33

	)

162 
	#WIN_WRITE_EXT
 0x34

	)

163 
	#WIN_WRITEDMA_EXT
 0x35

	)

164 
	#WIN_WRITEDMA_QUEUED_EXT
 0x36

	)

165 
	#WIN_SET_MAX_EXT
 0x37

	)

166 
	#CFA_WRITE_SECT_WO_ERASE
 0x38

	)

167 
	#WIN_MULTWRITE_EXT
 0x39

	)

171 
	#WIN_WRITE_VERIFY
 0x3C

	)

175 
	#WIN_VERIFY
 0x40

	)

176 
	#WIN_VERIFY_ONCE
 0x41

	)

177 
	#WIN_VERIFY_EXT
 0x42

	)

181 
	#WIN_FORMAT
 0x50

	)

185 
	#WIN_INIT
 0x60

	)

189 
	#WIN_SEEK
 0x70

	)

191 
	#CFA_TRANSLATE_SECTOR
 0x87

	)

192 
	#WIN_DIAGNOSE
 0x90

	)

193 
	#WIN_SPECIFY
 0x91

	)

194 
	#WIN_DOWNLOAD_MICROCODE
 0x92

	)

195 
	#WIN_STANDBYNOW2
 0x94

	)

196 
	#WIN_STANDBY2
 0x96

	)

197 
	#WIN_SETIDLE2
 0x97

	)

198 
	#WIN_CHECKPOWERMODE2
 0x98

	)

199 
	#WIN_SLEEPNOW2
 0x99

	)

203 
	#WIN_PACKETCMD
 0xA0

	)

204 
	#WIN_PIDENTIFY
 0xA1

	)

205 
	#WIN_QUEUED_SERVICE
 0xA2

	)

206 
	#WIN_SMART
 0xB0

	)

207 
	#CFA_ERASE_SECTORS
 0xC0

	)

208 
	#WIN_MULTREAD
 0xC4

	)

209 
	#WIN_MULTWRITE
 0xC5

	)

210 
	#WIN_SETMULT
 0xC6

	)

211 
	#WIN_READDMA_QUEUED
 0xC7

	)

212 
	#WIN_READDMA
 0xC8

	)

213 
	#WIN_READDMA_ONCE
 0xC9

	)

214 
	#WIN_WRITEDMA
 0xCA

	)

215 
	#WIN_WRITEDMA_ONCE
 0xCB

	)

216 
	#WIN_WRITEDMA_QUEUED
 0xCC

	)

217 
	#CFA_WRITE_MULTI_WO_ERASE
 0xCD

	)

218 
	#WIN_GETMEDIASTATUS
 0xDA

	)

219 
	#WIN_ACKMEDIACHANGE
 0xDB

	)

220 
	#WIN_POSTBOOT
 0xDC

	)

221 
	#WIN_PREBOOT
 0xDD

	)

222 
	#WIN_DOORLOCK
 0xDE

	)

223 
	#WIN_DOORUNLOCK
 0xDF

	)

224 
	#WIN_STANDBYNOW1
 0xE0

	)

225 
	#WIN_IDLEIMMEDIATE
 0xE1

	)

226 
	#WIN_STANDBY
 0xE2

	)

227 
	#WIN_SETIDLE1
 0xE3

	)

228 
	#WIN_READ_BUFFER
 0xE4

	)

229 
	#WIN_CHECKPOWERMODE1
 0xE5

	)

230 
	#WIN_SLEEPNOW1
 0xE6

	)

231 
	#WIN_FLUSH_CACHE
 0xE7

	)

232 
	#WIN_WRITE_BUFFER
 0xE8

	)

233 
	#WIN_WRITE_SAME
 0xE9

	)

235 
	#WIN_FLUSH_CACHE_EXT
 0xEA

	)

236 
	#WIN_IDENTIFY
 0xEC

	)

237 
	#WIN_MEDIAEJECT
 0xED

	)

238 
	#WIN_IDENTIFY_DMA
 0xEE

	)

239 
	#WIN_SETFEATURES
 0xEF

	)

240 
	#EXABYTE_ENABLE_NEST
 0xF0

	)

241 
	#WIN_SECURITY_SET_PASS
 0xF1

	)

242 
	#WIN_SECURITY_UNLOCK
 0xF2

	)

243 
	#WIN_SECURITY_ERASE_PREPARE
 0xF3

	)

244 
	#WIN_SECURITY_ERASE_UNIT
 0xF4

	)

245 
	#WIN_SECURITY_FREEZE_LOCK
 0xF5

	)

246 
	#WIN_SECURITY_DISABLE
 0xF6

	)

247 
	#WIN_READ_NATIVE_MAX
 0xF8

	)

248 
	#WIN_SET_MAX
 0xF9

	)

249 
	#DISABLE_SEAGATE
 0xFB

	)

253 
	#SMART_READ_VALUES
 0xD0

	)

254 
	#SMART_READ_THRESHOLDS
 0xD1

	)

255 
	#SMART_AUTOSAVE
 0xD2

	)

256 
	#SMART_SAVE
 0xD3

	)

257 
	#SMART_IMMEDIATE_OFFLINE
 0xD4

	)

258 
	#SMART_READ_LOG_SECTOR
 0xD5

	)

259 
	#SMART_WRITE_LOG_SECTOR
 0xD6

	)

260 
	#SMART_WRITE_THRESHOLDS
 0xD7

	)

261 
	#SMART_ENABLE
 0xD8

	)

262 
	#SMART_DISABLE
 0xD9

	)

263 
	#SMART_STATUS
 0xDA

	)

264 
	#SMART_AUTO_OFFLINE
 0xDB

	)

268 
	#SMART_LCYL_PASS
 0x4F

	)

269 
	#SMART_HCYL_PASS
 0xC2

	)

272 
	#SETFEATURES_EN_8BIT
 0x01

	)

273 
	#SETFEATURES_EN_WCACHE
 0x02

	)

274 
	#SETFEATURES_DIS_DEFECT
 0x04

	)

275 
	#SETFEATURES_EN_APM
 0x05

	)

276 
	#SETFEATURES_EN_SAME_R
 0x22

	)

277 
	#SETFEATURES_DIS_MSN
 0x31

	)

278 
	#SETFEATURES_DIS_RETRY
 0x33

	)

279 
	#SETFEATURES_EN_AAM
 0x42

	)

280 
	#SETFEATURES_RW_LONG
 0x44

	)

281 
	#SETFEATURES_SET_CACHE
 0x54

	)

282 
	#SETFEATURES_DIS_RLA
 0x55

	)

283 
	#SETFEATURES_EN_RI
 0x5D

	)

284 
	#SETFEATURES_EN_SI
 0x5E

	)

285 
	#SETFEATURES_DIS_RPOD
 0x66

	)

286 
	#SETFEATURES_DIS_ECC
 0x77

	)

287 
	#SETFEATURES_DIS_8BIT
 0x81

	)

288 
	#SETFEATURES_DIS_WCACHE
 0x82

	)

289 
	#SETFEATURES_EN_DEFECT
 0x84

	)

290 
	#SETFEATURES_DIS_APM
 0x85

	)

291 
	#SETFEATURES_EN_ECC
 0x88

	)

292 
	#SETFEATURES_EN_MSN
 0x95

	)

293 
	#SETFEATURES_EN_RETRY
 0x99

	)

294 
	#SETFEATURES_EN_RLA
 0xAA

	)

295 
	#SETFEATURES_PREFETCH
 0xAB

	)

296 
	#SETFEATURES_EN_REST
 0xAC

	)

297 
	#SETFEATURES_4B_RW_LONG
 0xBB

	)

298 
	#SETFEATURES_DIS_AAM
 0xC2

	)

299 
	#SETFEATURES_EN_RPOD
 0xCC

	)

300 
	#SETFEATURES_DIS_RI
 0xDD

	)

301 
	#SETFEATURES_EN_SAME_M
 0xDD

	)

302 
	#SETFEATURES_DIS_SI
 0xDE

	)

306 
	#SECURITY_SET_PASSWORD
 0xBA

	)

307 
	#SECURITY_UNLOCK
 0xBB

	)

308 
	#SECURITY_ERASE_PREPARE
 0xBC

	)

309 
	#SECURITY_ERASE_UNIT
 0xBD

	)

310 
	#SECURITY_FREEZE_LOCK
 0xBE

	)

311 
	#SECURITY_DISABLE_PASSWORD
 0xBF

	)

313 
	shd_geomëry
 {

314 
	mhóds
;

315 
	m£˘‹s
;

316 
	mcylödîs
;

317 
	m°¨t
;

321 
	#HDIO_GETGEO
 0x0301

	)

322 
	#HDIO_GET_UNMASKINTR
 0x0302

	)

323 
	#HDIO_GET_MULTCOUNT
 0x0304

	)

324 
	#HDIO_GET_QDMA
 0x0305

	)

326 
	#HDIO_SET_XFER
 0x0306

	)

328 
	#HDIO_OBSOLETE_IDENTITY
 0x0307

	)

329 
	#HDIO_GET_KEEPSETTINGS
 0x0308

	)

330 
	#HDIO_GET_32BIT
 0x0309

	)

331 
	#HDIO_GET_NOWERR
 0x030®

	)

332 
	#HDIO_GET_DMA
 0x030b

	)

333 
	#HDIO_GET_NICE
 0x030¯

	)

334 
	#HDIO_GET_IDENTITY
 0x030d

	)

335 
	#HDIO_GET_WCACHE
 0x030ê

	)

336 
	#HDIO_GET_ACOUSTIC
 0x030‡

	)

337 
	#HDIO_GET_ADDRESS
 0x0310

	)

339 
	#HDIO_GET_BUSSTATE
 0x031®

	)

340 
	#HDIO_TRISTATE_HWIF
 0x031b

	)

341 
	#HDIO_DRIVE_RESET
 0x031¯

	)

342 
	#HDIO_DRIVE_TASKFILE
 0x031d

	)

343 
	#HDIO_DRIVE_TASK
 0x031ê

	)

344 
	#HDIO_DRIVE_CMD
 0x031‡

	)

345 
	#HDIO_DRIVE_CMD_AEB
 
HDIO_DRIVE_TASK


	)

348 
	#HDIO_SET_MULTCOUNT
 0x0321

	)

349 
	#HDIO_SET_UNMASKINTR
 0x0322

	)

350 
	#HDIO_SET_KEEPSETTINGS
 0x0323

	)

351 
	#HDIO_SET_32BIT
 0x0324

	)

352 
	#HDIO_SET_NOWERR
 0x0325

	)

353 
	#HDIO_SET_DMA
 0x0326

	)

354 
	#HDIO_SET_PIO_MODE
 0x0327

	)

355 
	#HDIO_SCAN_HWIF
 0x0328

	)

356 
	#HDIO_UNREGISTER_HWIF
 0x032®

	)

357 
	#HDIO_SET_NICE
 0x0329

	)

358 
	#HDIO_SET_WCACHE
 0x032b

	)

359 
	#HDIO_SET_ACOUSTIC
 0x032¯

	)

360 
	#HDIO_SET_BUSSTATE
 0x032d

	)

361 
	#HDIO_SET_QDMA
 0x032ê

	)

362 
	#HDIO_SET_ADDRESS
 0x032‡

	)

366 
	mBUSSTATE_OFF
 = 0,

367 
	mBUSSTATE_ON
,

368 
	mBUSSTATE_TRISTATE


377 
	#__NEW_HD_DRIVE_ID


	)

385 
	shd_driveid
 {

386 
	mc⁄fig
;

387 
	mcyls
;

388 
	mª£rved2
;

389 
	mhóds
;

390 
	måack_byãs
;

391 
	m£˘‹_byãs
;

392 
	m£˘‹s
;

393 
	mvíd‹0
;

394 
	mvíd‹1
;

395 
	mvíd‹2
;

396 
	m£rül_no
[20];

397 
	mbuf_ty≥
;

398 
	mbuf_size
;

401 
	mecc_byãs
;

402 
	mfw_ªv
[8];

403 
	mmodñ
[40];

404 
	mmax_mu…£˘
;

405 
	mvíd‹3
;

406 
	mdw‹d_io
;

407 
	mvíd‹4
;

408 
	mˇ∑bûôy
;

414 
	mª£rved50
;

415 
	mvíd‹5
;

416 
	mtPIO
;

417 
	mvíd‹6
;

418 
	mtDMA
;

419 
	mfõld_vÆid
;

424 
	mcur_cyls
;

425 
	mcur_hóds
;

426 
	mcur_£˘‹s
;

427 
	mcur_ˇ∑côy0
;

428 
	mcur_ˇ∑côy1
;

429 
	mmu…£˘
;

430 
	mmu…£˘_vÆid
;

431 
	mlba_ˇ∑côy
;

432 
	mdma_1w‹d
;

433 
	mdma_mw‹d
;

434 
	meide_pio_modes
;

435 
	meide_dma_mö
;

436 
	meide_dma_time
;

437 
	meide_pio
;

438 
	meide_pio_i‹dy
;

439 
	mw‹ds69_70
[2];

442 
	mw‹ds71_74
[4];

445 
	mqueue_dïth
;

449 
	mw‹ds76_79
[4];

450 
	mmaj‹_ªv_num
;

451 
	mmö‹_ªv_num
;

452 
	mcomm™d_£t_1
;

470 
	mcomm™d_£t_2
;

488 
	mcfs£
;

500 
	mcfs_íabÀ_1
;

519 
	mcfs_íabÀ_2
;

538 
	mcsf_deÁu…
;

550 
	mdma_u…ø
;

551 
	må£uc
;

552 
	måsEuc
;

553 
	mCurAPMvÆues
;

554 
	mm¥c
;

555 
	mhw_c⁄fig
;

573 
	macou°ic
;

577 
	mm§qs
;

578 
	msx„π
;

579 
	mßl
;

580 
	m•g
;

581 
	mlba_ˇ∑côy_2
;

582 
	mw‹ds104_125
[22];

583 
	mœ°_lun
;

584 
	mw‹d127
;

592 
	mdlf
;

604 
	mcsfo
;

612 
	mw‹ds130_155
[26];

613 
	mw‹d156
;

614 
	mw‹ds157_159
[3];

615 
	mcÁ_powî
;

622 
	mw‹ds161_175
[15];

623 
	mw‹ds176_205
[30];

624 
	mw‹ds206_254
[49];

625 
	möãgrôy_w‹d
;

636 
	#IDE_NICE_DSC_OVERLAP
 (0Ë

	)

637 
	#IDE_NICE_ATAPI_OVERLAP
 (1Ë

	)

638 
	#IDE_NICE_1
 (3Ë

	)

639 
	#IDE_NICE_0
 (2Ë

	)

640 
	#IDE_NICE_2
 (4Ë

	)

	@/usr/include/linux/kdev_t.h

1 #i‚de‡
_LINUX_KDEV_T_H


2 
	#_LINUX_KDEV_T_H


	)

8 
	#MAJOR
(
dev
Ë((dev)>>8)

	)

9 
	#MINOR
(
dev
Ë((devË& 0xff)

	)

10 
	#MKDEV
(
ma
,
mi
Ë((ma)<<8 | (mi))

	)

	@/usr/include/linux/kernel.h

1 #i‚de‡
_LINUX_KERNEL_H


2 
	#_LINUX_KERNEL_H


	)

4 
	~<löux/sysöfo.h
>

9 
	#__ALIGN_KERNEL
(
x
, 
a
Ë
	`__ALIGN_KERNEL_MASK
(x, (
	`ty≥of
(x))◊Ë- 1)

	)

10 
	#__ALIGN_KERNEL_MASK
(
x
, 
mask
Ë(((xË+ (mask)Ë& ~(mask))

	)

	@/usr/include/linux/nvme.h

19 #i‚de‡
_LINUX_NVME_H


20 
	#_LINUX_NVME_H


	)

22 
	~<löux/ty≥s.h
>

24 
	snvme_id_powî_°©e
 {

25 
__À16
 
	mmax_powî
;

26 
__u8
 
	mrsvd2
;

27 
__u8
 
	mÊags
;

28 
__À32
 
	míåy_œt
;

29 
__À32
 
	mexô_œt
;

30 
__u8
 
	mªad_çut
;

31 
__u8
 
	mªad_œt
;

32 
__u8
 
	mwrôe_çut
;

33 
__u8
 
	mwrôe_œt
;

34 
__u8
 
	mrsvd16
[16];

38 
	mNVME_PS_FLAGS_MAX_POWER_SCALE
 = 1 << 0,

39 
	mNVME_PS_FLAGS_NON_OP_STATE
 = 1 << 1,

42 
	snvme_id_˘æ
 {

43 
__À16
 
	mvid
;

44 
__À16
 
	mssvid
;

45 
	m¢
[20];

46 
	mmn
[40];

47 
	m‰
[8];

48 
__u8
 
	møb
;

49 
__u8
 
	mõì
[3];

50 
__u8
 
	mmic
;

51 
__u8
 
	mmdts
;

52 
__u8
 
	mrsvd78
[178];

53 
__À16
 
	mﬂcs
;

54 
__u8
 
	ma˛
;

55 
__u8
 
	m´æ
;

56 
__u8
 
	m‰mw
;

57 
__u8
 
	mÕa
;

58 
__u8
 
	mñ≥
;

59 
__u8
 
	m≈ss
;

60 
__u8
 
	mrsvd264
[248];

61 
__u8
 
	msqes
;

62 
__u8
 
	mcqes
;

63 
__u8
 
	mrsvd514
[2];

64 
__À32
 
	m¬
;

65 
__À16
 
	m⁄cs
;

66 
__À16
 
	mfu£s
;

67 
__u8
 
	m‚a
;

68 
__u8
 
	mvwc
;

69 
__À16
 
	mawun
;

70 
__À16
 
	mawupf
;

71 
__u8
 
	mrsvd530
[1518];

72 
nvme_id_powî_°©e
 
	mpsd
[32];

73 
__u8
 
	mvs
[1024];

77 
	mNVME_CTRL_ONCS_COMPARE
 = 1 << 0,

78 
	mNVME_CTRL_ONCS_WRITE_UNCORRECTABLE
 = 1 << 1,

79 
	mNVME_CTRL_ONCS_DSM
 = 1 << 2,

82 
	snvme_lbaf
 {

83 
__À16
 
	mms
;

84 
__u8
 
	mds
;

85 
__u8
 
	mΩ
;

88 
	snvme_id_ns
 {

89 
__À64
 
	mnsze
;

90 
__À64
 
	mnˇp
;

91 
__À64
 
	mnu£
;

92 
__u8
 
	mns„©
;

93 
__u8
 
	m∆baf
;

94 
__u8
 
	mÊbas
;

95 
__u8
 
	mmc
;

96 
__u8
 
	mdpc
;

97 
__u8
 
	mdps
;

98 
__u8
 
	mrsvd30
[98];

99 
nvme_lbaf
 
	mlbaf
[16];

100 
__u8
 
	mrsvd192
[192];

101 
__u8
 
	mvs
[3712];

105 
	mNVME_NS_FEAT_THIN
 = 1 << 0,

106 
	mNVME_LBAF_RP_BEST
 = 0,

107 
	mNVME_LBAF_RP_BETTER
 = 1,

108 
	mNVME_LBAF_RP_GOOD
 = 2,

109 
	mNVME_LBAF_RP_DEGRADED
 = 3,

112 
	snvme_sm¨t_log
 {

113 
__u8
 
	m¸ôiˇl_w¨nög
;

114 
__u8
 
	mãm≥øtuª
[2];

115 
__u8
 
	mavaû_•¨e
;

116 
__u8
 
	m•¨e_thªsh
;

117 
__u8
 
	m≥r˚¡_u£d
;

118 
__u8
 
	mrsvd6
[26];

119 
__u8
 
	md©a_unôs_ªad
[16];

120 
__u8
 
	md©a_unôs_wrôãn
[16];

121 
__u8
 
	mho°_ªads
[16];

122 
__u8
 
	mho°_wrôes
[16];

123 
__u8
 
	m˘æ_busy_time
[16];

124 
__u8
 
	mpowî_cy˛es
[16];

125 
__u8
 
	mpowî_⁄_hours
[16];

126 
__u8
 
	munß„_shutdowns
[16];

127 
__u8
 
	mmedü_îr‹s
[16];

128 
__u8
 
	mnum_îr_log_íåõs
[16];

129 
__u8
 
	mrsvd192
[320];

133 
	mNVME_SMART_CRIT_SPARE
 = 1 << 0,

134 
	mNVME_SMART_CRIT_TEMPERATURE
 = 1 << 1,

135 
	mNVME_SMART_CRIT_RELIABILITY
 = 1 << 2,

136 
	mNVME_SMART_CRIT_MEDIA
 = 1 << 3,

137 
	mNVME_SMART_CRIT_VOLATILE_MEMORY
 = 1 << 4,

140 
	snvme_lba_ønge_ty≥
 {

141 
__u8
 
	mty≥
;

142 
__u8
 
	m©åibuãs
;

143 
__u8
 
	mrsvd2
[14];

144 
__u64
 
	m¶ba
;

145 
__u64
 
	m∆b
;

146 
__u8
 
	mguid
[16];

147 
__u8
 
	mrsvd48
[16];

151 
	mNVME_LBART_TYPE_FS
 = 0x01,

152 
	mNVME_LBART_TYPE_RAID
 = 0x02,

153 
	mNVME_LBART_TYPE_CACHE
 = 0x03,

154 
	mNVME_LBART_TYPE_SWAP
 = 0x04,

156 
	mNVME_LBART_ATTRIB_TEMP
 = 1 << 0,

157 
	mNVME_LBART_ATTRIB_HIDE
 = 1 << 1,

162 
	envme_›code
 {

163 
	mnvme_cmd_Êush
 = 0x00,

164 
	mnvme_cmd_wrôe
 = 0x01,

165 
	mnvme_cmd_ªad
 = 0x02,

166 
	mnvme_cmd_wrôe_unc‹
 = 0x04,

167 
	mnvme_cmd_com∑ª
 = 0x05,

168 
	mnvme_cmd_dsm
 = 0x09,

171 
	snvme_comm⁄_comm™d
 {

172 
__u8
 
	m›code
;

173 
__u8
 
	mÊags
;

174 
__u16
 
	mcomm™d_id
;

175 
__À32
 
	mnsid
;

176 
__À32
 
	mcdw2
[2];

177 
__À64
 
	mmëad©a
;

178 
__À64
 
	m¥p1
;

179 
__À64
 
	m¥p2
;

180 
__À32
 
	mcdw10
[6];

183 
	snvme_rw_comm™d
 {

184 
__u8
 
	m›code
;

185 
__u8
 
	mÊags
;

186 
__u16
 
	mcomm™d_id
;

187 
__À32
 
	mnsid
;

188 
__u64
 
	mrsvd2
;

189 
__À64
 
	mmëad©a
;

190 
__À64
 
	m¥p1
;

191 
__À64
 
	m¥p2
;

192 
__À64
 
	m¶ba
;

193 
__À16
 
	mÀngth
;

194 
__À16
 
	mc⁄åﬁ
;

195 
__À32
 
	mdsmgmt
;

196 
__À32
 
	mª·ag
;

197 
__À16
 
	m≠±ag
;

198 
__À16
 
	m≠pmask
;

202 
	mNVME_RW_LR
 = 1 << 15,

203 
	mNVME_RW_FUA
 = 1 << 14,

204 
	mNVME_RW_DSM_FREQ_UNSPEC
 = 0,

205 
	mNVME_RW_DSM_FREQ_TYPICAL
 = 1,

206 
	mNVME_RW_DSM_FREQ_RARE
 = 2,

207 
	mNVME_RW_DSM_FREQ_READS
 = 3,

208 
	mNVME_RW_DSM_FREQ_WRITES
 = 4,

209 
	mNVME_RW_DSM_FREQ_RW
 = 5,

210 
	mNVME_RW_DSM_FREQ_ONCE
 = 6,

211 
	mNVME_RW_DSM_FREQ_PREFETCH
 = 7,

212 
	mNVME_RW_DSM_FREQ_TEMP
 = 8,

213 
	mNVME_RW_DSM_LATENCY_NONE
 = 0 << 4,

214 
	mNVME_RW_DSM_LATENCY_IDLE
 = 1 << 4,

215 
	mNVME_RW_DSM_LATENCY_NORM
 = 2 << 4,

216 
	mNVME_RW_DSM_LATENCY_LOW
 = 3 << 4,

217 
	mNVME_RW_DSM_SEQ_REQ
 = 1 << 6,

218 
	mNVME_RW_DSM_COMPRESSED
 = 1 << 7,

221 
	snvme_dsm_cmd
 {

222 
__u8
 
	m›code
;

223 
__u8
 
	mÊags
;

224 
__u16
 
	mcomm™d_id
;

225 
__À32
 
	mnsid
;

226 
__u64
 
	mrsvd2
[2];

227 
__À64
 
	m¥p1
;

228 
__À64
 
	m¥p2
;

229 
__À32
 
	mƒ
;

230 
__À32
 
	m©åibuãs
;

231 
__u32
 
	mrsvd12
[4];

235 
	mNVME_DSMGMT_IDR
 = 1 << 0,

236 
	mNVME_DSMGMT_IDW
 = 1 << 1,

237 
	mNVME_DSMGMT_AD
 = 1 << 2,

240 
	snvme_dsm_ønge
 {

241 
__À32
 
	mˇâr
;

242 
__À32
 
	m∆b
;

243 
__À64
 
	m¶ba
;

248 
	envme_admö_›code
 {

249 
	mnvme_admö_dñëe_sq
 = 0x00,

250 
	mnvme_admö_¸óã_sq
 = 0x01,

251 
	mnvme_admö_gë_log_∑ge
 = 0x02,

252 
	mnvme_admö_dñëe_cq
 = 0x04,

253 
	mnvme_admö_¸óã_cq
 = 0x05,

254 
	mnvme_admö_idítify
 = 0x06,

255 
	mnvme_admö_ab‹t_cmd
 = 0x08,

256 
	mnvme_admö_£t_„©uªs
 = 0x09,

257 
	mnvme_admö_gë_„©uªs
 = 0x0a,

258 
	mnvme_admö_async_evít
 = 0x0c,

259 
	mnvme_admö_a˘iv©e_fw
 = 0x10,

260 
	mnvme_admö_dow∆ﬂd_fw
 = 0x11,

261 
	mnvme_admö_f‹m©_nvm
 = 0x80,

262 
	mnvme_admö_£curôy_£nd
 = 0x81,

263 
	mnvme_admö_£curôy_ªcv
 = 0x82,

267 
	mNVME_QUEUE_PHYS_CONTIG
 = (1 << 0),

268 
	mNVME_CQ_IRQ_ENABLED
 = (1 << 1),

269 
	mNVME_SQ_PRIO_URGENT
 = (0 << 1),

270 
	mNVME_SQ_PRIO_HIGH
 = (1 << 1),

271 
	mNVME_SQ_PRIO_MEDIUM
 = (2 << 1),

272 
	mNVME_SQ_PRIO_LOW
 = (3 << 1),

273 
	mNVME_FEAT_ARBITRATION
 = 0x01,

274 
	mNVME_FEAT_POWER_MGMT
 = 0x02,

275 
	mNVME_FEAT_LBA_RANGE
 = 0x03,

276 
	mNVME_FEAT_TEMP_THRESH
 = 0x04,

277 
	mNVME_FEAT_ERR_RECOVERY
 = 0x05,

278 
	mNVME_FEAT_VOLATILE_WC
 = 0x06,

279 
	mNVME_FEAT_NUM_QUEUES
 = 0x07,

280 
	mNVME_FEAT_IRQ_COALESCE
 = 0x08,

281 
	mNVME_FEAT_IRQ_CONFIG
 = 0x09,

282 
	mNVME_FEAT_WRITE_ATOMIC
 = 0x0a,

283 
	mNVME_FEAT_ASYNC_EVENT
 = 0x0b,

284 
	mNVME_FEAT_SW_PROGRESS
 = 0x0c,

285 
	mNVME_FWACT_REPL
 = (0 << 3),

286 
	mNVME_FWACT_REPL_ACTV
 = (1 << 3),

287 
	mNVME_FWACT_ACTV
 = (2 << 3),

290 
	snvme_idítify
 {

291 
__u8
 
	m›code
;

292 
__u8
 
	mÊags
;

293 
__u16
 
	mcomm™d_id
;

294 
__À32
 
	mnsid
;

295 
__u64
 
	mrsvd2
[2];

296 
__À64
 
	m¥p1
;

297 
__À64
 
	m¥p2
;

298 
__À32
 
	m˙s
;

299 
__u32
 
	mrsvd11
[5];

302 
	snvme_„©uªs
 {

303 
__u8
 
	m›code
;

304 
__u8
 
	mÊags
;

305 
__u16
 
	mcomm™d_id
;

306 
__À32
 
	mnsid
;

307 
__u64
 
	mrsvd2
[2];

308 
__À64
 
	m¥p1
;

309 
__À64
 
	m¥p2
;

310 
__À32
 
	mfid
;

311 
__À32
 
	mdw‹d11
;

312 
__u32
 
	mrsvd12
[4];

315 
	snvme_¸óã_cq
 {

316 
__u8
 
	m›code
;

317 
__u8
 
	mÊags
;

318 
__u16
 
	mcomm™d_id
;

319 
__u32
 
	mrsvd1
[5];

320 
__À64
 
	m¥p1
;

321 
__u64
 
	mrsvd8
;

322 
__À16
 
	mcqid
;

323 
__À16
 
	mqsize
;

324 
__À16
 
	mcq_Êags
;

325 
__À16
 
	múq_ve˘‹
;

326 
__u32
 
	mrsvd12
[4];

329 
	snvme_¸óã_sq
 {

330 
__u8
 
	m›code
;

331 
__u8
 
	mÊags
;

332 
__u16
 
	mcomm™d_id
;

333 
__u32
 
	mrsvd1
[5];

334 
__À64
 
	m¥p1
;

335 
__u64
 
	mrsvd8
;

336 
__À16
 
	msqid
;

337 
__À16
 
	mqsize
;

338 
__À16
 
	msq_Êags
;

339 
__À16
 
	mcqid
;

340 
__u32
 
	mrsvd12
[4];

343 
	snvme_dñëe_queue
 {

344 
__u8
 
	m›code
;

345 
__u8
 
	mÊags
;

346 
__u16
 
	mcomm™d_id
;

347 
__u32
 
	mrsvd1
[9];

348 
__À16
 
	mqid
;

349 
__u16
 
	mrsvd10
;

350 
__u32
 
	mrsvd11
[5];

353 
	snvme_ab‹t_cmd
 {

354 
__u8
 
	m›code
;

355 
__u8
 
	mÊags
;

356 
__u16
 
	mcomm™d_id
;

357 
__u32
 
	mrsvd1
[9];

358 
__À16
 
	msqid
;

359 
__u16
 
	mcid
;

360 
__u32
 
	mrsvd11
[5];

363 
	snvme_dow∆ﬂd_fúmw¨e
 {

364 
__u8
 
	m›code
;

365 
__u8
 
	mÊags
;

366 
__u16
 
	mcomm™d_id
;

367 
__u32
 
	mrsvd1
[5];

368 
__À64
 
	m¥p1
;

369 
__À64
 
	m¥p2
;

370 
__À32
 
	mnumd
;

371 
__À32
 
	moff£t
;

372 
__u32
 
	mrsvd12
[4];

375 
	snvme_f‹m©_cmd
 {

376 
__u8
 
	m›code
;

377 
__u8
 
	mÊags
;

378 
__u16
 
	mcomm™d_id
;

379 
__À32
 
	mnsid
;

380 
__u64
 
	mrsvd2
[4];

381 
__À32
 
	mcdw10
;

382 
__u32
 
	mrsvd11
[5];

385 
	snvme_comm™d
 {

387 
nvme_comm⁄_comm™d
 
	mcomm⁄
;

388 
nvme_rw_comm™d
 
	mrw
;

389 
nvme_idítify
 
	midítify
;

390 
nvme_„©uªs
 
	m„©uªs
;

391 
nvme_¸óã_cq
 
	m¸óã_cq
;

392 
nvme_¸óã_sq
 
	m¸óã_sq
;

393 
nvme_dñëe_queue
 
	mdñëe_queue
;

394 
nvme_dow∆ﬂd_fúmw¨e
 
	mdlfw
;

395 
nvme_f‹m©_cmd
 
	mf‹m©
;

396 
nvme_dsm_cmd
 
	mdsm
;

397 
nvme_ab‹t_cmd
 
	mab‹t
;

402 
	mNVME_SC_SUCCESS
 = 0x0,

403 
	mNVME_SC_INVALID_OPCODE
 = 0x1,

404 
	mNVME_SC_INVALID_FIELD
 = 0x2,

405 
	mNVME_SC_CMDID_CONFLICT
 = 0x3,

406 
	mNVME_SC_DATA_XFER_ERROR
 = 0x4,

407 
	mNVME_SC_POWER_LOSS
 = 0x5,

408 
	mNVME_SC_INTERNAL
 = 0x6,

409 
	mNVME_SC_ABORT_REQ
 = 0x7,

410 
	mNVME_SC_ABORT_QUEUE
 = 0x8,

411 
	mNVME_SC_FUSED_FAIL
 = 0x9,

412 
	mNVME_SC_FUSED_MISSING
 = 0xa,

413 
	mNVME_SC_INVALID_NS
 = 0xb,

414 
	mNVME_SC_CMD_SEQ_ERROR
 = 0xc,

415 
	mNVME_SC_LBA_RANGE
 = 0x80,

416 
	mNVME_SC_CAP_EXCEEDED
 = 0x81,

417 
	mNVME_SC_NS_NOT_READY
 = 0x82,

418 
	mNVME_SC_CQ_INVALID
 = 0x100,

419 
	mNVME_SC_QID_INVALID
 = 0x101,

420 
	mNVME_SC_QUEUE_SIZE
 = 0x102,

421 
	mNVME_SC_ABORT_LIMIT
 = 0x103,

422 
	mNVME_SC_ABORT_MISSING
 = 0x104,

423 
	mNVME_SC_ASYNC_LIMIT
 = 0x105,

424 
	mNVME_SC_FIRMWARE_SLOT
 = 0x106,

425 
	mNVME_SC_FIRMWARE_IMAGE
 = 0x107,

426 
	mNVME_SC_INVALID_VECTOR
 = 0x108,

427 
	mNVME_SC_INVALID_LOG_PAGE
 = 0x109,

428 
	mNVME_SC_INVALID_FORMAT
 = 0x10a,

429 
	mNVME_SC_BAD_ATTRIBUTES
 = 0x180,

430 
	mNVME_SC_WRITE_FAULT
 = 0x280,

431 
	mNVME_SC_READ_ERROR
 = 0x281,

432 
	mNVME_SC_GUARD_CHECK
 = 0x282,

433 
	mNVME_SC_APPTAG_CHECK
 = 0x283,

434 
	mNVME_SC_REFTAG_CHECK
 = 0x284,

435 
	mNVME_SC_COMPARE_FAILED
 = 0x285,

436 
	mNVME_SC_ACCESS_DENIED
 = 0x286,

439 
	snvme_com∂ëi⁄
 {

440 
__À32
 
	mªsu…
;

441 
__u32
 
	mrsvd
;

442 
__À16
 
	msq_hód
;

443 
__À16
 
	msq_id
;

444 
__u16
 
	mcomm™d_id
;

445 
__À16
 
	m°©us
;

448 
	snvme_u£r_io
 {

449 
__u8
 
	m›code
;

450 
__u8
 
	mÊags
;

451 
__u16
 
	mc⁄åﬁ
;

452 
__u16
 
	mnblocks
;

453 
__u16
 
	mrsvd
;

454 
__u64
 
	mmëad©a
;

455 
__u64
 
	maddr
;

456 
__u64
 
	m¶ba
;

457 
__u32
 
	mdsmgmt
;

458 
__u32
 
	mª·ag
;

459 
__u16
 
	m≠±ag
;

460 
__u16
 
	m≠pmask
;

463 
	snvme_admö_cmd
 {

464 
__u8
 
	m›code
;

465 
__u8
 
	mÊags
;

466 
__u16
 
	mrsvd1
;

467 
__u32
 
	mnsid
;

468 
__u32
 
	mcdw2
;

469 
__u32
 
	mcdw3
;

470 
__u64
 
	mmëad©a
;

471 
__u64
 
	maddr
;

472 
__u32
 
	mmëad©a_Àn
;

473 
__u32
 
	md©a_Àn
;

474 
__u32
 
	mcdw10
;

475 
__u32
 
	mcdw11
;

476 
__u32
 
	mcdw12
;

477 
__u32
 
	mcdw13
;

478 
__u32
 
	mcdw14
;

479 
__u32
 
	mcdw15
;

480 
__u32
 
	mtimeout_ms
;

481 
__u32
 
	mªsu…
;

484 
	#NVME_IOCTL_ID
 
	`_IO
('N', 0x40)

	)

485 
	#NVME_IOCTL_ADMIN_CMD
 
	`_IOWR
('N', 0x41, 
nvme_admö_cmd
)

	)

486 
	#NVME_IOCTL_SUBMIT_IO
 
	`_IOW
('N', 0x42, 
nvme_u£r_io
)

	)

	@/usr/include/linux/pci.h

17 #i‚de‡
LINUX_PCI_H


18 
	#LINUX_PCI_H


	)

20 
	~<löux/pci_ªgs.h
>

30 
	#PCI_DEVFN
(
¶Ÿ
, 
func
Ë((((¶ŸË& 0x1fË<< 3Ë| ((funcË& 0x07))

	)

31 
	#PCI_SLOT
(
dev‚
Ë(((dev‚Ë>> 3Ë& 0x1f)

	)

32 
	#PCI_FUNC
(
dev‚
Ë((dev‚Ë& 0x07)

	)

35 
	#PCIIOC_BASE
 ('P' << 24 | 'C' << 16 | 'I' << 8)

	)

36 
	#PCIIOC_CONTROLLER
 (
PCIIOC_BASE
 | 0x00Ë

	)

37 
	#PCIIOC_MMAP_IS_IO
 (
PCIIOC_BASE
 | 0x01Ë

	)

38 
	#PCIIOC_MMAP_IS_MEM
 (
PCIIOC_BASE
 | 0x02Ë

	)

39 
	#PCIIOC_WRITE_COMBINE
 (
PCIIOC_BASE
 | 0x03Ë

	)

	@/usr/include/linux/ptrace.h

1 #i‚de‡
_LINUX_PTRACE_H


2 
	#_LINUX_PTRACE_H


	)

8 
	~<löux/ty≥s.h
>

10 
	#PTRACE_TRACEME
 0

	)

11 
	#PTRACE_PEEKTEXT
 1

	)

12 
	#PTRACE_PEEKDATA
 2

	)

13 
	#PTRACE_PEEKUSR
 3

	)

14 
	#PTRACE_POKETEXT
 4

	)

15 
	#PTRACE_POKEDATA
 5

	)

16 
	#PTRACE_POKEUSR
 6

	)

17 
	#PTRACE_CONT
 7

	)

18 
	#PTRACE_KILL
 8

	)

19 
	#PTRACE_SINGLESTEP
 9

	)

21 
	#PTRACE_ATTACH
 16

	)

22 
	#PTRACE_DETACH
 17

	)

24 
	#PTRACE_SYSCALL
 24

	)

27 
	#PTRACE_SETOPTIONS
 0x4200

	)

28 
	#PTRACE_GETEVENTMSG
 0x4201

	)

29 
	#PTRACE_GETSIGINFO
 0x4202

	)

30 
	#PTRACE_SETSIGINFO
 0x4203

	)

49 
	#PTRACE_GETREGSET
 0x4204

	)

50 
	#PTRACE_SETREGSET
 0x4205

	)

52 
	#PTRACE_SEIZE
 0x4206

	)

53 
	#PTRACE_INTERRUPT
 0x4207

	)

54 
	#PTRACE_LISTEN
 0x4208

	)

56 
	#PTRACE_PEEKSIGINFO
 0x4209

	)

58 
	s±ø˚_≥eksigöfo_¨gs
 {

59 
__u64
 
	moff
;

60 
__u32
 
	mÊags
;

61 
__s32
 
	mƒ
;

64 
	#PTRACE_GETSIGMASK
 0x420a

	)

65 
	#PTRACE_SETSIGMASK
 0x420b

	)

68 
	#PTRACE_PEEKSIGINFO_SHARED
 (1 << 0)

	)

71 
	#PTRACE_EVENT_FORK
 1

	)

72 
	#PTRACE_EVENT_VFORK
 2

	)

73 
	#PTRACE_EVENT_CLONE
 3

	)

74 
	#PTRACE_EVENT_EXEC
 4

	)

75 
	#PTRACE_EVENT_VFORK_DONE
 5

	)

76 
	#PTRACE_EVENT_EXIT
 6

	)

77 
	#PTRACE_EVENT_SECCOMP
 7

	)

79 
	#PTRACE_EVENT_STOP
 128

	)

82 
	#PTRACE_O_TRACESYSGOOD
 1

	)

83 
	#PTRACE_O_TRACEFORK
 (1 << 
PTRACE_EVENT_FORK
)

	)

84 
	#PTRACE_O_TRACEVFORK
 (1 << 
PTRACE_EVENT_VFORK
)

	)

85 
	#PTRACE_O_TRACECLONE
 (1 << 
PTRACE_EVENT_CLONE
)

	)

86 
	#PTRACE_O_TRACEEXEC
 (1 << 
PTRACE_EVENT_EXEC
)

	)

87 
	#PTRACE_O_TRACEVFORKDONE
 (1 << 
PTRACE_EVENT_VFORK_DONE
)

	)

88 
	#PTRACE_O_TRACEEXIT
 (1 << 
PTRACE_EVENT_EXIT
)

	)

89 
	#PTRACE_O_TRACESECCOMP
 (1 << 
PTRACE_EVENT_SECCOMP
)

	)

92 
	#PTRACE_O_EXITKILL
 (1 << 20)

	)

94 
	#PTRACE_O_MASK
 (0x000000f‡| 
PTRACE_O_EXITKILL
)

	)

96 
	~<asm/±ø˚.h
>

	@/usr/include/linux/sched.h

1 #i‚de‡
_LINUX_SCHED_H


2 
	#_LINUX_SCHED_H


	)

7 
	#CSIGNAL
 0x000000f‡

	)

8 
	#CLONE_VM
 0x00000100

	)

9 
	#CLONE_FS
 0x00000200

	)

10 
	#CLONE_FILES
 0x00000400

	)

11 
	#CLONE_SIGHAND
 0x00000800

	)

12 
	#CLONE_PTRACE
 0x00002000

	)

13 
	#CLONE_VFORK
 0x00004000

	)

14 
	#CLONE_PARENT
 0x00008000

	)

15 
	#CLONE_THREAD
 0x00010000

	)

16 
	#CLONE_NEWNS
 0x00020000

	)

17 
	#CLONE_SYSVSEM
 0x00040000

	)

18 
	#CLONE_SETTLS
 0x00080000

	)

19 
	#CLONE_PARENT_SETTID
 0x00100000

	)

20 
	#CLONE_CHILD_CLEARTID
 0x00200000

	)

21 
	#CLONE_DETACHED
 0x00400000

	)

22 
	#CLONE_UNTRACED
 0x00800000

	)

23 
	#CLONE_CHILD_SETTID
 0x01000000

	)

26 
	#CLONE_NEWUTS
 0x04000000

	)

27 
	#CLONE_NEWIPC
 0x08000000

	)

28 
	#CLONE_NEWUSER
 0x10000000

	)

29 
	#CLONE_NEWPID
 0x20000000

	)

30 
	#CLONE_NEWNET
 0x40000000

	)

31 
	#CLONE_IO
 0x80000000

	)

36 
	#SCHED_NORMAL
 0

	)

37 
	#SCHED_FIFO
 1

	)

38 
	#SCHED_RR
 2

	)

39 
	#SCHED_BATCH
 3

	)

41 
	#SCHED_IDLE
 5

	)

43 
	#SCHED_RESET_ON_FORK
 0x40000000

	)

	@/usr/include/linux/types.h

1 #i‚de‡
_LINUX_TYPES_H


2 
	#_LINUX_TYPES_H


	)

4 
	~<asm/ty≥s.h
>

6 #i‚de‡
__ASSEMBLY__


8 
	~<löux/posix_ty≥s.h
>

16 #ifde‡
__CHECKER__


17 
	#__bôwi£__
 
	`__©åibuã__
((
bôwi£
))

	)

19 
	#__bôwi£__


	)

21 #ifde‡
__CHECK_ENDIAN__


22 
	#__bôwi£
 
__bôwi£__


	)

24 
	#__bôwi£


	)

27 
__u16
 
	t__bôwi£
 
	t__À16
;

28 
__u16
 
	t__bôwi£
 
	t__be16
;

29 
__u32
 
	t__bôwi£
 
	t__À32
;

30 
__u32
 
	t__bôwi£
 
	t__be32
;

31 
__u64
 
	t__bôwi£
 
	t__À64
;

32 
__u64
 
	t__bôwi£
 
	t__be64
;

34 
__u16
 
	t__bôwi£
 
	t__sum16
;

35 
__u32
 
	t__bôwi£
 
	t__wsum
;

46 
	#__Æig√d_u64
 
__u64
 
	`__©åibuã__
((
	`Æig√d
(8)))

	)

47 
	#__Æig√d_be64
 
__be64
 
	`__©åibuã__
((
	`Æig√d
(8)))

	)

48 
	#__Æig√d_À64
 
__À64
 
	`__©åibuã__
((
	`Æig√d
(8)))

	)

	@/usr/include/scsi/scsi.h

23 #i‚de‡
_SCSI_SCSI_H


24 
	#_SCSI_SCSI_H
 1

	)

26 
	~<„©uªs.h
>

32 
	#TEST_UNIT_READY
 0x00

	)

33 
	#REZERO_UNIT
 0x01

	)

34 
	#REQUEST_SENSE
 0x03

	)

35 
	#FORMAT_UNIT
 0x04

	)

36 
	#READ_BLOCK_LIMITS
 0x05

	)

37 
	#REASSIGN_BLOCKS
 0x07

	)

38 
	#READ_6
 0x08

	)

39 
	#WRITE_6
 0x0a

	)

40 
	#SEEK_6
 0x0b

	)

41 
	#READ_REVERSE
 0x0f

	)

42 
	#WRITE_FILEMARKS
 0x10

	)

43 
	#SPACE
 0x11

	)

44 
	#INQUIRY
 0x12

	)

45 
	#RECOVER_BUFFERED_DATA
 0x14

	)

46 
	#MODE_SELECT
 0x15

	)

47 
	#RESERVE
 0x16

	)

48 
	#RELEASE
 0x17

	)

49 
	#COPY
 0x18

	)

50 
	#ERASE
 0x19

	)

51 
	#MODE_SENSE
 0x1a

	)

52 
	#START_STOP
 0x1b

	)

53 
	#RECEIVE_DIAGNOSTIC
 0x1c

	)

54 
	#SEND_DIAGNOSTIC
 0x1d

	)

55 
	#ALLOW_MEDIUM_REMOVAL
 0x1e

	)

57 
	#SET_WINDOW
 0x24

	)

58 
	#READ_CAPACITY
 0x25

	)

59 
	#READ_10
 0x28

	)

60 
	#WRITE_10
 0x2a

	)

61 
	#SEEK_10
 0x2b

	)

62 
	#WRITE_VERIFY
 0x2e

	)

63 
	#VERIFY
 0x2f

	)

64 
	#SEARCH_HIGH
 0x30

	)

65 
	#SEARCH_EQUAL
 0x31

	)

66 
	#SEARCH_LOW
 0x32

	)

67 
	#SET_LIMITS
 0x33

	)

68 
	#PRE_FETCH
 0x34

	)

69 
	#READ_POSITION
 0x34

	)

70 
	#SYNCHRONIZE_CACHE
 0x35

	)

71 
	#LOCK_UNLOCK_CACHE
 0x36

	)

72 
	#READ_DEFECT_DATA
 0x37

	)

73 
	#MEDIUM_SCAN
 0x38

	)

74 
	#COMPARE
 0x39

	)

75 
	#COPY_VERIFY
 0x3a

	)

76 
	#WRITE_BUFFER
 0x3b

	)

77 
	#READ_BUFFER
 0x3c

	)

78 
	#UPDATE_BLOCK
 0x3d

	)

79 
	#READ_LONG
 0x3e

	)

80 
	#WRITE_LONG
 0x3f

	)

81 
	#CHANGE_DEFINITION
 0x40

	)

82 
	#WRITE_SAME
 0x41

	)

83 
	#READ_TOC
 0x43

	)

84 
	#LOG_SELECT
 0x4c

	)

85 
	#LOG_SENSE
 0x4d

	)

86 
	#MODE_SELECT_10
 0x55

	)

87 
	#RESERVE_10
 0x56

	)

88 
	#RELEASE_10
 0x57

	)

89 
	#MODE_SENSE_10
 0x5a

	)

90 
	#PERSISTENT_RESERVE_IN
 0x5e

	)

91 
	#PERSISTENT_RESERVE_OUT
 0x5f

	)

92 
	#MOVE_MEDIUM
 0xa5

	)

93 
	#READ_12
 0xa8

	)

94 
	#WRITE_12
 0xØ

	)

95 
	#WRITE_VERIFY_12
 0x´

	)

96 
	#SEARCH_HIGH_12
 0xb0

	)

97 
	#SEARCH_EQUAL_12
 0xb1

	)

98 
	#SEARCH_LOW_12
 0xb2

	)

99 
	#READ_ELEMENT_STATUS
 0xb8

	)

100 
	#SEND_VOLUME_TAG
 0xb6

	)

101 
	#WRITE_LONG_2
 0xó

	)

107 
	#GOOD
 0x00

	)

108 
	#CHECK_CONDITION
 0x01

	)

109 
	#CONDITION_GOOD
 0x02

	)

110 
	#BUSY
 0x04

	)

111 
	#INTERMEDIATE_GOOD
 0x08

	)

112 
	#INTERMEDIATE_C_GOOD
 0x0a

	)

113 
	#RESERVATION_CONFLICT
 0x0c

	)

114 
	#COMMAND_TERMINATED
 0x11

	)

115 
	#QUEUE_FULL
 0x14

	)

117 
	#STATUS_MASK
 0x3e

	)

123 
	#NO_SENSE
 0x00

	)

124 
	#RECOVERED_ERROR
 0x01

	)

125 
	#NOT_READY
 0x02

	)

126 
	#MEDIUM_ERROR
 0x03

	)

127 
	#HARDWARE_ERROR
 0x04

	)

128 
	#ILLEGAL_REQUEST
 0x05

	)

129 
	#UNIT_ATTENTION
 0x06

	)

130 
	#DATA_PROTECT
 0x07

	)

131 
	#BLANK_CHECK
 0x08

	)

132 
	#COPY_ABORTED
 0x0a

	)

133 
	#ABORTED_COMMAND
 0x0b

	)

134 
	#VOLUME_OVERFLOW
 0x0d

	)

135 
	#MISCOMPARE
 0x0e

	)

142 
	#TYPE_DISK
 0x00

	)

143 
	#TYPE_TAPE
 0x01

	)

144 
	#TYPE_PROCESSOR
 0x03

	)

145 
	#TYPE_WORM
 0x04

	)

146 
	#TYPE_ROM
 0x05

	)

147 
	#TYPE_SCANNER
 0x06

	)

148 
	#TYPE_MOD
 0x07

	)

150 
	#TYPE_MEDIUM_CHANGER
 0x08

	)

151 
	#TYPE_ENCLOSURE
 0x0d

	)

152 
	#TYPE_NO_LUN
 0x7f

	)

160 
	sccs_mode£l_hód


162 
	m_r1
;

163 
	mmedium
;

164 
	m_r2
;

165 
	mblock_desc_Àngth
;

166 
	mdísôy
;

167 
	mnumbî_blocks_hi
;

169 
	mnumbî_blocks_med
;

170 
	mnumbî_blocks_lo
;

171 
	m_r3
;

172 
	mblock_Àngth_hi
;

174 
	mblock_Àngth_med
;

175 
	mblock_Àngth_lo
;

182 
	#COMMAND_COMPLETE
 0x00

	)

183 
	#EXTENDED_MESSAGE
 0x01

	)

184 
	#EXTENDED_MODIFY_DATA_POINTER
 0x00

	)

185 
	#EXTENDED_SDTR
 0x01

	)

186 
	#EXTENDED_EXTENDED_IDENTIFY
 0x02

	)

187 
	#EXTENDED_WDTR
 0x03

	)

188 
	#SAVE_POINTERS
 0x02

	)

189 
	#RESTORE_POINTERS
 0x03

	)

190 
	#DISCONNECT
 0x04

	)

191 
	#INITIATOR_ERROR
 0x05

	)

192 
	#ABORT
 0x06

	)

193 
	#MESSAGE_REJECT
 0x07

	)

194 
	#NOP
 0x08

	)

195 
	#MSG_PARITY_ERROR
 0x09

	)

196 
	#LINKED_CMD_COMPLETE
 0x0a

	)

197 
	#LINKED_FLG_CMD_COMPLETE
 0x0b

	)

198 
	#BUS_DEVICE_RESET
 0x0c

	)

200 
	#INITIATE_RECOVERY
 0x0‡

	)

201 
	#RELEASE_RECOVERY
 0x10

	)

203 
	#SIMPLE_QUEUE_TAG
 0x20

	)

204 
	#HEAD_OF_QUEUE_TAG
 0x21

	)

205 
	#ORDERED_QUEUE_TAG
 0x22

	)

212 
	#SCSI_IOCTL_GET_IDLUN
 0x5382

	)

216 
	#SCSI_IOCTL_TAGGED_ENABLE
 0x5383

	)

217 
	#SCSI_IOCTL_TAGGED_DISABLE
 0x5384

	)

220 
	#SCSI_IOCTL_PROBE_HOST
 0x5385

	)

223 
	#SCSI_IOCTL_GET_BUS_NUMBER
 0x5386

	)

	@/usr/include/scsi/sg.h

25 #i‚de‡
_SCSI_SG_H


26 
	#_SCSI_SG_H
 1

	)

28 
	~<„©uªs.h
>

29 
	#__√ed_size_t


	)

30 
	~<°ddef.h
>

37 
	ssg_iovec


39 * 
	miov_ba£
;

40 
size_t
 
	miov_Àn
;

41 } 
	tsg_iovec_t
;

44 
	ssg_io_hdr


46 
	möãrÁ˚_id
;

47 
	mdx„r_dúe˘i⁄
;

48 
	mcmd_Àn
;

49 
	mmx_sb_Àn
;

50 
	miovec_cou¡
;

51 
	mdx„r_Àn
;

52 * 
	mdx„Ω
;

54 * 
	mcmdp
;

55 * 
	msbp
;

56 
	mtimeout
;

57 
	mÊags
;

58 
	m∑ck_id
;

59 * 
	mu§_±r
;

60 
	m°©us
;

61 
	mmasked_°©us
;

62 
	mmsg_°©us
;

63 
	msb_Àn_wr
;

64 
	mho°_°©us
;

65 
	mdrivî_°©us
;

66 
	mªsid
;

67 
	mduøti⁄
;

68 
	möfo
;

69 } 
	tsg_io_hdr_t
;

73 
	#SG_DXFER_NONE
 -1

	)

74 
	#SG_DXFER_TO_DEV
 -2

	)

75 
	#SG_DXFER_FROM_DEV
 -3

	)

76 
	#SG_DXFER_TO_FROM_DEV
 -4

	)

83 
	#SG_FLAG_DIRECT_IO
 1

	)

84 
	#SG_FLAG_LUN_INHIBIT
 2

	)

86 
	#SG_FLAG_NO_DXFER
 0x10000

	)

90 
	#SG_INFO_OK_MASK
 0x1

	)

91 
	#SG_INFO_OK
 0x0

	)

92 
	#SG_INFO_CHECK
 0x1

	)

94 
	#SG_INFO_DIRECT_IO_MASK
 0x6

	)

95 
	#SG_INFO_INDIRECT_IO
 0x0

	)

96 
	#SG_INFO_DIRECT_IO
 0x2

	)

97 
	#SG_INFO_MIXED_IO
 0x4

	)

102 
	ssg_scsi_id
 {

104 
	mho°_no
;

105 
	mch™√l
;

107 
	mscsi_id
;

108 
	mlun
;

110 
	mscsi_ty≥
;

112 
	mh_cmd_≥r_lun
;

114 
	md_queue_dïth
;

116 
	munu£d
[2];

120 
	ssg_ªq_öfo
 {

121 
	mªq_°©e
;

122 
	m‹ph™
;

123 
	msg_io_ow√d
;

124 
	m¥obÀm
;

125 
	m∑ck_id
;

126 * 
	mu§_±r
;

127 
	mduøti⁄
;

129 
	munu£d
;

130 } 
	tsg_ªq_öfo_t
;

137 
	#SG_EMULATED_HOST
 0x2203

	)

141 
	#SG_SET_TRANSFORM
 0x2204

	)

143 
	#SG_GET_TRANSFORM
 0x2205

	)

145 
	#SG_SET_RESERVED_SIZE
 0x2275

	)

146 
	#SG_GET_RESERVED_SIZE
 0x2272

	)

149 
	#SG_GET_SCSI_ID
 0x2276

	)

153 
	#SG_SET_FORCE_LOW_DMA
 0x2279

	)

154 
	#SG_GET_LOW_DMA
 0x227®

	)

160 
	#SG_SET_FORCE_PACK_ID
 0x227b

	)

161 
	#SG_GET_PACK_ID
 0x227¯

	)

163 
	#SG_GET_NUM_WAITING
 0x227d

	)

166 
	#SG_GET_SG_TABLESIZE
 0x227F

	)

168 
	#SG_GET_VERSION_NUM
 0x2282

	)

171 
	#SG_SCSI_RESET
 0x2284

	)

173 
	#SG_SCSI_RESET_NOTHING
 0

	)

174 
	#SG_SCSI_RESET_DEVICE
 1

	)

175 
	#SG_SCSI_RESET_BUS
 2

	)

176 
	#SG_SCSI_RESET_HOST
 3

	)

179 
	#SG_IO
 0x2285

	)

181 
	#SG_GET_REQUEST_TABLE
 0x2286

	)

184 
	#SG_SET_KEEP_ORPHAN
 0x2287

	)

185 
	#SG_GET_KEEP_ORPHAN
 0x2288

	)

188 
	#SG_SCATTER_SZ
 (8 * 4096Ë

	)

196 
	#SG_DEFAULT_RETRIES
 1

	)

199 
	#SG_DEF_FORCE_LOW_DMA
 0

	)

200 
	#SG_DEF_FORCE_PACK_ID
 0

	)

201 
	#SG_DEF_KEEP_ORPHAN
 0

	)

202 
	#SG_DEF_RESERVED_SIZE
 
SG_SCATTER_SZ


	)

205 
	#SG_MAX_QUEUE
 16

	)

207 
	#SG_BIG_BUFF
 
SG_DEF_RESERVED_SIZE


	)

210 
sg_io_hdr
 
	tSg_io_hdr
;

211 
sg_io_vec
 
	tSg_io_vec
;

212 
sg_scsi_id
 
	tSg_scsi_id
;

213 
sg_ªq_öfo
 
	tSg_ªq_öfo
;

220 
	#SG_MAX_SENSE
 16

	)

222 
	ssg_hódî


225 
	m∑ck_Àn
;

227 
	mª∂y_Àn
;

229 
	m∑ck_id
;

231 
	mªsu…
;

233 
	mtwñve_byã
:1;

235 
	mèrgë_°©us
:5;

237 
	mho°_°©us
:8;

239 
	mdrivî_°©us
:8;

241 
	mŸhî_Êags
:10;

246 
	m£n£_buf„r
[
SG_MAX_SENSE
];

254 
	#SG_SET_TIMEOUT
 0x2201

	)

255 
	#SG_GET_TIMEOUT
 0x2202

	)

258 
	#SG_GET_COMMAND_Q
 0x2270

	)

259 
	#SG_SET_COMMAND_Q
 0x2271

	)

263 
	#SG_SET_DEBUG
 0x227ê

	)

265 
	#SG_NEXT_CMD_LEN
 0x2283

	)

270 
	#SG_DEFAULT_TIMEOUT
 (60*
HZ
Ë

	)

271 
	#SG_DEF_COMMAND_Q
 0

	)

273 
	#SG_DEF_UNDERRUN_FLAG
 0

	)

	@/usr/include/asm/errno.h

1 
	~<asm-gíîic/î∫o.h
>

	@/usr/include/asm/ptrace.h

1 #i‚de‡
_ASM_X86_PTRACE_H


2 
	#_ASM_X86_PTRACE_H


	)

5 
	~<asm/±ø˚-abi.h
>

6 
	~<asm/¥o˚ss‹-Êags.h
>

9 #i‚de‡
__ASSEMBLY__


11 #ifde‡
__i386__


16 
	s±_ªgs
 {

17 
	mebx
;

18 
	mecx
;

19 
	medx
;

20 
	mesi
;

21 
	medi
;

22 
	mebp
;

23 
	móx
;

24 
	mxds
;

25 
	mxes
;

26 
	mxfs
;

27 
	mxgs
;

28 
	m‹ig_óx
;

29 
	meù
;

30 
	mxcs
;

31 
	meÊags
;

32 
	me•
;

33 
	mxss
;

40 
	s±_ªgs
 {

41 
	mr15
;

42 
	mr14
;

43 
	mr13
;

44 
	mr12
;

45 
	mrbp
;

46 
	mrbx
;

48 
	mr11
;

49 
	mr10
;

50 
	mr9
;

51 
	mr8
;

52 
	møx
;

53 
	mrcx
;

54 
	mrdx
;

55 
	mrsi
;

56 
	mrdi
;

57 
	m‹ig_øx
;

60 
	mrù
;

61 
	mcs
;

62 
	meÊags
;

63 
	mr•
;

64 
	mss
;

	@/usr/include/asm/types.h

1 #i‚de‡
_ASM_X86_TYPES_H


2 
	#_ASM_X86_TYPES_H


	)

4 
	~<asm-gíîic/ty≥s.h
>

	@/usr/include/features.h

18 #i‚def 
_FEATURES_H


19 
	#_FEATURES_H
 1

	)

101 #unde‡
__USE_ISOC11


102 #unde‡
__USE_ISOC99


103 #unde‡
__USE_ISOC95


104 #unde‡
__USE_ISOCXX11


105 #unde‡
__USE_POSIX


106 #unde‡
__USE_POSIX2


107 #unde‡
__USE_POSIX199309


108 #unde‡
__USE_POSIX199506


109 #unde‡
__USE_XOPEN


110 #unde‡
__USE_XOPEN_EXTENDED


111 #unde‡
__USE_UNIX98


112 #unde‡
__USE_XOPEN2K


113 #unde‡
__USE_XOPEN2KXSI


114 #unde‡
__USE_XOPEN2K8


115 #unde‡
__USE_XOPEN2K8XSI


116 #unde‡
__USE_LARGEFILE


117 #unde‡
__USE_LARGEFILE64


118 #unde‡
__USE_FILE_OFFSET64


119 #unde‡
__USE_BSD


120 #unde‡
__USE_SVID


121 #unde‡
__USE_MISC


122 #unde‡
__USE_ATFILE


123 #unde‡
__USE_GNU


124 #unde‡
__USE_REENTRANT


125 #unde‡
__USE_FORTIFY_LEVEL


126 #unde‡
__KERNEL_STRICT_NAMES


130 #i‚de‡
_LOOSE_KERNEL_NAMES


131 
	#__KERNEL_STRICT_NAMES


	)

141 #i‡
deföed
 
__GNUC__
 && deföed 
__GNUC_MINOR__


142 
	#__GNUC_PREREQ
(
maj
, 
mö
) \

143 ((
__GNUC__
 << 16Ë+ 
__GNUC_MINOR__
 >((
maj
Ë<< 16Ë+ (
mö
))

	)

145 
	#__GNUC_PREREQ
(
maj
, 
mö
Ë0

	)

150 #ifde‡
_GNU_SOURCE


151 #unde‡
_ISOC95_SOURCE


152 
	#_ISOC95_SOURCE
 1

	)

153 #unde‡
_ISOC99_SOURCE


154 
	#_ISOC99_SOURCE
 1

	)

155 #unde‡
_ISOC11_SOURCE


156 
	#_ISOC11_SOURCE
 1

	)

157 #unde‡
_POSIX_SOURCE


158 
	#_POSIX_SOURCE
 1

	)

159 #unde‡
_POSIX_C_SOURCE


160 
	#_POSIX_C_SOURCE
 200809L

	)

161 #unde‡
_XOPEN_SOURCE


162 
	#_XOPEN_SOURCE
 700

	)

163 #unde‡
_XOPEN_SOURCE_EXTENDED


164 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

165 #unde‡
_LARGEFILE64_SOURCE


166 
	#_LARGEFILE64_SOURCE
 1

	)

167 #unde‡
_DEFAULT_SOURCE


168 
	#_DEFAULT_SOURCE
 1

	)

169 #unde‡
_BSD_SOURCE


170 
	#_BSD_SOURCE
 1

	)

171 #unde‡
_SVID_SOURCE


172 
	#_SVID_SOURCE
 1

	)

173 #unde‡
_ATFILE_SOURCE


174 
	#_ATFILE_SOURCE
 1

	)

179 #i‡(
deföed
 
_DEFAULT_SOURCE
 \

180 || (!
deföed
 
	g__STRICT_ANSI__
 \

181 && !
deföed
 
	g_ISOC99_SOURCE
 \

182 && !
deföed
 
	g_POSIX_SOURCE
 && !deföed 
	g_POSIX_C_SOURCE
 \

183 && !
deföed
 
	g_XOPEN_SOURCE
 \

184 && !
deföed
 
	g_BSD_SOURCE
 && !deföed 
	g_SVID_SOURCE
))

185 #unde‡
_DEFAULT_SOURCE


186 
	#_DEFAULT_SOURCE
 1

	)

187 #unde‡
_BSD_SOURCE


188 
	#_BSD_SOURCE
 1

	)

189 #unde‡
_SVID_SOURCE


190 
	#_SVID_SOURCE
 1

	)

194 #i‡(
deföed
 
_ISOC11_SOURCE
 \

195 || (
deföed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 201112L))

196 
	#__USE_ISOC11
 1

	)

200 #i‡(
deföed
 
_ISOC99_SOURCE
 || deföed 
_ISOC11_SOURCE
 \

201 || (
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

202 
	#__USE_ISOC99
 1

	)

206 #i‡(
deföed
 
_ISOC99_SOURCE
 || deföed 
_ISOC11_SOURCE
 \

207 || (
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

208 
	#__USE_ISOC95
 1

	)

215 #i‡((
deföed
 
__˝lu•lus
 && __cplusplus >= 201103L) \

216 || 
deföed
 
__GXX_EXPERIMENTAL_CXX0X__
)

217 
	#__USE_ISOCXX11
 1

	)

223 #ifde‡
_DEFAULT_SOURCE


224 #i‡!
deföed
 
_POSIX_SOURCE
 && !deföed 
_POSIX_C_SOURCE


225 
	#__USE_POSIX_IMPLICITLY
 1

	)

227 #unde‡
_POSIX_SOURCE


228 
	#_POSIX_SOURCE
 1

	)

229 #unde‡
_POSIX_C_SOURCE


230 
	#_POSIX_C_SOURCE
 200809L

	)

232 #i‡((!
deföed
 
__STRICT_ANSI__
 || (
_XOPEN_SOURCE
 - 0) >= 500) && \

233 !
deföed
 
_POSIX_SOURCE
 && !deföed 
_POSIX_C_SOURCE
)

234 
	#_POSIX_SOURCE
 1

	)

235 #i‡
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

236 
	#_POSIX_C_SOURCE
 2

	)

237 #ñi‡
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

238 
	#_POSIX_C_SOURCE
 199506L

	)

239 #ñi‡
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 700

240 
	#_POSIX_C_SOURCE
 200112L

	)

242 
	#_POSIX_C_SOURCE
 200809L

	)

244 
	#__USE_POSIX_IMPLICITLY
 1

	)

247 #i‡
deföed
 
_POSIX_SOURCE
 || 
_POSIX_C_SOURCE
 >1 || deföed 
_XOPEN_SOURCE


248 
	#__USE_POSIX
 1

	)

251 #i‡
deföed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >2 || deföed 
_XOPEN_SOURCE


252 
	#__USE_POSIX2
 1

	)

255 #i‡(
_POSIX_C_SOURCE
 - 0) >= 199309L

256 
	#__USE_POSIX199309
 1

	)

259 #i‡(
_POSIX_C_SOURCE
 - 0) >= 199506L

260 
	#__USE_POSIX199506
 1

	)

263 #i‡(
_POSIX_C_SOURCE
 - 0) >= 200112L

264 
	#__USE_XOPEN2K
 1

	)

265 #unde‡
__USE_ISOC95


266 
	#__USE_ISOC95
 1

	)

267 #unde‡
__USE_ISOC99


268 
	#__USE_ISOC99
 1

	)

271 #i‡(
_POSIX_C_SOURCE
 - 0) >= 200809L

272 
	#__USE_XOPEN2K8
 1

	)

273 #unde‡
_ATFILE_SOURCE


274 
	#_ATFILE_SOURCE
 1

	)

277 #ifdef 
_XOPEN_SOURCE


278 
	#__USE_XOPEN
 1

	)

279 #i‡(
_XOPEN_SOURCE
 - 0) >= 500

280 
	#__USE_XOPEN_EXTENDED
 1

	)

281 
	#__USE_UNIX98
 1

	)

282 #unde‡
_LARGEFILE_SOURCE


283 
	#_LARGEFILE_SOURCE
 1

	)

284 #i‡(
_XOPEN_SOURCE
 - 0) >= 600

285 #i‡(
_XOPEN_SOURCE
 - 0) >= 700

286 
	#__USE_XOPEN2K8
 1

	)

287 
	#__USE_XOPEN2K8XSI
 1

	)

289 
	#__USE_XOPEN2K
 1

	)

290 
	#__USE_XOPEN2KXSI
 1

	)

291 #unde‡
__USE_ISOC95


292 
	#__USE_ISOC95
 1

	)

293 #unde‡
__USE_ISOC99


294 
	#__USE_ISOC99
 1

	)

297 #ifde‡
_XOPEN_SOURCE_EXTENDED


298 
	#__USE_XOPEN_EXTENDED
 1

	)

303 #ifde‡
_LARGEFILE_SOURCE


304 
	#__USE_LARGEFILE
 1

	)

307 #ifde‡
_LARGEFILE64_SOURCE


308 
	#__USE_LARGEFILE64
 1

	)

311 #i‡
deföed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

312 
	#__USE_FILE_OFFSET64
 1

	)

315 #i‡
deföed
 
_BSD_SOURCE
 || deföed 
_SVID_SOURCE


316 
	#__USE_MISC
 1

	)

319 #ifdef 
_BSD_SOURCE


320 
	#__USE_BSD
 1

	)

323 #ifdef 
_SVID_SOURCE


324 
	#__USE_SVID
 1

	)

327 #ifdef 
_ATFILE_SOURCE


328 
	#__USE_ATFILE
 1

	)

331 #ifdef 
_GNU_SOURCE


332 
	#__USE_GNU
 1

	)

335 #i‡
deföed
 
_REENTRANT
 || deföed 
_THREAD_SAFE


336 
	#__USE_REENTRANT
 1

	)

339 #i‡
deföed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0 \

340 && 
__GNUC_PREREQ
 (4, 1Ë&& 
deföed
 
	g__OPTIMIZE__
 && __OPTIMIZE__ > 0

341 #i‡
_FORTIFY_SOURCE
 > 1

342 
	#__USE_FORTIFY_LEVEL
 2

	)

344 
	#__USE_FORTIFY_LEVEL
 1

	)

347 
	#__USE_FORTIFY_LEVEL
 0

	)

352 
	~<°dc-¥edef.h
>

360 #unde‡
__GNU_LIBRARY__


361 
	#__GNU_LIBRARY__
 6

	)

365 
	#__GLIBC__
 2

	)

366 
	#__GLIBC_MINOR__
 19

	)

368 
	#__GLIBC_PREREQ
(
maj
, 
mö
) \

369 ((
__GLIBC__
 << 16Ë+ 
__GLIBC_MINOR__
 >((
maj
Ë<< 16Ë+ (
mö
))

	)

372 #i‚de‡
__ASSEMBLER__


373 #i‚de‡
_SYS_CDEFS_H


374 
	~<sys/cdefs.h
>

379 #i‡
deföed
 
__USE_FILE_OFFSET64
 && !deföed 
__REDIRECT


380 
	#__USE_LARGEFILE
 1

	)

381 
	#__USE_LARGEFILE64
 1

	)

387 #i‡
__GNUC_PREREQ
 (2, 7Ë&& 
deföed
 
__OPTIMIZE__
 \

388 && !
deföed
 
	g__OPTIMIZE_SIZE__
 && !deföed 
	g__NO_INLINE__
 \

389 && 
deföed
 
	g__exã∫_ölöe


390 
	#__USE_EXTERN_INLINES
 1

	)

398 
	~<gnu/°ubs.h
>

	@/usr/include/linux/ioctl.h

1 #i‚de‡
_LINUX_IOCTL_H


2 
	#_LINUX_IOCTL_H


	)

4 
	~<asm/io˘l.h
>

	@/usr/include/linux/limits.h

1 #i‚de‡
_LINUX_LIMITS_H


2 
	#_LINUX_LIMITS_H


	)

4 
	#NR_OPEN
 1024

	)

6 
	#NGROUPS_MAX
 65536

	)

7 
	#ARG_MAX
 131072

	)

8 
	#LINK_MAX
 127

	)

9 
	#MAX_CANON
 255

	)

10 
	#MAX_INPUT
 255

	)

11 
	#NAME_MAX
 255

	)

12 
	#PATH_MAX
 4096

	)

13 
	#PIPE_BUF
 4096

	)

14 
	#XATTR_NAME_MAX
 255

	)

15 
	#XATTR_SIZE_MAX
 65536

	)

16 
	#XATTR_LIST_MAX
 65536

	)

18 
	#RTSIG_MAX
 32

	)

	@/usr/include/linux/pci_regs.h

22 #i‚de‡
LINUX_PCI_REGS_H


23 
	#LINUX_PCI_REGS_H


	)

29 
	#PCI_STD_HEADER_SIZEOF
 64

	)

30 
	#PCI_VENDOR_ID
 0x00

	)

31 
	#PCI_DEVICE_ID
 0x02

	)

32 
	#PCI_COMMAND
 0x04

	)

33 
	#PCI_COMMAND_IO
 0x1

	)

34 
	#PCI_COMMAND_MEMORY
 0x2

	)

35 
	#PCI_COMMAND_MASTER
 0x4

	)

36 
	#PCI_COMMAND_SPECIAL
 0x8

	)

37 
	#PCI_COMMAND_INVALIDATE
 0x10

	)

38 
	#PCI_COMMAND_VGA_PALETTE
 0x20

	)

39 
	#PCI_COMMAND_PARITY
 0x40

	)

40 
	#PCI_COMMAND_WAIT
 0x80

	)

41 
	#PCI_COMMAND_SERR
 0x100

	)

42 
	#PCI_COMMAND_FAST_BACK
 0x200

	)

43 
	#PCI_COMMAND_INTX_DISABLE
 0x400

	)

45 
	#PCI_STATUS
 0x06

	)

46 
	#PCI_STATUS_INTERRUPT
 0x08

	)

47 
	#PCI_STATUS_CAP_LIST
 0x10

	)

48 
	#PCI_STATUS_66MHZ
 0x20

	)

49 
	#PCI_STATUS_UDF
 0x40

	)

50 
	#PCI_STATUS_FAST_BACK
 0x80

	)

51 
	#PCI_STATUS_PARITY
 0x100

	)

52 
	#PCI_STATUS_DEVSEL_MASK
 0x600

	)

53 
	#PCI_STATUS_DEVSEL_FAST
 0x000

	)

54 
	#PCI_STATUS_DEVSEL_MEDIUM
 0x200

	)

55 
	#PCI_STATUS_DEVSEL_SLOW
 0x400

	)

56 
	#PCI_STATUS_SIG_TARGET_ABORT
 0x800

	)

57 
	#PCI_STATUS_REC_TARGET_ABORT
 0x1000

	)

58 
	#PCI_STATUS_REC_MASTER_ABORT
 0x2000

	)

59 
	#PCI_STATUS_SIG_SYSTEM_ERROR
 0x4000

	)

60 
	#PCI_STATUS_DETECTED_PARITY
 0x8000

	)

62 
	#PCI_CLASS_REVISION
 0x08

	)

63 
	#PCI_REVISION_ID
 0x08

	)

64 
	#PCI_CLASS_PROG
 0x09

	)

65 
	#PCI_CLASS_DEVICE
 0x0®

	)

67 
	#PCI_CACHE_LINE_SIZE
 0x0¯

	)

68 
	#PCI_LATENCY_TIMER
 0x0d

	)

69 
	#PCI_HEADER_TYPE
 0x0ê

	)

70 
	#PCI_HEADER_TYPE_NORMAL
 0

	)

71 
	#PCI_HEADER_TYPE_BRIDGE
 1

	)

72 
	#PCI_HEADER_TYPE_CARDBUS
 2

	)

74 
	#PCI_BIST
 0x0‡

	)

75 
	#PCI_BIST_CODE_MASK
 0x0‡

	)

76 
	#PCI_BIST_START
 0x40

	)

77 
	#PCI_BIST_CAPABLE
 0x80

	)

85 
	#PCI_BASE_ADDRESS_0
 0x10

	)

86 
	#PCI_BASE_ADDRESS_1
 0x14

	)

87 
	#PCI_BASE_ADDRESS_2
 0x18

	)

88 
	#PCI_BASE_ADDRESS_3
 0x1¯

	)

89 
	#PCI_BASE_ADDRESS_4
 0x20

	)

90 
	#PCI_BASE_ADDRESS_5
 0x24

	)

91 
	#PCI_BASE_ADDRESS_SPACE
 0x01

	)

92 
	#PCI_BASE_ADDRESS_SPACE_IO
 0x01

	)

93 
	#PCI_BASE_ADDRESS_SPACE_MEMORY
 0x00

	)

94 
	#PCI_BASE_ADDRESS_MEM_TYPE_MASK
 0x06

	)

95 
	#PCI_BASE_ADDRESS_MEM_TYPE_32
 0x00

	)

96 
	#PCI_BASE_ADDRESS_MEM_TYPE_1M
 0x02

	)

97 
	#PCI_BASE_ADDRESS_MEM_TYPE_64
 0x04

	)

98 
	#PCI_BASE_ADDRESS_MEM_PREFETCH
 0x08

	)

99 
	#PCI_BASE_ADDRESS_MEM_MASK
 (~0x0fUL)

	)

100 
	#PCI_BASE_ADDRESS_IO_MASK
 (~0x03UL)

	)

104 
	#PCI_CARDBUS_CIS
 0x28

	)

105 
	#PCI_SUBSYSTEM_VENDOR_ID
 0x2c

	)

106 
	#PCI_SUBSYSTEM_ID
 0x2e

	)

107 
	#PCI_ROM_ADDRESS
 0x30

	)

108 
	#PCI_ROM_ADDRESS_ENABLE
 0x01

	)

109 
	#PCI_ROM_ADDRESS_MASK
 (~0x7ffUL)

	)

111 
	#PCI_CAPABILITY_LIST
 0x34

	)

114 
	#PCI_INTERRUPT_LINE
 0x3¯

	)

115 
	#PCI_INTERRUPT_PIN
 0x3d

	)

116 
	#PCI_MIN_GNT
 0x3ê

	)

117 
	#PCI_MAX_LAT
 0x3‡

	)

120 
	#PCI_PRIMARY_BUS
 0x18

	)

121 
	#PCI_SECONDARY_BUS
 0x19

	)

122 
	#PCI_SUBORDINATE_BUS
 0x1®

	)

123 
	#PCI_SEC_LATENCY_TIMER
 0x1b

	)

124 
	#PCI_IO_BASE
 0x1¯

	)

125 
	#PCI_IO_LIMIT
 0x1d

	)

126 
	#PCI_IO_RANGE_TYPE_MASK
 0x0fUL

	)

127 
	#PCI_IO_RANGE_TYPE_16
 0x00

	)

128 
	#PCI_IO_RANGE_TYPE_32
 0x01

	)

129 
	#PCI_IO_RANGE_MASK
 (~0x0fULË

	)

130 
	#PCI_IO_1K_RANGE_MASK
 (~0x03ULË

	)

131 
	#PCI_SEC_STATUS
 0x1ê

	)

132 
	#PCI_MEMORY_BASE
 0x20

	)

133 
	#PCI_MEMORY_LIMIT
 0x22

	)

134 
	#PCI_MEMORY_RANGE_TYPE_MASK
 0x0fUL

	)

135 
	#PCI_MEMORY_RANGE_MASK
 (~0x0fUL)

	)

136 
	#PCI_PREF_MEMORY_BASE
 0x24

	)

137 
	#PCI_PREF_MEMORY_LIMIT
 0x26

	)

138 
	#PCI_PREF_RANGE_TYPE_MASK
 0x0fUL

	)

139 
	#PCI_PREF_RANGE_TYPE_32
 0x00

	)

140 
	#PCI_PREF_RANGE_TYPE_64
 0x01

	)

141 
	#PCI_PREF_RANGE_MASK
 (~0x0fUL)

	)

142 
	#PCI_PREF_BASE_UPPER32
 0x28

	)

143 
	#PCI_PREF_LIMIT_UPPER32
 0x2c

	)

144 
	#PCI_IO_BASE_UPPER16
 0x30

	)

145 
	#PCI_IO_LIMIT_UPPER16
 0x32

	)

148 
	#PCI_ROM_ADDRESS1
 0x38

	)

150 
	#PCI_BRIDGE_CONTROL
 0x3e

	)

151 
	#PCI_BRIDGE_CTL_PARITY
 0x01

	)

152 
	#PCI_BRIDGE_CTL_SERR
 0x02

	)

153 
	#PCI_BRIDGE_CTL_ISA
 0x04

	)

154 
	#PCI_BRIDGE_CTL_VGA
 0x08

	)

155 
	#PCI_BRIDGE_CTL_MASTER_ABORT
 0x20

	)

156 
	#PCI_BRIDGE_CTL_BUS_RESET
 0x40

	)

157 
	#PCI_BRIDGE_CTL_FAST_BACK
 0x80

	)

160 
	#PCI_CB_CAPABILITY_LIST
 0x14

	)

162 
	#PCI_CB_SEC_STATUS
 0x16

	)

163 
	#PCI_CB_PRIMARY_BUS
 0x18

	)

164 
	#PCI_CB_CARD_BUS
 0x19

	)

165 
	#PCI_CB_SUBORDINATE_BUS
 0x1®

	)

166 
	#PCI_CB_LATENCY_TIMER
 0x1b

	)

167 
	#PCI_CB_MEMORY_BASE_0
 0x1c

	)

168 
	#PCI_CB_MEMORY_LIMIT_0
 0x20

	)

169 
	#PCI_CB_MEMORY_BASE_1
 0x24

	)

170 
	#PCI_CB_MEMORY_LIMIT_1
 0x28

	)

171 
	#PCI_CB_IO_BASE_0
 0x2c

	)

172 
	#PCI_CB_IO_BASE_0_HI
 0x2e

	)

173 
	#PCI_CB_IO_LIMIT_0
 0x30

	)

174 
	#PCI_CB_IO_LIMIT_0_HI
 0x32

	)

175 
	#PCI_CB_IO_BASE_1
 0x34

	)

176 
	#PCI_CB_IO_BASE_1_HI
 0x36

	)

177 
	#PCI_CB_IO_LIMIT_1
 0x38

	)

178 
	#PCI_CB_IO_LIMIT_1_HI
 0x3a

	)

179 
	#PCI_CB_IO_RANGE_MASK
 (~0x03UL)

	)

181 
	#PCI_CB_BRIDGE_CONTROL
 0x3e

	)

182 
	#PCI_CB_BRIDGE_CTL_PARITY
 0x01

	)

183 
	#PCI_CB_BRIDGE_CTL_SERR
 0x02

	)

184 
	#PCI_CB_BRIDGE_CTL_ISA
 0x04

	)

185 
	#PCI_CB_BRIDGE_CTL_VGA
 0x08

	)

186 
	#PCI_CB_BRIDGE_CTL_MASTER_ABORT
 0x20

	)

187 
	#PCI_CB_BRIDGE_CTL_CB_RESET
 0x40

	)

188 
	#PCI_CB_BRIDGE_CTL_16BIT_INT
 0x80

	)

189 
	#PCI_CB_BRIDGE_CTL_PREFETCH_MEM0
 0x100

	)

190 
	#PCI_CB_BRIDGE_CTL_PREFETCH_MEM1
 0x200

	)

191 
	#PCI_CB_BRIDGE_CTL_POST_WRITES
 0x400

	)

192 
	#PCI_CB_SUBSYSTEM_VENDOR_ID
 0x40

	)

193 
	#PCI_CB_SUBSYSTEM_ID
 0x42

	)

194 
	#PCI_CB_LEGACY_MODE_BASE
 0x44

	)

199 
	#PCI_CAP_LIST_ID
 0

	)

200 
	#PCI_CAP_ID_PM
 0x01

	)

201 
	#PCI_CAP_ID_AGP
 0x02

	)

202 
	#PCI_CAP_ID_VPD
 0x03

	)

203 
	#PCI_CAP_ID_SLOTID
 0x04

	)

204 
	#PCI_CAP_ID_MSI
 0x05

	)

205 
	#PCI_CAP_ID_CHSWP
 0x06

	)

206 
	#PCI_CAP_ID_PCIX
 0x07

	)

207 
	#PCI_CAP_ID_HT
 0x08

	)

208 
	#PCI_CAP_ID_VNDR
 0x09

	)

209 
	#PCI_CAP_ID_DBG
 0x0A

	)

210 
	#PCI_CAP_ID_CCRC
 0x0B

	)

211 
	#PCI_CAP_ID_SHPC
 0x0C

	)

212 
	#PCI_CAP_ID_SSVID
 0x0D

	)

213 
	#PCI_CAP_ID_AGP3
 0x0E

	)

214 
	#PCI_CAP_ID_SECDEV
 0x0F

	)

215 
	#PCI_CAP_ID_EXP
 0x10

	)

216 
	#PCI_CAP_ID_MSIX
 0x11

	)

217 
	#PCI_CAP_ID_SATA
 0x12

	)

218 
	#PCI_CAP_ID_AF
 0x13

	)

219 
	#PCI_CAP_ID_MAX
 
PCI_CAP_ID_AF


	)

220 
	#PCI_CAP_LIST_NEXT
 1

	)

221 
	#PCI_CAP_FLAGS
 2

	)

222 
	#PCI_CAP_SIZEOF
 4

	)

226 
	#PCI_PM_PMC
 2

	)

227 
	#PCI_PM_CAP_VER_MASK
 0x0007

	)

228 
	#PCI_PM_CAP_PME_CLOCK
 0x0008

	)

229 
	#PCI_PM_CAP_RESERVED
 0x0010

	)

230 
	#PCI_PM_CAP_DSI
 0x0020

	)

231 
	#PCI_PM_CAP_AUX_POWER
 0x01C0

	)

232 
	#PCI_PM_CAP_D1
 0x0200

	)

233 
	#PCI_PM_CAP_D2
 0x0400

	)

234 
	#PCI_PM_CAP_PME
 0x0800

	)

235 
	#PCI_PM_CAP_PME_MASK
 0xF800

	)

236 
	#PCI_PM_CAP_PME_D0
 0x0800

	)

237 
	#PCI_PM_CAP_PME_D1
 0x1000

	)

238 
	#PCI_PM_CAP_PME_D2
 0x2000

	)

239 
	#PCI_PM_CAP_PME_D3
 0x4000

	)

240 
	#PCI_PM_CAP_PME_D3cﬁd
 0x8000

	)

241 
	#PCI_PM_CAP_PME_SHIFT
 11

	)

242 
	#PCI_PM_CTRL
 4

	)

243 
	#PCI_PM_CTRL_STATE_MASK
 0x0003

	)

244 
	#PCI_PM_CTRL_NO_SOFT_RESET
 0x0008

	)

245 
	#PCI_PM_CTRL_PME_ENABLE
 0x0100

	)

246 
	#PCI_PM_CTRL_DATA_SEL_MASK
 0x1e00

	)

247 
	#PCI_PM_CTRL_DATA_SCALE_MASK
 0x6000

	)

248 
	#PCI_PM_CTRL_PME_STATUS
 0x8000

	)

249 
	#PCI_PM_PPB_EXTENSIONS
 6

	)

250 
	#PCI_PM_PPB_B2_B3
 0x40

	)

251 
	#PCI_PM_BPCC_ENABLE
 0x80

	)

252 
	#PCI_PM_DATA_REGISTER
 7

	)

253 
	#PCI_PM_SIZEOF
 8

	)

257 
	#PCI_AGP_VERSION
 2

	)

258 
	#PCI_AGP_RFU
 3

	)

259 
	#PCI_AGP_STATUS
 4

	)

260 
	#PCI_AGP_STATUS_RQ_MASK
 0xff000000

	)

261 
	#PCI_AGP_STATUS_SBA
 0x0200

	)

262 
	#PCI_AGP_STATUS_64BIT
 0x0020

	)

263 
	#PCI_AGP_STATUS_FW
 0x0010

	)

264 
	#PCI_AGP_STATUS_RATE4
 0x0004

	)

265 
	#PCI_AGP_STATUS_RATE2
 0x0002

	)

266 
	#PCI_AGP_STATUS_RATE1
 0x0001

	)

267 
	#PCI_AGP_COMMAND
 8

	)

268 
	#PCI_AGP_COMMAND_RQ_MASK
 0xff000000

	)

269 
	#PCI_AGP_COMMAND_SBA
 0x0200

	)

270 
	#PCI_AGP_COMMAND_AGP
 0x0100

	)

271 
	#PCI_AGP_COMMAND_64BIT
 0x0020

	)

272 
	#PCI_AGP_COMMAND_FW
 0x0010

	)

273 
	#PCI_AGP_COMMAND_RATE4
 0x0004

	)

274 
	#PCI_AGP_COMMAND_RATE2
 0x0002

	)

275 
	#PCI_AGP_COMMAND_RATE1
 0x0001

	)

276 
	#PCI_AGP_SIZEOF
 12

	)

280 
	#PCI_VPD_ADDR
 2

	)

281 
	#PCI_VPD_ADDR_MASK
 0x7ff‡

	)

282 
	#PCI_VPD_ADDR_F
 0x8000

	)

283 
	#PCI_VPD_DATA
 4

	)

284 
	#PCI_CAP_VPD_SIZEOF
 8

	)

288 
	#PCI_SID_ESR
 2

	)

289 
	#PCI_SID_ESR_NSLOTS
 0x1‡

	)

290 
	#PCI_SID_ESR_FIC
 0x20

	)

291 
	#PCI_SID_CHASSIS_NR
 3

	)

295 
	#PCI_MSI_FLAGS
 2

	)

296 
	#PCI_MSI_FLAGS_ENABLE
 0x0001

	)

297 
	#PCI_MSI_FLAGS_QMASK
 0x000ê

	)

298 
	#PCI_MSI_FLAGS_QSIZE
 0x0070

	)

299 
	#PCI_MSI_FLAGS_64BIT
 0x0080

	)

300 
	#PCI_MSI_FLAGS_MASKBIT
 0x0100

	)

301 
	#PCI_MSI_RFU
 3

	)

302 
	#PCI_MSI_ADDRESS_LO
 4

	)

303 
	#PCI_MSI_ADDRESS_HI
 8

	)

304 
	#PCI_MSI_DATA_32
 8

	)

305 
	#PCI_MSI_MASK_32
 12

	)

306 
	#PCI_MSI_PENDING_32
 16

	)

307 
	#PCI_MSI_DATA_64
 12

	)

308 
	#PCI_MSI_MASK_64
 16

	)

309 
	#PCI_MSI_PENDING_64
 20

	)

312 
	#PCI_MSIX_FLAGS
 2

	)

313 
	#PCI_MSIX_FLAGS_QSIZE
 0x07FF

	)

314 
	#PCI_MSIX_FLAGS_MASKALL
 0x4000

	)

315 
	#PCI_MSIX_FLAGS_ENABLE
 0x8000

	)

316 
	#PCI_MSIX_TABLE
 4

	)

317 
	#PCI_MSIX_TABLE_BIR
 0x00000007

	)

318 
	#PCI_MSIX_TABLE_OFFSET
 0xfffffff8

	)

319 
	#PCI_MSIX_PBA
 8

	)

320 
	#PCI_MSIX_PBA_BIR
 0x00000007

	)

321 
	#PCI_MSIX_PBA_OFFSET
 0xfffffff8

	)

322 
	#PCI_MSIX_FLAGS_BIRMASK
 
PCI_MSIX_PBA_BIR


	)

323 
	#PCI_CAP_MSIX_SIZEOF
 12

	)

326 
	#PCI_MSIX_ENTRY_SIZE
 16

	)

327 
	#PCI_MSIX_ENTRY_LOWER_ADDR
 0

	)

328 
	#PCI_MSIX_ENTRY_UPPER_ADDR
 4

	)

329 
	#PCI_MSIX_ENTRY_DATA
 8

	)

330 
	#PCI_MSIX_ENTRY_VECTOR_CTRL
 12

	)

331 
	#PCI_MSIX_ENTRY_CTRL_MASKBIT
 1

	)

335 
	#PCI_CHSWP_CSR
 2

	)

336 
	#PCI_CHSWP_DHA
 0x01

	)

337 
	#PCI_CHSWP_EIM
 0x02

	)

338 
	#PCI_CHSWP_PIE
 0x04

	)

339 
	#PCI_CHSWP_LOO
 0x08

	)

340 
	#PCI_CHSWP_PI
 0x30

	)

341 
	#PCI_CHSWP_EXT
 0x40

	)

342 
	#PCI_CHSWP_INS
 0x80

	)

346 
	#PCI_AF_LENGTH
 2

	)

347 
	#PCI_AF_CAP
 3

	)

348 
	#PCI_AF_CAP_TP
 0x01

	)

349 
	#PCI_AF_CAP_FLR
 0x02

	)

350 
	#PCI_AF_CTRL
 4

	)

351 
	#PCI_AF_CTRL_FLR
 0x01

	)

352 
	#PCI_AF_STATUS
 5

	)

353 
	#PCI_AF_STATUS_TP
 0x01

	)

354 
	#PCI_CAP_AF_SIZEOF
 6

	)

358 
	#PCI_X_CMD
 2

	)

359 
	#PCI_X_CMD_DPERR_E
 0x0001

	)

360 
	#PCI_X_CMD_ERO
 0x0002

	)

361 
	#PCI_X_CMD_READ_512
 0x0000

	)

362 
	#PCI_X_CMD_READ_1K
 0x0004

	)

363 
	#PCI_X_CMD_READ_2K
 0x0008

	)

364 
	#PCI_X_CMD_READ_4K
 0x000¯

	)

365 
	#PCI_X_CMD_MAX_READ
 0x000¯

	)

367 
	#PCI_X_CMD_SPLIT_1
 0x0000

	)

368 
	#PCI_X_CMD_SPLIT_2
 0x0010

	)

369 
	#PCI_X_CMD_SPLIT_3
 0x0020

	)

370 
	#PCI_X_CMD_SPLIT_4
 0x0030

	)

371 
	#PCI_X_CMD_SPLIT_8
 0x0040

	)

372 
	#PCI_X_CMD_SPLIT_12
 0x0050

	)

373 
	#PCI_X_CMD_SPLIT_16
 0x0060

	)

374 
	#PCI_X_CMD_SPLIT_32
 0x0070

	)

375 
	#PCI_X_CMD_MAX_SPLIT
 0x0070

	)

376 
	#PCI_X_CMD_VERSION
(
x
Ë(((xË>> 12Ë& 3Ë

	)

377 
	#PCI_X_STATUS
 4

	)

378 
	#PCI_X_STATUS_DEVFN
 0x000000f‡

	)

379 
	#PCI_X_STATUS_BUS
 0x0000ff00

	)

380 
	#PCI_X_STATUS_64BIT
 0x00010000

	)

381 
	#PCI_X_STATUS_133MHZ
 0x00020000

	)

382 
	#PCI_X_STATUS_SPL_DISC
 0x00040000

	)

383 
	#PCI_X_STATUS_UNX_SPL
 0x00080000

	)

384 
	#PCI_X_STATUS_COMPLEX
 0x00100000

	)

385 
	#PCI_X_STATUS_MAX_READ
 0x00600000

	)

386 
	#PCI_X_STATUS_MAX_SPLIT
 0x03800000

	)

387 
	#PCI_X_STATUS_MAX_CUM
 0x1c000000

	)

388 
	#PCI_X_STATUS_SPL_ERR
 0x20000000

	)

389 
	#PCI_X_STATUS_266MHZ
 0x40000000

	)

390 
	#PCI_X_STATUS_533MHZ
 0x80000000

	)

391 
	#PCI_X_ECC_CSR
 8

	)

392 
	#PCI_CAP_PCIX_SIZEOF_V0
 8

	)

393 
	#PCI_CAP_PCIX_SIZEOF_V1
 24

	)

394 
	#PCI_CAP_PCIX_SIZEOF_V2
 
PCI_CAP_PCIX_SIZEOF_V1


	)

398 
	#PCI_X_BRIDGE_SSTATUS
 2

	)

399 
	#PCI_X_SSTATUS_64BIT
 0x0001

	)

400 
	#PCI_X_SSTATUS_133MHZ
 0x0002

	)

401 
	#PCI_X_SSTATUS_FREQ
 0x03c0

	)

402 
	#PCI_X_SSTATUS_VERS
 0x3000

	)

403 
	#PCI_X_SSTATUS_V1
 0x1000

	)

404 
	#PCI_X_SSTATUS_V2
 0x2000

	)

405 
	#PCI_X_SSTATUS_266MHZ
 0x4000

	)

406 
	#PCI_X_SSTATUS_533MHZ
 0x8000

	)

407 
	#PCI_X_BRIDGE_STATUS
 4

	)

411 
	#PCI_SSVID_VENDOR_ID
 4

	)

412 
	#PCI_SSVID_DEVICE_ID
 6

	)

416 
	#PCI_EXP_FLAGS
 2

	)

417 
	#PCI_EXP_FLAGS_VERS
 0x000‡

	)

418 
	#PCI_EXP_FLAGS_TYPE
 0x00f0

	)

419 
	#PCI_EXP_TYPE_ENDPOINT
 0x0

	)

420 
	#PCI_EXP_TYPE_LEG_END
 0x1

	)

421 
	#PCI_EXP_TYPE_ROOT_PORT
 0x4

	)

422 
	#PCI_EXP_TYPE_UPSTREAM
 0x5

	)

423 
	#PCI_EXP_TYPE_DOWNSTREAM
 0x6

	)

424 
	#PCI_EXP_TYPE_PCI_BRIDGE
 0x7

	)

425 
	#PCI_EXP_TYPE_PCIE_BRIDGE
 0x8

	)

426 
	#PCI_EXP_TYPE_RC_END
 0x9

	)

427 
	#PCI_EXP_TYPE_RC_EC
 0x®

	)

428 
	#PCI_EXP_FLAGS_SLOT
 0x0100

	)

429 
	#PCI_EXP_FLAGS_IRQ
 0x3e00

	)

430 
	#PCI_EXP_DEVCAP
 4

	)

431 
	#PCI_EXP_DEVCAP_PAYLOAD
 0x00000007

	)

432 
	#PCI_EXP_DEVCAP_PHANTOM
 0x00000018

	)

433 
	#PCI_EXP_DEVCAP_EXT_TAG
 0x00000020

	)

434 
	#PCI_EXP_DEVCAP_L0S
 0x000001c0

	)

435 
	#PCI_EXP_DEVCAP_L1
 0x00000e00

	)

436 
	#PCI_EXP_DEVCAP_ATN_BUT
 0x00001000

	)

437 
	#PCI_EXP_DEVCAP_ATN_IND
 0x00002000

	)

438 
	#PCI_EXP_DEVCAP_PWR_IND
 0x00004000

	)

439 
	#PCI_EXP_DEVCAP_RBER
 0x00008000

	)

440 
	#PCI_EXP_DEVCAP_PWR_VAL
 0x03fc0000

	)

441 
	#PCI_EXP_DEVCAP_PWR_SCL
 0x0c000000

	)

442 
	#PCI_EXP_DEVCAP_FLR
 0x10000000

	)

443 
	#PCI_EXP_DEVCTL
 8

	)

444 
	#PCI_EXP_DEVCTL_CERE
 0x0001

	)

445 
	#PCI_EXP_DEVCTL_NFERE
 0x0002

	)

446 
	#PCI_EXP_DEVCTL_FERE
 0x0004

	)

447 
	#PCI_EXP_DEVCTL_URRE
 0x0008

	)

448 
	#PCI_EXP_DEVCTL_RELAX_EN
 0x0010

	)

449 
	#PCI_EXP_DEVCTL_PAYLOAD
 0x00e0

	)

450 
	#PCI_EXP_DEVCTL_EXT_TAG
 0x0100

	)

451 
	#PCI_EXP_DEVCTL_PHANTOM
 0x0200

	)

452 
	#PCI_EXP_DEVCTL_AUX_PME
 0x0400

	)

453 
	#PCI_EXP_DEVCTL_NOSNOOP_EN
 0x0800

	)

454 
	#PCI_EXP_DEVCTL_READRQ
 0x7000

	)

455 
	#PCI_EXP_DEVCTL_BCR_FLR
 0x8000

	)

456 
	#PCI_EXP_DEVSTA
 10

	)

457 
	#PCI_EXP_DEVSTA_CED
 0x0001

	)

458 
	#PCI_EXP_DEVSTA_NFED
 0x0002

	)

459 
	#PCI_EXP_DEVSTA_FED
 0x0004

	)

460 
	#PCI_EXP_DEVSTA_URD
 0x0008

	)

461 
	#PCI_EXP_DEVSTA_AUXPD
 0x0010

	)

462 
	#PCI_EXP_DEVSTA_TRPND
 0x0020

	)

463 
	#PCI_EXP_LNKCAP
 12

	)

464 
	#PCI_EXP_LNKCAP_SLS
 0x0000000‡

	)

465 
	#PCI_EXP_LNKCAP_SLS_2_5GB
 0x00000001

	)

466 
	#PCI_EXP_LNKCAP_SLS_5_0GB
 0x00000002

	)

467 
	#PCI_EXP_LNKCAP_MLW
 0x000003f0

	)

468 
	#PCI_EXP_LNKCAP_ASPMS
 0x00000c00

	)

469 
	#PCI_EXP_LNKCAP_L0SEL
 0x00007000

	)

470 
	#PCI_EXP_LNKCAP_L1EL
 0x00038000

	)

471 
	#PCI_EXP_LNKCAP_CLKPM
 0x00040000

	)

472 
	#PCI_EXP_LNKCAP_SDERC
 0x00080000

	)

473 
	#PCI_EXP_LNKCAP_DLLLARC
 0x00100000

	)

474 
	#PCI_EXP_LNKCAP_LBNC
 0x00200000

	)

475 
	#PCI_EXP_LNKCAP_PN
 0xff000000

	)

476 
	#PCI_EXP_LNKCTL
 16

	)

477 
	#PCI_EXP_LNKCTL_ASPMC
 0x0003

	)

478 
	#PCI_EXP_LNKCTL_ASPM_L0S
 0x0001

	)

479 
	#PCI_EXP_LNKCTL_ASPM_L1
 0x0002

	)

480 
	#PCI_EXP_LNKCTL_RCB
 0x0008

	)

481 
	#PCI_EXP_LNKCTL_LD
 0x0010

	)

482 
	#PCI_EXP_LNKCTL_RL
 0x0020

	)

483 
	#PCI_EXP_LNKCTL_CCC
 0x0040

	)

484 
	#PCI_EXP_LNKCTL_ES
 0x0080

	)

485 
	#PCI_EXP_LNKCTL_CLKREQ_EN
 0x0100

	)

486 
	#PCI_EXP_LNKCTL_HAWD
 0x0200

	)

487 
	#PCI_EXP_LNKCTL_LBMIE
 0x0400

	)

488 
	#PCI_EXP_LNKCTL_LABIE
 0x0800

	)

489 
	#PCI_EXP_LNKSTA
 18

	)

490 
	#PCI_EXP_LNKSTA_CLS
 0x000‡

	)

491 
	#PCI_EXP_LNKSTA_CLS_2_5GB
 0x0001

	)

492 
	#PCI_EXP_LNKSTA_CLS_5_0GB
 0x0002

	)

493 
	#PCI_EXP_LNKSTA_CLS_8_0GB
 0x0003

	)

494 
	#PCI_EXP_LNKSTA_NLW
 0x03f0

	)

495 
	#PCI_EXP_LNKSTA_NLW_X1
 0x0010

	)

496 
	#PCI_EXP_LNKSTA_NLW_X2
 0x0020

	)

497 
	#PCI_EXP_LNKSTA_NLW_X4
 0x0040

	)

498 
	#PCI_EXP_LNKSTA_NLW_X8
 0x0080

	)

499 
	#PCI_EXP_LNKSTA_NLW_SHIFT
 4

	)

500 
	#PCI_EXP_LNKSTA_LT
 0x0800

	)

501 
	#PCI_EXP_LNKSTA_SLC
 0x1000

	)

502 
	#PCI_EXP_LNKSTA_DLLLA
 0x2000

	)

503 
	#PCI_EXP_LNKSTA_LBMS
 0x4000

	)

504 
	#PCI_EXP_LNKSTA_LABS
 0x8000

	)

505 
	#PCI_CAP_EXP_ENDPOINT_SIZEOF_V1
 20

	)

506 
	#PCI_EXP_SLTCAP
 20

	)

507 
	#PCI_EXP_SLTCAP_ABP
 0x00000001

	)

508 
	#PCI_EXP_SLTCAP_PCP
 0x00000002

	)

509 
	#PCI_EXP_SLTCAP_MRLSP
 0x00000004

	)

510 
	#PCI_EXP_SLTCAP_AIP
 0x00000008

	)

511 
	#PCI_EXP_SLTCAP_PIP
 0x00000010

	)

512 
	#PCI_EXP_SLTCAP_HPS
 0x00000020

	)

513 
	#PCI_EXP_SLTCAP_HPC
 0x00000040

	)

514 
	#PCI_EXP_SLTCAP_SPLV
 0x00007f80

	)

515 
	#PCI_EXP_SLTCAP_SPLS
 0x00018000

	)

516 
	#PCI_EXP_SLTCAP_EIP
 0x00020000

	)

517 
	#PCI_EXP_SLTCAP_NCCS
 0x00040000

	)

518 
	#PCI_EXP_SLTCAP_PSN
 0xfff80000

	)

519 
	#PCI_EXP_SLTCTL
 24

	)

520 
	#PCI_EXP_SLTCTL_ABPE
 0x0001

	)

521 
	#PCI_EXP_SLTCTL_PFDE
 0x0002

	)

522 
	#PCI_EXP_SLTCTL_MRLSCE
 0x0004

	)

523 
	#PCI_EXP_SLTCTL_PDCE
 0x0008

	)

524 
	#PCI_EXP_SLTCTL_CCIE
 0x0010

	)

525 
	#PCI_EXP_SLTCTL_HPIE
 0x0020

	)

526 
	#PCI_EXP_SLTCTL_AIC
 0x00c0

	)

527 
	#PCI_EXP_SLTCTL_PIC
 0x0300

	)

528 
	#PCI_EXP_SLTCTL_PCC
 0x0400

	)

529 
	#PCI_EXP_SLTCTL_EIC
 0x0800

	)

530 
	#PCI_EXP_SLTCTL_DLLSCE
 0x1000

	)

531 
	#PCI_EXP_SLTSTA
 26

	)

532 
	#PCI_EXP_SLTSTA_ABP
 0x0001

	)

533 
	#PCI_EXP_SLTSTA_PFD
 0x0002

	)

534 
	#PCI_EXP_SLTSTA_MRLSC
 0x0004

	)

535 
	#PCI_EXP_SLTSTA_PDC
 0x0008

	)

536 
	#PCI_EXP_SLTSTA_CC
 0x0010

	)

537 
	#PCI_EXP_SLTSTA_MRLSS
 0x0020

	)

538 
	#PCI_EXP_SLTSTA_PDS
 0x0040

	)

539 
	#PCI_EXP_SLTSTA_EIS
 0x0080

	)

540 
	#PCI_EXP_SLTSTA_DLLSC
 0x0100

	)

541 
	#PCI_EXP_RTCTL
 28

	)

542 
	#PCI_EXP_RTCTL_SECEE
 0x0001

	)

543 
	#PCI_EXP_RTCTL_SENFEE
 0x0002

	)

544 
	#PCI_EXP_RTCTL_SEFEE
 0x0004

	)

545 
	#PCI_EXP_RTCTL_PMEIE
 0x0008

	)

546 
	#PCI_EXP_RTCTL_CRSSVE
 0x0010

	)

547 
	#PCI_EXP_RTCAP
 30

	)

548 
	#PCI_EXP_RTSTA
 32

	)

549 
	#PCI_EXP_RTSTA_PME
 0x00010000

	)

550 
	#PCI_EXP_RTSTA_PENDING
 0x00020000

	)

559 
	#PCI_EXP_DEVCAP2
 36

	)

560 
	#PCI_EXP_DEVCAP2_ARI
 0x00000020

	)

561 
	#PCI_EXP_DEVCAP2_LTR
 0x00000800

	)

562 
	#PCI_EXP_DEVCAP2_OBFF_MASK
 0x000c0000

	)

563 
	#PCI_EXP_DEVCAP2_OBFF_MSG
 0x00040000

	)

564 
	#PCI_EXP_DEVCAP2_OBFF_WAKE
 0x00080000

	)

565 
	#PCI_EXP_DEVCTL2
 40

	)

566 
	#PCI_EXP_DEVCTL2_COMP_TIMEOUT
 0x000‡

	)

567 
	#PCI_EXP_DEVCTL2_ARI
 0x0020

	)

568 
	#PCI_EXP_DEVCTL2_IDO_REQ_EN
 0x0100

	)

569 
	#PCI_EXP_DEVCTL2_IDO_CMP_EN
 0x0200

	)

570 
	#PCI_EXP_DEVCTL2_LTR_EN
 0x0400

	)

571 
	#PCI_EXP_DEVCTL2_OBFF_MSGA_EN
 0x2000

	)

572 
	#PCI_EXP_DEVCTL2_OBFF_MSGB_EN
 0x4000

	)

573 
	#PCI_EXP_DEVCTL2_OBFF_WAKE_EN
 0x6000

	)

574 
	#PCI_EXP_DEVSTA2
 42

	)

575 
	#PCI_CAP_EXP_ENDPOINT_SIZEOF_V2
 44

	)

576 
	#PCI_EXP_LNKCAP2
 44

	)

577 
	#PCI_EXP_LNKCAP2_SLS_2_5GB
 0x00000002

	)

578 
	#PCI_EXP_LNKCAP2_SLS_5_0GB
 0x00000004

	)

579 
	#PCI_EXP_LNKCAP2_SLS_8_0GB
 0x00000008

	)

580 
	#PCI_EXP_LNKCAP2_CROSSLINK
 0x00000100

	)

581 
	#PCI_EXP_LNKCTL2
 48

	)

582 
	#PCI_EXP_LNKSTA2
 50

	)

583 
	#PCI_EXP_SLTCAP2
 52

	)

584 
	#PCI_EXP_SLTCTL2
 56

	)

585 
	#PCI_EXP_SLTSTA2
 58

	)

588 
	#PCI_EXT_CAP_ID
(
hódî
Ë(hódî & 0x0000ffff)

	)

589 
	#PCI_EXT_CAP_VER
(
hódî
Ë((hódî >> 16Ë& 0xf)

	)

590 
	#PCI_EXT_CAP_NEXT
(
hódî
Ë((hódî >> 20Ë& 0xffc)

	)

592 
	#PCI_EXT_CAP_ID_ERR
 0x01

	)

593 
	#PCI_EXT_CAP_ID_VC
 0x02

	)

594 
	#PCI_EXT_CAP_ID_DSN
 0x03

	)

595 
	#PCI_EXT_CAP_ID_PWR
 0x04

	)

596 
	#PCI_EXT_CAP_ID_RCLD
 0x05

	)

597 
	#PCI_EXT_CAP_ID_RCILC
 0x06

	)

598 
	#PCI_EXT_CAP_ID_RCEC
 0x07

	)

599 
	#PCI_EXT_CAP_ID_MFVC
 0x08

	)

600 
	#PCI_EXT_CAP_ID_VC9
 0x09

	)

601 
	#PCI_EXT_CAP_ID_RCRB
 0x0A

	)

602 
	#PCI_EXT_CAP_ID_VNDR
 0x0B

	)

603 
	#PCI_EXT_CAP_ID_CAC
 0x0C

	)

604 
	#PCI_EXT_CAP_ID_ACS
 0x0D

	)

605 
	#PCI_EXT_CAP_ID_ARI
 0x0E

	)

606 
	#PCI_EXT_CAP_ID_ATS
 0x0F

	)

607 
	#PCI_EXT_CAP_ID_SRIOV
 0x10

	)

608 
	#PCI_EXT_CAP_ID_MRIOV
 0x11

	)

609 
	#PCI_EXT_CAP_ID_MCAST
 0x12

	)

610 
	#PCI_EXT_CAP_ID_PRI
 0x13

	)

611 
	#PCI_EXT_CAP_ID_AMD_XXX
 0x14

	)

612 
	#PCI_EXT_CAP_ID_REBAR
 0x15

	)

613 
	#PCI_EXT_CAP_ID_DPA
 0x16

	)

614 
	#PCI_EXT_CAP_ID_TPH
 0x17

	)

615 
	#PCI_EXT_CAP_ID_LTR
 0x18

	)

616 
	#PCI_EXT_CAP_ID_SECPCI
 0x19

	)

617 
	#PCI_EXT_CAP_ID_PMUX
 0x1A

	)

618 
	#PCI_EXT_CAP_ID_PASID
 0x1B

	)

619 
	#PCI_EXT_CAP_ID_MAX
 
PCI_EXT_CAP_ID_PASID


	)

621 
	#PCI_EXT_CAP_DSN_SIZEOF
 12

	)

622 
	#PCI_EXT_CAP_MCAST_ENDPOINT_SIZEOF
 40

	)

625 
	#PCI_ERR_UNCOR_STATUS
 4

	)

626 
	#PCI_ERR_UNC_TRAIN
 0x00000001

	)

627 
	#PCI_ERR_UNC_DLP
 0x00000010

	)

628 
	#PCI_ERR_UNC_SURPDN
 0x00000020

	)

629 
	#PCI_ERR_UNC_POISON_TLP
 0x00001000

	)

630 
	#PCI_ERR_UNC_FCP
 0x00002000

	)

631 
	#PCI_ERR_UNC_COMP_TIME
 0x00004000

	)

632 
	#PCI_ERR_UNC_COMP_ABORT
 0x00008000

	)

633 
	#PCI_ERR_UNC_UNX_COMP
 0x00010000

	)

634 
	#PCI_ERR_UNC_RX_OVER
 0x00020000

	)

635 
	#PCI_ERR_UNC_MALF_TLP
 0x00040000

	)

636 
	#PCI_ERR_UNC_ECRC
 0x00080000

	)

637 
	#PCI_ERR_UNC_UNSUP
 0x00100000

	)

638 
	#PCI_ERR_UNC_ACSV
 0x00200000

	)

639 
	#PCI_ERR_UNC_INTN
 0x00400000

	)

640 
	#PCI_ERR_UNC_MCBTLP
 0x00800000

	)

641 
	#PCI_ERR_UNC_ATOMEG
 0x01000000

	)

642 
	#PCI_ERR_UNC_TLPPRE
 0x02000000

	)

643 
	#PCI_ERR_UNCOR_MASK
 8

	)

645 
	#PCI_ERR_UNCOR_SEVER
 12

	)

647 
	#PCI_ERR_COR_STATUS
 16

	)

648 
	#PCI_ERR_COR_RCVR
 0x00000001

	)

649 
	#PCI_ERR_COR_BAD_TLP
 0x00000040

	)

650 
	#PCI_ERR_COR_BAD_DLLP
 0x00000080

	)

651 
	#PCI_ERR_COR_REP_ROLL
 0x00000100

	)

652 
	#PCI_ERR_COR_REP_TIMER
 0x00001000

	)

653 
	#PCI_ERR_COR_ADV_NFAT
 0x00002000

	)

654 
	#PCI_ERR_COR_INTERNAL
 0x00004000

	)

655 
	#PCI_ERR_COR_LOG_OVER
 0x00008000

	)

656 
	#PCI_ERR_COR_MASK
 20

	)

658 
	#PCI_ERR_CAP
 24

	)

659 
	#PCI_ERR_CAP_FEP
(
x
Ë((xË& 31Ë

	)

660 
	#PCI_ERR_CAP_ECRC_GENC
 0x00000020

	)

661 
	#PCI_ERR_CAP_ECRC_GENE
 0x00000040

	)

662 
	#PCI_ERR_CAP_ECRC_CHKC
 0x00000080

	)

663 
	#PCI_ERR_CAP_ECRC_CHKE
 0x00000100

	)

664 
	#PCI_ERR_HEADER_LOG
 28

	)

665 
	#PCI_ERR_ROOT_COMMAND
 44

	)

667 
	#PCI_ERR_ROOT_CMD_COR_EN
 0x00000001

	)

669 
	#PCI_ERR_ROOT_CMD_NONFATAL_EN
 0x00000002

	)

671 
	#PCI_ERR_ROOT_CMD_FATAL_EN
 0x00000004

	)

672 
	#PCI_ERR_ROOT_STATUS
 48

	)

673 
	#PCI_ERR_ROOT_COR_RCV
 0x00000001

	)

675 
	#PCI_ERR_ROOT_MULTI_COR_RCV
 0x00000002

	)

677 
	#PCI_ERR_ROOT_UNCOR_RCV
 0x00000004

	)

679 
	#PCI_ERR_ROOT_MULTI_UNCOR_RCV
 0x00000008

	)

680 
	#PCI_ERR_ROOT_FIRST_FATAL
 0x00000010

	)

681 
	#PCI_ERR_ROOT_NONFATAL_RCV
 0x00000020

	)

682 
	#PCI_ERR_ROOT_FATAL_RCV
 0x00000040

	)

683 
	#PCI_ERR_ROOT_ERR_SRC
 52

	)

686 
	#PCI_VC_PORT_REG1
 4

	)

687 
	#PCI_VC_REG1_EVCC
 0x7

	)

688 
	#PCI_VC_PORT_REG2
 8

	)

689 
	#PCI_VC_REG2_32_PHASE
 0x2

	)

690 
	#PCI_VC_REG2_64_PHASE
 0x4

	)

691 
	#PCI_VC_REG2_128_PHASE
 0x8

	)

692 
	#PCI_VC_PORT_CTRL
 12

	)

693 
	#PCI_VC_PORT_STATUS
 14

	)

694 
	#PCI_VC_RES_CAP
 16

	)

695 
	#PCI_VC_RES_CTRL
 20

	)

696 
	#PCI_VC_RES_STATUS
 26

	)

697 
	#PCI_CAP_VC_BASE_SIZEOF
 0x10

	)

698 
	#PCI_CAP_VC_PER_VC_SIZEOF
 0x0C

	)

701 
	#PCI_PWR_DSR
 4

	)

702 
	#PCI_PWR_DATA
 8

	)

703 
	#PCI_PWR_DATA_BASE
(
x
Ë((xË& 0xffË

	)

704 
	#PCI_PWR_DATA_SCALE
(
x
Ë(((xË>> 8Ë& 3Ë

	)

705 
	#PCI_PWR_DATA_PM_SUB
(
x
Ë(((xË>> 10Ë& 7Ë

	)

706 
	#PCI_PWR_DATA_PM_STATE
(
x
Ë(((xË>> 13Ë& 3Ë

	)

707 
	#PCI_PWR_DATA_TYPE
(
x
Ë(((xË>> 15Ë& 7Ë

	)

708 
	#PCI_PWR_DATA_RAIL
(
x
Ë(((xË>> 18Ë& 7Ë

	)

709 
	#PCI_PWR_CAP
 12

	)

710 
	#PCI_PWR_CAP_BUDGET
(
x
Ë((xË& 1Ë

	)

711 
	#PCI_EXT_CAP_PWR_SIZEOF
 16

	)

714 
	#PCI_VNDR_HEADER
 4

	)

715 
	#PCI_VNDR_HEADER_ID
(
x
Ë((xË& 0xffff)

	)

716 
	#PCI_VNDR_HEADER_REV
(
x
Ë(((xË>> 16Ë& 0xf)

	)

717 
	#PCI_VNDR_HEADER_LEN
(
x
Ë(((xË>> 20Ë& 0xfff)

	)

727 
	#HT_3BIT_CAP_MASK
 0xE0

	)

728 
	#HT_CAPTYPE_SLAVE
 0x00

	)

729 
	#HT_CAPTYPE_HOST
 0x20

	)

731 
	#HT_5BIT_CAP_MASK
 0xF8

	)

732 
	#HT_CAPTYPE_IRQ
 0x80

	)

733 
	#HT_CAPTYPE_REMAPPING_40
 0xA0

	)

734 
	#HT_CAPTYPE_REMAPPING_64
 0xA2

	)

735 
	#HT_CAPTYPE_UNITID_CLUMP
 0x90

	)

736 
	#HT_CAPTYPE_EXTCONF
 0x98

	)

737 
	#HT_CAPTYPE_MSI_MAPPING
 0xA8

	)

738 
	#HT_MSI_FLAGS
 0x02

	)

739 
	#HT_MSI_FLAGS_ENABLE
 0x1

	)

740 
	#HT_MSI_FLAGS_FIXED
 0x2

	)

741 
	#HT_MSI_FIXED_ADDR
 0x00000000FEE00000ULL

	)

742 
	#HT_MSI_ADDR_LO
 0x04

	)

743 
	#HT_MSI_ADDR_LO_MASK
 0xFFF00000

	)

744 
	#HT_MSI_ADDR_HI
 0x08

	)

745 
	#HT_CAPTYPE_DIRECT_ROUTE
 0xB0

	)

746 
	#HT_CAPTYPE_VCSET
 0xB8

	)

747 
	#HT_CAPTYPE_ERROR_RETRY
 0xC0

	)

748 
	#HT_CAPTYPE_GEN3
 0xD0

	)

749 
	#HT_CAPTYPE_PM
 0xE0

	)

750 
	#HT_CAP_SIZEOF_LONG
 28

	)

751 
	#HT_CAP_SIZEOF_SHORT
 24

	)

754 
	#PCI_ARI_CAP
 0x04

	)

755 
	#PCI_ARI_CAP_MFVC
 0x0001

	)

756 
	#PCI_ARI_CAP_ACS
 0x0002

	)

757 
	#PCI_ARI_CAP_NFN
(
x
Ë(((xË>> 8Ë& 0xffË

	)

758 
	#PCI_ARI_CTRL
 0x06

	)

759 
	#PCI_ARI_CTRL_MFVC
 0x0001

	)

760 
	#PCI_ARI_CTRL_ACS
 0x0002

	)

761 
	#PCI_ARI_CTRL_FG
(
x
Ë(((xË>> 4Ë& 7Ë

	)

762 
	#PCI_EXT_CAP_ARI_SIZEOF
 8

	)

765 
	#PCI_ATS_CAP
 0x04

	)

766 
	#PCI_ATS_CAP_QDEP
(
x
Ë((xË& 0x1fË

	)

767 
	#PCI_ATS_MAX_QDEP
 32

	)

768 
	#PCI_ATS_CTRL
 0x06

	)

769 
	#PCI_ATS_CTRL_ENABLE
 0x8000

	)

770 
	#PCI_ATS_CTRL_STU
(
x
Ë((xË& 0x1fË

	)

771 
	#PCI_ATS_MIN_STU
 12

	)

772 
	#PCI_EXT_CAP_ATS_SIZEOF
 8

	)

775 
	#PCI_PRI_CTRL
 0x04

	)

776 
	#PCI_PRI_CTRL_ENABLE
 0x01

	)

777 
	#PCI_PRI_CTRL_RESET
 0x02

	)

778 
	#PCI_PRI_STATUS
 0x06

	)

779 
	#PCI_PRI_STATUS_RF
 0x001

	)

780 
	#PCI_PRI_STATUS_UPRGI
 0x002

	)

781 
	#PCI_PRI_STATUS_STOPPED
 0x100

	)

782 
	#PCI_PRI_MAX_REQ
 0x08

	)

783 
	#PCI_PRI_ALLOC_REQ
 0x0¯

	)

784 
	#PCI_EXT_CAP_PRI_SIZEOF
 16

	)

787 
	#PCI_PASID_CAP
 0x04

	)

788 
	#PCI_PASID_CAP_EXEC
 0x02

	)

789 
	#PCI_PASID_CAP_PRIV
 0x04

	)

790 
	#PCI_PASID_CTRL
 0x06

	)

791 
	#PCI_PASID_CTRL_ENABLE
 0x01

	)

792 
	#PCI_PASID_CTRL_EXEC
 0x02

	)

793 
	#PCI_PASID_CTRL_PRIV
 0x04

	)

794 
	#PCI_EXT_CAP_PASID_SIZEOF
 8

	)

797 
	#PCI_SRIOV_CAP
 0x04

	)

798 
	#PCI_SRIOV_CAP_VFM
 0x01

	)

799 
	#PCI_SRIOV_CAP_INTR
(
x
Ë((xË>> 21Ë

	)

800 
	#PCI_SRIOV_CTRL
 0x08

	)

801 
	#PCI_SRIOV_CTRL_VFE
 0x01

	)

802 
	#PCI_SRIOV_CTRL_VFM
 0x02

	)

803 
	#PCI_SRIOV_CTRL_INTR
 0x04

	)

804 
	#PCI_SRIOV_CTRL_MSE
 0x08

	)

805 
	#PCI_SRIOV_CTRL_ARI
 0x10

	)

806 
	#PCI_SRIOV_STATUS
 0x0®

	)

807 
	#PCI_SRIOV_STATUS_VFM
 0x01

	)

808 
	#PCI_SRIOV_INITIAL_VF
 0x0¯

	)

809 
	#PCI_SRIOV_TOTAL_VF
 0x0ê

	)

810 
	#PCI_SRIOV_NUM_VF
 0x10

	)

811 
	#PCI_SRIOV_FUNC_LINK
 0x12

	)

812 
	#PCI_SRIOV_VF_OFFSET
 0x14

	)

813 
	#PCI_SRIOV_VF_STRIDE
 0x16

	)

814 
	#PCI_SRIOV_VF_DID
 0x1®

	)

815 
	#PCI_SRIOV_SUP_PGSIZE
 0x1¯

	)

816 
	#PCI_SRIOV_SYS_PGSIZE
 0x20

	)

817 
	#PCI_SRIOV_BAR
 0x24

	)

818 
	#PCI_SRIOV_NUM_BARS
 6

	)

819 
	#PCI_SRIOV_VFM
 0x3¯

	)

820 
	#PCI_SRIOV_VFM_BIR
(
x
Ë((xË& 7Ë

	)

821 
	#PCI_SRIOV_VFM_OFFSET
(
x
Ë((xË& ~7Ë

	)

822 
	#PCI_SRIOV_VFM_UA
 0x0

	)

823 
	#PCI_SRIOV_VFM_MI
 0x1

	)

824 
	#PCI_SRIOV_VFM_MO
 0x2

	)

825 
	#PCI_SRIOV_VFM_AV
 0x3

	)

826 
	#PCI_EXT_CAP_SRIOV_SIZEOF
 64

	)

828 
	#PCI_LTR_MAX_SNOOP_LAT
 0x4

	)

829 
	#PCI_LTR_MAX_NOSNOOP_LAT
 0x6

	)

830 
	#PCI_LTR_VALUE_MASK
 0x000003ff

	)

831 
	#PCI_LTR_SCALE_MASK
 0x00001c00

	)

832 
	#PCI_LTR_SCALE_SHIFT
 10

	)

833 
	#PCI_EXT_CAP_LTR_SIZEOF
 8

	)

836 
	#PCI_ACS_CAP
 0x04

	)

837 
	#PCI_ACS_SV
 0x01

	)

838 
	#PCI_ACS_TB
 0x02

	)

839 
	#PCI_ACS_RR
 0x04

	)

840 
	#PCI_ACS_CR
 0x08

	)

841 
	#PCI_ACS_UF
 0x10

	)

842 
	#PCI_ACS_EC
 0x20

	)

843 
	#PCI_ACS_DT
 0x40

	)

844 
	#PCI_ACS_EGRESS_BITS
 0x05

	)

845 
	#PCI_ACS_CTRL
 0x06

	)

846 
	#PCI_ACS_EGRESS_CTL_V
 0x08

	)

848 
	#PCI_VSEC_HDR
 4

	)

849 
	#PCI_VSEC_HDR_LEN_SHIFT
 20

	)

852 
	#PCI_SATA_REGS
 4

	)

853 
	#PCI_SATA_REGS_MASK
 0xF

	)

854 
	#PCI_SATA_REGS_INLINE
 0xF

	)

855 
	#PCI_SATA_SIZEOF_SHORT
 8

	)

856 
	#PCI_SATA_SIZEOF_LONG
 16

	)

859 
	#PCI_REBAR_CTRL
 8

	)

860 
	#PCI_REBAR_CTRL_NBAR_MASK
 (7 << 5Ë

	)

861 
	#PCI_REBAR_CTRL_NBAR_SHIFT
 5

	)

864 
	#PCI_DPA_CAP
 4

	)

865 
	#PCI_DPA_CAP_SUBSTATE_MASK
 0x1F

	)

866 
	#PCI_DPA_BASE_SIZEOF
 16

	)

869 
	#PCI_TPH_CAP
 4

	)

870 
	#PCI_TPH_CAP_LOC_MASK
 0x600

	)

871 
	#PCI_TPH_LOC_NONE
 0x000

	)

872 
	#PCI_TPH_LOC_CAP
 0x200

	)

873 
	#PCI_TPH_LOC_MSIX
 0x400

	)

874 
	#PCI_TPH_CAP_ST_MASK
 0x07FF0000

	)

875 
	#PCI_TPH_CAP_ST_SHIFT
 16

	)

876 
	#PCI_TPH_BASE_SIZEOF
 12

	)

	@/usr/include/linux/posix_types.h

1 #i‚de‡
_LINUX_POSIX_TYPES_H


2 
	#_LINUX_POSIX_TYPES_H


	)

4 
	~<löux/°ddef.h
>

21 #unde‡
__FD_SETSIZE


22 
	#__FD_SETSIZE
 1024

	)

25 
	mfds_bôs
[
__FD_SETSIZE
 / (8 * ())];

26 } 
	t__kî√l_fd_£t
;

29 (*
	t__kî√l_sigh™dÀr_t
)();

32 
	t__kî√l_key_t
;

33 
	t__kî√l_mqd_t
;

35 
	~<asm/posix_ty≥s.h
>

	@/usr/include/linux/sysinfo.h

1 #i‚de‡
_LINUX_SYSINFO_H


2 
	#_LINUX_SYSINFO_H


	)

4 
	~<löux/ty≥s.h
>

6 
	#SI_LOAD_SHIFT
 16

	)

7 
	ssysöfo
 {

8 
__kî√l_l⁄g_t
 
	mu±ime
;

9 
__kî√l_ul⁄g_t
 
	mlﬂds
[3];

10 
__kî√l_ul⁄g_t
 
	mtŸÆøm
;

11 
__kî√l_ul⁄g_t
 
	m‰ìøm
;

12 
__kî√l_ul⁄g_t
 
	msh¨edøm
;

13 
__kî√l_ul⁄g_t
 
	mbuf„ºam
;

14 
__kî√l_ul⁄g_t
 
	mtŸÆsw≠
;

15 
__kî√l_ul⁄g_t
 
	m‰ìsw≠
;

16 
__u16
 
	m¥ocs
;

17 
__u16
 
	m∑d
;

18 
__kî√l_ul⁄g_t
 
	mtŸÆhigh
;

19 
__kî√l_ul⁄g_t
 
	m‰ìhigh
;

20 
__u32
 
	mmem_unô
;

21 
	m_f
[20-2*(
__kî√l_ul⁄g_t
)-(
__u32
)];

	@/usr/include/asm-generic/errno.h

1 #i‚de‡
_ASM_GENERIC_ERRNO_H


2 
	#_ASM_GENERIC_ERRNO_H


	)

4 
	~<asm-gíîic/î∫o-ba£.h
>

6 
	#EDEADLK
 35

	)

7 
	#ENAMETOOLONG
 36

	)

8 
	#ENOLCK
 37

	)

9 
	#ENOSYS
 38

	)

10 
	#ENOTEMPTY
 39

	)

11 
	#ELOOP
 40

	)

12 
	#EWOULDBLOCK
 
EAGAIN


	)

13 
	#ENOMSG
 42

	)

14 
	#EIDRM
 43

	)

15 
	#ECHRNG
 44

	)

16 
	#EL2NSYNC
 45

	)

17 
	#EL3HLT
 46

	)

18 
	#EL3RST
 47

	)

19 
	#ELNRNG
 48

	)

20 
	#EUNATCH
 49

	)

21 
	#ENOCSI
 50

	)

22 
	#EL2HLT
 51

	)

23 
	#EBADE
 52

	)

24 
	#EBADR
 53

	)

25 
	#EXFULL
 54

	)

26 
	#ENOANO
 55

	)

27 
	#EBADRQC
 56

	)

28 
	#EBADSLT
 57

	)

30 
	#EDEADLOCK
 
EDEADLK


	)

32 
	#EBFONT
 59

	)

33 
	#ENOSTR
 60

	)

34 
	#ENODATA
 61

	)

35 
	#ETIME
 62

	)

36 
	#ENOSR
 63

	)

37 
	#ENONET
 64

	)

38 
	#ENOPKG
 65

	)

39 
	#EREMOTE
 66

	)

40 
	#ENOLINK
 67

	)

41 
	#EADV
 68

	)

42 
	#ESRMNT
 69

	)

43 
	#ECOMM
 70

	)

44 
	#EPROTO
 71

	)

45 
	#EMULTIHOP
 72

	)

46 
	#EDOTDOT
 73

	)

47 
	#EBADMSG
 74

	)

48 
	#EOVERFLOW
 75

	)

49 
	#ENOTUNIQ
 76

	)

50 
	#EBADFD
 77

	)

51 
	#EREMCHG
 78

	)

52 
	#ELIBACC
 79

	)

53 
	#ELIBBAD
 80

	)

54 
	#ELIBSCN
 81

	)

55 
	#ELIBMAX
 82

	)

56 
	#ELIBEXEC
 83

	)

57 
	#EILSEQ
 84

	)

58 
	#ERESTART
 85

	)

59 
	#ESTRPIPE
 86

	)

60 
	#EUSERS
 87

	)

61 
	#ENOTSOCK
 88

	)

62 
	#EDESTADDRREQ
 89

	)

63 
	#EMSGSIZE
 90

	)

64 
	#EPROTOTYPE
 91

	)

65 
	#ENOPROTOOPT
 92

	)

66 
	#EPROTONOSUPPORT
 93

	)

67 
	#ESOCKTNOSUPPORT
 94

	)

68 
	#EOPNOTSUPP
 95

	)

69 
	#EPFNOSUPPORT
 96

	)

70 
	#EAFNOSUPPORT
 97

	)

71 
	#EADDRINUSE
 98

	)

72 
	#EADDRNOTAVAIL
 99

	)

73 
	#ENETDOWN
 100

	)

74 
	#ENETUNREACH
 101

	)

75 
	#ENETRESET
 102

	)

76 
	#ECONNABORTED
 103

	)

77 
	#ECONNRESET
 104

	)

78 
	#ENOBUFS
 105

	)

79 
	#EISCONN
 106

	)

80 
	#ENOTCONN
 107

	)

81 
	#ESHUTDOWN
 108

	)

82 
	#ETOOMANYREFS
 109

	)

83 
	#ETIMEDOUT
 110

	)

84 
	#ECONNREFUSED
 111

	)

85 
	#EHOSTDOWN
 112

	)

86 
	#EHOSTUNREACH
 113

	)

87 
	#EALREADY
 114

	)

88 
	#EINPROGRESS
 115

	)

89 
	#ESTALE
 116

	)

90 
	#EUCLEAN
 117

	)

91 
	#ENOTNAM
 118

	)

92 
	#ENAVAIL
 119

	)

93 
	#EISNAM
 120

	)

94 
	#EREMOTEIO
 121

	)

95 
	#EDQUOT
 122

	)

97 
	#ENOMEDIUM
 123

	)

98 
	#EMEDIUMTYPE
 124

	)

99 
	#ECANCELED
 125

	)

100 
	#ENOKEY
 126

	)

101 
	#EKEYEXPIRED
 127

	)

102 
	#EKEYREVOKED
 128

	)

103 
	#EKEYREJECTED
 129

	)

106 
	#EOWNERDEAD
 130

	)

107 
	#ENOTRECOVERABLE
 131

	)

109 
	#ERFKILL
 132

	)

111 
	#EHWPOISON
 133

	)

	@/usr/include/asm-generic/types.h

1 #i‚de‡
_ASM_GENERIC_TYPES_H


2 
	#_ASM_GENERIC_TYPES_H


	)

7 
	~<asm-gíîic/öt-Œ64.h
>

	@/usr/include/asm/ioctl.h

1 
	~<asm-gíîic/io˘l.h
>

	@/usr/include/asm/posix_types.h

1 #ifde‡
__i386__


2 
	~<asm/posix_ty≥s_32.h
>

3 #ñi‡
deföed
(
__ILP32__
)

4 
	~<asm/posix_ty≥s_x32.h
>

6 
	~<asm/posix_ty≥s_64.h
>

	@/usr/include/asm/processor-flags.h

1 #i‚de‡
_ASM_X86_PROCESSOR_FLAGS_H


2 
	#_ASM_X86_PROCESSOR_FLAGS_H


	)

5 
	~<löux/c⁄°.h
>

10 
	#X86_EFLAGS_CF_BIT
 0

	)

11 
	#X86_EFLAGS_CF
 
	`_BITUL
(
X86_EFLAGS_CF_BIT
)

	)

12 
	#X86_EFLAGS_FIXED_BIT
 1

	)

13 
	#X86_EFLAGS_FIXED
 
	`_BITUL
(
X86_EFLAGS_FIXED_BIT
)

	)

14 
	#X86_EFLAGS_PF_BIT
 2

	)

15 
	#X86_EFLAGS_PF
 
	`_BITUL
(
X86_EFLAGS_PF_BIT
)

	)

16 
	#X86_EFLAGS_AF_BIT
 4

	)

17 
	#X86_EFLAGS_AF
 
	`_BITUL
(
X86_EFLAGS_AF_BIT
)

	)

18 
	#X86_EFLAGS_ZF_BIT
 6

	)

19 
	#X86_EFLAGS_ZF
 
	`_BITUL
(
X86_EFLAGS_ZF_BIT
)

	)

20 
	#X86_EFLAGS_SF_BIT
 7

	)

21 
	#X86_EFLAGS_SF
 
	`_BITUL
(
X86_EFLAGS_SF_BIT
)

	)

22 
	#X86_EFLAGS_TF_BIT
 8

	)

23 
	#X86_EFLAGS_TF
 
	`_BITUL
(
X86_EFLAGS_TF_BIT
)

	)

24 
	#X86_EFLAGS_IF_BIT
 9

	)

25 
	#X86_EFLAGS_IF
 
	`_BITUL
(
X86_EFLAGS_IF_BIT
)

	)

26 
	#X86_EFLAGS_DF_BIT
 10

	)

27 
	#X86_EFLAGS_DF
 
	`_BITUL
(
X86_EFLAGS_DF_BIT
)

	)

28 
	#X86_EFLAGS_OF_BIT
 11

	)

29 
	#X86_EFLAGS_OF
 
	`_BITUL
(
X86_EFLAGS_OF_BIT
)

	)

30 
	#X86_EFLAGS_IOPL_BIT
 12

	)

31 
	#X86_EFLAGS_IOPL
 (
	`_AC
(3,
UL
Ë<< 
X86_EFLAGS_IOPL_BIT
)

	)

32 
	#X86_EFLAGS_NT_BIT
 14

	)

33 
	#X86_EFLAGS_NT
 
	`_BITUL
(
X86_EFLAGS_NT_BIT
)

	)

34 
	#X86_EFLAGS_RF_BIT
 16

	)

35 
	#X86_EFLAGS_RF
 
	`_BITUL
(
X86_EFLAGS_RF_BIT
)

	)

36 
	#X86_EFLAGS_VM_BIT
 17

	)

37 
	#X86_EFLAGS_VM
 
	`_BITUL
(
X86_EFLAGS_VM_BIT
)

	)

38 
	#X86_EFLAGS_AC_BIT
 18

	)

39 
	#X86_EFLAGS_AC
 
	`_BITUL
(
X86_EFLAGS_AC_BIT
)

	)

40 
	#X86_EFLAGS_AC_BIT
 18

	)

41 
	#X86_EFLAGS_AC
 
	`_BITUL
(
X86_EFLAGS_AC_BIT
)

	)

42 
	#X86_EFLAGS_VIF_BIT
 19

	)

43 
	#X86_EFLAGS_VIF
 
	`_BITUL
(
X86_EFLAGS_VIF_BIT
)

	)

44 
	#X86_EFLAGS_VIP_BIT
 20

	)

45 
	#X86_EFLAGS_VIP
 
	`_BITUL
(
X86_EFLAGS_VIP_BIT
)

	)

46 
	#X86_EFLAGS_ID_BIT
 21

	)

47 
	#X86_EFLAGS_ID
 
	`_BITUL
(
X86_EFLAGS_ID_BIT
)

	)

52 
	#X86_CR0_PE_BIT
 0

	)

53 
	#X86_CR0_PE
 
	`_BITUL
(
X86_CR0_PE_BIT
)

	)

54 
	#X86_CR0_MP_BIT
 1

	)

55 
	#X86_CR0_MP
 
	`_BITUL
(
X86_CR0_MP_BIT
)

	)

56 
	#X86_CR0_EM_BIT
 2

	)

57 
	#X86_CR0_EM
 
	`_BITUL
(
X86_CR0_EM_BIT
)

	)

58 
	#X86_CR0_TS_BIT
 3

	)

59 
	#X86_CR0_TS
 
	`_BITUL
(
X86_CR0_TS_BIT
)

	)

60 
	#X86_CR0_ET_BIT
 4

	)

61 
	#X86_CR0_ET
 
	`_BITUL
(
X86_CR0_ET_BIT
)

	)

62 
	#X86_CR0_NE_BIT
 5

	)

63 
	#X86_CR0_NE
 
	`_BITUL
(
X86_CR0_NE_BIT
)

	)

64 
	#X86_CR0_WP_BIT
 16

	)

65 
	#X86_CR0_WP
 
	`_BITUL
(
X86_CR0_WP_BIT
)

	)

66 
	#X86_CR0_AM_BIT
 18

	)

67 
	#X86_CR0_AM
 
	`_BITUL
(
X86_CR0_AM_BIT
)

	)

68 
	#X86_CR0_NW_BIT
 29

	)

69 
	#X86_CR0_NW
 
	`_BITUL
(
X86_CR0_NW_BIT
)

	)

70 
	#X86_CR0_CD_BIT
 30

	)

71 
	#X86_CR0_CD
 
	`_BITUL
(
X86_CR0_CD_BIT
)

	)

72 
	#X86_CR0_PG_BIT
 31

	)

73 
	#X86_CR0_PG
 
	`_BITUL
(
X86_CR0_PG_BIT
)

	)

78 
	#X86_CR3_PWT_BIT
 3

	)

79 
	#X86_CR3_PWT
 
	`_BITUL
(
X86_CR3_PWT_BIT
)

	)

80 
	#X86_CR3_PCD_BIT
 4

	)

81 
	#X86_CR3_PCD
 
	`_BITUL
(
X86_CR3_PCD_BIT
)

	)

82 
	#X86_CR3_PCID_MASK
 
	`_AC
(0x00000fff,
UL
Ë

	)

87 
	#X86_CR4_VME_BIT
 0

	)

88 
	#X86_CR4_VME
 
	`_BITUL
(
X86_CR4_VME_BIT
)

	)

89 
	#X86_CR4_PVI_BIT
 1

	)

90 
	#X86_CR4_PVI
 
	`_BITUL
(
X86_CR4_PVI_BIT
)

	)

91 
	#X86_CR4_TSD_BIT
 2

	)

92 
	#X86_CR4_TSD
 
	`_BITUL
(
X86_CR4_TSD_BIT
)

	)

93 
	#X86_CR4_DE_BIT
 3

	)

94 
	#X86_CR4_DE
 
	`_BITUL
(
X86_CR4_DE_BIT
)

	)

95 
	#X86_CR4_PSE_BIT
 4

	)

96 
	#X86_CR4_PSE
 
	`_BITUL
(
X86_CR4_PSE_BIT
)

	)

97 
	#X86_CR4_PAE_BIT
 5

	)

98 
	#X86_CR4_PAE
 
	`_BITUL
(
X86_CR4_PAE_BIT
)

	)

99 
	#X86_CR4_MCE_BIT
 6

	)

100 
	#X86_CR4_MCE
 
	`_BITUL
(
X86_CR4_MCE_BIT
)

	)

101 
	#X86_CR4_PGE_BIT
 7

	)

102 
	#X86_CR4_PGE
 
	`_BITUL
(
X86_CR4_PGE_BIT
)

	)

103 
	#X86_CR4_PCE_BIT
 8

	)

104 
	#X86_CR4_PCE
 
	`_BITUL
(
X86_CR4_PCE_BIT
)

	)

105 
	#X86_CR4_OSFXSR_BIT
 9

	)

106 
	#X86_CR4_OSFXSR
 
	`_BITUL
(
X86_CR4_OSFXSR_BIT
)

	)

107 
	#X86_CR4_OSXMMEXCPT_BIT
 10

	)

108 
	#X86_CR4_OSXMMEXCPT
 
	`_BITUL
(
X86_CR4_OSXMMEXCPT_BIT
)

	)

109 
	#X86_CR4_VMXE_BIT
 13

	)

110 
	#X86_CR4_VMXE
 
	`_BITUL
(
X86_CR4_VMXE_BIT
)

	)

111 
	#X86_CR4_SMXE_BIT
 14

	)

112 
	#X86_CR4_SMXE
 
	`_BITUL
(
X86_CR4_SMXE_BIT
)

	)

113 
	#X86_CR4_FSGSBASE_BIT
 16

	)

114 
	#X86_CR4_FSGSBASE
 
	`_BITUL
(
X86_CR4_FSGSBASE_BIT
)

	)

115 
	#X86_CR4_PCIDE_BIT
 17

	)

116 
	#X86_CR4_PCIDE
 
	`_BITUL
(
X86_CR4_PCIDE_BIT
)

	)

117 
	#X86_CR4_OSXSAVE_BIT
 18

	)

118 
	#X86_CR4_OSXSAVE
 
	`_BITUL
(
X86_CR4_OSXSAVE_BIT
)

	)

119 
	#X86_CR4_SMEP_BIT
 20

	)

120 
	#X86_CR4_SMEP
 
	`_BITUL
(
X86_CR4_SMEP_BIT
)

	)

121 
	#X86_CR4_SMAP_BIT
 21

	)

122 
	#X86_CR4_SMAP
 
	`_BITUL
(
X86_CR4_SMAP_BIT
)

	)

127 
	#X86_CR8_TPR
 
	`_AC
(0x0000000f,
UL
Ë

	)

136 
	#CX86_PCR0
 0x20

	)

137 
	#CX86_GCR
 0xb8

	)

138 
	#CX86_CCR0
 0xc0

	)

139 
	#CX86_CCR1
 0xc1

	)

140 
	#CX86_CCR2
 0xc2

	)

141 
	#CX86_CCR3
 0xc3

	)

142 
	#CX86_CCR4
 0xe8

	)

143 
	#CX86_CCR5
 0xe9

	)

144 
	#CX86_CCR6
 0xó

	)

145 
	#CX86_CCR7
 0xeb

	)

146 
	#CX86_PCR1
 0xf0

	)

147 
	#CX86_DIR0
 0x„

	)

148 
	#CX86_DIR1
 0xff

	)

149 
	#CX86_ARR_BASE
 0xc4

	)

150 
	#CX86_RCR_BASE
 0xdc

	)

	@/usr/include/asm/ptrace-abi.h

1 #i‚de‡
_ASM_X86_PTRACE_ABI_H


2 
	#_ASM_X86_PTRACE_ABI_H


	)

4 #ifde‡
__i386__


6 
	#EBX
 0

	)

7 
	#ECX
 1

	)

8 
	#EDX
 2

	)

9 
	#ESI
 3

	)

10 
	#EDI
 4

	)

11 
	#EBP
 5

	)

12 
	#EAX
 6

	)

13 
	#DS
 7

	)

14 
	#ES
 8

	)

15 
	#FS
 9

	)

16 
	#GS
 10

	)

17 
	#ORIG_EAX
 11

	)

18 
	#EIP
 12

	)

19 
	#CS
 13

	)

20 
	#EFL
 14

	)

21 
	#UESP
 15

	)

22 
	#SS
 16

	)

23 
	#FRAME_SIZE
 17

	)

27 #i‡
deföed
(
__ASSEMBLY__
Ë|| deföed(
__FRAME_OFFSETS
)

28 
	#R15
 0

	)

29 
	#R14
 8

	)

30 
	#R13
 16

	)

31 
	#R12
 24

	)

32 
	#RBP
 32

	)

33 
	#RBX
 40

	)

35 
	#R11
 48

	)

36 
	#R10
 56

	)

37 
	#R9
 64

	)

38 
	#R8
 72

	)

39 
	#RAX
 80

	)

40 
	#RCX
 88

	)

41 
	#RDX
 96

	)

42 
	#RSI
 104

	)

43 
	#RDI
 112

	)

44 
	#ORIG_RAX
 120

	)

47 
	#RIP
 128

	)

48 
	#CS
 136

	)

49 
	#EFLAGS
 144

	)

50 
	#RSP
 152

	)

51 
	#SS
 160

	)

52 
	#ARGOFFSET
 
R11


	)

56 
	#FRAME_SIZE
 168

	)

61 
	#PTRACE_GETREGS
 12

	)

62 
	#PTRACE_SETREGS
 13

	)

63 
	#PTRACE_GETFPREGS
 14

	)

64 
	#PTRACE_SETFPREGS
 15

	)

65 
	#PTRACE_GETFPXREGS
 18

	)

66 
	#PTRACE_SETFPXREGS
 19

	)

68 
	#PTRACE_OLDSETOPTIONS
 21

	)

71 
	#PTRACE_GET_THREAD_AREA
 25

	)

72 
	#PTRACE_SET_THREAD_AREA
 26

	)

74 #ifde‡
__x86_64__


75 
	#PTRACE_ARCH_PRCTL
 30

	)

78 
	#PTRACE_SYSEMU
 31

	)

79 
	#PTRACE_SYSEMU_SINGLESTEP
 32

	)

81 
	#PTRACE_SINGLEBLOCK
 33

	)

83 #i‚de‡
__ASSEMBLY__


84 
	~<löux/ty≥s.h
>

	@/usr/include/gnu/stubs.h

6 #i‡!
deföed
 
__x86_64__


7 
	~<gnu/°ubs-32.h
>

9 #i‡
deföed
 
__x86_64__
 && deföed 
__LP64__


10 
	~<gnu/°ubs-64.h
>

12 #i‡
deföed
 
__x86_64__
 && deföed 
__ILP32__


13 
	~<gnu/°ubs-x32.h
>

	@/usr/include/linux/stddef.h

	@/usr/include/stdc-predef.h

18 #i‚def 
_STDC_PREDEF_H


19 
	#_STDC_PREDEF_H
 1

	)

36 #ifde‡
__GCC_IEC_559


37 #i‡
__GCC_IEC_559
 > 0

38 
	#__STDC_IEC_559__
 1

	)

41 
	#__STDC_IEC_559__
 1

	)

44 #ifde‡
__GCC_IEC_559_COMPLEX


45 #i‡
__GCC_IEC_559_COMPLEX
 > 0

46 
	#__STDC_IEC_559_COMPLEX__
 1

	)

49 
	#__STDC_IEC_559_COMPLEX__
 1

	)

54 
	#__STDC_ISO_10646__
 201103L

	)

57 
	#__STDC_NO_THREADS__
 1

	)

	@/usr/include/sys/cdefs.h

18 #i‚def 
_SYS_CDEFS_H


19 
	#_SYS_CDEFS_H
 1

	)

22 #i‚de‡
_FEATURES_H


23 
	~<„©uªs.h
>

29 #i‡
deföed
 
__GNUC__
 && !deföed 
__STDC__


34 #unde‡
__P


35 #unde‡
__PMT


37 #ifde‡
__GNUC__


41 #i‡
__GNUC_PREREQ
 (4, 6Ë&& !
deföed
 
_LIBC


42 
	#__LEAF
 , 
__Àaf__


	)

43 
	#__LEAF_ATTR
 
	`__©åibuã__
 ((
__Àaf__
))

	)

45 
	#__LEAF


	)

46 
	#__LEAF_ATTR


	)

54 #i‡!
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (3, 3)

55 
	#__THROW
 
	`__©åibuã__
 ((
__nŸhrow__
 
__LEAF
))

	)

56 
	#__THROWNL
 
	`__©åibuã__
 ((
__nŸhrow__
))

	)

57 
	#__NTH
(
f˘
Ë
	`__©åibuã__
 ((
__nŸhrow__
 
__LEAF
)Ë
	)
fct

59 #i‡
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (2,8)

60 
	#__THROW
 
	`throw
 ()

	)

61 
	#__THROWNL
 
	`throw
 ()

	)

62 
	#__NTH
(
f˘
Ë
__LEAF_ATTR
 f˘ 
	`throw
 ()

	)

64 
	#__THROW


	)

65 
	#__THROWNL


	)

66 
	#__NTH
(
f˘
Ë
	)
fct

72 
	#__ölöe


	)

74 
	#__THROW


	)

75 
	#__THROWNL


	)

76 
	#__NTH
(
f˘
Ë
	)
fct

82 
	#__P
(
¨gs
Ë
	)
args

83 
	#__PMT
(
¨gs
Ë
	)
args

88 
	#__CONCAT
(
x
,
y
Ëx ## 
	)
y

89 
	#__STRING
(
x
Ë#x

	)

92 
	#__±r_t
 *

	)

93 
	#__l⁄g_doubÀ_t
 

	)

97 #ifdef 
__˝lu•lus


98 
	#__BEGIN_DECLS
 "C" {

	)

99 
	#__END_DECLS
 }

	)

101 
	#__BEGIN_DECLS


	)

102 
	#__END_DECLS


	)

111 #i‡
deföed
 
__˝lu•lus
 && deföed 
_GLIBCPP_USE_NAMESPACES


112 
	#__BEGIN_NAMESPACE_STD
 
«me•a˚
 
°d
 {

	)

113 
	#__END_NAMESPACE_STD
 }

	)

114 
	#__USING_NAMESPACE_STD
(
«me
Ë
usög
 
°d
::«me;

	)

115 
	#__BEGIN_NAMESPACE_C99
 
«me•a˚
 
__c99
 {

	)

116 
	#__END_NAMESPACE_C99
 }

	)

117 
	#__USING_NAMESPACE_C99
(
«me
Ë
usög
 
__c99
::«me;

	)

122 
	#__BEGIN_NAMESPACE_STD


	)

123 
	#__END_NAMESPACE_STD


	)

124 
	#__USING_NAMESPACE_STD
(
«me
)

	)

125 
	#__BEGIN_NAMESPACE_C99


	)

126 
	#__END_NAMESPACE_C99


	)

127 
	#__USING_NAMESPACE_C99
(
«me
)

	)

132 
	#__bos
(
±r
Ë
	`__buûtö_obje˘_size
 (±r, 
__USE_FORTIFY_LEVEL
 > 1)

	)

133 
	#__bos0
(
±r
Ë
	`__buûtö_obje˘_size
 (±r, 0)

	)

134 
	#__f‹tify_fun˘i⁄
 
__exã∫_Æways_ölöe
 
__©åibuã_¨tificül__


	)

136 #i‡
__GNUC_PREREQ
 (4,3)

137 
	#__w¨nde˛
(
«me
, 
msg
) \

138 
	`«me
 (Ë
	`__©åibuã__
((
	`__w¨nög__
 (
msg
)))

	)

139 
	#__w¨«âr
(
msg
Ë
	`__©åibuã__
((
	`__w¨nög__
 (msg)))

	)

140 
	#__îr‹de˛
(
«me
, 
msg
) \

141 
	`«me
 (Ë
	`__©åibuã__
((
	`__îr‹__
 (
msg
)))

	)

143 
	#__w¨nde˛
(
«me
, 
msg
Ë
	`«me
 ()

	)

144 
	#__w¨«âr
(
msg
)

	)

145 
	#__îr‹de˛
(
«me
, 
msg
Ë
	`«me
 ()

	)

149 #i‡
__GNUC_PREREQ
 (2,97)

151 
	#__Êex¨r
 []

	)

153 #ifde‡
__GNUC__


154 
	#__Êex¨r
 [0]

	)

156 #i‡
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

157 
	#__Êex¨r
 []

	)

160 
	#__Êex¨r
 [1]

	)

176 #i‡
deföed
 
__GNUC__
 && __GNUC__ >= 2

178 
	#__REDIRECT
(
«me
, 
¥Ÿo
, 
Æüs
Ë«mê¥Ÿÿ
	`__asm__
 (
	`__ASMNAME
 (#Æüs))

	)

179 #ifde‡
__˝lu•lus


180 
	#__REDIRECT_NTH
(
«me
, 
¥Ÿo
, 
Æüs
) \

181 
«me
 
¥Ÿo
 
__THROW
 
	`__asm__
 (
	`__ASMNAME
 (#Æüs))

	)

182 
	#__REDIRECT_NTHNL
(
«me
, 
¥Ÿo
, 
Æüs
) \

183 
«me
 
¥Ÿo
 
__THROWNL
 
	`__asm__
 (
	`__ASMNAME
 (#Æüs))

	)

185 
	#__REDIRECT_NTH
(
«me
, 
¥Ÿo
, 
Æüs
) \

186 
«me
 
¥Ÿo
 
	`__asm__
 (
	`__ASMNAME
 (#Æüs)Ë
__THROW


	)

187 
	#__REDIRECT_NTHNL
(
«me
, 
¥Ÿo
, 
Æüs
) \

188 
«me
 
¥Ÿo
 
	`__asm__
 (
	`__ASMNAME
 (#Æüs)Ë
__THROWNL


	)

190 
	#__ASMNAME
(
˙ame
Ë
	`__ASMNAME2
 (
__USER_LABEL_PREFIX__
, c«me)

	)

191 
	#__ASMNAME2
(
¥efix
, 
˙ame
Ë
	`__STRING
 (¥efixË
	)
cname

204 #i‡!
deföed
 
__GNUC__
 || __GNUC__ < 2

205 
	#__©åibuã__
(
xyz
Ë

	)

211 #i‡
__GNUC_PREREQ
 (2,96)

212 
	#__©åibuã_mÆloc__
 
	`__©åibuã__
 ((
__mÆloc__
))

	)

214 
	#__©åibuã_mÆloc__


	)

219 #i‡
__GNUC_PREREQ
 (4, 3)

220 
	#__©åibuã_Æloc_size__
(
∑øms
) \

221 
	`__©åibuã__
 ((
__Æloc_size__
 
∑øms
))

	)

223 
	#__©åibuã_Æloc_size__
(
∑øms
Ë

	)

229 #i‡
__GNUC_PREREQ
 (2,96)

230 
	#__©åibuã_puª__
 
	`__©åibuã__
 ((
__puª__
))

	)

232 
	#__©åibuã_puª__


	)

236 #i‡
__GNUC_PREREQ
 (2,5)

237 
	#__©åibuã_c⁄°__
 
	`__©åibuã__
 ((
__c⁄°__
))

	)

239 
	#__©åibuã_c⁄°__


	)

245 #i‡
__GNUC_PREREQ
 (3,1)

246 
	#__©åibuã_u£d__
 
	`__©åibuã__
 ((
__u£d__
))

	)

247 
	#__©åibuã_noölöe__
 
	`__©åibuã__
 ((
__noölöe__
))

	)

249 
	#__©åibuã_u£d__
 
	`__©åibuã__
 ((
__unu£d__
))

	)

250 
	#__©åibuã_noölöe__


	)

254 #i‡
__GNUC_PREREQ
 (3,2)

255 
	#__©åibuã_dïªˇãd__
 
	`__©åibuã__
 ((
__dïªˇãd__
))

	)

257 
	#__©åibuã_dïªˇãd__


	)

266 #i‡
__GNUC_PREREQ
 (2,8)

267 
	#__©åibuã_f‹m©_¨g__
(
x
Ë
	`__©åibuã__
 ((
	`__f‹m©_¨g__
 (x)))

	)

269 
	#__©åibuã_f‹m©_¨g__
(
x
Ë

	)

276 #i‡
__GNUC_PREREQ
 (2,97)

277 
	#__©åibuã_f‹m©_°rfm⁄__
(
a
,
b
) \

278 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__°rfm⁄__
, 
a
, 
b
)))

	)

280 
	#__©åibuã_f‹m©_°rfm⁄__
(
a
,
b
Ë

	)

285 #i‡
__GNUC_PREREQ
 (3,3)

286 
	#__n⁄nuŒ
(
∑øms
Ë
	`__©åibuã__
 ((
__n⁄nuŒ__
Ö¨ams))

	)

288 
	#__n⁄nuŒ
(
∑øms
)

	)

293 #i‡
__GNUC_PREREQ
 (3,4)

294 
	#__©åibuã_w¨n_unu£d_ªsu…__
 \

295 
	`__©åibuã__
 ((
__w¨n_unu£d_ªsu…__
))

	)

296 #i‡
__USE_FORTIFY_LEVEL
 > 0

297 
	#__wur
 
__©åibuã_w¨n_unu£d_ªsu…__


	)

300 
	#__©åibuã_w¨n_unu£d_ªsu…__


	)

302 #i‚de‡
__wur


303 
	#__wur


	)

307 #i‡
__GNUC_PREREQ
 (3,2)

308 
	#__Æways_ölöe
 
__ölöe
 
	`__©åibuã__
 ((
__Æways_ölöe__
))

	)

310 
	#__Æways_ölöe
 
__ölöe


	)

315 #i‡
__GNUC_PREREQ
 (4,3)

316 
	#__©åibuã_¨tificül__
 
	`__©åibuã__
 ((
__¨tificül__
))

	)

318 
	#__©åibuã_¨tificül__


	)

321 #ifde‡
__GNUC__


326 #i‡
deföed
 
__GNUC_STDC_INLINE__
 || deföed 
__GNUC_GNU_INLINE__


327 
	#__exã∫_ölöe
 
__ölöe
 
	`__©åibuã__
 ((
__gnu_ölöe__
))

	)

328 
	#__exã∫_Æways_ölöe
 \

329 
__Æways_ölöe
 
	`__©åibuã__
 ((
__gnu_ölöe__
))

	)

331 
	#__exã∫_ölöe
 
__ölöe


	)

332 
	#__exã∫_Æways_ölöe
 
__Æways_ölöe


	)

335 
	#__exã∫_ölöe


	)

336 
	#__exã∫_Æways_ölöe


	)

341 #i‡
__GNUC_PREREQ
 (4,3)

342 
	#__va_¨g_∑ck
(Ë
	`__buûtö_va_¨g_∑ck
 ()

	)

343 
	#__va_¨g_∑ck_Àn
(Ë
	`__buûtö_va_¨g_∑ck_Àn
 ()

	)

350 #i‡!
__GNUC_PREREQ
 (2,8)

351 
	#__exãnsi⁄__


	)

355 #i‡!
__GNUC_PREREQ
 (2,92)

356 
	#__ª°ri˘


	)

362 #i‡
__GNUC_PREREQ
 (3,1Ë&& !
deföed
 
__GNUG__


363 
	#__ª°ri˘_¨r
 
__ª°ri˘


	)

365 #ifde‡
__GNUC__


366 
	#__ª°ri˘_¨r


	)

368 #i‡
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

369 
	#__ª°ri˘_¨r
 
ª°ri˘


	)

372 
	#__ª°ri˘_¨r


	)

377 #i‡
__GNUC__
 >= 3

378 
	#__glibc_u∆ikñy
(
c⁄d
Ë
	`__buûtö_ex≥˘
 ((c⁄d), 0)

	)

379 
	#__glibc_likñy
(
c⁄d
Ë
	`__buûtö_ex≥˘
 ((c⁄d), 1)

	)

381 
	#__glibc_u∆ikñy
(
c⁄d
Ë(c⁄d)

	)

382 
	#__glibc_likñy
(
c⁄d
Ë(c⁄d)

	)

385 
	~<bôs/w‹dsize.h
>

387 #i‡
deföed
 
__LONG_DOUBLE_MATH_OPTIONAL
 && deföed 
__NO_LONG_DOUBLE_MATH


388 
	#__LDBL_COMPAT
 1

	)

389 #ifde‡
__REDIRECT


390 
	#__LDBL_REDIR1
(
«me
, 
¥Ÿo
, 
Æüs
Ë
	`__REDIRECT
 («me,ÖrŸo,álüs)

	)

391 
	#__LDBL_REDIR
(
«me
, 
¥Ÿo
) \

392 
	`__LDBL_REDIR1
 (
«me
, 
¥Ÿo
, 
__∆dbl_
##«me)

	)

393 
	#__LDBL_REDIR1_NTH
(
«me
, 
¥Ÿo
, 
Æüs
Ë
	`__REDIRECT_NTH
 («me,ÖrŸo,álüs)

	)

394 
	#__LDBL_REDIR_NTH
(
«me
, 
¥Ÿo
) \

395 
	`__LDBL_REDIR1_NTH
 (
«me
, 
¥Ÿo
, 
__∆dbl_
##«me)

	)

396 
	#__LDBL_REDIR1_DECL
(
«me
, 
Æüs
) \

397 
	`__ty≥of
 (
«me
Ë«mê
	`__asm
 (
	`__ASMNAME
 (#Æüs));

	)

398 
	#__LDBL_REDIR_DECL
(
«me
) \

399 
	`__ty≥of
 (
«me
Ë«mê
	`__asm
 (
	`__ASMNAME
 ("__∆dbl_" #«me));

	)

400 
	#__REDIRECT_LDBL
(
«me
, 
¥Ÿo
, 
Æüs
) \

401 
	`__LDBL_REDIR1
 (
«me
, 
¥Ÿo
, 
__∆dbl_
##
Æüs
)

	)

402 
	#__REDIRECT_NTH_LDBL
(
«me
, 
¥Ÿo
, 
Æüs
) \

403 
	`__LDBL_REDIR1_NTH
 (
«me
, 
¥Ÿo
, 
__∆dbl_
##
Æüs
)

	)

406 #i‡!
deföed
 
__LDBL_COMPAT
 || !deföed 
__REDIRECT


407 
	#__LDBL_REDIR1
(
«me
, 
¥Ÿo
, 
Æüs
Ë«mê
	)
proto

408 
	#__LDBL_REDIR
(
«me
, 
¥Ÿo
Ë«mê
	)
proto

409 
	#__LDBL_REDIR1_NTH
(
«me
, 
¥Ÿo
, 
Æüs
Ë«mê¥Ÿÿ
__THROW


	)

410 
	#__LDBL_REDIR_NTH
(
«me
, 
¥Ÿo
Ë«mê¥Ÿÿ
__THROW


	)

411 
	#__LDBL_REDIR_DECL
(
«me
)

	)

412 #ifde‡
__REDIRECT


413 
	#__REDIRECT_LDBL
(
«me
, 
¥Ÿo
, 
Æüs
Ë
	`__REDIRECT
 («me,ÖrŸo,álüs)

	)

414 
	#__REDIRECT_NTH_LDBL
(
«me
, 
¥Ÿo
, 
Æüs
) \

415 
	`__REDIRECT_NTH
 (
«me
, 
¥Ÿo
, 
Æüs
)

	)

	@/usr/include/asm-generic/errno-base.h

1 #i‚de‡
_ASM_GENERIC_ERRNO_BASE_H


2 
	#_ASM_GENERIC_ERRNO_BASE_H


	)

4 
	#EPERM
 1

	)

5 
	#ENOENT
 2

	)

6 
	#ESRCH
 3

	)

7 
	#EINTR
 4

	)

8 
	#EIO
 5

	)

9 
	#ENXIO
 6

	)

10 
	#E2BIG
 7

	)

11 
	#ENOEXEC
 8

	)

12 
	#EBADF
 9

	)

13 
	#ECHILD
 10

	)

14 
	#EAGAIN
 11

	)

15 
	#ENOMEM
 12

	)

16 
	#EACCES
 13

	)

17 
	#EFAULT
 14

	)

18 
	#ENOTBLK
 15

	)

19 
	#EBUSY
 16

	)

20 
	#EEXIST
 17

	)

21 
	#EXDEV
 18

	)

22 
	#ENODEV
 19

	)

23 
	#ENOTDIR
 20

	)

24 
	#EISDIR
 21

	)

25 
	#EINVAL
 22

	)

26 
	#ENFILE
 23

	)

27 
	#EMFILE
 24

	)

28 
	#ENOTTY
 25

	)

29 
	#ETXTBSY
 26

	)

30 
	#EFBIG
 27

	)

31 
	#ENOSPC
 28

	)

32 
	#ESPIPE
 29

	)

33 
	#EROFS
 30

	)

34 
	#EMLINK
 31

	)

35 
	#EPIPE
 32

	)

36 
	#EDOM
 33

	)

37 
	#ERANGE
 34

	)

	@/usr/include/asm-generic/int-ll64.h

8 #i‚de‡
_ASM_GENERIC_INT_LL64_H


9 
	#_ASM_GENERIC_INT_LL64_H


	)

11 
	~<asm/bô•îl⁄g.h
>

13 #i‚de‡
__ASSEMBLY__


19 
__sig√d__
 
	t__s8
;

20 
	t__u8
;

22 
__sig√d__
 
	t__s16
;

23 
	t__u16
;

25 
__sig√d__
 
	t__s32
;

26 
	t__u32
;

28 #ifde‡
__GNUC__


29 
__exãnsi⁄__
 
__sig√d__
 
	t__s64
;

30 
__exãnsi⁄__
 
	t__u64
;

32 
__sig√d__
 
	t__s64
;

33 
	t__u64
;

	@/usr/include/asm-generic/ioctl.h

1 #i‚de‡
_ASM_GENERIC_IOCTL_H


2 
	#_ASM_GENERIC_IOCTL_H


	)

22 
	#_IOC_NRBITS
 8

	)

23 
	#_IOC_TYPEBITS
 8

	)

30 #i‚de‡
_IOC_SIZEBITS


31 
	#_IOC_SIZEBITS
 14

	)

34 #i‚de‡
_IOC_DIRBITS


35 
	#_IOC_DIRBITS
 2

	)

38 
	#_IOC_NRMASK
 ((1 << 
_IOC_NRBITS
)-1)

	)

39 
	#_IOC_TYPEMASK
 ((1 << 
_IOC_TYPEBITS
)-1)

	)

40 
	#_IOC_SIZEMASK
 ((1 << 
_IOC_SIZEBITS
)-1)

	)

41 
	#_IOC_DIRMASK
 ((1 << 
_IOC_DIRBITS
)-1)

	)

43 
	#_IOC_NRSHIFT
 0

	)

44 
	#_IOC_TYPESHIFT
 (
_IOC_NRSHIFT
+
_IOC_NRBITS
)

	)

45 
	#_IOC_SIZESHIFT
 (
_IOC_TYPESHIFT
+
_IOC_TYPEBITS
)

	)

46 
	#_IOC_DIRSHIFT
 (
_IOC_SIZESHIFT
+
_IOC_SIZEBITS
)

	)

53 #i‚de‡
_IOC_NONE


54 
	#_IOC_NONE
 0U

	)

57 #i‚de‡
_IOC_WRITE


58 
	#_IOC_WRITE
 1U

	)

61 #i‚de‡
_IOC_READ


62 
	#_IOC_READ
 2U

	)

65 
	#_IOC
(
dú
,
ty≥
,
ƒ
,
size
) \

66 (((
dú
Ë<< 
_IOC_DIRSHIFT
) | \

67 ((
ty≥
Ë<< 
_IOC_TYPESHIFT
) | \

68 ((
ƒ
Ë<< 
_IOC_NRSHIFT
) | \

69 ((
size
Ë<< 
_IOC_SIZESHIFT
))

	)

71 
	#_IOC_TYPECHECK
(
t
Ë(—))

	)

74 
	#_IO
(
ty≥
,
ƒ
Ë
	`_IOC
(
_IOC_NONE
,—y≥),“r),0)

	)

75 
	#_IOR
(
ty≥
,
ƒ
,
size
Ë
	`_IOC
(
_IOC_READ
,—y≥),“r),(
	`_IOC_TYPECHECK
(size)))

	)

76 
	#_IOW
(
ty≥
,
ƒ
,
size
Ë
	`_IOC
(
_IOC_WRITE
,—y≥),“r),(
	`_IOC_TYPECHECK
(size)))

	)

77 
	#_IOWR
(
ty≥
,
ƒ
,
size
Ë
	`_IOC
(
_IOC_READ
|
_IOC_WRITE
,—y≥),“r),(
	`_IOC_TYPECHECK
(size)))

	)

78 
	#_IOR_BAD
(
ty≥
,
ƒ
,
size
Ë
	`_IOC
(
_IOC_READ
,—y≥),“r),(size))

	)

79 
	#_IOW_BAD
(
ty≥
,
ƒ
,
size
Ë
	`_IOC
(
_IOC_WRITE
,—y≥),“r),(size))

	)

80 
	#_IOWR_BAD
(
ty≥
,
ƒ
,
size
Ë
	`_IOC
(
_IOC_READ
|
_IOC_WRITE
,—y≥),“r),(size))

	)

83 
	#_IOC_DIR
(
ƒ
Ë((“rË>> 
_IOC_DIRSHIFT
Ë& 
_IOC_DIRMASK
)

	)

84 
	#_IOC_TYPE
(
ƒ
Ë((“rË>> 
_IOC_TYPESHIFT
Ë& 
_IOC_TYPEMASK
)

	)

85 
	#_IOC_NR
(
ƒ
Ë((“rË>> 
_IOC_NRSHIFT
Ë& 
_IOC_NRMASK
)

	)

86 
	#_IOC_SIZE
(
ƒ
Ë((“rË>> 
_IOC_SIZESHIFT
Ë& 
_IOC_SIZEMASK
)

	)

90 
	#IOC_IN
 (
_IOC_WRITE
 << 
_IOC_DIRSHIFT
)

	)

91 
	#IOC_OUT
 (
_IOC_READ
 << 
_IOC_DIRSHIFT
)

	)

92 
	#IOC_INOUT
 ((
_IOC_WRITE
|
_IOC_READ
Ë<< 
_IOC_DIRSHIFT
)

	)

93 
	#IOCSIZE_MASK
 (
_IOC_SIZEMASK
 << 
_IOC_SIZESHIFT
)

	)

94 
	#IOCSIZE_SHIFT
 (
_IOC_SIZESHIFT
)

	)

	@/usr/include/asm/posix_types_32.h

1 #i‚de‡
_ASM_X86_POSIX_TYPES_32_H


2 
	#_ASM_X86_POSIX_TYPES_32_H


	)

10 
	t__kî√l_mode_t
;

11 
	#__kî√l_mode_t
 
__kî√l_mode_t


	)

13 
	t__kî√l_ùc_pid_t
;

14 
	#__kî√l_ùc_pid_t
 
__kî√l_ùc_pid_t


	)

16 
	t__kî√l_uid_t
;

17 
	t__kî√l_gid_t
;

18 
	#__kî√l_uid_t
 
__kî√l_uid_t


	)

20 
	t__kî√l_ﬁd_dev_t
;

21 
	#__kî√l_ﬁd_dev_t
 
__kî√l_ﬁd_dev_t


	)

23 
	~<asm-gíîic/posix_ty≥s.h
>

	@/usr/include/asm/posix_types_64.h

1 #i‚de‡
_ASM_X86_POSIX_TYPES_64_H


2 
	#_ASM_X86_POSIX_TYPES_64_H


	)

10 
	t__kî√l_ﬁd_uid_t
;

11 
	t__kî√l_ﬁd_gid_t
;

12 
	#__kî√l_ﬁd_uid_t
 
__kî√l_ﬁd_uid_t


	)

14 
	t__kî√l_ﬁd_dev_t
;

15 
	#__kî√l_ﬁd_dev_t
 
__kî√l_ﬁd_dev_t


	)

17 
	~<asm-gíîic/posix_ty≥s.h
>

	@/usr/include/asm/posix_types_x32.h

1 #i‚de‡
_ASM_X86_POSIX_TYPES_X32_H


2 
	#_ASM_X86_POSIX_TYPES_X32_H


	)

13 
	t__kî√l_l⁄g_t
;

14 
	t__kî√l_ul⁄g_t
;

15 
	#__kî√l_l⁄g_t
 
__kî√l_l⁄g_t


	)

17 
	~<asm/posix_ty≥s_64.h
>

	@/usr/include/bits/wordsize.h

3 #i‡
deföed
 
__x86_64__
 && !deföed 
__ILP32__


4 
	#__WORDSIZE
 64

	)

6 
	#__WORDSIZE
 32

	)

9 #ifde‡
__x86_64__


10 
	#__WORDSIZE_TIME64_COMPAT32
 1

	)

12 
	#__SYSCALL_WORDSIZE
 64

	)

	@/usr/include/gnu/stubs-32.h

6 #ifde‡
_LIBC


7 #îr‹ 
Aµliˇti⁄s
 
may
 
nŸ
 
deföe
 
the
 
ma¸o
 
_LIBC


10 
	#__°ub_chÊags


	)

11 
	#__°ub_Áâach


	)

12 
	#__°ub_fchÊags


	)

13 
	#__°ub_fdëach


	)

14 
	#__°ub_gây


	)

15 
	#__°ub_lchmod


	)

16 
	#__°ub_ªvoke


	)

17 
	#__°ub_£éogö


	)

18 
	#__°ub_sigªtu∫


	)

19 
	#__°ub_s°k


	)

20 
	#__°ub_°ty


	)

	@/usr/include/gnu/stubs-64.h

6 #ifde‡
_LIBC


7 #îr‹ 
Aµliˇti⁄s
 
may
 
nŸ
 
deföe
 
the
 
ma¸o
 
_LIBC


10 
	#__°ub_bdÊush


	)

11 
	#__°ub_chÊags


	)

12 
	#__°ub_Áâach


	)

13 
	#__°ub_fchÊags


	)

14 
	#__°ub_fdëach


	)

15 
	#__°ub_gëmsg


	)

16 
	#__°ub_gây


	)

17 
	#__°ub_lchmod


	)

18 
	#__°ub_putmsg


	)

19 
	#__°ub_ªvoke


	)

20 
	#__°ub_£éogö


	)

21 
	#__°ub_sigªtu∫


	)

22 
	#__°ub_s°k


	)

23 
	#__°ub_°ty


	)

	@/usr/include/gnu/stubs-x32.h

6 #ifde‡
_LIBC


7 #îr‹ 
Aµliˇti⁄s
 
may
 
nŸ
 
deföe
 
the
 
ma¸o
 
_LIBC


10 
	#__°ub_bdÊush


	)

11 
	#__°ub_chÊags


	)

12 
	#__°ub_¸óã_moduÀ


	)

13 
	#__°ub_Áâach


	)

14 
	#__°ub_fchÊags


	)

15 
	#__°ub_fdëach


	)

16 
	#__°ub_gë_kî√l_syms


	)

17 
	#__°ub_gëmsg


	)

18 
	#__°ub_gây


	)

19 
	#__°ub_lchmod


	)

20 
	#__°ub_nfs£rv˘l


	)

21 
	#__°ub_putmsg


	)

22 
	#__°ub_quîy_moduÀ


	)

23 
	#__°ub_ªvoke


	)

24 
	#__°ub_£éogö


	)

25 
	#__°ub_sigªtu∫


	)

26 
	#__°ub_s°k


	)

27 
	#__°ub_°ty


	)

28 
	#__°ub_u£lib


	)

	@/usr/include/linux/const.h

3 #i‚de‡
_LINUX_CONST_H


4 
	#_LINUX_CONST_H


	)

15 #ifde‡
__ASSEMBLY__


16 
	#_AC
(
X
,
Y
Ë
	)
X

17 
	#_AT
(
T
,
X
Ë
	)
X

19 
	#__AC
(
X
,
Y
Ë(X##Y)

	)

20 
	#_AC
(
X
,
Y
Ë
	`__AC
(X,Y)

	)

21 
	#_AT
(
T
,
X
Ë((T)(X))

	)

24 
	#_BITUL
(
x
Ë(
	`_AC
(1,
UL
Ë<< (x))

	)

25 
	#_BITULL
(
x
Ë(
	`_AC
(1,
ULL
Ë<< (x))

	)

	@/usr/include/asm-generic/posix_types.h

1 #i‚de‡
__ASM_GENERIC_POSIX_TYPES_H


2 
	#__ASM_GENERIC_POSIX_TYPES_H


	)

4 
	~<asm/bô•îl⁄g.h
>

13 #i‚de‡
__kî√l_l⁄g_t


14 
	t__kî√l_l⁄g_t
;

15 
	t__kî√l_ul⁄g_t
;

18 #i‚de‡
__kî√l_öo_t


19 
__kî√l_ul⁄g_t
 
	t__kî√l_öo_t
;

22 #i‚de‡
__kî√l_mode_t


23 
	t__kî√l_mode_t
;

26 #i‚de‡
__kî√l_pid_t


27 
	t__kî√l_pid_t
;

30 #i‚de‡
__kî√l_ùc_pid_t


31 
	t__kî√l_ùc_pid_t
;

34 #i‚de‡
__kî√l_uid_t


35 
	t__kî√l_uid_t
;

36 
	t__kî√l_gid_t
;

39 #i‚de‡
__kî√l_su£c⁄ds_t


40 
__kî√l_l⁄g_t
 
	t__kî√l_su£c⁄ds_t
;

43 #i‚de‡
__kî√l_daddr_t


44 
	t__kî√l_daddr_t
;

47 #i‚de‡
__kî√l_uid32_t


48 
	t__kî√l_uid32_t
;

49 
	t__kî√l_gid32_t
;

52 #i‚de‡
__kî√l_ﬁd_uid_t


53 
__kî√l_uid_t
 
	t__kî√l_ﬁd_uid_t
;

54 
__kî√l_gid_t
 
	t__kî√l_ﬁd_gid_t
;

57 #i‚de‡
__kî√l_ﬁd_dev_t


58 
	t__kî√l_ﬁd_dev_t
;

65 #i‚de‡
__kî√l_size_t


66 #i‡
__BITS_PER_LONG
 != 64

67 
	t__kî√l_size_t
;

68 
	t__kî√l_ssize_t
;

69 
	t__kî√l_±rdiff_t
;

71 
__kî√l_ul⁄g_t
 
	t__kî√l_size_t
;

72 
__kî√l_l⁄g_t
 
	t__kî√l_ssize_t
;

73 
__kî√l_l⁄g_t
 
	t__kî√l_±rdiff_t
;

77 #i‚de‡
__kî√l_fsid_t


79 
	mvÆ
[2];

80 } 
	t__kî√l_fsid_t
;

86 
__kî√l_l⁄g_t
 
	t__kî√l_off_t
;

87 
	t__kî√l_loff_t
;

88 
__kî√l_l⁄g_t
 
	t__kî√l_time_t
;

89 
__kî√l_l⁄g_t
 
	t__kî√l_˛ock_t
;

90 
	t__kî√l_timî_t
;

91 
	t__kî√l_˛ockid_t
;

92 * 
	t__kî√l_ˇddr_t
;

93 
	t__kî√l_uid16_t
;

94 
	t__kî√l_gid16_t
;

	@/usr/include/asm/bitsperlong.h

1 #i‚de‡
__ASM_X86_BITSPERLONG_H


2 
	#__ASM_X86_BITSPERLONG_H


	)

4 #ifde‡
__x86_64__


5 
	#__BITS_PER_LONG
 64

	)

7 
	#__BITS_PER_LONG
 32

	)

10 
	~<asm-gíîic/bô•îl⁄g.h
>

	@/usr/include/asm-generic/bitsperlong.h

1 #i‚de‡
__ASM_GENERIC_BITS_PER_LONG


2 
	#__ASM_GENERIC_BITS_PER_LONG


	)

11 #i‚de‡
__BITS_PER_LONG


12 
	#__BITS_PER_LONG
 32

	)

	@
1
.
1
/usr/include
47
1338
nvme-core.c
nvme-scsi.c
/usr/include/linux/errno.h
/usr/include/linux/fs.h
/usr/include/linux/hdreg.h
/usr/include/linux/kdev_t.h
/usr/include/linux/kernel.h
/usr/include/linux/nvme.h
/usr/include/linux/pci.h
/usr/include/linux/ptrace.h
/usr/include/linux/sched.h
/usr/include/linux/types.h
/usr/include/scsi/scsi.h
/usr/include/scsi/sg.h
/usr/include/asm/errno.h
/usr/include/asm/ptrace.h
/usr/include/asm/types.h
/usr/include/features.h
/usr/include/linux/ioctl.h
/usr/include/linux/limits.h
/usr/include/linux/pci_regs.h
/usr/include/linux/posix_types.h
/usr/include/linux/sysinfo.h
/usr/include/asm-generic/errno.h
/usr/include/asm-generic/types.h
/usr/include/asm/ioctl.h
/usr/include/asm/posix_types.h
/usr/include/asm/processor-flags.h
/usr/include/asm/ptrace-abi.h
/usr/include/gnu/stubs.h
/usr/include/linux/stddef.h
/usr/include/stdc-predef.h
/usr/include/sys/cdefs.h
/usr/include/asm-generic/errno-base.h
/usr/include/asm-generic/int-ll64.h
/usr/include/asm-generic/ioctl.h
/usr/include/asm/posix_types_32.h
/usr/include/asm/posix_types_64.h
/usr/include/asm/posix_types_x32.h
/usr/include/bits/wordsize.h
/usr/include/gnu/stubs-32.h
/usr/include/gnu/stubs-64.h
/usr/include/gnu/stubs-x32.h
/usr/include/linux/const.h
/usr/include/asm-generic/posix_types.h
/usr/include/asm/bitsperlong.h
/usr/include/asm-generic/bitsperlong.h
